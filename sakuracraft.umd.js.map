{"version":3,"file":"sakuracraft.umd.js","sources":["../src/game/SakuraCraftGame.ts","../src/index.ts"],"sourcesContent":["/**\n * SakuraCraft Game Engine\n * A voxel-based browser game with cherry blossom aesthetics\n * \n * TypeScript version with full type annotations\n */\n\nimport type {\n  GameStats,\n  GameSettings,\n  SakuraCraftInitOptions,\n  ISakuraCraftEngine\n} from '../types';\n\nimport '../styles/game.css';\n\n// Extend Document and HTMLElement interfaces for webkit fullscreen APIs\ndeclare global {\n  interface Document {\n    webkitFullscreenElement?: Element;\n    webkitExitFullscreen?: () => Promise<void>;\n  }\n  \n  interface HTMLElement {\n    webkitRequestFullscreen?: () => Promise<void>;\n  }\n}\n\n// Game HTML template\nconst gameTemplate = `\n<!-- SakuraCraft Game HTML Template -->\n<!-- This file is inserted into the DOM when the game initializes -->\n\n<div class=\"minecraft-overlay\" id=\"minecraftGame\">\n  <div class=\"minecraft-title\">üå∏ SakuraCraft üå∏</div>\n  <div class=\"minecraft-container\">\n    <button class=\"minecraft-close\" id=\"closeMinecraft\">‚úï Close</button>\n    <canvas id=\"gameCanvas\" class=\"minecraft-canvas\" width=\"800\" height=\"500\"></canvas>\n    \n    <!-- Click to Play Overlay (required for pointer lock) -->\n    <div class=\"click-to-play active\" id=\"clickToPlay\">\n      <div class=\"click-to-play-text\">üéÆ Click to Play</div>\n      <div class=\"click-to-play-hint\">Mouse will be captured ‚Ä¢ Press ESC to pause</div>\n    </div>\n    \n    <!-- Pause Menu -->\n    <div class=\"pause-menu\" id=\"pauseMenu\">\n      <!-- Main Menu -->\n      <div class=\"pause-submenu active\" id=\"menuMain\">\n        <div class=\"pause-title\">‚è∏ Paused</div>\n        <div class=\"pause-buttons\">\n          <button class=\"pause-btn resume\" id=\"btnResume\">Resume</button>\n          <button class=\"pause-btn fullscreen\" id=\"btnFullscreen\">Fullscreen</button>\n          <button class=\"pause-btn disabled\" id=\"btnAccount\">Sign In</button>\n          <button class=\"pause-btn\" id=\"btnStats\">Stats</button>\n          <button class=\"pause-btn\" id=\"btnOptions\">Options</button>\n          <button class=\"pause-btn quit\" id=\"btnQuit\">Quit Game</button>\n        </div>\n      </div>\n      \n      <!-- Stats Menu -->\n      <div class=\"pause-submenu\" id=\"menuStats\">\n        <div class=\"submenu-title\">üìä Statistics</div>\n        <div class=\"submenu-content\">\n          <div class=\"stat-row\">\n            <span>Blocks Placed</span>\n            <span class=\"stat-value\" id=\"statPlaced\">0</span>\n          </div>\n          <div class=\"stat-row\">\n            <span>Blocks Broken</span>\n            <span class=\"stat-value\" id=\"statBroken\">0</span>\n          </div>\n          <div class=\"stat-row\">\n            <span>Distance Walked</span>\n            <span class=\"stat-value\" id=\"statDistance\">0m</span>\n          </div>\n          <div class=\"stat-row\">\n            <span>Jumps</span>\n            <span class=\"stat-value\" id=\"statJumps\">0</span>\n          </div>\n          <div class=\"stat-row\">\n            <span>Play Time</span>\n            <span class=\"stat-value\" id=\"statTime\">0:00</span>\n          </div>\n        </div>\n        <button class=\"back-btn\" id=\"statsBack\">‚Üê Back</button>\n      </div>\n      \n      <!-- Options Menu -->\n      <div class=\"pause-submenu\" id=\"menuOptions\">\n        <div class=\"submenu-title\">‚öôÔ∏è Options</div>\n        <div class=\"submenu-content\">\n          <div class=\"option-row\">\n            <span>Brightness</span>\n            <input type=\"range\" class=\"option-slider\" id=\"optBrightness\" min=\"50\" max=\"150\" value=\"100\">\n          </div>\n          <div class=\"option-row\">\n            <span>Color Filter</span>\n            <select class=\"option-select\" id=\"optFilter\">\n              <option value=\"none\">Normal</option>\n              <option value=\"sepia\">Sepia</option>\n              <option value=\"grayscale\">Black & White</option>\n              <option value=\"trippy\">Trippy Hyperbolic</option>\n            </select>\n          </div>\n          <div class=\"option-row\">\n            <span>Render Distance</span>\n            <select class=\"option-select\" id=\"optRenderDist\">\n              <option value=\"12\">Near (Fast)</option>\n              <option value=\"18\">Medium</option>\n              <option value=\"25\" selected>Far</option>\n              <option value=\"35\">Ultra</option>\n            </select>\n          </div>\n          <div class=\"option-row\">\n            <span>Shadows</span>\n            <div class=\"option-toggle on\" id=\"optShadows\" data-on=\"true\"></div>\n          </div>\n          <div class=\"option-row\">\n            <span>Enhanced Lighting</span>\n            <div class=\"option-toggle on\" id=\"optLighting\" data-on=\"true\"></div>\n          </div>\n          <div class=\"option-row\">\n            <span>Anti-Aliasing</span>\n            <div class=\"option-toggle\" id=\"optAA\" data-on=\"false\"></div>\n          </div>\n          <div class=\"option-row\">\n            <span>Show FPS</span>\n            <div class=\"option-toggle on\" id=\"optShowFps\" data-on=\"true\"></div>\n          </div>\n          <div class=\"option-row\">\n            <span>Target FPS: <span id=\"targetFpsValue\">60</span></span>\n            <input type=\"range\" min=\"15\" max=\"240\" value=\"60\" class=\"option-slider\" id=\"optTargetFps\">\n          </div>\n        </div>\n        <button class=\"back-btn\" id=\"optionsBack\">‚Üê Back</button>\n      </div>\n    </div>\n    \n    <!-- Inventory Screen -->\n    <div class=\"inventory-screen\" id=\"inventoryScreen\">\n      <!-- Content populated by JavaScript -->\n    </div>\n    \n    <div class=\"minecraft-ui\" id=\"gameUI\">\n      <div class=\"hotbar-slot selected\" data-block=\"grass\"></div>\n      <div class=\"hotbar-slot\" data-block=\"dirt\"></div>\n      <div class=\"hotbar-slot\" data-block=\"stone\"></div>\n      <div class=\"hotbar-slot\" data-block=\"wood\"></div>\n      <div class=\"hotbar-slot\" data-block=\"brick\"></div>\n      <div class=\"hotbar-slot\" data-item=\"water_bucket\"></div>\n      <div class=\"hotbar-slot\" data-item=\"lava_bucket\"></div>\n      <div class=\"hotbar-slot\" data-item=\"ak47\"></div>\n      <div class=\"hotbar-slot\" data-empty=\"true\"></div>\n    </div>\n    <div class=\"pickup-notification\" id=\"pickupNotification\"></div>\n    \n    <!-- Survival HUD -->\n    <div id=\"survivalHUD\" style=\"position:absolute;top:10px;left:10px;color:#fff;font-family:monospace;font-size:14px;text-shadow:1px 1px 2px #000;pointer-events:none;\">\n      <div id=\"scoreDisplay\">Score: 0</div>\n      <div id=\"waveDisplay\">Wave: 1</div>\n      <div id=\"objectiveDisplay\"></div>\n    </div>\n    \n    <!-- Debug Console -->\n    <div class=\"debug-console\" id=\"debugConsole\">\n      <div class=\"debug-console-header\">\n        <span>Debug Console (\\` to toggle)</span>\n        <span id=\"debugFps\">0 FPS</span>\n      </div>\n      <div class=\"debug-console-output\" id=\"debugOutput\"></div>\n      <div class=\"debug-console-input\">\n        <span>&gt;</span>\n        <input type=\"text\" id=\"debugInput\" placeholder=\"Type command...\">\n      </div>\n    </div>\n    \n    <!-- Block Tooltip -->\n    <div class=\"block-tooltip\" id=\"blockTooltip\">\n      <div class=\"tooltip-title\"></div>\n      <div class=\"tooltip-desc\"></div>\n    </div>\n  </div>\n  <div class=\"minecraft-instructions\">\n    WASD move | SPACE jump/swim | SHIFT swim down | Q drop | R ritual | SCROLL hotbar | LEFT break | RIGHT use/place | E inventory | \\` debug\n  </div>\n</div>\n`;\n\n/**\n * Inject the game HTML into the DOM\n */\nfunction injectGameHTML(container: HTMLElement = document.body): void {\n  const wrapper = document.createElement('div');\n  wrapper.innerHTML = gameTemplate;\n  while (wrapper.firstChild) {\n    container.appendChild(wrapper.firstChild);\n  }\n}\n\n/**\n * The core game engine object with type annotations\n * Using 'any' for complex internal state to maintain compatibility\n */\nexport const minecraftGame: ISakuraCraftEngine & Record<string, any> = {\n            canvas: null,\n            ctx: null,\n            isActive: false,\n            isPaused: false,\n            camera: { x: 0, y: 50, z: 0, rotX: 0, rotY: 0 },\n            velocity: { x: 0, y: 0, z: 0 },\n            world: {},\n            keys: {},\n            isJumping: false,\n            gravity: -0.035,  // Stronger gravity for snappier jumps\n            lastPos: { x: 0, z: 0 },\n            pointerLocked: false,\n            \n            // Fluid state\n            inWater: false,\n            inLava: false,\n            swimming: false,\n            headSubmergedWater: false,\n            headSubmergedLava: false,\n            \n            // Player dimensions - camera at waist/hip level\n            playerEyeHeight: 1.2,  // How high camera is above feet\n            playerHeight: 1.8,     // Total player height\n            \n            // Birds and mobs\n            birds: [],\n            pestBirds: [],\n            blueBirds: [],\n            fish: [],\n            cats: [],\n            creepers: [],\n            \n            // Items and inventory\n            selectedSlot: 0,  // 0-8 for hotbar slots\n            selectedBlock: 'grass',\n            selectedItem: null,  // For non-block items like ak47\n            \n            // Inventory system\n            inventory: {\n                // Hotbar slots (9 slots)\n                hotbar: [\n                    { type: 'block', id: 'grass', count: 64 },\n                    { type: 'block', id: 'dirt', count: 64 },\n                    { type: 'block', id: 'stone', count: 64 },\n                    { type: 'block', id: 'wood', count: 64 },\n                    { type: 'block', id: 'brick', count: 64 },\n                    { type: 'bucket', id: 'water_bucket', count: 5 },\n                    { type: 'bucket', id: 'lava_bucket', count: 5 },\n                    { type: 'weapon', id: 'ak47', count: 1, durability: 100, maxDurability: 100 },\n                    null  // Empty slot\n                ],\n                // Main inventory (27 slots - 3 rows of 9)\n                main: [\n                    { type: 'block', id: 'leaves', count: 64 },\n                    { type: 'block', id: 'sand', count: 64 },\n                    null, null, null, null, null, null, null,\n                    null, null, null, null, null, null, null, null, null,\n                    null, null, null, null, null, null, null, null, null\n                ],\n                // Crafting result\n                craftingResult: null\n            },\n            \n            // Crafting recipes\n            recipes: [\n                { ingredients: [{ id: 'wood', count: 4 }], result: { type: 'block', id: 'wood', count: 16 }, name: 'Planks' },\n                { ingredients: [{ id: 'stone', count: 8 }], result: { type: 'block', id: 'brick', count: 4 }, name: 'Bricks' },\n                { ingredients: [{ id: 'sand', count: 4 }], result: { type: 'block', id: 'stone', count: 2 }, name: 'Sandstone' },\n                { ingredients: [{ id: 'wood', count: 8 }], result: { type: 'block', id: 'chest', count: 1 }, name: 'Chest' }\n            ],\n            \n            // Fluid blocks that need updating\n            fluidUpdates: [],\n            fluidLevels: {},  // Stores fluid level 1-8 at each position\n            fluidUpdateTimer: 0,\n            \n            // Bird anger system\n            birdPruneTimer: 0,\n            \n            // Weapon properties\n            shootCooldown: 0,\n            muzzleFlash: 0,\n            particles: [],  // Bullet particles\n            \n            // UI state\n            inventoryOpen: false,\n            draggedItem: null,\n            dragSource: null,\n            \n            // Stats\n            stats: {\n                blocksPlaced: 0,\n                blocksBroken: 0,\n                distance: 0,\n                jumps: 0,\n                startTime: 0\n            },\n            \n            // Graphics settings\n            settings: {\n                brightness: 100,\n                filter: 'none',\n                renderDistance: 20,\n                shadows: true,\n                lighting: true,\n                antialiasing: false,\n                showFps: true,\n                targetFps: 60\n            },\n            \n            // FPS tracking\n            fpsCounter: {\n                frames: 0,\n                lastTime: 0,\n                fps: 0\n            },\n            \n            // Simple 2D noise function (value noise with interpolation)\n            noise2D: (function() {\n                // Permutation table\n                const perm = [];\n                for (let i = 0; i < 512; i++) {\n                    perm[i] = Math.floor(Math.random() * 256);\n                }\n                \n                function fade(t) { return t * t * t * (t * (t * 6 - 15) + 10); }\n                function lerp(a, b, t) { return a + t * (b - a); }\n                function grad(hash, x, y) {\n                    const h = hash & 3;\n                    const u = h < 2 ? x : y;\n                    const v = h < 2 ? y : x;\n                    return ((h & 1) ? -u : u) + ((h & 2) ? -v : v);\n                }\n                \n                return function(x, y) {\n                    const X = Math.floor(x) & 255;\n                    const Y = Math.floor(y) & 255;\n                    x -= Math.floor(x);\n                    y -= Math.floor(y);\n                    const u = fade(x);\n                    const v = fade(y);\n                    const A = perm[X] + Y;\n                    const B = perm[X + 1] + Y;\n                    return lerp(\n                        lerp(grad(perm[A], x, y), grad(perm[B], x - 1, y), u),\n                        lerp(grad(perm[A + 1], x, y - 1), grad(perm[B + 1], x - 1, y - 1), u),\n                        v\n                    );\n                };\n            })(),\n            \n            // Fractal Brownian Motion for more natural terrain\n            fbm(x, y, octaves = 4) {\n                let value = 0;\n                let amplitude = 1;\n                let frequency = 1;\n                let maxValue = 0;\n                \n                for (let i = 0; i < octaves; i++) {\n                    value += this.noise2D(x * frequency, y * frequency) * amplitude;\n                    maxValue += amplitude;\n                    amplitude *= 0.5;\n                    frequency *= 2;\n                }\n                \n                return value / maxValue;\n            },\n            \n            blockColors: {\n                grass: { top: '#7cba5f', side: '#8b6b4a', bottom: '#6b4423' },\n                dirt: { top: '#8b6b4a', side: '#8b6b4a', bottom: '#8b6b4a' },\n                stone: { top: '#888888', side: '#777777', bottom: '#666666' },\n                wood: { top: '#a0825a', side: '#6b4423', bottom: '#6b4423' },\n                leaves: { top: 'rgba(50, 180, 50, 0.85)', side: 'rgba(40, 160, 40, 0.85)', bottom: 'rgba(30, 140, 30, 0.85)', transparent: true }, // Beautiful transparent leaves\n                appleLeaves: { top: 'rgba(50, 180, 50, 0.85)', side: 'rgba(40, 160, 40, 0.85)', bottom: 'rgba(30, 140, 30, 0.85)', transparent: true }, // Beautiful transparent apple leaves\n                water: { top: 'rgba(74, 144, 217, 0.7)', side: 'rgba(58, 128, 201, 0.7)', bottom: 'rgba(42, 112, 185, 0.7)', transparent: true, animated: true },\n                sand: { top: '#e6d9a0', side: '#d9cc93', bottom: '#ccbf86' },\n                brick: { top: '#b35050', side: '#a04040', bottom: '#903030' },\n                lava: { top: '#ff6600', side: '#ff4400', bottom: '#cc3300', animated: true },\n                obsidian: { top: '#1a0a2e', side: '#140820', bottom: '#0a0410' },\n                cherryWood: { top: '#c4a07a', side: '#8b5a5a', bottom: '#8b5a5a' },\n                cherryLeaves: { top: 'rgba(255, 183, 197, 0.85)', side: 'rgba(255, 192, 203, 0.85)', bottom: 'rgba(255, 144, 165, 0.85)', transparent: true },\n                chest: { top: '#8b6914', side: '#a0780a', bottom: '#705010' },\n                ritualChest: { top: '#4a0080', side: '#6a00b0', bottom: '#300060' },\n                buildingChest: { top: '#c0c0c0', side: '#a0a0a0', bottom: '#808080' },\n                // Ritual Temple blocks\n                ritualStone: { top: '#4a4a6a', side: '#3a3a5a', bottom: '#2a2a4a' },\n                petalSocket: { top: '#ffb7c5', side: '#8b5a5a', bottom: '#5a3a3a' },\n                ropeSocket: { top: '#8b7355', side: '#6b5a45', bottom: '#4b3a25' },\n                charmSocket: { top: '#ffd700', side: '#daa520', bottom: '#b8860b' },\n                plaqueSocket: { top: '#deb887', side: '#c4a07a', bottom: '#8b7355' },\n                incenseSocket: { top: '#9370db', side: '#7b68ee', bottom: '#6a5acd' },\n                // Filled socket blocks (glowing versions)\n                petalSocketFilled: { top: '#ff69b4', side: '#ff1493', bottom: '#c71585' },\n                ropeSocketFilled: { top: '#daa520', side: '#b8860b', bottom: '#8b6914' },\n                charmSocketFilled: { top: '#fff700', side: '#ffd700', bottom: '#ffb700' },\n                plaqueSocketFilled: { top: '#f4a460', side: '#d2691e', bottom: '#a0522d' },\n                incenseSocketFilled: { top: '#da70d6', side: '#ba55d3', bottom: '#9932cc' },\n                // Church blocks\n                whiteBrick: { top: '#f0f0f0', side: '#e0e0e0', bottom: '#d0d0d0' },\n                redBrick: { top: '#b35050', side: '#a04040', bottom: '#903030' },\n                glowstone: { top: '#ffdd88', side: '#eebb66', bottom: '#ddaa44' }\n            },\n            \n            // Item definitions with properties\n            itemTypes: {\n                // Building materials\n                grass: { stackable: true, maxStack: 64 },\n                dirt: { stackable: true, maxStack: 64 },\n                stone: { stackable: true, maxStack: 64 },\n                wood: { stackable: true, maxStack: 64 },\n                leaves: { stackable: true, maxStack: 64 },\n                appleLeaves: { stackable: true, maxStack: 64 },\n                sand: { stackable: true, maxStack: 64 },\n                brick: { stackable: true, maxStack: 64 },\n                cherryWood: { stackable: true, maxStack: 64 },\n                cherryLeaves: { stackable: true, maxStack: 64 },\n                chest: { stackable: true, maxStack: 16 },\n                obsidian: { stackable: true, maxStack: 64 },\n                whiteBrick: { stackable: true, maxStack: 64 },\n                redBrick: { stackable: true, maxStack: 64 },\n                glowstone: { stackable: true, maxStack: 64 },\n                ritualStone: { stackable: true, maxStack: 64 },\n                // Consumables/Throwables\n                apple: { stackable: true, maxStack: 64, throwable: true, description: 'Throw at birds to knock them away' },\n                // Buckets\n                water_bucket: { stackable: true, maxStack: 16 },\n                lava_bucket: { stackable: true, maxStack: 16 },\n                // Tools with durability\n                ak47: { stackable: false, maxStack: 1, durability: 100, maxDurability: 100, description: 'Shoots bullets at birds' },\n                seeds: { stackable: true, maxStack: 64, description: 'Calms angry birds temporarily' },\n                berdger: { stackable: false, maxStack: 1, invincible: true, description: 'The legendary bird repellent - infinite uses!' },\n                // Ritual items (Omamori charm components)\n                sakuraPetal: { stackable: true, maxStack: 16, description: 'Sacred cherry blossom petal', ritual: true },\n                shimenawa: { stackable: true, maxStack: 1, description: 'Sacred rope', ritual: true },\n                omamori: { stackable: true, maxStack: 1, description: 'Protective charm base', ritual: true },\n                ema: { stackable: true, maxStack: 1, description: 'Wooden wish plaque', ritual: true },\n                incense: { stackable: true, maxStack: 1, description: 'Purifying incense', ritual: true }\n            },\n            \n            // Fluids that player can pass through\n            fluidBlocks: ['water', 'lava'],\n            \n            // Ritual system - Omamori Blessing (Japanese protective charm ritual)\n            ritualItems: ['sakuraPetal', 'shimenawa', 'omamori', 'ema', 'incense'],\n            ritualComplete: false,\n            ritualBlessingActive: false,\n            ritualBlessingTimer: 0,\n            ritualFlight: false,\n            ritualFlightTimer: 0,\n            ritualBarrierActive: false,\n            \n            init() {\n                // Lightweight init - just get canvas reference\n                // World generation is deferred to start() to avoid lagging main site\n                this.canvas = document.getElementById('gameCanvas');\n                this.ctx = this.canvas.getContext('2d');\n                this.initialized = false;  // Track if world has been generated\n                this.gameLoopId = null;    // Track animation frame for cleanup\n                this.lastFrameTime = 0;    // For FPS limiting\n            },\n            \n            // Full initialization - called only when game starts\n            fullInit() {\n                if (this.initialized) return;  // Don't regenerate if already done\n                \n                this.generateWorld();\n                this.setupControls();\n                this.setupMenus();\n                this.setupDebugConsole();\n                this.initialized = true;\n                \n                // Force initial hotbar render with multiple attempts for reliability\n                this.updateHotbarDisplay();\n                setTimeout(() => this.updateHotbarDisplay(), 50);\n                setTimeout(() => this.updateHotbarDisplay(), 150);\n                setTimeout(() => this.updateHotbarDisplay(), 300);\n            },\n            \n            generateWorld() {\n                this.world = {};\n                this.fluidLevels = {};  // Clear fluid levels\n                this.droppedItems = []; // Items on ground\n                this.cherryTrees = [];  // Cherry blossom tree locations\n                this.petalParticles = []; // Cherry blossom petals\n                \n                const worldSize = 50; // -50 to 50 = 101x101 blocks\n                const waterLevel = 6;\n                const baseHeight = 8;\n                \n                // Store world bounds for forcefield - ON the last block, not past it\n                this.worldBounds = {\n                    minX: -worldSize,\n                    maxX: worldSize + 1,\n                    minZ: -worldSize,\n                    maxZ: worldSize + 1,\n                    minY: 0,\n                    maxY: 50\n                };\n                \n                // Wind system for petals and birds\n                this.wind = {\n                    x: 0,\n                    z: 0,\n                    targetX: 0,\n                    targetZ: 0,\n                    gustTimer: 0,\n                    strength: 0.02\n                };\n                \n                // Building placements storage\n                this.buildings = [];\n                \n                // Fluid simulation queue\n                this.fluidQueue = [];\n                \n                // Pre-calculate height map for faster generation\n                const heightMap = {};\n                const biomeMap = {};\n                \n                // First pass: calculate heights\n                for (let x = -worldSize; x <= worldSize; x++) {\n                    for (let z = -worldSize; z <= worldSize; z++) {\n                        const n1 = this.fbm(x * 0.03, z * 0.03, 2) * 10;\n                        const n2 = this.fbm(x * 0.05 + 100, z * 0.05 + 100, 2) * 5;\n                        \n                        const distFromCenter = Math.sqrt(x * x + z * z) / worldSize;\n                        const edgeFalloff = Math.max(0, 1 - distFromCenter * 0.5);\n                        \n                        let height = Math.floor(baseHeight + (n1 + n2) * edgeFalloff);\n                        height = Math.max(1, Math.min(22, height));\n                        \n                        const key = `${x},${z}`;\n                        heightMap[key] = height;\n                        biomeMap[key] = this.noise2D(x * 0.03 + 500, z * 0.03 + 500);\n                    }\n                }\n                \n                // Second pass: generate blocks using cached heights\n                for (let x = -worldSize; x <= worldSize; x++) {\n                    for (let z = -worldSize; z <= worldSize; z++) {\n                        const key = `${x},${z}`;\n                        const height = heightMap[key];\n                        const biomeNoise = biomeMap[key];\n                        \n                        const isBeach = height <= waterLevel + 1 && height >= waterLevel - 1;\n                        const isDesert = biomeNoise > 0.3 && height > waterLevel + 2;\n                        \n                        // Generate column - only surface blocks for speed\n                        // Just 3 layers of stone at bottom\n                        for (let y = Math.max(0, height - 3); y < height - 1; y++) {\n                            this.setBlock(x, y, z, 'stone');\n                        }\n                        \n                        // Surface layers based on biome\n                        if (isBeach || (height <= waterLevel)) {\n                            this.setBlock(x, height - 1, z, 'sand');\n                            this.setBlock(x, height, z, 'sand');\n                        } else if (isDesert) {\n                            this.setBlock(x, height - 1, z, 'sand');\n                            this.setBlock(x, height, z, 'sand');\n                        } else {\n                            this.setBlock(x, height - 1, z, 'dirt');\n                            this.setBlock(x, height, z, 'grass');\n                        }\n                        \n                        // Water - source blocks at full level\n                        if (height < waterLevel) {\n                            for (let y = height + 1; y <= waterLevel; y++) {\n                                this.setBlock(x, y, z, 'water');\n                                this.setFluidLevel(x, y, z, 8);  // Full level for natural water\n                            }\n                        }\n                    }\n                }\n                \n                // Trees - separate pass, sparser\n                for (let x = -worldSize; x <= worldSize; x += 2) { // Skip every other for speed\n                    for (let z = -worldSize; z <= worldSize; z += 2) {\n                        const key = `${x},${z}`;\n                        const height = heightMap[key];\n                        const biomeNoise = biomeMap[key];\n                        const isBeach = height <= waterLevel + 1;\n                        const isDesert = biomeNoise > 0.3;\n                        \n                        if (height > waterLevel + 1 && !isDesert && !isBeach) {\n                            const treeNoise = this.noise2D(x * 0.4 + 300, z * 0.4 + 300);\n                            if (treeNoise > 0.5 && Math.random() < 0.12) {\n                                // Check if area is clear (no overlapping structures)\n                                const treeSize = 5; // Trees are roughly 5x5\n                                if (!this.checkStructureCollision(x - 2, height + 1, z - 2, treeSize, 8, treeSize)) {\n                                    // 25% chance for cherry blossom tree\n                                    if (Math.random() < 0.25) {\n                                        this.generateCherryTree(x, height + 1, z);\n                                    } else {\n                                        this.generateTree(x, height + 1, z);\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n                \n                // Spawn ritual item chests (rare, ~5 in world)\n                const ritualChestCount = 5;\n                for (let i = 0; i < ritualChestCount; i++) {\n                    const rx = Math.floor(Math.random() * worldSize * 2) - worldSize;\n                    const rz = Math.floor(Math.random() * worldSize * 2) - worldSize;\n                    const rKey = `${rx},${rz}`;\n                    const rHeight = heightMap[rKey] || baseHeight;\n                    if (rHeight > waterLevel) {\n                        this.setBlock(rx, rHeight + 1, rz, 'ritualChest');\n                        // Store chest contents\n                        const ritualItem = this.ritualItems[i % this.ritualItems.length];\n                        this.chestContents = this.chestContents || {};\n                        this.chestContents[`${rx},${rHeight + 1},${rz}`] = [\n                            { type: ritualItem, count: 1 }\n                        ];\n                    }\n                }\n                \n                // Spawn seeds around the world (uncommon ground items)\n                for (let i = 0; i < 30; i++) {\n                    const sx = Math.floor(Math.random() * worldSize * 2) - worldSize;\n                    const sz = Math.floor(Math.random() * worldSize * 2) - worldSize;\n                    const sKey = `${sx},${sz}`;\n                    const sHeight = heightMap[sKey] || baseHeight;\n                    if (sHeight > waterLevel) {\n                        this.droppedItems.push({\n                            x: sx + 0.5,\n                            y: sHeight + 1.2,\n                            z: sz + 0.5,\n                            type: 'seeds',\n                            count: 1 + Math.floor(Math.random() * 3),\n                            bobPhase: Math.random() * Math.PI * 2\n                        });\n                    }\n                }\n                \n                // Spawn apples under apple trees\n                if (this.appleTrees) {\n                    for (const tree of this.appleTrees) {\n                        // 50% chance of apples under each tree\n                        if (Math.random() < 0.5) {\n                            const appleCount = 1 + Math.floor(Math.random() * 3);\n                            for (let i = 0; i < appleCount; i++) {\n                                this.droppedItems.push({\n                                    x: tree.x + (Math.random() - 0.5) * 4,\n                                    y: tree.y - 3,\n                                    z: tree.z + (Math.random() - 0.5) * 4,\n                                    type: 'apple',\n                                    count: 1,\n                                    bobPhase: Math.random() * Math.PI * 2\n                                });\n                            }\n                        }\n                    }\n                }\n                \n                // Generate buildings\n                this.generateBuildings(worldSize);\n                \n                // Generate ONE Ritual Temple in a random far location\n                let templeX, templeZ;\n                do {\n                    templeX = Math.floor(Math.random() * (worldSize - 20)) + 15;\n                    templeZ = Math.floor(Math.random() * (worldSize - 20)) + 15;\n                    if (Math.random() < 0.5) templeX = -templeX;\n                    if (Math.random() < 0.5) templeZ = -templeZ;\n                } while (Math.abs(templeX) < 20 || Math.abs(templeZ) < 20);\n                \n                const templeKey = `${templeX},${templeZ}`;\n                const templeHeight = heightMap[templeKey] || baseHeight;\n                this.generateRitualTemple(templeX, templeHeight + 1, templeZ);\n                \n                // Initialize birds\n                this.initBirds();\n                this.initPestBirds();\n            },\n            \n            generateBuildings(worldSize) {\n                // Building types\n                const buildingTypes = ['church', 'house1', 'house2', 'house3', 'grocery', 'wcdonalds'];\n                \n                // Quadrant-based generation: 2-6 buildings per 25x25 area\n                const quadrantSize = 25;\n                let wcdonaldsPlaced = false;\n                \n                for (let qx = -Math.floor(worldSize / quadrantSize); qx <= Math.floor(worldSize / quadrantSize); qx++) {\n                    for (let qz = -Math.floor(worldSize / quadrantSize); qz <= Math.floor(worldSize / quadrantSize); qz++) {\n                        // Skip center quadrant (spawn area)\n                        if (qx === 0 && qz === 0) continue;\n                        \n                        const minX = qx * quadrantSize;\n                        const minZ = qz * quadrantSize;\n                        \n                        // 2-6 buildings per quadrant\n                        const numBuildings = 2 + Math.floor(Math.random() * 5);\n                        \n                        for (let i = 0; i < numBuildings; i++) {\n                            const bx = minX + 3 + Math.floor(Math.random() * (quadrantSize - 6));\n                            const bz = minZ + 3 + Math.floor(Math.random() * (quadrantSize - 6));\n                            \n                            // Force WcDonald's if not placed yet and this is a good spot\n                            if (!wcdonaldsPlaced && Math.random() < 0.3) {\n                                if (this.tryPlaceBuilding(bx, bz, ['wcdonalds'])) {\n                                    wcdonaldsPlaced = true;\n                                    continue;\n                                }\n                            }\n                            \n                            this.tryPlaceBuilding(bx, bz, buildingTypes);\n                        }\n                    }\n                }\n                \n                // Guarantee at least one WcDonald's if not placed\n                if (!wcdonaldsPlaced) {\n                    for (let attempts = 0; attempts < 50; attempts++) {\n                        const bx = 25 + Math.floor(Math.random() * 20);\n                        const bz = 25 + Math.floor(Math.random() * 20);\n                        if (this.tryPlaceBuilding(bx, bz, ['wcdonalds'])) {\n                            break;\n                        }\n                    }\n                }\n            },\n            \n            tryPlaceBuilding(x, z, buildingTypes) {\n                const groundY = this.getHighestBlock(x, z);\n                if (!groundY || groundY < 7) return false;\n                \n                const block = this.getBlock(x, groundY, z);\n                if (block === 'water' || block === 'sand') return false;\n                \n                // Quick flatness check\n                const h1 = this.getHighestBlock(x + 3, z) || groundY;\n                const h2 = this.getHighestBlock(x - 3, z) || groundY;\n                const h3 = this.getHighestBlock(x, z + 3) || groundY;\n                const h4 = this.getHighestBlock(x, z - 3) || groundY;\n                if (Math.max(Math.abs(h1 - groundY), Math.abs(h2 - groundY), Math.abs(h3 - groundY), Math.abs(h4 - groundY)) > 2) return false;\n                \n                // Check overlap\n                for (const b of this.buildings) {\n                    if (Math.sqrt((x - b.x) ** 2 + (z - b.z) ** 2) < 15) return false;\n                }\n                \n                const type = buildingTypes[Math.floor(Math.random() * buildingTypes.length)];\n                const baseY = groundY + 1;\n                \n                this.buildings.push({ x, z, type, y: baseY });\n                \n                switch (type) {\n                    case 'church': this.generateChurch(x, baseY, z); break;\n                    case 'house1': this.generateHouse1(x, baseY, z); break;\n                    case 'house2': this.generateHouse2(x, baseY, z); break;\n                    case 'house3': this.generateHouse3(x, baseY, z); break;\n                    case 'grocery': this.generateGrocery(x, baseY, z); break;\n                    case 'wcdonalds': this.generateWcDonalds(x, baseY, z); break;\n                }\n                return true;\n            },\n            \n            // Ruined Church - tall with steeple and intact cross\n            generateChurch(x, y, z) {\n                const w = 7, d = 12, h = 8;\n                const ruinFactor = 0.3; // 30% of blocks are missing\n                \n                // Floor\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'stone');\n                    }\n                }\n                \n                // Walls with random holes\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h; dy++) {\n                            const isWall = dx === 0 || dx === w - 1 || dz === 0 || dz === d - 1;\n                            if (isWall && Math.random() > ruinFactor) {\n                                // Door opening\n                                if (dz === d - 1 && dx >= 2 && dx <= 4 && dy < 3) continue;\n                                // Window openings\n                                if ((dx === 0 || dx === w - 1) && dy >= 2 && dy <= 4 && (dz === 3 || dz === 8)) continue;\n                                this.setBlock(x + dx, y + dy, z + dz, 'stone');\n                            }\n                        }\n                    }\n                }\n                \n                // Steeple (partially collapsed but supporting structure for cross)\n                const steepleX = x + 3, steepleZ = z + 2;\n                for (let dy = h; dy < h + 5; dy++) {\n                    // Main pillar always intact to support cross\n                    this.setBlock(steepleX, y + dy, steepleZ, 'stone');\n                    if (dy < h + 3) {\n                        // Side supports may be ruined\n                        if (Math.random() > ruinFactor) {\n                            this.setBlock(steepleX + 1, y + dy, steepleZ, 'stone');\n                        }\n                        if (Math.random() > ruinFactor) {\n                            this.setBlock(steepleX - 1, y + dy, steepleZ, 'stone');\n                        }\n                    }\n                }\n                \n                // CROSS - Always intact! (This identifies it as a church)\n                const crossY = y + h + 5;\n                // Vertical part of cross\n                this.setBlock(steepleX, crossY, steepleZ, 'stone');\n                this.setBlock(steepleX, crossY + 1, steepleZ, 'stone');\n                this.setBlock(steepleX, crossY + 2, steepleZ, 'stone');\n                // Horizontal part of cross\n                this.setBlock(steepleX - 1, crossY + 1, steepleZ, 'stone');\n                this.setBlock(steepleX + 1, crossY + 1, steepleZ, 'stone');\n            },\n            \n            // Small cottage house\n            generateHouse1(x, y, z) {\n                const w = 5, d = 6, h = 4;\n                const ruinFactor = 0.25;\n                \n                // Floor\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'wood');\n                    }\n                }\n                \n                // Walls (wood)\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h; dy++) {\n                            const isWall = dx === 0 || dx === w - 1 || dz === 0 || dz === d - 1;\n                            if (isWall && Math.random() > ruinFactor) {\n                                // Door\n                                if (dz === d - 1 && dx === 2 && dy < 2) continue;\n                                // Window\n                                if (dx === 0 && dy === 1 && dz === 2) continue;\n                                this.setBlock(x + dx, y + dy, z + dz, 'wood');\n                            }\n                        }\n                    }\n                }\n                \n                // Roof (leaves - like thatch)\n                for (let dx = -1; dx <= w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        if (Math.random() > ruinFactor) {\n                            this.setBlock(x + dx, y + h, z + dz, 'leaves');\n                        }\n                    }\n                }\n            },\n            \n            // Two-story house\n            generateHouse2(x, y, z) {\n                const w = 6, d = 7, h = 6;\n                const ruinFactor = 0.3;\n                \n                // Foundation\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'stone');\n                    }\n                }\n                \n                // Brick walls\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h; dy++) {\n                            const isWall = dx === 0 || dx === w - 1 || dz === 0 || dz === d - 1;\n                            if (isWall && Math.random() > ruinFactor) {\n                                // Door\n                                if (dz === d - 1 && dx >= 2 && dx <= 3 && dy < 2) continue;\n                                // Windows\n                                if ((dx === 0 || dx === w - 1) && (dy === 1 || dy === 4) && (dz === 2 || dz === 4)) continue;\n                                this.setBlock(x + dx, y + dy, z + dz, 'brick');\n                            }\n                        }\n                    }\n                }\n                \n                // Floor between stories\n                for (let dx = 1; dx < w - 1; dx++) {\n                    for (let dz = 1; dz < d - 1; dz++) {\n                        if (Math.random() > ruinFactor * 2) {\n                            this.setBlock(x + dx, y + 3, z + dz, 'wood');\n                        }\n                    }\n                }\n            },\n            \n            // L-shaped house\n            generateHouse3(x, y, z) {\n                const ruinFactor = 0.35;\n                \n                // Main section\n                for (let dx = 0; dx < 5; dx++) {\n                    for (let dz = 0; dz < 8; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'stone');\n                        for (let dy = 0; dy < 4; dy++) {\n                            const isWall = dx === 0 || dx === 4 || dz === 0 || dz === 7;\n                            if (isWall && Math.random() > ruinFactor) {\n                                if (dz === 7 && dx === 2 && dy < 2) continue; // Door\n                                this.setBlock(x + dx, y + dy, z + dz, 'brick');\n                            }\n                        }\n                    }\n                }\n                \n                // L extension\n                for (let dx = 5; dx < 9; dx++) {\n                    for (let dz = 0; dz < 5; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'stone');\n                        for (let dy = 0; dy < 4; dy++) {\n                            const isWall = dx === 8 || dz === 0 || dz === 4 || (dx === 5 && dz > 4);\n                            if (isWall && Math.random() > ruinFactor) {\n                                this.setBlock(x + dx, y + dy, z + dz, 'brick');\n                            }\n                        }\n                    }\n                }\n            },\n            \n            // Abandoned grocery store\n            generateGrocery(x, y, z) {\n                const w = 10, d = 8, h = 4;\n                const ruinFactor = 0.25;\n                \n                // Concrete floor\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'stone');\n                    }\n                }\n                \n                // Walls\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h; dy++) {\n                            const isWall = dx === 0 || dx === w - 1 || dz === 0 || dz === d - 1;\n                            if (isWall && Math.random() > ruinFactor) {\n                                // Wide entrance\n                                if (dz === d - 1 && dx >= 3 && dx <= 6 && dy < 3) continue;\n                                // Windows (front)\n                                if (dz === d - 1 && (dx === 1 || dx === 8) && dy >= 1 && dy <= 2) continue;\n                                this.setBlock(x + dx, y + dy, z + dz, 'stone');\n                            }\n                        }\n                    }\n                }\n                \n                // Shelving units (partial)\n                for (let row = 0; row < 2; row++) {\n                    for (let dz = 2; dz < 6; dz++) {\n                        if (Math.random() > 0.4) {\n                            this.setBlock(x + 3 + row * 3, y, z + dz, 'wood');\n                            if (Math.random() > 0.5) {\n                                this.setBlock(x + 3 + row * 3, y + 1, z + dz, 'wood');\n                            }\n                        }\n                    }\n                }\n                \n                // \"GROCERY\" sign (just some blocks on roof)\n                for (let dx = 2; dx < 8; dx++) {\n                    if (Math.random() > 0.3) {\n                        this.setBlock(x + dx, y + h, z + d - 1, 'stone');\n                    }\n                }\n            },\n            \n            // WcDonald's - the knockoff! (W instead of M, same colors)\n            generateWcDonalds(x, y, z) {\n                const w = 9, d = 9, h = 4;\n                const ruinFactor = 0.2;\n                \n                // FIRST: Clear interior space (remove any terrain blocks inside building)\n                for (let dx = 1; dx < w - 1; dx++) {\n                    for (let dz = 1; dz < d - 1; dz++) {\n                        for (let dy = 0; dy < h + 2; dy++) {\n                            const existingBlock = this.getBlock(x + dx, y + dy, z + dz);\n                            // Remove any solid non-air blocks inside\n                            if (existingBlock && existingBlock !== 'water' && existingBlock !== 'lava') {\n                                this.setBlock(x + dx, y + dy, z + dz, null);\n                            }\n                        }\n                    }\n                }\n                \n                // Red foundation/floor\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'brick'); // Red brick as red\n                    }\n                }\n                \n                // Walls (mix of brick and stone for that fast food look)\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h; dy++) {\n                            const isWall = dx === 0 || dx === w - 1 || dz === 0 || dz === d - 1;\n                            if (isWall && Math.random() > ruinFactor) {\n                                // Double door entrance\n                                if (dz === d - 1 && dx >= 3 && dx <= 5 && dy < 3) continue;\n                                // Drive-thru window\n                                if (dx === w - 1 && dz >= 2 && dz <= 4 && dy === 1) continue;\n                                // Use brick for bottom, stone for top\n                                this.setBlock(x + dx, y + dy, z + dz, dy < 2 ? 'brick' : 'stone');\n                            }\n                        }\n                    }\n                }\n                \n                // The famous \"W\" arches (golden... well, sand-colored)\n                // W shape using sand blocks (yellow-ish) - ALWAYS SOLID, no ruin\n                const wX = x + 4;\n                const wZ = z + d;\n                const wY = y + h;\n                \n                // Build the W shape - guaranteed to always appear\n                // Left vertical leg\n                this.setBlock(wX - 2, wY, wZ, 'sand');\n                this.setBlock(wX - 2, wY + 1, wZ, 'sand');\n                this.setBlock(wX - 2, wY + 2, wZ, 'sand');\n                this.setBlock(wX - 2, wY + 3, wZ, 'sand');\n                \n                // Left diagonal down to center\n                this.setBlock(wX - 1, wY, wZ, 'sand');\n                this.setBlock(wX - 1, wY + 1, wZ, 'sand');\n                \n                // Center bottom (the V dip)\n                this.setBlock(wX, wY, wZ, 'sand');\n                \n                // Right diagonal up from center  \n                this.setBlock(wX + 1, wY, wZ, 'sand');\n                this.setBlock(wX + 1, wY + 1, wZ, 'sand');\n                \n                // Right vertical leg\n                this.setBlock(wX + 2, wY, wZ, 'sand');\n                this.setBlock(wX + 2, wY + 1, wZ, 'sand');\n                this.setBlock(wX + 2, wY + 2, wZ, 'sand');\n                this.setBlock(wX + 2, wY + 3, wZ, 'sand');\n                \n                // Counter inside\n                for (let dx = 2; dx < 7; dx++) {\n                    if (Math.random() > 0.3) {\n                        this.setBlock(x + dx, y, z + 2, 'brick');\n                    }\n                }\n                \n                // Some tables (wood blocks)\n                if (Math.random() > 0.4) this.setBlock(x + 2, y, z + 5, 'wood');\n                if (Math.random() > 0.4) this.setBlock(x + 6, y, z + 5, 'wood');\n                if (Math.random() > 0.4) this.setBlock(x + 4, y, z + 6, 'wood');\n                \n                // Special WcDonalds chest behind counter - may contain the legendary Berdger!\n                this.setBlock(x + 4, y, z + 1, 'buildingChest');\n                this.chestContents = this.chestContents || {};\n                const chestKey = `${x + 4},${y},${z + 1}`;\n                // 30% chance for berdger, otherwise seeds\n                if (Math.random() < 0.3) {\n                    this.chestContents[chestKey] = [{ type: 'berdger', count: 1 }];\n                } else {\n                    this.chestContents[chestKey] = [{ type: 'seeds', count: 3 + Math.floor(Math.random() * 5) }];\n                }\n            },\n            \n            getHighestBlock(x, z) {\n                for (let y = 30; y >= 0; y--) {\n                    if (this.getBlock(x, y, z)) return y;\n                }\n                return null;\n            },\n            \n\n            \n            // Check if bird would collide with blocks\n            checkBirdCollision(x, y, z, radius = 0.5) {\n                // Check blocks around bird position\n                const bx = Math.floor(x);\n                const by = Math.floor(y);\n                const bz = Math.floor(z);\n                \n                // Check 3x3x3 area around bird\n                for (let dx = -1; dx <= 1; dx++) {\n                    for (let dy = -1; dy <= 1; dy++) {\n                        for (let dz = -1; dz <= 1; dz++) {\n                            const block = this.getBlock(bx + dx, by + dy, bz + dz);\n                            // getBlock returns undefined for air, so check if block exists and is solid\n                            if (block && block !== 'water') {\n                                // Calculate distance to block center\n                                const blockX = bx + dx + 0.5;\n                                const blockY = by + dy + 0.5;\n                                const blockZ = bz + dz + 0.5;\n                                const dist = Math.sqrt(\n                                    (x - blockX) ** 2 + \n                                    (y - blockY) ** 2 + \n                                    (z - blockZ) ** 2\n                                );\n                                if (dist < radius + 0.7) return true; // Collision\n                            }\n                        }\n                    }\n                }\n                return false; // No collision\n            },\n            \n            // Check if area is clear for structure placement\n            checkStructureCollision(x, y, z, width, height, depth) {\n                // Check if this area overlaps with any existing structures\n                for (let dx = 0; dx < width; dx++) {\n                    for (let dy = 0; dy < height; dy++) {\n                        for (let dz = 0; dz < depth; dz++) {\n                            const block = this.getBlock(x + dx, y + dy, z + dz);\n                            // If there's already a block here (not air), area is occupied\n                            if (block) {\n                                return true; // Collision detected\n                            }\n                        }\n                    }\n                }\n                return false; // Area is clear\n            },\n            \n            // Find nearest clear spot for structure\n            findClearSpot(centerX, centerZ, width, depth, searchRadius = 20) {\n                // Try to find a clear spot near the center\n                for (let radius = 0; radius < searchRadius; radius++) {\n                    // Try positions in a circle around center\n                    for (let angle = 0; angle < Math.PI * 2; angle += Math.PI / 8) {\n                        const testX = Math.floor(centerX + Math.cos(angle) * radius);\n                        const testZ = Math.floor(centerZ + Math.sin(angle) * radius);\n                        const groundY = this.getGroundHeight(testX, testZ);\n                        \n                        // Check if this spot is clear\n                        if (!this.checkStructureCollision(testX, groundY, testZ, width, 10, depth)) {\n                            return { x: testX, y: groundY, z: testZ };\n                        }\n                    }\n                }\n                \n                // Fallback: return original position\n                const groundY = this.getGroundHeight(centerX, centerZ);\n                return { x: centerX, y: groundY, z: centerZ };\n            },\n\n            \n            // Toggle sneak mode\n            toggleSneak() {\n                this.camera.sneaking = !this.camera.sneaking;\n                console.log('Sneaking:', this.camera.sneaking);\n            },\n            \n            // Get current eye height based on sneak state\n            getEyeHeight() {\n                if (!this.camera.sneaking) return 1.6; // Default height\n                return 1.3; // Sneak height\n            },\n            initBirds() {\n                this.birds = [];\n                const numBirds = 12; // Good number for small world\n                \n                for (let i = 0; i < numBirds; i++) {\n                    this.birds.push({\n                        x: (Math.random() - 0.5) * 80,\n                        y: 15 + Math.random() * 10,\n                        z: (Math.random() - 0.5) * 80,\n                        // Movement pattern\n                        baseY: 15 + Math.random() * 10,\n                        angle: Math.random() * Math.PI * 2,\n                        radius: 5 + Math.random() * 15,\n                        speed: 0.01 + Math.random() * 0.02,\n                        wobble: Math.random() * Math.PI * 2,\n                        wobbleSpeed: 0.05 + Math.random() * 0.05,\n                        // Visual\n                        wingPhase: Math.random() * Math.PI * 2,\n                        size: 0.3 + Math.random() * 0.2\n                    });\n                }\n            },\n            \n            // Initialize pest birds (small annoying birds that follow player)\n            initPestBirds() {\n                this.pestBirds = [];\n                const numPests = 3;\n                \n                for (let i = 0; i < numPests; i++) {\n                    this.pestBirds.push({\n                        x: 0, y: 12, z: 0,\n                        // Velocity for knockback\n                        vx: 0, vy: 0, vz: 0,\n                        // Target offset from player\n                        targetOffsetX: 0,\n                        targetOffsetY: 0,\n                        targetOffsetZ: 0,\n                        // Behavior state\n                        state: 'circling', // 'circling', 'swooping', 'retreating', 'hovering', 'knockback'\n                        stateTimer: Math.random() * 100,\n                        // Movement\n                        angle: (i / numPests) * Math.PI * 2, // Spread them out\n                        circleRadius: 2 + Math.random(),\n                        baseCircleRadius: 2 + Math.random(),\n                        circleSpeed: 0.08 + Math.random() * 0.04,\n                        swoopProgress: 0,\n                        // Visual\n                        wingPhase: Math.random() * Math.PI * 2,\n                        size: 0.15 + Math.random() * 0.05, // Smaller than regular birds\n                        chirpTimer: Math.random() * 60,\n                        knockbackSpin: 0,\n                        // Anger system - gets angrier when shot\n                        anger: 0,           // 0-5 anger level\n                        timesShot: 0,       // How many times this bird has been shot\n                        spawnThreshold: 4 + Math.floor(Math.random() * 4)  // 4-7 shots to spawn reinforcements\n                    });\n                }\n            },\n            \n            updatePestBirds() {\n                const playerX = this.camera.x;\n                const playerY = this.camera.y;\n                const playerZ = this.camera.z;\n                \n                // Check for seed calming effect\n                if (!this.seedCalmTimer) this.seedCalmTimer = 0;\n                if (this.seedCalmTimer > 0) {\n                    this.seedCalmTimer--;\n                }\n                const birdsCalmed = this.seedCalmTimer > 0;\n                \n                // Prune excess birds every ~30 seconds (1800 frames at 60fps)\n                if (!this.birdPruneTimer) this.birdPruneTimer = 0;\n                this.birdPruneTimer++;\n                if (this.birdPruneTimer >= 1800) {\n                    this.birdPruneTimer = 0;\n                    if (this.pestBirds.length > 15) {\n                        // Keep the 15 angriest birds\n                        this.pestBirds.sort((a, b) => b.anger - a.anger);\n                        this.pestBirds = this.pestBirds.slice(0, 15);\n                    }\n                }\n                \n                for (const pest of this.pestBirds) {\n                    // Handle rage mode timer\n                    if (pest.rageMode && pest.rageTimer) {\n                        pest.rageTimer--;\n                        if (pest.rageTimer <= 0) {\n                            pest.rageMode = false;\n                            pest.speed = 0.06; // Reset to normal speed\n                        }\n                    }\n                    \n                    // Rage mode makes birds more aggressive\n                    \n                    // Wind affects all bird movement\n                    if (this.wind && pest.state !== 'knockback') {\n                        pest.x += this.wind.x * 0.5;\n                        pest.z += this.wind.z * 0.5;\n                    }\n                    \n                    // If calmed by seeds, birds retreat and become passive\n                    if (birdsCalmed && pest.state !== 'knockback') {\n                        pest.state = 'retreating';\n                        pest.stateTimer = Math.max(pest.stateTimer, 60);\n                        pest.anger = Math.max(0, pest.anger - 0.01); // Slowly calm down\n                    }\n                    \n                    pest.stateTimer--;\n                    \n                    // Anger affects wing flap speed\n                    const angerWingBonus = pest.anger * 0.1;\n                    pest.wingPhase += (pest.state === 'knockback' ? 0.8 : 0.5) + angerWingBonus;\n                    pest.chirpTimer--;\n                    \n                    // Calculate anger-based multipliers\n                    const angerSpeedMult = 1 + pest.anger * 0.3;      // Up to 2.5x faster at max anger\n                    const angerRadiusMult = 1 - pest.anger * 0.1;    // Gets closer when angry (down to 0.5x)\n                    const angerSwoopChance = 0.3 + pest.anger * 0.15; // Up to 0.9 swoop chance at max anger\n                    \n                    // Handle knockback state with physics including wall ricochet\n                    if (pest.state === 'knockback') {\n                        // Store previous position for collision detection\n                        const prevX = pest.x, prevY = pest.y, prevZ = pest.z;\n                        \n                        // Apply velocity\n                        pest.x += pest.vx;\n                        pest.y += pest.vy;\n                        pest.z += pest.vz;\n                        \n                        // WALL COLLISION AND RICOCHET\n                        const birdBlock = this.getBlock(Math.floor(pest.x), Math.floor(pest.y), Math.floor(pest.z));\n                        if (birdBlock && birdBlock !== 'water' && birdBlock !== 'lava') {\n                            // Hit a block - check which face and ricochet\n                            const isLeaves = birdBlock.includes('Leaves') || birdBlock.includes('leaves');\n                            \n                            if (isLeaves) {\n                                // Leaves catch birds and slow them significantly\n                                pest.vx *= 0.4;\n                                pest.vy *= 0.4;\n                                pest.vz *= 0.4;\n                                pest.stateTimer = Math.min(pest.stateTimer, 90); // Stuck briefly\n                                pest.caughtInLeaves = true;\n                            } else {\n                                // Solid block - ricochet with energy loss\n                                const blockX = Math.floor(pest.x);\n                                const blockY = Math.floor(pest.y);\n                                const blockZ = Math.floor(pest.z);\n                                \n                                // Determine which face was hit and bounce\n                                if (!this.getBlock(blockX, Math.floor(prevY), Math.floor(prevZ))) {\n                                    pest.vx *= -0.7; // X wall hit\n                                    pest.x = prevX;\n                                } else if (!this.getBlock(Math.floor(prevX), blockY, Math.floor(prevZ))) {\n                                    pest.vy *= -0.7; // Y wall/floor/ceiling hit\n                                    pest.y = prevY;\n                                } else if (!this.getBlock(Math.floor(prevX), Math.floor(prevY), blockZ)) {\n                                    pest.vz *= -0.7; // Z wall hit\n                                    pest.z = prevZ;\n                                } else {\n                                    // Corner - reverse all\n                                    pest.vx *= -0.5;\n                                    pest.vy *= -0.5;\n                                    pest.vz *= -0.5;\n                                    pest.x = prevX; pest.y = prevY; pest.z = prevZ;\n                                }\n                                \n                                // Add ricochet particle\n                                this.particles.push({\n                                    x: pest.x, y: pest.y, z: pest.z,\n                                    vx: (Math.random() - 0.5) * 0.1,\n                                    vy: Math.random() * 0.1,\n                                    vz: (Math.random() - 0.5) * 0.1,\n                                    life: 20, type: 'spark', size: 2\n                                });\n                            }\n                        }\n                        \n                        // If caught in leaves, slowly release\n                        if (pest.caughtInLeaves) {\n                            pest.vx *= 0.9;\n                            pest.vy *= 0.9;\n                            pest.vz *= 0.9;\n                            pest.vy += 0.01; // Slowly float up out of tree\n                            if (Math.abs(pest.vx) < 0.01 && Math.abs(pest.vz) < 0.01) {\n                                pest.caughtInLeaves = false;\n                            }\n                        } else {\n                            // Normal drag and gravity\n                            pest.vx *= 0.95;\n                            pest.vy *= 0.95;\n                            pest.vy -= 0.01; // Gravity\n                            pest.vz *= 0.95;\n                        }\n                        \n                        // Spin animation\n                        pest.knockbackSpin += 0.3;\n                        \n                        // Recover when velocity is low enough - angrier birds recover faster\n                        const speed = Math.sqrt(pest.vx * pest.vx + pest.vy * pest.vy + pest.vz * pest.vz);\n                        const recoveryThreshold = 0.05 + pest.anger * 0.02;\n                        if (speed < recoveryThreshold || pest.stateTimer <= 0) {\n                            // Getting shot makes the bird ANGRIER!\n                            pest.anger = Math.min(5, pest.anger + 1);\n                            pest.timesShot++;\n                            \n                            // Spawn reinforcements when threshold reached\n                            if (pest.timesShot === pest.spawnThreshold && this.pestBirds.length < 15) {\n                                const numToSpawn = 2 + Math.floor(Math.random() * 2); // 2-3 new birds\n                                for (let i = 0; i < numToSpawn; i++) {\n                                    const newAngle = Math.random() * Math.PI * 2;\n                                    const newRadius = 3 + Math.random() * 2;\n                                    this.pestBirds.push({\n                                        x: this.camera.x + Math.cos(newAngle) * newRadius,\n                                        y: this.camera.y + 1 + Math.random(),\n                                        z: this.camera.z + Math.sin(newAngle) * newRadius,\n                                        vx: 0, vy: 0, vz: 0,\n                                        targetOffsetX: 0, targetOffsetY: 0, targetOffsetZ: 0,\n                                        state: 'circling',\n                                        stateTimer: 20 + Math.random() * 30,\n                                        angle: newAngle,\n                                        circleRadius: newRadius,\n                                        baseCircleRadius: newRadius,\n                                        circleSpeed: 0.06 + Math.random() * 0.04,\n                                        swoopProgress: 0,\n                                        wingPhase: Math.random() * Math.PI * 2,\n                                        size: 0.2 + Math.random() * 0.05,\n                                        chirpTimer: Math.random() * 60,\n                                        knockbackSpin: 0,\n                                        anger: 2 + Math.floor(Math.random() * 2), // Spawned already angry (2-3)\n                                        timesShot: 0,\n                                        spawnThreshold: 4 + Math.floor(Math.random() * 4)\n                                    });\n                                }\n                            }\n                            \n                            pest.state = 'retreating';\n                            pest.stateTimer = Math.max(30, 120 - pest.anger * 20); // Shorter retreat when angry\n                            pest.circleRadius = (pest.baseCircleRadius + 4) * angerRadiusMult;\n                            pest.vx = pest.vy = pest.vz = 0;\n                            pest.knockbackSpin = 0;\n                            pest.caughtInLeaves = false;\n                        }\n                        continue; // Skip normal movement\n                    }\n                    \n                    // State machine for pest behavior\n                    switch (pest.state) {\n                        case 'circling':\n                            // Circle around player's head - faster and closer when angry\n                            pest.angle += pest.circleSpeed * angerSpeedMult;\n                            pest.targetOffsetX = Math.cos(pest.angle) * pest.circleRadius * angerRadiusMult;\n                            pest.targetOffsetZ = Math.sin(pest.angle) * pest.circleRadius * angerRadiusMult;\n                            pest.targetOffsetY = 0.5 + Math.sin(pest.angle * 2) * 0.3;\n                            \n                            // Gradually return to base radius\n                            pest.circleRadius += (pest.baseCircleRadius - pest.circleRadius) * 0.01;\n                            \n                            // Randomly decide to swoop - more likely when angry\n                            if (pest.stateTimer <= 0) {\n                                if (Math.random() < angerSwoopChance) {\n                                    pest.state = 'swooping';\n                                    pest.swoopProgress = 0;\n                                    pest.stateTimer = 60;\n                                } else if (Math.random() < 0.2) {\n                                    pest.state = 'hovering';\n                                    pest.stateTimer = Math.max(20, 40 - pest.anger * 5) + Math.random() * 40;\n                                } else {\n                                    pest.stateTimer = Math.max(15, 30 - pest.anger * 5) + Math.random() * 60;\n                                }\n                            }\n                            break;\n                            \n                        case 'swooping':\n                            // Dive at the player's face! Faster when angry\n                            pest.swoopProgress += 0.05 * angerSpeedMult;\n                            const swoopT = pest.swoopProgress;\n                            \n                            if (swoopT < 0.5) {\n                                // Diving in\n                                pest.targetOffsetX = Math.cos(pest.angle) * pest.circleRadius * (1 - swoopT * 2);\n                                pest.targetOffsetZ = Math.sin(pest.angle) * pest.circleRadius * (1 - swoopT * 2);\n                                pest.targetOffsetY = 0.5 - swoopT;\n                            } else {\n                                // Pulling away\n                                const pullT = (swoopT - 0.5) * 2;\n                                pest.targetOffsetX = Math.cos(pest.angle) * pest.circleRadius * pullT;\n                                pest.targetOffsetZ = Math.sin(pest.angle) * pest.circleRadius * pullT;\n                                pest.targetOffsetY = -0.5 + pullT;\n                            }\n                            \n                            if (pest.swoopProgress >= 1) {\n                                pest.state = 'retreating';\n                                pest.stateTimer = 30;\n                            }\n                            break;\n                            \n                        case 'retreating':\n                            // Back off temporarily\n                            pest.angle += pest.circleSpeed * 0.5;\n                            const retreatDist = pest.circleRadius + 2;\n                            pest.targetOffsetX = Math.cos(pest.angle) * retreatDist;\n                            pest.targetOffsetZ = Math.sin(pest.angle) * retreatDist;\n                            pest.targetOffsetY = 1 + Math.sin(pest.angle * 3) * 0.2;\n                            \n                            // Gradually return to base radius\n                            pest.circleRadius += (pest.baseCircleRadius - pest.circleRadius) * 0.02;\n                            \n                            if (pest.stateTimer <= 0) {\n                                pest.state = 'circling';\n                                pest.stateTimer = 60 + Math.random() * 60;\n                            }\n                            break;\n                            \n                        case 'hovering':\n                            // Hover annoyingly in front of player's face\n                            const hoverAngle = Math.sin(Date.now() * 0.01) * 0.3;\n                            pest.targetOffsetX = Math.sin(this.camera.rotY + hoverAngle) * -1.5;\n                            pest.targetOffsetZ = Math.cos(this.camera.rotY + hoverAngle) * -1.5;\n                            pest.targetOffsetY = 0.2 + Math.sin(Date.now() * 0.02) * 0.1;\n                            \n                            if (pest.stateTimer <= 0) {\n                                pest.state = 'circling';\n                                pest.stateTimer = 80 + Math.random() * 40;\n                            }\n                            break;\n                    }\n                    \n                    // Smoothly move toward target position with max speed cap\n                    const targetX = playerX + pest.targetOffsetX;\n                    const targetY = playerY + pest.targetOffsetY;\n                    const targetZ = playerZ + pest.targetOffsetZ;\n                    \n                    const smoothing = pest.state === 'swooping' ? 0.15 : 0.08;\n                    let dx = (targetX - pest.x) * smoothing;\n                    let dy = (targetY - pest.y) * smoothing;\n                    let dz = (targetZ - pest.z) * smoothing;\n                    \n                    // Cap maximum speed so player can outrun angry birds\n                    // Player moves at ~0.1 per frame when running, birds max at 0.08\n                    // Rage mode allows birds to match player speed temporarily\n                    const baseMaxSpeed = 0.08;\n                    const maxBirdSpeed = pest.rageMode ? 0.12 : baseMaxSpeed; // Rage birds can be faster!\n                    const moveSpeed = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                    if (moveSpeed > maxBirdSpeed) {\n                        const scale = maxBirdSpeed / moveSpeed;\n                        dx *= scale;\n                        dy *= scale;\n                        dz *= scale;\n                    }\n                    \n                    pest.x += dx;\n                    pest.y += dy;\n                    pest.z += dz;\n                }\n            },\n            \n            updateBirds() {\n                for (const bird of this.birds) {\n                    // Handle swarm mode timer\n                    if (bird.swarmMode && bird.swarmTimer) {\n                        bird.swarmTimer--;\n                        if (bird.swarmTimer <= 0) {\n                            bird.swarmMode = false;\n                        }\n                    }\n                    \n                    // Swarm mode: birds converge on player\n                    if (bird.swarmMode) {\n                        // Move towards player\n                        const dx = this.camera.x - bird.x;\n                        const dy = this.camera.y - bird.y;\n                        const dz = this.camera.z - bird.z;\n                        const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                        \n                        if (dist > 3) {\n                            // Try to move, but check for collisions\n                            const newX = bird.x + (dx / dist) * 0.15;\n                            const newY = bird.y + (dy / dist) * 0.1;\n                            const newZ = bird.z + (dz / dist) * 0.15;\n                            \n                            // Move in X if no collision\n                            if (!this.checkBirdCollision(newX, bird.y, bird.z, 0.3)) {\n                                bird.x = newX;\n                            } else {\n                                // Try going around - move perpendicular\n                                bird.x += (dz / dist) * 0.1; // Move sideways\n                            }\n                            \n                            // Move in Y if no collision\n                            if (!this.checkBirdCollision(bird.x, newY, bird.z, 0.3)) {\n                                bird.y = newY;\n                            }\n                            \n                            // Move in Z if no collision\n                            if (!this.checkBirdCollision(bird.x, bird.y, newZ, 0.3)) {\n                                bird.z = newZ;\n                            } else {\n                                // Try going around - move perpendicular\n                                bird.z += (dx / dist) * 0.1; // Move sideways\n                            }\n                        } else {\n                            // Circle close to player\n                            bird.angle += 0.1;\n                            bird.x = this.camera.x + Math.cos(bird.angle) * 3;\n                            bird.z = this.camera.z + Math.sin(bird.angle) * 3;\n                            bird.y = this.camera.y + Math.sin(bird.wobble) * 0.5;\n                        }\n                        \n                        bird.wobble += bird.wobbleSpeed * 2;\n                        bird.wingPhase += 0.5; // Faster flapping\n                    } else {\n                        // Normal flight pattern\n                        // Circular flight pattern with wobble\n                        bird.angle += bird.speed;\n                        bird.wobble += bird.wobbleSpeed;\n                        \n                        // Center point slowly drifts\n                        const centerX = Math.sin(bird.angle * 0.1) * 20;\n                        const centerZ = Math.cos(bird.angle * 0.1) * 20;\n                        \n                        // Base position\n                        let bx = centerX + Math.cos(bird.angle) * bird.radius;\n                        let bz = centerZ + Math.sin(bird.angle) * bird.radius;\n                        \n                        // Wind affects bird position\n                        if (this.wind) {\n                            bx += this.wind.x * 15;\n                            bz += this.wind.z * 15;\n                        }\n                        \n                        bird.x = bx;\n                        bird.z = bz;\n                        bird.y = bird.baseY + Math.sin(bird.wobble) * 2;\n                        \n                        // Wing flapping\n                        bird.wingPhase += 0.3;\n                    }\n                }\n                \n                // Also update pest birds\n                this.updatePestBirds();\n                \n                // Update other mobs\n                this.updateBlueBirds();\n                this.updateFish();\n                this.updateCats();\n                this.updateCreepers();\n                \n                // Friendly birds can drop items\n                this.updateFriendlyBirdDrops();\n                \n                // Update bird event timer\n                this.updateBirdEventTimer();\n            },\n            \n            // Blue birds - aggressive birds that knockback player\n            updateBlueBirds() {\n                if (!this.blueBirds) this.blueBirds = [];\n                \n                for (let i = this.blueBirds.length - 1; i >= 0; i--) {\n                    const bird = this.blueBirds[i];\n                    \n                    bird.wingPhase += 0.6;\n                    if (bird.attackCooldown > 0) bird.attackCooldown--;\n                    \n                    // Chase player aggressively\n                    const dx = this.camera.x - bird.x;\n                    const dy = this.camera.y - bird.y;\n                    const dz = this.camera.z - bird.z;\n                    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                    \n                    if (dist > 1.5) {\n                        // Move towards player\n                        bird.vx += (dx / dist) * 0.02;\n                        bird.vy += (dy / dist) * 0.015;\n                        bird.vz += (dz / dist) * 0.02;\n                    }\n                    \n                    // Apply velocity with drag - check collisions\n                    const newX = bird.x + bird.vx;\n                    const newY = bird.y + bird.vy;\n                    const newZ = bird.z + bird.vz;\n                    \n                    if (!this.checkBirdCollision(newX, bird.y, bird.z, 0.3)) {\n                        bird.x = newX;\n                    } else {\n                        bird.vx *= -0.5; // Bounce off walls\n                    }\n                    \n                    if (!this.checkBirdCollision(bird.x, newY, bird.z, 0.3)) {\n                        bird.y = newY;\n                    } else {\n                        bird.vy *= -0.5; // Bounce off ceiling/floor\n                    }\n                    \n                    if (!this.checkBirdCollision(bird.x, bird.y, newZ, 0.3)) {\n                        bird.z = newZ;\n                    } else {\n                        bird.vz *= -0.5; // Bounce off walls\n                    }\n                    bird.vx *= 0.9;\n                    bird.vy *= 0.9;\n                    bird.vz *= 0.9;\n                    \n                    // Attack player - knockback\n                    if (dist < 2 && bird.attackCooldown <= 0) {\n                        // Knockback player slightly\n                        this.velocity.x += (this.camera.x - bird.x) * 0.1;\n                        this.velocity.y += 0.15;\n                        this.velocity.z += (this.camera.z - bird.z) * 0.1;\n                        bird.attackCooldown = 60; // 1 second cooldown\n                    }\n                    \n                    // Despawn if too far\n                    if (dist > 60) {\n                        this.blueBirds.splice(i, 1);\n                    }\n                }\n            },\n            \n            // Fish in water\n            updateFish() {\n                if (!this.fish) this.fish = [];\n                \n                for (let i = this.fish.length - 1; i >= 0; i--) {\n                    const fish = this.fish[i];\n                    fish.swimPhase += 0.15;\n                    \n                    // Swim in water\n                    const block = this.getBlock(Math.floor(fish.x), Math.floor(fish.y), Math.floor(fish.z));\n                    if (block !== 'water') {\n                        // Not in water - try to find water\n                        fish.vy -= 0.01; // Fall\n                    } else {\n                        // In water - swim around\n                        fish.vx += (Math.random() - 0.5) * 0.01;\n                        fish.vz += (Math.random() - 0.5) * 0.01;\n                        fish.vy += (Math.random() - 0.5) * 0.005;\n                    }\n                    \n                    fish.x += fish.vx;\n                    fish.y += fish.vy;\n                    fish.z += fish.vz;\n                    fish.vx *= 0.95;\n                    fish.vy *= 0.95;\n                    fish.vz *= 0.95;\n                    \n                    // Limit speed\n                    const speed = Math.sqrt(fish.vx * fish.vx + fish.vz * fish.vz);\n                    if (speed > 0.08) {\n                        fish.vx = (fish.vx / speed) * 0.08;\n                        fish.vz = (fish.vz / speed) * 0.08;\n                    }\n                }\n            },\n            \n            // Cats follow player\n            updateCats() {\n                if (!this.cats) this.cats = [];\n                \n                for (const cat of this.cats) {\n                    cat.walkPhase += 0.1;\n                    cat.meowTimer--;\n                    \n                    const dx = this.camera.x - cat.x;\n                    const dz = this.camera.z - cat.z;\n                    const dist = Math.sqrt(dx * dx + dz * dz);\n                    \n                    // Follow player if too far\n                    if (dist > cat.followDistance + 2) {\n                        cat.state = 'following';\n                        cat.vx += (dx / dist) * 0.01;\n                        cat.vz += (dz / dist) * 0.01;\n                    } else if (dist < cat.followDistance) {\n                        cat.state = 'idle';\n                    }\n                    \n                    // Apply movement with ground detection\n                    cat.x += cat.vx;\n                    cat.z += cat.vz;\n                    cat.vx *= 0.85;\n                    cat.vz *= 0.85;\n                    \n                    // Gravity and ground collision\n                    cat.vy -= 0.02;\n                    cat.y += cat.vy;\n                    \n                    const groundY = Math.floor(cat.y);\n                    if (this.getBlock(Math.floor(cat.x), groundY, Math.floor(cat.z))) {\n                        cat.y = groundY + 1;\n                        cat.vy = 0;\n                    }\n                    \n                    // Random meow\n                    if (cat.meowTimer <= 0) {\n                        cat.meowTimer = 200 + Math.random() * 400;\n                        // Add meow particle/effect if desired\n                    }\n                }\n            },\n            \n            // Creepers stalk and explode\n            updateCreepers() {\n                if (!this.creepers) this.creepers = [];\n                \n                for (let i = this.creepers.length - 1; i >= 0; i--) {\n                    const creeper = this.creepers[i];\n                    creeper.walkPhase += 0.08;\n                    \n                    const dx = this.camera.x - creeper.x;\n                    const dz = this.camera.z - creeper.z;\n                    const dist = Math.sqrt(dx * dx + dz * dz);\n                    \n                    if (creeper.state === 'stalking') {\n                        // Walk towards player slowly\n                        if (dist > 2) {\n                            creeper.vx += (dx / dist) * 0.003;\n                            creeper.vz += (dz / dist) * 0.003;\n                        } else {\n                            // Close enough - start fuse!\n                            creeper.state = 'fusing';\n                            creeper.fuseTimer = 0;\n                        }\n                    } else if (creeper.state === 'fusing') {\n                        creeper.fuseTimer++;\n                        \n                        // Flash warning\n                        creeper.flashing = Math.floor(creeper.fuseTimer / 5) % 2 === 0;\n                        \n                        if (creeper.fuseTimer >= creeper.fuseMax) {\n                            // EXPLODE!\n                            this.creeperExplode(creeper);\n                            this.creepers.splice(i, 1);\n                            continue;\n                        }\n                        \n                        // Player can escape\n                        if (dist > 4) {\n                            creeper.state = 'stalking';\n                            creeper.fuseTimer = 0;\n                        }\n                    }\n                    \n                    // Apply movement\n                    creeper.x += creeper.vx;\n                    creeper.z += creeper.vz;\n                    creeper.vx *= 0.9;\n                    creeper.vz *= 0.9;\n                    \n                    // Gravity\n                    creeper.vy -= 0.02;\n                    creeper.y += creeper.vy;\n                    \n                    const groundY = Math.floor(creeper.y);\n                    if (this.getBlock(Math.floor(creeper.x), groundY, Math.floor(creeper.z))) {\n                        creeper.y = groundY + 1;\n                        creeper.vy = 0;\n                    }\n                }\n            },\n            \n            // Creeper explosion\n            creeperExplode(creeper) {\n                // Launch player\n                const dx = this.camera.x - creeper.x;\n                const dz = this.camera.z - creeper.z;\n                const dist = Math.sqrt(dx * dx + dz * dz);\n                if (dist < 6) {\n                    const force = (6 - dist) / 6 * 1.5;\n                    this.velocity.x += (dx / dist) * force;\n                    this.velocity.y += 0.8;\n                    this.velocity.z += (dz / dist) * force;\n                }\n                \n                // Explosion particles\n                for (let i = 0; i < 30; i++) {\n                    this.particles.push({\n                        x: creeper.x, y: creeper.y + 0.5, z: creeper.z,\n                        vx: (Math.random() - 0.5) * 0.3,\n                        vy: Math.random() * 0.3,\n                        vz: (Math.random() - 0.5) * 0.3,\n                        life: 30 + Math.random() * 20,\n                        type: 'explosion',\n                        size: 3 + Math.random() * 3\n                    });\n                }\n                \n                // Spawn blue bird horde!\n                for (let i = 0; i < 5; i++) {\n                    this.spawnBlueBird();\n                }\n                \n                // Alert\n                if (this.birdEvent) {\n                    this.showBirdAlert('üí• CREEPER EXPLODED! Blue birds incoming! üí•');\n                }\n            },\n            \n            // Friendly birds drop items\n            updateFriendlyBirdDrops() {\n                if (!this.birdDropTimer) this.birdDropTimer = 0;\n                this.birdDropTimer++;\n                \n                // Every ~10 seconds, chance for friendly bird to drop item\n                if (this.birdDropTimer >= 600) {\n                    this.birdDropTimer = 0;\n                    \n                    for (const bird of this.birds) {\n                        // 30% chance per bird\n                        if (Math.random() < 0.3) {\n                            // Determine drop\n                            const roll = Math.random();\n                            let dropType = 'seeds';\n                            let dropCount = 1 + Math.floor(Math.random() * 3);\n                            \n                            if (roll < 0.05) {\n                                // 5% rare item\n                                dropType = ['berdger', 'omamori', 'shimenawa'][Math.floor(Math.random() * 3)];\n                                dropCount = 1;\n                            } else if (roll < 0.2) {\n                                // 15% apple\n                                dropType = 'apple';\n                                dropCount = 1 + Math.floor(Math.random() * 2);\n                            }\n                            \n                            // Drop item near player\n                            this.dropItem(\n                                bird.x + (Math.random() - 0.5) * 2,\n                                bird.y - 2,\n                                bird.z + (Math.random() - 0.5) * 2,\n                                dropType, dropCount\n                            );\n                            \n                            // Only one drop per cycle\n                            break;\n                        }\n                    }\n                }\n            },\n            \n            // Bird event timer system\n            updateBirdEventTimer() {\n                if (!this.birdEvent) return;\n                \n                const now = Date.now();\n                const delta = now - this.birdEvent.lastUpdate;\n                this.birdEvent.lastUpdate = now;\n                this.birdEvent.timer -= delta;\n                \n                // Fade out alerts\n                if (this.birdEvent.alertFade > 0) {\n                    this.birdEvent.alertFade -= delta;\n                    if (this.birdEvent.alertFade <= 0) {\n                        this.birdEvent.alertMessage = null;\n                    }\n                }\n                \n                const timeLeft = this.birdEvent.timer;\n                const nextEvent = this.birdEvent.events[this.birdEvent.currentEvent];\n                \n                // Show alerts at specific times\n                if (timeLeft <= 5 * 60 * 1000 && timeLeft > 4 * 60 * 1000 && !this.birdEvent.alertShown.five) {\n                    this.showBirdAlert(`‚ö†Ô∏è In 5 minutes, ${nextEvent.description} ‚ö†Ô∏è`);\n                    this.birdEvent.alertShown.five = true;\n                }\n                if (timeLeft <= 3 * 60 * 1000 && timeLeft > 2 * 60 * 1000 && !this.birdEvent.alertShown.three) {\n                    this.showBirdAlert(`‚ö†Ô∏è In 3 minutes, ${nextEvent.description} ‚ö†Ô∏è`);\n                    this.birdEvent.alertShown.three = true;\n                }\n                if (timeLeft <= 1 * 60 * 1000 && timeLeft > 50 * 1000 && !this.birdEvent.alertShown.one) {\n                    this.showBirdAlert(`‚ö†Ô∏è In 1 minute, ${nextEvent.description} ‚ö†Ô∏è`);\n                    this.birdEvent.alertShown.one = true;\n                }\n                if (timeLeft <= 30 * 1000 && timeLeft > 20 * 1000 && !this.birdEvent.alertShown.thirty) {\n                    this.showBirdAlert(`‚ö†Ô∏è In 30 seconds, ${nextEvent.description.toUpperCase()} ‚ö†Ô∏è`);\n                    this.birdEvent.alertShown.thirty = true;\n                }\n                if (timeLeft <= 10 * 1000 && timeLeft > 5 * 1000 && !this.birdEvent.alertShown.ten) {\n                    this.showBirdAlert(`üî• In 10 seconds, ${nextEvent.description.toUpperCase()} üî•`);\n                    this.birdEvent.alertShown.ten = true;\n                }\n                \n                // Trigger event when timer reaches 0\n                if (timeLeft <= 0) {\n                    this.triggerBirdEvent();\n                }\n            },\n            \n            showBirdAlert(message) {\n                this.birdEvent.alertMessage = message;\n                this.birdEvent.alertFade = 4000; // 4 seconds\n            },\n            \n            triggerBirdEvent() {\n                const event = this.birdEvent.events[this.birdEvent.currentEvent];\n                this.showBirdAlert(`üê¶ BIRD EVENT: ${event.name}! üê¶`);\n                event.action();\n                \n                // Reset timer and move to next event\n                this.birdEvent.timer = 5 * 60 * 1000; // Reset to 5 minutes\n                this.birdEvent.currentEvent = (this.birdEvent.currentEvent + 1) % this.birdEvent.events.length;\n                this.birdEvent.alertShown = { five: false, three: false, one: false, thirty: false, ten: false };\n            },\n            \n            // Bird Event 1: Swarm - all birds converge on player\n            triggerBirdSwarm() {\n                // Make all decorative birds become aggressive for 30 seconds\n                for (const bird of this.birds) {\n                    bird.swarmMode = true;\n                    bird.swarmTimer = 30 * 60; // 30 seconds at 60fps\n                }\n                // Also spawn extra pest birds\n                for (let i = 0; i < 5; i++) {\n                    this.spawnPestBird();\n                }\n            },\n            \n            // Bird Event 2: Rage - pest birds become faster and more aggressive\n            triggerBirdRage() {\n                // Boost all pest birds\n                if (this.pestBirds) {\n                    for (const bird of this.pestBirds) {\n                        bird.rageMode = true;\n                        bird.rageTimer = 45 * 60; // 45 seconds\n                        bird.speed = (bird.speed || 0.06) * 1.5;\n                    }\n                }\n                // Spawn some extra angry birds\n                for (let i = 0; i < 3; i++) {\n                    const bird = this.spawnPestBird();\n                    if (bird) {\n                        bird.rageMode = true;\n                        bird.rageTimer = 45 * 60;\n                    }\n                }\n            },\n            \n            // Bird Event 3: Multiply - spawn many birds everywhere\n            triggerBirdMultiply() {\n                // Spawn lots of pest birds at random locations around the player\n                for (let i = 0; i < 10; i++) {\n                    const angle = Math.random() * Math.PI * 2;\n                    const dist = 10 + Math.random() * 20;\n                    const bird = this.spawnPestBird();\n                    if (bird) {\n                        bird.x = this.camera.x + Math.cos(angle) * dist;\n                        bird.z = this.camera.z + Math.sin(angle) * dist;\n                        bird.y = this.camera.y + 5 + Math.random() * 10;\n                    }\n                }\n            },\n            \n            // Bird Event 4: Creeper Invasion - spawn stalking creepers\n            triggerCreeperInvasion() {\n                this.showBirdAlert('üí• CREEPERS ARE STALKING YOU! üí•');\n                // Spawn 2-4 creepers around the player\n                const numCreepers = 2 + Math.floor(Math.random() * 3);\n                for (let i = 0; i < numCreepers; i++) {\n                    this.spawnCreeper();\n                }\n            },\n            \n            spawnPestBird() {\n                if (!this.pestBirds) this.pestBirds = [];\n                const bird = {\n                    x: this.camera.x + (Math.random() - 0.5) * 30,\n                    y: this.camera.y + 10 + Math.random() * 10,\n                    z: this.camera.z + (Math.random() - 0.5) * 30,\n                    vx: 0, vy: 0, vz: 0,\n                    state: 'hunting',\n                    wingPhase: Math.random() * Math.PI * 2,\n                    speed: 0.06,\n                    angryTimer: 60 * 60 * 5 // 5 minutes\n                };\n                this.pestBirds.push(bird);\n                return bird;\n            },\n            \n            // Spawn blue bird (more aggressive, can knockback player)\n            spawnBlueBird() {\n                if (!this.blueBirds) this.blueBirds = [];\n                const bird = {\n                    x: this.camera.x + (Math.random() - 0.5) * 20,\n                    y: this.camera.y + 5 + Math.random() * 8,\n                    z: this.camera.z + (Math.random() - 0.5) * 20,\n                    vx: 0, vy: 0, vz: 0,\n                    state: 'aggressive',\n                    wingPhase: Math.random() * Math.PI * 2,\n                    speed: 0.1, // Faster than normal birds\n                    attackCooldown: 0\n                };\n                this.blueBirds.push(bird);\n                return bird;\n            },\n            \n            // Spawn fish in water\n            spawnFish() {\n                if (!this.fish) this.fish = [];\n                // Find water to spawn in\n                let waterPos = null;\n                for (let attempts = 0; attempts < 50; attempts++) {\n                    const x = Math.floor(this.camera.x + (Math.random() - 0.5) * 40);\n                    const z = Math.floor(this.camera.z + (Math.random() - 0.5) * 40);\n                    for (let y = 20; y >= 0; y--) {\n                        if (this.getBlock(x, y, z) === 'water') {\n                            waterPos = { x: x + 0.5, y: y + 0.5, z: z + 0.5 };\n                            break;\n                        }\n                    }\n                    if (waterPos) break;\n                }\n                \n                if (!waterPos) {\n                    // Spawn near player in any case\n                    waterPos = { \n                        x: this.camera.x + (Math.random() - 0.5) * 10, \n                        y: 7, \n                        z: this.camera.z + (Math.random() - 0.5) * 10 \n                    };\n                }\n                \n                const fish = {\n                    x: waterPos.x, y: waterPos.y, z: waterPos.z,\n                    vx: (Math.random() - 0.5) * 0.05,\n                    vy: 0,\n                    vz: (Math.random() - 0.5) * 0.05,\n                    swimPhase: Math.random() * Math.PI * 2,\n                    color: Math.random() > 0.5 ? '#ff6347' : '#ffd700', // Orange or gold\n                    size: 0.3 + Math.random() * 0.2\n                };\n                this.fish.push(fish);\n                return fish;\n            },\n            \n            // Spawn cat that follows player\n            spawnCat() {\n                if (!this.cats) this.cats = [];\n                const cat = {\n                    x: this.camera.x + (Math.random() - 0.5) * 10,\n                    y: this.camera.y - 1,\n                    z: this.camera.z + (Math.random() - 0.5) * 10,\n                    vx: 0, vy: 0, vz: 0,\n                    state: 'idle',\n                    walkPhase: 0,\n                    color: ['#ffa500', '#808080', '#000000', '#ffffff'][Math.floor(Math.random() * 4)], // Orange, gray, black, white\n                    meowTimer: Math.random() * 300 + 200,\n                    followDistance: 3 + Math.random() * 2\n                };\n                this.cats.push(cat);\n                return cat;\n            },\n            \n            // Spawn creeper (explodes, spawns blue birds)\n            spawnCreeper() {\n                if (!this.creepers) this.creepers = [];\n                const creeper = {\n                    x: this.camera.x + (Math.random() > 0.5 ? 15 : -15) + (Math.random() - 0.5) * 10,\n                    y: this.camera.y,\n                    z: this.camera.z + (Math.random() > 0.5 ? 15 : -15) + (Math.random() - 0.5) * 10,\n                    vx: 0, vy: 0, vz: 0,\n                    state: 'stalking',\n                    fuseTimer: 0,\n                    fuseMax: 90, // 1.5 seconds fuse\n                    walkPhase: 0,\n                    health: 3\n                };\n                this.creepers.push(creeper);\n                return creeper;\n            },\n            \n            // Update survival HUD\n            updateSurvivalHUD() {\n                if (!this.survivalStats) return;\n                \n                const scoreEl = document.getElementById('scoreDisplay');\n                const waveEl = document.getElementById('waveDisplay');\n                const objEl = document.getElementById('objectiveDisplay');\n                \n                if (scoreEl) scoreEl.textContent = `Score: ${this.survivalStats.score}`;\n                if (waveEl) waveEl.textContent = `Wave: ${this.survivalStats.wave}`;\n                if (objEl && this.survivalStats.currentObjective) {\n                    objEl.textContent = `Objective: ${this.survivalStats.currentObjective.text}`;\n                }\n            },\n            \n            // Generate Ritual Temple - only one per world\n            generateRitualTemple(x, y, z) {\n                const w = 11;\n                const h = 8;\n                const d = 11;\n                \n                // Mark temple location\n                this.ritualTempleLocation = { x, y, z };\n                \n                // Clear space\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h + 2; dy++) {\n                            this.setBlock(x + dx, y + dy, z + dz, null);\n                        }\n                    }\n                }\n                \n                // Floor\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y, z + dz, 'ritualStone');\n                    }\n                }\n                \n                // Walls\n                for (let dy = 1; dy < h; dy++) {\n                    for (let dx = 0; dx < w; dx++) {\n                        this.setBlock(x + dx, y + dy, z, 'ritualStone');\n                        this.setBlock(x + dx, y + dy, z + d - 1, 'ritualStone');\n                    }\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x, y + dy, z + dz, 'ritualStone');\n                        this.setBlock(x + w - 1, y + dy, z + dz, 'ritualStone');\n                    }\n                }\n                \n                // Entrance\n                this.setBlock(x + w/2|0, y + 1, z, null);\n                this.setBlock(x + w/2|0, y + 2, z, null);\n                this.setBlock(x + w/2|0, y + 3, z, null);\n                \n                // Ritual socket blocks in center (5 sockets for 5 ritual items)\n                const cx = x + w/2|0;\n                const cz = z + d/2|0;\n                \n                this.setBlock(cx, y + 1, cz, 'charmSocket');      // Center - Omamori\n                this.setBlock(cx - 2, y + 1, cz, 'petalSocket');  // Left - Sakura Petal\n                this.setBlock(cx + 2, y + 1, cz, 'ropeSocket');   // Right - Shimenawa\n                this.setBlock(cx, y + 1, cz - 2, 'plaqueSocket'); // Back - Ema\n                this.setBlock(cx, y + 1, cz + 2, 'incenseSocket'); // Front - Incense\n                \n                // Glowing pillars\n                for (let dy = 1; dy <= 4; dy++) {\n                    this.setBlock(x + 2, y + dy, z + 2, 'glowstone');\n                    this.setBlock(x + w - 3, y + dy, z + 2, 'glowstone');\n                    this.setBlock(x + 2, y + dy, z + d - 3, 'glowstone');\n                    this.setBlock(x + w - 3, y + dy, z + d - 3, 'glowstone');\n                }\n            },\n            \n            // Generate apple tree with green leaves and chance to drop apples\n            generateTree(x, y, z) {\n                for (let h = 0; h < 4; h++) {\n                    this.setBlock(x, y + h, z, 'wood');\n                }\n                for (let dx = -2; dx <= 2; dx++) {\n                    for (let dz = -2; dz <= 2; dz++) {\n                        for (let dy = 3; dy <= 5; dy++) {\n                            if (Math.abs(dx) + Math.abs(dz) + Math.abs(dy - 4) < 4) {\n                                if (!(dx === 0 && dz === 0 && dy < 4)) {\n                                    this.setBlock(x + dx, y + dy, z + dz, 'appleLeaves');\n                                }\n                            }\n                        }\n                    }\n                }\n                // Store apple tree for occasional apple drops\n                if (!this.appleTrees) this.appleTrees = [];\n                this.appleTrees.push({ x, y: y + 4, z });\n            },\n            \n            // Generate cherry blossom tree (larger, more dramatic)\n            generateCherryTree(x, y, z) {\n                // Taller trunk with pink-tinted wood\n                for (let h = 0; h < 6; h++) {\n                    this.setBlock(x, y + h, z, 'cherryWood');\n                }\n                \n                // Wider, more dramatic canopy\n                for (let dx = -3; dx <= 3; dx++) {\n                    for (let dz = -3; dz <= 3; dz++) {\n                        for (let dy = 4; dy <= 8; dy++) {\n                            const dist = Math.abs(dx) + Math.abs(dz) + Math.abs(dy - 6);\n                            if (dist < 5 && Math.random() > 0.15) {\n                                if (!(dx === 0 && dz === 0 && dy < 5)) {\n                                    this.setBlock(x + dx, y + dy, z + dz, 'cherryLeaves');\n                                }\n                            }\n                        }\n                    }\n                }\n                \n                // Store tree location for petal spawning\n                this.cherryTrees.push({ x, y: y + 6, z });\n            },\n            \n            setBlock(x, y, z, type) {\n                const key = `${x},${y},${z}`;\n                if (type === null) {\n                    delete this.world[key];\n                } else {\n                    this.world[key] = type;\n                }\n            },\n            \n            getBlock(x, y, z) {\n                return this.world[`${x},${y},${z}`] || null;\n            },\n            \n            setupControls() {\n                // Keyboard controls\n                document.addEventListener('keydown', (e) => {\n                    if (!this.isActive) return;\n                    \n                    if (e.key === 'Escape') {\n                        e.preventDefault();\n                        \n                        // If inventory is open, close it instead of pausing\n                        if (this.inventoryOpen) {\n                            this.toggleInventory();\n                            return;\n                        }\n                        \n                        if (this.isPaused) {\n                            this.resume();\n                        } else {\n                            this.pause();\n                        }\n                        return;\n                    }\n                    \n                    if (this.isPaused) return;\n                    \n                    this.keys[e.key.toLowerCase()] = true;\n                    \n                    // Hotbar selection (1-9)\n                    const slotKeys = ['1', '2', '3', '4', '5', '6', '7', '8', '9'];\n                    const slotIdx = slotKeys.indexOf(e.key);\n                    if (slotIdx !== -1) {\n                        this.selectedSlot = slotIdx;\n                        const slot = this.inventory.hotbar[slotIdx];\n                        if (slot) {\n                            if (slot.type === 'block') {\n                                this.selectedBlock = slot.id;\n                                this.selectedItem = null;\n                            } else if (slot.type === 'weapon') {\n                                this.selectedItem = slot.id;\n                                this.selectedBlock = null;\n                            }\n                        }\n                        this.updateHotbar();\n                    }\n                    \n                    // Toggle inventory with E\n                    if (e.key.toLowerCase() === 'e') {\n                        this.toggleInventory();\n                    }\n                    \n                    // Drop item with Q\n                    if (e.key.toLowerCase() === 'q') {\n                        this.dropHeldItem();\n                    }\n                    \n                    // Check ritual with R\n                    if (e.key.toLowerCase() === 'r') {\n                        if (this.checkRitual()) {\n                            console.log('Omamori Ritual Complete! Birds are blessed and calmed.');\n                        }\n                    }\n                    \n                    // Toggle debug console with backtick\n                    if (e.key === '`' || e.key === '~') {\n                        e.preventDefault();\n                        this.toggleDebugConsole();\n                        return;\n                    }\n                    \n                    // Jump is handled in update() for continuous jumping while holding space\n                    \n                    e.preventDefault();\n                });\n                \n                document.addEventListener('keyup', (e) => {\n                    this.keys[e.key.toLowerCase()] = false;\n                });\n                \n                // ===== POINTER LOCK CONTROLS (Industry Standard for Browser FPS) =====\n                // Pointer Lock is the ONLY way to truly capture mouse across monitors\n                \n                this.pointerLocked = false;\n                \n                // Pointer lock state change handler\n                document.addEventListener('pointerlockchange', () => {\n                    this.pointerLocked = document.pointerLockElement === this.canvas;\n                    \n                    if (this.pointerLocked) {\n                        // Successfully locked - hide overlay\n                        document.getElementById('clickToPlay').classList.remove('active');\n                    } else {\n                        // Lock released (user pressed ESC or we exited)\n                        // If game is active and not paused and inventory is NOT open\n                        // and we didn't just close the inventory, pause\n                        if (this.isActive && !this.isPaused && !this.inventoryOpen && !this.justClosedInventory) {\n                            this.pause();\n                        }\n                    }\n                });\n                \n                // Pointer lock error handler\n                document.addEventListener('pointerlockerror', () => {\n                    console.log('Pointer lock failed');\n                    // Show the click overlay so user can try again\n                    if (this.isActive && !this.isPaused) {\n                        document.getElementById('clickToPlay').classList.add('active');\n                    }\n                });\n                \n                // Mouse button handler - works during pointer lock\n                this.canvas.addEventListener('mousedown', (e) => {\n                    if (!this.isActive || this.isPaused) return;\n                    \n                    // If inventory is open, handle inventory clicks\n                    if (this.inventoryOpen) {\n                        // TODO: Handle inventory slot clicks\n                        return;\n                    }\n                    \n                    // If not locked, any click should request pointer lock\n                    if (!this.pointerLocked) {\n                        this.canvas.requestPointerLock();\n                        return;\n                    }\n                    \n                    if (e.button === 0) {\n                        // Left click - BREAK block\n                        const hit = this.raycast();\n                        if (hit && hit.hit) {\n                            const blockType = this.getBlock(hit.hit.x, hit.hit.y, hit.hit.z);\n                            \n                            // Cannot break water or lava\n                            if (blockType === 'water' || blockType === 'lava') {\n                                return;\n                            }\n                            \n                            // Helper to check if block is a chest\n                            const isChest = (b) => b && (b === 'chest' || b === 'ritualChest' || b === 'buildingChest' || b.toLowerCase().includes('chest'));\n                            \n                            // Helper to check if block is a socket (indestructible)\n                            const isSocket = (b) => b && b.includes('Socket');\n                            if (isSocket(blockType)) {\n                                return; // Can't break socket blocks\n                            }\n                            \n                            this.setBlock(hit.hit.x, hit.hit.y, hit.hit.z, null);\n                            this.stats.blocksBroken++;\n                            \n                            // Score for breaking blocks\n                            if (this.survivalStats) {\n                                this.survivalStats.score += 1;\n                                this.updateSurvivalHUD();\n                            }\n                            \n                            // Drop the block as an item (if it's a normal block, not chest)\n                            if (blockType && !isChest(blockType)) {\n                                // Special drops for certain blocks\n                                if (blockType === 'appleLeaves') {\n                                    // Apple leaves have chance to drop apple\n                                    this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, 'appleLeaves', 1);\n                                    if (Math.random() < 0.15) {\n                                        this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, 'apple', 1);\n                                    }\n                                } else if (blockType === 'cherryLeaves') {\n                                    // Cherry leaves have chance to drop sakura petals\n                                    this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, 'cherryLeaves', 1);\n                                    if (Math.random() < 0.1) {\n                                        this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, 'sakuraPetal', 1);\n                                    }\n                                } else {\n                                    this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, blockType, 1);\n                                }\n                            } else if (isChest(blockType)) {\n                                // Breaking a chest drops its contents\n                                const chestKey = `${hit.hit.x},${hit.hit.y},${hit.hit.z}`;\n                                const contents = this.chestContents && this.chestContents[chestKey];\n                                if (contents && Array.isArray(contents)) {\n                                    for (const item of contents) {\n                                        if (item && item.type) {\n                                            this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, item.type, item.count || 1);\n                                        }\n                                    }\n                                    delete this.chestContents[chestKey];\n                                }\n                                // Also drop the chest itself\n                                this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, 'chest', 1);\n                            }\n                        }\n                    } else if (e.button === 2) {\n                        // Right click - PLACE block, SHOOT, USE item, or interact\n                        // First check for chest interaction\n                        const hit = this.raycast();\n                        if (hit && hit.hit) {\n                            const hitBlock = this.getBlock(hit.hit.x, hit.hit.y, hit.hit.z);\n                            // Check for any type of chest (case-insensitive)\n                            if (hitBlock && (hitBlock === 'chest' || hitBlock === 'ritualChest' || hitBlock === 'buildingChest' || hitBlock.toLowerCase().includes('chest'))) {\n                                this.openChest(hit.hit.x, hit.hit.y, hit.hit.z);\n                                return;\n                            }\n                            \n                            // Check for ritual socket blocks\n                            if (hitBlock && hitBlock.includes('Socket')) {\n                                this.interactWithSocket(hit.hit.x, hit.hit.y, hit.hit.z, hitBlock);\n                                return;\n                            }\n                        }\n                        \n                        // Check held item\n                        const heldSlot = this.inventory.hotbar[this.selectedSlot];\n                        const heldId = heldSlot ? heldSlot.id : null;\n                        \n                        if (this.selectedItem === 'ak47') {\n                            // Shoot the AK-47!\n                            this.shootAK47();\n                        } else if (heldId === 'berdger') {\n                            // Shoot the Berdger! (infinite burgers)\n                            this.shootBerdger();\n                        } else if (heldId === 'apple') {\n                            // Throw an apple at birds\n                            this.throwApple();\n                        } else if (heldId === 'seeds') {\n                            // Use seeds to calm birds\n                            this.useSeeds();\n                        } else if (this.selectedItem === 'water_bucket' || this.selectedItem === 'lava_bucket') {\n                            // Pour bucket\n                            const hit = this.raycast();\n                            if (hit && hit.place) {\n                                const fluidType = this.selectedItem === 'water_bucket' ? 'water' : 'lava';\n                                const placePos = hit.place;\n                                \n                                // Don't pour inside player\n                                const px = Math.floor(this.camera.x);\n                                const pz = Math.floor(this.camera.z);\n                                const feetY = Math.floor(this.camera.y - this.playerEyeHeight);\n                                const headY = Math.floor(this.camera.y - this.playerEyeHeight + this.playerHeight);\n                                \n                                let wouldCollide = false;\n                                for (let checkY = feetY; checkY <= headY; checkY++) {\n                                    if (px === placePos.x && checkY === placePos.y && pz === placePos.z) {\n                                        wouldCollide = true;\n                                        break;\n                                    }\n                                }\n                                \n                                if (!wouldCollide) {\n                                    // Place source fluid block with full level (8)\n                                    this.setBlock(placePos.x, placePos.y, placePos.z, fluidType);\n                                    this.setFluidLevel(placePos.x, placePos.y, placePos.z, 8);\n                                    \n                                    // Add to fluid update queue for spreading\n                                    this.fluidUpdates.push({\n                                        x: placePos.x,\n                                        y: placePos.y,\n                                        z: placePos.z,\n                                        type: fluidType,\n                                        level: 8  // Source block has max level\n                                    });\n                                    \n                                    // Consume bucket\n                                    const slot = this.inventory.hotbar[this.selectedSlot];\n                                    if (slot && slot.count > 1) {\n                                        slot.count--;\n                                    } else {\n                                        this.inventory.hotbar[this.selectedSlot] = null;\n                                        this.selectedItem = null;\n                                    }\n                                    this.updateHotbar();\n                                }\n                            }\n                        } else if (this.selectedBlock) {\n                            // Place block\n                            const hit = this.raycast();\n                            if (hit && hit.place) {\n                                // Don't place block inside player\n                                const px = Math.floor(this.camera.x);\n                                const pz = Math.floor(this.camera.z);\n                                const placePos = hit.place;\n                                \n                                // Check if placement would be inside player body\n                                const feetY = Math.floor(this.camera.y - this.playerEyeHeight);\n                                const headY = Math.floor(this.camera.y - this.playerEyeHeight + this.playerHeight);\n                                \n                                let wouldCollide = false;\n                                for (let checkY = feetY; checkY <= headY; checkY++) {\n                                    if (px === placePos.x && checkY === placePos.y && pz === placePos.z) {\n                                        wouldCollide = true;\n                                        break;\n                                    }\n                                }\n                                \n                                if (!wouldCollide) {\n                                    this.setBlock(placePos.x, placePos.y, placePos.z, this.selectedBlock);\n                                    this.stats.blocksPlaced++;\n                                    \n                                    // Consume block from inventory\n                                    const slot = this.inventory.hotbar[this.selectedSlot];\n                                    if (slot && slot.count > 0) {\n                                        slot.count--;\n                                        if (slot.count <= 0) {\n                                            this.inventory.hotbar[this.selectedSlot] = null;\n                                            this.selectedBlock = null;\n                                        }\n                                        this.updateHotbarDisplay();\n                                    }\n                                }\n                            }\n                        }\n                    }\n                });\n                \n                // Prevent context menu from appearing\n                this.canvas.addEventListener('contextmenu', (e) => {\n                    e.preventDefault();\n                });\n                \n                // Scroll wheel - change hotbar selection\n                this.canvas.addEventListener('wheel', (e) => {\n                    if (!this.isActive || this.isPaused || this.inventoryOpen) return;\n                    e.preventDefault();\n                    \n                    // Scroll down = next slot, scroll up = previous slot\n                    if ((e as WheelEvent).deltaY > 0) {\n                        this.selectedSlot = (this.selectedSlot + 1) % 9;\n                    } else if ((e as WheelEvent).deltaY < 0) {\n                        this.selectedSlot = (this.selectedSlot + 8) % 9; // +8 is same as -1 mod 9\n                    }\n                    \n                    // Update selected item\n                    const slot = this.inventory.hotbar[this.selectedSlot];\n                    if (slot) {\n                        if (slot.type === 'block') {\n                            this.selectedBlock = slot.id;\n                            this.selectedItem = null;\n                        } else if (slot.type === 'weapon') {\n                            this.selectedItem = slot.id;\n                            this.selectedBlock = null;\n                        } else if (slot.type === 'bucket') {\n                            this.selectedItem = slot.id;\n                            this.selectedBlock = null;\n                        }\n                    } else {\n                        this.selectedBlock = null;\n                        this.selectedItem = null;\n                    }\n                    this.updateHotbar();\n                }, { passive: false });\n                \n                // Also catch wheel events on the game container to prevent page scroll\n                const gameContainer = document.getElementById('minecraftGame');\n                gameContainer.addEventListener('wheel', (e) => {\n                    if (this.isActive) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                    }\n                }, { passive: false });\n                \n                // Mouse movement - use movementX/Y deltas (works across screen boundaries)\n                document.addEventListener('mousemove', (e) => {\n                    if (!this.isActive || this.isPaused || !this.pointerLocked) return;\n                    \n                    // movementX/Y provide delta movement even across screen edges\n                    this.camera.rotY -= e.movementX * 0.003;\n                    this.camera.rotX = Math.max(-1.5, Math.min(1.5, this.camera.rotX + e.movementY * 0.003));\n                });\n                \n                // Visibility change - pause when tab hidden\n                document.addEventListener('visibilitychange', () => {\n                    if (document.hidden && this.isActive && !this.isPaused) {\n                        this.pause();\n                    }\n                });\n                \n                // Window resize - update canvas if fullscreen\n                window.addEventListener('resize', () => {\n                    const isFs = document.fullscreenElement || document.webkitFullscreenElement;\n                    if (isFs && this.isActive) {\n                        this.canvas.width = window.innerWidth;\n                        this.canvas.height = window.innerHeight;\n                    }\n                });\n                \n                // Hotbar clicks\n                document.querySelectorAll('.hotbar-slot').forEach((slot, index) => {\n                    slot.addEventListener('click', (e) => {\n                        e.stopPropagation();\n                        this.selectedSlot = index;\n                        const invSlot = this.inventory.hotbar[index];\n                        if (invSlot) {\n                            if (invSlot.type === 'block') {\n                                this.selectedBlock = invSlot.id;\n                                this.selectedItem = null;\n                            } else if (invSlot.type === 'weapon') {\n                                this.selectedItem = invSlot.id;\n                                this.selectedBlock = null;\n                            }\n                        }\n                        this.updateHotbar();\n                    });\n                });\n            },\n            \n            setupMenus() {\n                // Resume button\n                document.getElementById('btnResume').addEventListener('click', () => this.resume());\n                \n                // Fullscreen toggle button\n                document.getElementById('btnFullscreen').addEventListener('click', (e) => {\n                    e.preventDefault();\n                    const container = document.getElementById('minecraftGame');\n                    const isFs = document.fullscreenElement || document.webkitFullscreenElement;\n                    \n                    if (isFs) {\n                        // Exit fullscreen\n                        if (document.exitFullscreen) {\n                            document.exitFullscreen();\n                        } else if (document.webkitExitFullscreen) {\n                            document.webkitExitFullscreen();\n                        }\n                    } else {\n                        // Enter fullscreen - must be in same click handler\n                        if (container.requestFullscreen) {\n                            container.requestFullscreen().catch(err => console.log('Fullscreen error:', err));\n                        } else if (container.webkitRequestFullscreen) {\n                            container.webkitRequestFullscreen();\n                        }\n                    }\n                    \n                    // Resume game after toggling\n                    this.resume();\n                });\n                \n                // Update button text on fullscreen change\n                document.addEventListener('fullscreenchange', () => this.updateFullscreenButton());\n                document.addEventListener('webkitfullscreenchange', () => this.updateFullscreenButton());\n                \n                // Account button (disabled)\n                document.getElementById('btnAccount').addEventListener('click', (e) => {\n                    e.preventDefault();\n                });\n                \n                // Stats button\n                document.getElementById('btnStats').addEventListener('click', () => {\n                    this.showSubmenu('menuStats');\n                    this.updateStatsDisplay();\n                });\n                \n                // Options button\n                document.getElementById('btnOptions').addEventListener('click', () => {\n                    this.showSubmenu('menuOptions');\n                });\n                \n                // Quit button\n                document.getElementById('btnQuit').addEventListener('click', () => this.stop());\n                \n                // Back buttons\n                document.getElementById('statsBack').addEventListener('click', () => this.showSubmenu('menuMain'));\n                document.getElementById('optionsBack').addEventListener('click', () => this.showSubmenu('menuMain'));\n                \n                // Options controls\n                document.getElementById('optBrightness').addEventListener('input', (e) => {\n                    this.settings.brightness = parseInt((e.target as HTMLInputElement).value);\n                    this.applyFilters();\n                });\n                \n                document.getElementById('optFilter').addEventListener('change', (e) => {\n                    this.settings.filter = (e.target as HTMLInputElement).value;\n                    this.applyFilters();\n                });\n                \n                document.getElementById('optRenderDist').addEventListener('change', (e) => {\n                    this.settings.renderDistance = parseInt((e.target as HTMLInputElement).value);\n                });\n                \n                // Toggle switches\n                ['optShadows', 'optLighting', 'optAA', 'optShowFps'].forEach(id => {\n                    document.getElementById(id).addEventListener('click', (e) => {\n                        const toggle = e.target;\n                        const isOn = (toggle as HTMLElement).dataset.on === 'true';\n                        (toggle as HTMLElement).dataset.on = (!isOn).toString();\n                        (toggle as HTMLElement).classList.toggle('on', !isOn);\n                        \n                        if (id === 'optShadows') this.settings.shadows = !isOn;\n                        if (id === 'optLighting') this.settings.lighting = !isOn;\n                        if (id === 'optAA') {\n                            this.settings.antialiasing = !isOn;\n                            (this.canvas as HTMLCanvasElement).style.imageRendering = !isOn ? 'pixelated' : 'auto';\n                        }\n                        if (id === 'optShowFps') this.settings.showFps = !isOn;\n                    });\n                });\n                \n                // Target FPS slider\n                document.getElementById('optTargetFps').addEventListener('input', (e) => {\n                    const fps = parseInt((e.target as HTMLInputElement).value);\n                    this.settings.targetFps = fps;\n                    document.getElementById('targetFpsValue').textContent = String(fps);\n                });\n            },\n            \n            showSubmenu(menuId) {\n                document.querySelectorAll('.pause-submenu').forEach(m => m.classList.remove('active'));\n                document.getElementById(menuId).classList.add('active');\n            },\n            \n            updateStatsDisplay() {\n                document.getElementById('statPlaced').textContent = this.stats.blocksPlaced;\n                document.getElementById('statBroken').textContent = this.stats.blocksBroken;\n                document.getElementById('statDistance').textContent = String(Math.floor(this.stats.distance)) + 'm';\n                document.getElementById('statJumps').textContent = this.stats.jumps;\n                \n                const elapsed = Math.floor((Date.now() - this.stats.startTime) / 1000);\n                const mins = Math.floor(elapsed / 60);\n                const secs = elapsed % 60;\n                document.getElementById('statTime').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;\n            },\n            \n            applyFilters() {\n                let filter = `brightness(${this.settings.brightness}%)`;\n                \n                switch (this.settings.filter) {\n                    case 'sepia':\n                        filter += ' sepia(80%)';\n                        break;\n                    case 'grayscale':\n                        filter += ' grayscale(100%)';\n                        break;\n                    case 'trippy':\n                        filter += ' hue-rotate(' + (Date.now() % 3600) / 10 + 'deg) saturate(200%)';\n                        break;\n                }\n                \n                (this.canvas as HTMLElement).style.filter = filter;\n            },\n            \n            updateHotbar() {\n                const slots = document.querySelectorAll('.hotbar-slot');\n                slots.forEach((slot, index) => {\n                    const isSelected = index === this.selectedSlot;\n                    slot.classList.toggle('selected', isSelected);\n                });\n            },\n            \n            // Update hotbar display with item counts and icons\n            updateHotbarDisplay() {\n                const slots = document.querySelectorAll('.hotbar-slot');\n                slots.forEach((slot, index) => {\n                    const item = this.inventory.hotbar[index];\n                    const isSelected = index === this.selectedSlot;\n                    slot.classList.toggle('selected', isSelected);\n                    \n                    // Set count attribute\n                    if (item && item.count) {\n                        slot.setAttribute('data-count', item.count);\n                    } else {\n                        slot.setAttribute('data-count', '');\n                    }\n                    \n                    // Clear and redraw canvas\n                    let canvas = slot.querySelector('canvas');\n                    if (!canvas) {\n                        canvas = document.createElement('canvas');\n                        canvas.width = 32;\n                        canvas.height = 32;\n                        (canvas as HTMLElement).style.width = '100%';\n                        (canvas as HTMLElement).style.height = '100%';\n                        (canvas as HTMLElement).style.position = 'absolute';\n                        (canvas as HTMLElement).style.top = '2px';\n                        (canvas as HTMLElement).style.left = '2px';\n                        slot.appendChild(canvas);\n                    }\n                    \n                    if (item) {\n                        this.drawMiniBlock(canvas, item.id);\n                        \n                        // Update durability bar if exists\n                        let durBar = slot.querySelector('.durability-bar');\n                        if (item.durability !== undefined && item.maxDurability) {\n                            if (!durBar) {\n                                durBar = document.createElement('div');\n                                durBar.className = 'durability-bar';\n                                durBar.innerHTML = '<div class=\"durability-fill\"></div>';\n                                slot.appendChild(durBar);\n                            }\n                            const fill = durBar.querySelector('.durability-fill');\n                            const percent = (item.durability / item.maxDurability) * 100;\n                            (fill as HTMLElement).style.width = percent + '%';\n                            (fill as HTMLElement).style.backgroundColor = percent > 50 ? '#4a4' : percent > 25 ? '#aa4' : '#a44';\n                            (durBar as HTMLElement).style.display = 'block';\n                        } else if (durBar) {\n                            (durBar as HTMLElement).style.display = 'none';\n                        }\n                    } else {\n                        // Clear canvas for empty slot\n                        const ctx = canvas.getContext('2d');\n                        ctx.clearRect(0, 0, canvas.width, canvas.height);\n                        // Hide durability bar\n                        const durBar = slot.querySelector('.durability-bar');\n                        if (durBar) (durBar as HTMLElement).style.display = 'none';\n                    }\n                });\n            },\n            \n            // Shoot the AK-47\n            shootAK47() {\n                if (this.shootCooldown > 0) return;\n                \n                // Check durability and reduce it\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.id === 'ak47') {\n                    if (slot.durability !== undefined && slot.durability <= 0) {\n                        // Gun is broken!\n                        return;\n                    }\n                    // Reduce durability\n                    if (slot.durability !== undefined) {\n                        slot.durability--;\n                        if (slot.durability <= 0) {\n                            // Gun breaks\n                            this.inventory.hotbar[this.selectedSlot] = null;\n                            this.selectedItem = null;\n                            this.showPickupNotification('ak47', -1); // Show break notification\n                        }\n                        this.updateHotbarDisplay();\n                    }\n                }\n                \n                this.shootCooldown = 8; // Frames between shots\n                this.muzzleFlash = 5;   // Frames of muzzle flash\n                \n                // Get shoot direction\n                const pitch = this.camera.rotX;\n                const yaw = this.camera.rotY;\n                const dirX = -Math.sin(yaw) * Math.cos(pitch);\n                const dirY = -Math.sin(pitch);\n                const dirZ = Math.cos(yaw) * Math.cos(pitch);\n                \n                // Create bullet particle\n                const bulletSpeed = 2.5;\n                const bullet = {\n                    x: this.camera.x + dirX * 0.5,\n                    y: this.camera.y + dirY * 0.5,\n                    z: this.camera.z + dirZ * 0.5,\n                    vx: dirX * bulletSpeed,\n                    vy: dirY * bulletSpeed,\n                    vz: dirZ * bulletSpeed,\n                    life: 60,\n                    type: 'bullet',\n                    trail: []\n                };\n                this.particles.push(bullet);\n                \n                // Check for bird hits and apply velocity knockback\n                const knockbackForce = 0.8;\n                let hitBird = null;\n                let hitDist = Infinity;\n                \n                // Check pest birds - find closest hit\n                for (const pest of this.pestBirds) {\n                    const dx = pest.x - this.camera.x;\n                    const dy = pest.y - this.camera.y;\n                    const dz = pest.z - this.camera.z;\n                    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                    \n                    if (dist < 15 && dist < hitDist) {\n                        const birdDirX = dx / dist;\n                        const birdDirY = dy / dist;\n                        const birdDirZ = dz / dist;\n                        const dot = dirX * birdDirX + dirY * birdDirY + dirZ * birdDirZ;\n                        \n                        if (dot > 0.9) {\n                            hitBird = pest;\n                            hitDist = dist;\n                        }\n                    }\n                }\n                \n                // Apply knockback with velocity\n                if (hitBird) {\n                    // Set velocity for knockback animation\n                    hitBird.vx = dirX * knockbackForce + (Math.random() - 0.5) * 0.2;\n                    hitBird.vy = dirY * knockbackForce + 0.3 + Math.random() * 0.2; // Add upward force\n                    hitBird.vz = dirZ * knockbackForce + (Math.random() - 0.5) * 0.2;\n                    hitBird.state = 'knockback';\n                    hitBird.stateTimer = 90;\n                    \n                    // Create ricochet particles\n                    for (let i = 0; i < 8; i++) {\n                        const ricochetSpeed = 0.15 + Math.random() * 0.2;\n                        // Reflect direction with randomness\n                        const rx = -dirX * 0.5 + (Math.random() - 0.5) * 1.5;\n                        const ry = Math.random() * 0.8 + 0.2;\n                        const rz = -dirZ * 0.5 + (Math.random() - 0.5) * 1.5;\n                        const len = Math.sqrt(rx * rx + ry * ry + rz * rz);\n                        \n                        this.particles.push({\n                            x: hitBird.x,\n                            y: hitBird.y,\n                            z: hitBird.z,\n                            vx: (rx / len) * ricochetSpeed,\n                            vy: (ry / len) * ricochetSpeed,\n                            vz: (rz / len) * ricochetSpeed,\n                            life: 25 + Math.random() * 20,\n                            type: 'ricochet',\n                            size: 2 + Math.random() * 3\n                        });\n                    }\n                    \n                    // Feather particles\n                    for (let i = 0; i < 5; i++) {\n                        this.particles.push({\n                            x: hitBird.x + (Math.random() - 0.5) * 0.3,\n                            y: hitBird.y + (Math.random() - 0.5) * 0.3,\n                            z: hitBird.z + (Math.random() - 0.5) * 0.3,\n                            vx: (Math.random() - 0.5) * 0.1,\n                            vy: 0.05 + Math.random() * 0.05,\n                            vz: (Math.random() - 0.5) * 0.1,\n                            life: 40 + Math.random() * 30,\n                            type: 'feather',\n                            rotation: Math.random() * Math.PI * 2,\n                            rotSpeed: (Math.random() - 0.5) * 0.3\n                        });\n                    }\n                    \n                    // Birds bounce player around when shot!\n                    // Small random knockback to player\n                    const playerKnockback = 0.08 + Math.random() * 0.05;\n                    this.velocity.y += 0.05 + Math.random() * 0.03;  // Small upward bump\n                    // Push player away from bird\n                    const toBirdX = hitBird.x - this.camera.x;\n                    const toBirdZ = hitBird.z - this.camera.z;\n                    const toBirdDist = Math.sqrt(toBirdX * toBirdX + toBirdZ * toBirdZ);\n                    if (toBirdDist > 0.1) {\n                        // Push player in random direction with slight bias away from bird\n                        this.camera.x -= (toBirdX / toBirdDist) * playerKnockback * 0.3 + (Math.random() - 0.5) * playerKnockback;\n                        this.camera.z -= (toBirdZ / toBirdDist) * playerKnockback * 0.3 + (Math.random() - 0.5) * playerKnockback;\n                    }\n                    \n                    // Special spawn chances!\n                    const spawnRoll = Math.random();\n                    let birdsToSpawn = 0;\n                    \n                    if (spawnRoll < 0.01) {\n                        // 1/100 chance: SWARM! 20 birds spawn\n                        birdsToSpawn = 20;\n                    } else if (spawnRoll < 0.1) {\n                        // 1/10 chance: 5 birds spawn\n                        birdsToSpawn = 5;\n                    }\n                    \n                    // Spawn the extra birds\n                    for (let i = 0; i < birdsToSpawn; i++) {\n                        const newAngle = Math.random() * Math.PI * 2;\n                        const newRadius = 2 + Math.random() * 3;\n                        this.pestBirds.push({\n                            x: hitBird.x + Math.cos(newAngle) * newRadius,\n                            y: hitBird.y + (Math.random() - 0.5) * 2,\n                            z: hitBird.z + Math.sin(newAngle) * newRadius,\n                            vx: 0, vy: 0, vz: 0,\n                            targetOffsetX: 0, targetOffsetY: 0, targetOffsetZ: 0,\n                            state: 'circling',\n                            stateTimer: 10 + Math.random() * 20,\n                            angle: newAngle,\n                            circleRadius: newRadius,\n                            baseCircleRadius: newRadius,\n                            circleSpeed: 0.07 + Math.random() * 0.05,\n                            swoopProgress: 0,\n                            wingPhase: Math.random() * Math.PI * 2,\n                            size: 0.15 + Math.random() * 0.08,\n                            chirpTimer: Math.random() * 30,\n                            knockbackSpin: 0,\n                            anger: 1 + Math.floor(Math.random() * 3), // Spawned angry (1-3)\n                            timesShot: 0,\n                            spawnThreshold: 4 + Math.floor(Math.random() * 4)\n                        });\n                    }\n                }\n                \n                // Check regular birds\n                for (const bird of this.birds) {\n                    const dx = bird.x - this.camera.x;\n                    const dy = bird.y - this.camera.y;\n                    const dz = bird.z - this.camera.z;\n                    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                    \n                    if (dist < 25) {\n                        const birdDirX = dx / dist;\n                        const birdDirY = dy / dist;\n                        const birdDirZ = dz / dist;\n                        const dot = dirX * birdDirX + dirY * birdDirY + dirZ * birdDirZ;\n                        \n                        if (dot > 0.85) {\n                            // Knock away by modifying orbit\n                            bird.radius += 8;\n                            bird.baseY += 5;\n                            \n                            // Create some ricochet sparks\n                            for (let i = 0; i < 5; i++) {\n                                this.particles.push({\n                                    x: bird.x,\n                                    y: bird.y,\n                                    z: bird.z,\n                                    vx: (Math.random() - 0.5) * 0.3,\n                                    vy: Math.random() * 0.2,\n                                    vz: (Math.random() - 0.5) * 0.3,\n                                    life: 20 + Math.random() * 15,\n                                    type: 'ricochet',\n                                    size: 2 + Math.random() * 2\n                                });\n                            }\n                        }\n                    }\n                }\n            },\n            \n            // Update particles\n            updateParticles() {\n                for (let i = this.particles.length - 1; i >= 0; i--) {\n                    const p = this.particles[i];\n                    p.life--;\n                    \n                    if (p.life <= 0) {\n                        this.particles.splice(i, 1);\n                        continue;\n                    }\n                    \n                    // Update position\n                    p.x += p.vx;\n                    p.y += p.vy;\n                    p.z += p.vz;\n                    \n                    if (p.type === 'bullet') {\n                        // Store trail positions\n                        p.trail.push({ x: p.x, y: p.y, z: p.z });\n                        if (p.trail.length > 8) p.trail.shift();\n                        \n                        // Check for block collision\n                        const bx = Math.floor(p.x);\n                        const by = Math.floor(p.y);\n                        const bz = Math.floor(p.z);\n                        if (this.getBlock(bx, by, bz)) {\n                            // Hit a block - create impact sparks\n                            for (let j = 0; j < 6; j++) {\n                                this.particles.push({\n                                    x: p.x,\n                                    y: p.y,\n                                    z: p.z,\n                                    vx: (Math.random() - 0.5) * 0.2,\n                                    vy: Math.random() * 0.15,\n                                    vz: (Math.random() - 0.5) * 0.2,\n                                    life: 15 + Math.random() * 10,\n                                    type: 'spark',\n                                    size: 2 + Math.random() * 2\n                                });\n                            }\n                            this.particles.splice(i, 1);\n                        }\n                    } else if (p.type === 'ricochet' || p.type === 'spark') {\n                        p.vy -= 0.008; // Gravity\n                        p.vx *= 0.97;\n                        p.vz *= 0.97;\n                    } else if (p.type === 'feather') {\n                        p.vy -= 0.002; // Light gravity\n                        p.vx *= 0.98;\n                        p.vz *= 0.98;\n                        p.rotation += p.rotSpeed;\n                    } else if (p.type === 'burger') {\n                        // Burger projectile - flies fast, affected slightly by gravity\n                        p.vy -= 0.003;\n                        // Check for bird collision\n                        for (const pest of this.pestBirds) {\n                            const dx = pest.x - p.x;\n                            const dy = pest.y - p.y;\n                            const dz = pest.z - p.z;\n                            const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                            if (dist < 1.5) {\n                                // Hit! Send bird flying and enrage it\n                                const knockForce = 2.5;\n                                pest.vx = (p.vx * 0.5) + (dx / dist) * knockForce;\n                                pest.vy = Math.abs(p.vy) + 0.5;\n                                pest.vz = (p.vz * 0.5) + (dz / dist) * knockForce;\n                                pest.state = 'knockback';\n                                pest.stateTimer = 120;\n                                pest.anger = Math.min(5, pest.anger + 2); // Extra anger from burgers!\n                                p.life = 0; // Burger consumed\n                                \n                                // Burger splat particles\n                                for (let j = 0; j < 8; j++) {\n                                    this.particles.push({\n                                        x: p.x, y: p.y, z: p.z,\n                                        vx: (Math.random() - 0.5) * 0.3,\n                                        vy: Math.random() * 0.2,\n                                        vz: (Math.random() - 0.5) * 0.3,\n                                        life: 20,\n                                        type: 'burgerSplat',\n                                        size: 3 + Math.random() * 3\n                                    });\n                                }\n                            }\n                        }\n                    } else if (p.type === 'burgerSplat') {\n                        p.vy -= 0.01;\n                        p.vx *= 0.95;\n                        p.vz *= 0.95;\n                    } else if (p.type === 'apple') {\n                        // Apple projectile - flies with arc, knocks birds away\n                        p.vy += (p.gravity || -0.008);\n                        // Check for bird collision\n                        for (const pest of this.pestBirds) {\n                            const dx = pest.x - p.x;\n                            const dy = pest.y - p.y;\n                            const dz = pest.z - p.z;\n                            const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                            if (dist < 1.5) {\n                                // Hit! Send bird flying but DON'T enrage it\n                                const knockForce = 3.0;\n                                pest.vx = (p.vx * 0.5) + (dx / dist) * knockForce;\n                                pest.vy = 0.8; // Pop up\n                                pest.vz = (p.vz * 0.5) + (dz / dist) * knockForce;\n                                pest.state = 'knockback';\n                                pest.stateTimer = 180; // Longer stun\n                                // Apples calm birds slightly\n                                pest.anger = Math.max(0, pest.anger - 0.5);\n                                p.life = 0;\n                                \n                                // Score for hitting bird\n                                if (this.survivalStats) {\n                                    this.survivalStats.score += 50;\n                                    this.updateSurvivalHUD();\n                                }\n                                \n                                // Apple splat particles\n                                for (let j = 0; j < 6; j++) {\n                                    this.particles.push({\n                                        x: p.x, y: p.y, z: p.z,\n                                        vx: (Math.random() - 0.5) * 0.3,\n                                        vy: Math.random() * 0.2,\n                                        vz: (Math.random() - 0.5) * 0.3,\n                                        life: 15,\n                                        type: 'appleSplat',\n                                        size: 2 + Math.random() * 2\n                                    });\n                                }\n                            }\n                        }\n                        // Check for decorative bird collision during swarm\n                        for (const bird of this.birds) {\n                            if (bird.swarmMode) {\n                                const dx = bird.x - p.x;\n                                const dy = bird.y - p.y;\n                                const dz = bird.z - p.z;\n                                const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                                if (dist < 2) {\n                                    bird.swarmMode = false;\n                                    bird.swarmTimer = 0;\n                                    p.life = 0;\n                                    if (this.survivalStats) {\n                                        this.survivalStats.score += 25;\n                                        this.updateSurvivalHUD();\n                                    }\n                                }\n                            }\n                        }\n                        // Hit ground\n                        const groundY = this.getGroundHeightBelow(p.x, p.z, p.y + 10);\n                        if (p.y <= groundY + 0.5) {\n                            p.life = 0;\n                        }\n                    } else if (p.type === 'appleSplat') {\n                        p.vy -= 0.015;\n                        p.vx *= 0.9;\n                        p.vz *= 0.9;\n                    } else if (p.type === 'petal') {\n                        // Cherry blossom petals - float and flutter with wind\n                        p.vy -= 0.0008; // Very light gravity for graceful fall\n                        p.vx += this.wind.x * 0.15;\n                        p.vz += this.wind.z * 0.15;\n                        p.vx *= 0.985;\n                        p.vz *= 0.985;\n                        p.rotation += p.rotSpeed + this.wind.x * 0.08;\n                        p.flutter += p.flutterSpeed || 0.08;\n                        \n                        // More complex flutter pattern - both horizontal sway and tumbling\n                        p.x += Math.sin(p.flutter) * 0.025;\n                        p.y += Math.cos(p.flutter * 1.3) * 0.008; // Slight vertical bob\n                        p.z += Math.cos(p.flutter * 0.7) * 0.015;\n                        \n                        // Hit ground - disappear\n                        if (p.y < this.getGroundHeightBelow(p.x, p.z, p.y + 10) + 1) {\n                            p.life = 0;\n                        }\n                    }\n                }\n            },\n            \n            // Wind system - creates natural gusts that affect petals and birds\n            updateWind() {\n                this.wind.gustTimer++;\n                \n                // Change wind direction occasionally (gusts)\n                if (this.wind.gustTimer > 120 + Math.random() * 180) {\n                    this.wind.gustTimer = 0;\n                    // New target wind direction\n                    const gustStrength = 0.01 + Math.random() * 0.04;\n                    const gustAngle = Math.random() * Math.PI * 2;\n                    this.wind.targetX = Math.cos(gustAngle) * gustStrength;\n                    this.wind.targetZ = Math.sin(gustAngle) * gustStrength;\n                }\n                \n                // Smoothly interpolate toward target\n                this.wind.x += (this.wind.targetX - this.wind.x) * 0.02;\n                this.wind.z += (this.wind.targetZ - this.wind.z) * 0.02;\n                \n                // Add small random turbulence\n                this.wind.x += (Math.random() - 0.5) * 0.002;\n                this.wind.z += (Math.random() - 0.5) * 0.002;\n            },\n            \n            // Spawn cherry blossom petals near trees\n            updatePetals() {\n                if (!this.cherryTrees || this.cherryTrees.length === 0) return;\n                \n                // Count current petals\n                const currentPetals = this.particles.filter(p => p.type === 'petal').length;\n                const maxPetals = 150; // Performance cap\n                \n                // Spawn multiple petals per frame for dense shower effect\n                const petalsToSpawn = Math.min(5, maxPetals - currentPetals); // Spawn up to 5 per frame\n                \n                for (let i = 0; i < petalsToSpawn; i++) {\n                    // 60% chance per slot to actually spawn (creates natural variation)\n                    if (Math.random() > 0.6) continue;\n                    \n                    // Pick a random cherry tree\n                    const tree = this.cherryTrees[Math.floor(Math.random() * this.cherryTrees.length)];\n                    const dist = Math.sqrt((tree.x - this.camera.x) ** 2 + (tree.z - this.camera.z) ** 2);\n                    \n                    // Spawn petals for trees within range, with falloff\n                    const spawnRange = 40;\n                    if (dist < spawnRange) {\n                        // Higher spawn chance for closer trees\n                        const spawnChance = 1 - (dist / spawnRange) * 0.5;\n                        if (Math.random() < spawnChance) {\n                            // Wider spawn area around tree canopy\n                            const spreadX = (Math.random() - 0.5) * 10;\n                            const spreadZ = (Math.random() - 0.5) * 10;\n                            \n                            // Also spawn some petals floating in the air (wind-carried)\n                            const heightBonus = Math.random() < 0.3 ? Math.random() * 8 : 0;\n                            \n                            this.particles.push({\n                                x: tree.x + spreadX,\n                                y: tree.y + Math.random() * 3 + heightBonus,\n                                z: tree.z + spreadZ,\n                                vx: this.wind.x * 1.5 + (Math.random() - 0.5) * 0.03,\n                                vy: -0.008 - Math.random() * 0.015, // Slower fall for more graceful effect\n                                vz: this.wind.z * 1.5 + (Math.random() - 0.5) * 0.03,\n                                life: 250 + Math.random() * 200, // Longer life\n                                type: 'petal',\n                                size: 2.5 + Math.random() * 2.5,\n                                rotation: Math.random() * Math.PI * 2,\n                                rotSpeed: (Math.random() - 0.5) * 0.15,\n                                flutter: Math.random() * Math.PI * 2,\n                                flutterSpeed: 0.05 + Math.random() * 0.05\n                            });\n                        }\n                    }\n                }\n                \n                // Also spawn ambient petals in the air around player (wind-blown)\n                if (currentPetals < maxPetals * 0.8 && Math.random() < 0.3) {\n                    const angle = Math.random() * Math.PI * 2;\n                    const radius = 10 + Math.random() * 20;\n                    this.particles.push({\n                        x: this.camera.x + Math.cos(angle) * radius,\n                        y: this.camera.y + 5 + Math.random() * 10,\n                        z: this.camera.z + Math.sin(angle) * radius,\n                        vx: this.wind.x * 2 + (Math.random() - 0.5) * 0.02,\n                        vy: -0.005 - Math.random() * 0.01,\n                        vz: this.wind.z * 2 + (Math.random() - 0.5) * 0.02,\n                        life: 150 + Math.random() * 100,\n                        type: 'petal',\n                        size: 2 + Math.random() * 2,\n                        rotation: Math.random() * Math.PI * 2,\n                        rotSpeed: (Math.random() - 0.5) * 0.12,\n                        flutter: Math.random() * Math.PI * 2,\n                        flutterSpeed: 0.04 + Math.random() * 0.04\n                    });\n                }\n            },\n            \n            // Drop an item on the ground\n            dropItem(x, y, z, type, count) {\n                if (!this.droppedItems) this.droppedItems = [];\n                this.droppedItems.push({\n                    x: x + (Math.random() - 0.5) * 0.3,\n                    y: y,\n                    z: z + (Math.random() - 0.5) * 0.3,\n                    vy: 0.1 + Math.random() * 0.05,\n                    type: type,\n                    count: count,\n                    bobPhase: Math.random() * Math.PI * 2,\n                    pickupDelay: 30 // Frames before can be picked up\n                });\n            },\n            \n            // Update dropped items (physics and pickup)\n            updateDroppedItems() {\n                if (!this.droppedItems) return;\n                \n                for (let i = this.droppedItems.length - 1; i >= 0; i--) {\n                    const item = this.droppedItems[i];\n                    \n                    // Pickup delay\n                    if (item.pickupDelay > 0) item.pickupDelay--;\n                    \n                    // Physics\n                    item.vy -= 0.015; // Gravity\n                    item.y += item.vy;\n                    \n                    // Ground collision\n                    const groundY = this.getGroundHeightBelow(item.x, item.z, item.y + 5) + 1.3;\n                    if (item.y < groundY) {\n                        item.y = groundY;\n                        item.vy = 0;\n                    }\n                    \n                    // Bobbing animation\n                    item.bobPhase += 0.05;\n                    \n                    // Check pickup by player\n                    if (item.pickupDelay <= 0) {\n                        const dx = item.x - this.camera.x;\n                        const dy = item.y - this.camera.y;\n                        const dz = item.z - this.camera.z;\n                        const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                        \n                        if (dist < 2) {\n                            // Try to add to inventory\n                            if (this.addToInventory(item.type, item.count)) {\n                                this.droppedItems.splice(i, 1);\n                            }\n                        }\n                    }\n                }\n            },\n            \n            // Add item to inventory (hotbar first, then main inventory)\n            addToInventory(type, count) {\n                // Determine item category\n                let itemType = 'block';  // Default\n                if (type === 'ak47' || type === 'berdger') itemType = 'weapon';\n                if (type === 'water_bucket' || type === 'lava_bucket') itemType = 'bucket';\n                if (this.ritualItems && this.ritualItems.includes(type)) itemType = 'item';\n                if (type === 'seeds' || type === 'apple') itemType = 'item';\n                \n                // Show pickup animation\n                this.showPickupNotification(type, count);\n                \n                // Try to stack with existing items in hotbar first\n                for (let i = 0; i < 9; i++) {\n                    const slot = this.inventory.hotbar[i];\n                    if (slot && (slot.id === type || slot.type === type) && slot.count < 64) {\n                        const canAdd = Math.min(count, 64 - slot.count);\n                        slot.count += canAdd;\n                        count -= canAdd;\n                        if (count <= 0) {\n                            this.updateHotbarDisplay();\n                            return true;\n                        }\n                    }\n                }\n                \n                // Try to stack with existing items in main inventory\n                for (let i = 0; i < 27; i++) {\n                    const slot = this.inventory.main[i];\n                    if (slot && (slot.id === type || slot.type === type) && slot.count < 64) {\n                        const canAdd = Math.min(count, 64 - slot.count);\n                        slot.count += canAdd;\n                        count -= canAdd;\n                        if (count <= 0) {\n                            this.updateHotbarDisplay();\n                            return true;\n                        }\n                    }\n                }\n                \n                // Find empty slot in hotbar\n                for (let i = 0; i < 9; i++) {\n                    if (!this.inventory.hotbar[i]) {\n                        const itemDef = this.itemTypes[type] || {};\n                        this.inventory.hotbar[i] = { \n                            type: itemType, \n                            id: type, \n                            count,\n                            durability: itemDef.durability,\n                            maxDurability: itemDef.maxDurability\n                        };\n                        this.updateHotbarDisplay();\n                        return true;\n                    }\n                }\n                \n                // Find empty slot in main inventory\n                for (let i = 0; i < 27; i++) {\n                    if (!this.inventory.main[i]) {\n                        const itemDef = this.itemTypes[type] || {};\n                        this.inventory.main[i] = { \n                            type: itemType, \n                            id: type, \n                            count,\n                            durability: itemDef.durability,\n                            maxDurability: itemDef.maxDurability\n                        };\n                        this.updateHotbarDisplay();\n                        return true;\n                    }\n                }\n                \n                return false; // All inventory full\n            },\n            \n            // Show pickup notification (uses batch queue for multiple pickups)\n            showPickupNotification(type, count) {\n                // Handle broken items immediately (don't batch)\n                if (count < 0) {\n                    const container = document.getElementById('pickupNotification');\n                    if (!container) return;\n                    \n                    const itemNames = {\n                        grass: 'Grass Block', dirt: 'Dirt', stone: 'Stone', wood: 'Wood',\n                        appleLeaves: 'Apple Leaves', leaves: 'Leaves', sand: 'Sand', brick: 'Brick',\n                        ak47: 'AK-47', water_bucket: 'Water Bucket', lava_bucket: 'Lava Bucket',\n                        obsidian: 'Obsidian', cherryWood: 'Cherry Wood', cherryLeaves: 'Cherry Leaves',\n                        chest: 'Chest', seeds: 'Seeds', berdger: 'The Berdger', apple: 'Apple',\n                        sakuraPetal: 'Cherry Petal', shimenawa: 'Sacred Rope', omamori: 'Charm',\n                        ema: 'Wish Plaque', incense: 'Incense', whiteBrick: 'White Brick',\n                        redBrick: 'Red Brick', glowstone: 'Glowstone', ritualStone: 'Ritual Stone'\n                    };\n                    \n                    const notification = document.createElement('div');\n                    notification.className = 'pickup-item';\n                    (notification as HTMLElement).style.borderColor = 'rgba(255, 50, 50, 0.8)';\n                    notification.innerHTML = `\n                        <span class=\"pickup-icon\">üíî</span>\n                        <span style=\"color:#ff6666\">${itemNames[type] || type} broke!</span>\n                    `;\n                    container.appendChild(notification);\n                    setTimeout(() => {\n                        if (notification.parentNode) {\n                            notification.parentNode.removeChild(notification);\n                        }\n                    }, 2000);\n                    return;\n                }\n                \n                // Use batch queue for normal pickups\n                this.queuePickupNotification(type, count);\n            },\n            \n            // Draw a mini 3D block for inventory display\n            drawMiniBlock(canvas, type) {\n                const ctx = canvas.getContext('2d');\n                const colors = this.blockColors[type];\n                const w = canvas.width;\n                const h = canvas.height;\n                \n                ctx.clearRect(0, 0, w, h);\n                \n                const cx = w / 2;\n                const cy = h / 2;\n                const size = Math.min(w, h) * 0.35;\n                \n                // Special item rendering for non-blocks\n                if (!colors) {\n                    ctx.save();\n                    ctx.translate(cx, cy);\n                    \n                    if (type === 'apple') {\n                        // Red apple\n                        ctx.fillStyle = '#dc143c';\n                        ctx.beginPath();\n                        ctx.arc(0, 0, size * 0.7, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.fillStyle = 'rgba(255,255,255,0.3)';\n                        ctx.beginPath();\n                        ctx.arc(-size * 0.2, -size * 0.2, size * 0.25, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-1, -size * 0.8, 3, size * 0.3);\n                        ctx.fillStyle = '#228b22';\n                        ctx.beginPath();\n                        ctx.ellipse(3, -size * 0.7, 4, 2, 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (type === 'seeds') {\n                        ctx.fillStyle = '#daa520';\n                        for (let i = 0; i < 5; i++) {\n                            const angle = (i / 5) * Math.PI * 2;\n                            const sx = Math.cos(angle) * size * 0.4;\n                            const sy = Math.sin(angle) * size * 0.3;\n                            ctx.beginPath();\n                            ctx.ellipse(sx, sy, 3, 5, angle, 0, Math.PI * 2);\n                            ctx.fill();\n                        }\n                    } else if (type === 'ak47') {\n                        ctx.fillStyle = '#333';\n                        ctx.fillRect(-size * 0.6, -size * 0.1, size * 1.2, size * 0.25);\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-size * 0.3, size * 0.1, size * 0.4, size * 0.4);\n                        ctx.fillStyle = '#222';\n                        ctx.fillRect(size * 0.1, size * 0.1, size * 0.15, size * 0.35);\n                    } else if (type === 'berdger') {\n                        ctx.fillStyle = '#daa520';\n                        ctx.beginPath();\n                        ctx.ellipse(0, -size * 0.3, size * 0.5, size * 0.25, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-size * 0.4, -size * 0.15, size * 0.8, size * 0.2);\n                        ctx.fillStyle = '#228b22';\n                        ctx.fillRect(-size * 0.35, -size * 0.05, size * 0.7, size * 0.1);\n                        ctx.fillStyle = '#daa520';\n                        ctx.beginPath();\n                        ctx.ellipse(0, size * 0.2, size * 0.55, size * 0.3, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (type === 'water_bucket' || type === 'lava_bucket') {\n                        ctx.fillStyle = '#888';\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.4, -size * 0.3);\n                        ctx.lineTo(size * 0.4, -size * 0.3);\n                        ctx.lineTo(size * 0.3, size * 0.5);\n                        ctx.lineTo(-size * 0.3, size * 0.5);\n                        ctx.closePath();\n                        ctx.fill();\n                        ctx.fillStyle = type === 'water_bucket' ? '#4a90d9' : '#ff6600';\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.3, -size * 0.1);\n                        ctx.lineTo(size * 0.3, -size * 0.1);\n                        ctx.lineTo(size * 0.25, size * 0.4);\n                        ctx.lineTo(-size * 0.25, size * 0.4);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else if (type === 'sakuraPetal') {\n                        ctx.fillStyle = '#ffb7c5';\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size * 0.6, size * 0.3, 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (type === 'shimenawa') {\n                        ctx.strokeStyle = '#daa520';\n                        ctx.lineWidth = 4;\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.5, 0);\n                        ctx.quadraticCurveTo(0, -size * 0.4, size * 0.5, 0);\n                        ctx.stroke();\n                    } else if (type === 'omamori') {\n                        ctx.fillStyle = '#cc0000';\n                        ctx.fillRect(-size * 0.3, -size * 0.5, size * 0.6, size);\n                        ctx.fillStyle = '#ffd700';\n                        ctx.fillRect(-size * 0.25, -size * 0.35, size * 0.5, size * 0.15);\n                    } else if (type === 'ema') {\n                        ctx.fillStyle = '#deb887';\n                        ctx.beginPath();\n                        ctx.moveTo(0, -size * 0.5);\n                        ctx.lineTo(size * 0.4, -size * 0.2);\n                        ctx.lineTo(size * 0.4, size * 0.4);\n                        ctx.lineTo(-size * 0.4, size * 0.4);\n                        ctx.lineTo(-size * 0.4, -size * 0.2);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else if (type === 'incense') {\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-1, -size * 0.6, 3, size * 1.2);\n                        ctx.fillStyle = '#ff6600';\n                        ctx.beginPath();\n                        ctx.arc(0.5, -size * 0.6, 3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else {\n                        // Unknown item - draw placeholder\n                        ctx.fillStyle = '#888';\n                        ctx.fillRect(-size * 0.4, -size * 0.4, size * 0.8, size * 0.8);\n                        ctx.fillStyle = '#444';\n                        ctx.font = '8px monospace';\n                        ctx.textAlign = 'center';\n                        ctx.fillText('?', 0, 3);\n                    }\n                    ctx.restore();\n                    return;\n                }\n                \n                // Isometric 3D block drawing for blocks\n                const blockSize = Math.min(w, h) * 0.25;\n                \n                // Handle rgba colors for transparent blocks like water\n                let topColor = colors.top;\n                let sideColor = colors.side;\n                if (typeof topColor === 'string' && topColor.includes('rgba')) {\n                    // Make opaque for icon display\n                    topColor = topColor.replace(/[\\d.]+\\)$/, '1)');\n                    sideColor = sideColor.replace(/[\\d.]+\\)$/, '1)');\n                }\n                \n                // Top face (brightest)\n                ctx.fillStyle = topColor;\n                ctx.beginPath();\n                ctx.moveTo(cx, cy - blockSize);\n                ctx.lineTo(cx + blockSize, cy - blockSize/2);\n                ctx.lineTo(cx, cy);\n                ctx.lineTo(cx - blockSize, cy - blockSize/2);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Left face (medium)\n                ctx.fillStyle = sideColor;\n                ctx.beginPath();\n                ctx.moveTo(cx - blockSize, cy - blockSize/2);\n                ctx.lineTo(cx, cy);\n                ctx.lineTo(cx, cy + blockSize);\n                ctx.lineTo(cx - blockSize, cy + blockSize/2);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Right face (darkest)\n                let rightColor;\n                try {\n                    rightColor = this.darkenColor(sideColor.replace(/rgba?\\([^)]+\\)/, '#888888'), 0.7);\n                } catch(e) {\n                    rightColor = this.darkenColor(sideColor, 0.7);\n                }\n                ctx.fillStyle = rightColor;\n                ctx.beginPath();\n                ctx.moveTo(cx, cy);\n                ctx.lineTo(cx + blockSize, cy - blockSize/2);\n                ctx.lineTo(cx + blockSize, cy + blockSize/2);\n                ctx.lineTo(cx, cy + blockSize);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Outline\n                ctx.strokeStyle = 'rgba(0,0,0,0.3)';\n                ctx.lineWidth = 0.5;\n                ctx.beginPath();\n                ctx.moveTo(cx, cy - size);\n                ctx.lineTo(cx + size, cy - size/2);\n                ctx.lineTo(cx + size, cy + size/2);\n                ctx.lineTo(cx, cy + size);\n                ctx.lineTo(cx - size, cy + size/2);\n                ctx.lineTo(cx - size, cy - size/2);\n                ctx.closePath();\n                ctx.stroke();\n            },\n            \n            // Draw 3D item for dropped items in the world\n            drawDroppedItem3D(ctx, cx, cy, size, type, bobPhase) {\n                const colors = this.blockColors[type];\n                const rotation = (bobPhase || 0) * 0.5; // Slowly rotate\n                \n                ctx.save();\n                ctx.translate(cx, cy);\n                \n                // Non-block items get special rendering\n                if (!colors) {\n                    // Special item rendering\n                    if (type === 'apple') {\n                        // Red apple\n                        ctx.fillStyle = '#dc143c';\n                        ctx.beginPath();\n                        ctx.arc(0, 0, size * 0.8, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Highlight\n                        ctx.fillStyle = 'rgba(255,255,255,0.3)';\n                        ctx.beginPath();\n                        ctx.arc(-size * 0.2, -size * 0.2, size * 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Stem\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-1, -size * 0.9, 2, size * 0.3);\n                        ctx.fillStyle = '#228b22';\n                        ctx.beginPath();\n                        ctx.ellipse(2, -size * 0.8, 3, 2, 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (type === 'seeds') {\n                        // Wheat seeds\n                        ctx.fillStyle = '#daa520';\n                        for (let i = 0; i < 5; i++) {\n                            const angle = (i / 5) * Math.PI * 2 + rotation;\n                            const sx = Math.cos(angle) * size * 0.4;\n                            const sy = Math.sin(angle) * size * 0.3;\n                            ctx.beginPath();\n                            ctx.ellipse(sx, sy, size * 0.2, size * 0.1, angle, 0, Math.PI * 2);\n                            ctx.fill();\n                        }\n                    } else if (type === 'ak47') {\n                        // Gun silhouette\n                        ctx.fillStyle = '#333';\n                        ctx.fillRect(-size * 0.8, -size * 0.15, size * 1.6, size * 0.3);\n                        ctx.fillRect(-size * 0.3, -size * 0.15, size * 0.15, size * 0.5);\n                        ctx.fillRect(size * 0.3, -size * 0.4, size * 0.5, size * 0.25);\n                    } else if (type === 'berdger') {\n                        // Mini burger\n                        ctx.fillStyle = '#D2691E';\n                        ctx.beginPath();\n                        ctx.ellipse(0, -size * 0.2, size * 0.7, size * 0.35, 0, Math.PI, 0);\n                        ctx.fill();\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-size * 0.6, -size * 0.1, size * 1.2, size * 0.25);\n                        ctx.fillStyle = '#228B22';\n                        ctx.fillRect(-size * 0.55, size * 0.1, size * 1.1, size * 0.1);\n                        ctx.fillStyle = '#DEB887';\n                        ctx.beginPath();\n                        ctx.ellipse(0, size * 0.25, size * 0.65, size * 0.3, 0, 0, Math.PI);\n                        ctx.fill();\n                    } else if (type === 'water_bucket' || type === 'lava_bucket') {\n                        // Bucket\n                        ctx.fillStyle = '#888';\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.5, -size * 0.5);\n                        ctx.lineTo(size * 0.5, -size * 0.5);\n                        ctx.lineTo(size * 0.4, size * 0.5);\n                        ctx.lineTo(-size * 0.4, size * 0.5);\n                        ctx.closePath();\n                        ctx.fill();\n                        // Contents\n                        ctx.fillStyle = type === 'water_bucket' ? '#4a90d9' : '#ff6600';\n                        ctx.fillRect(-size * 0.35, -size * 0.3, size * 0.7, size * 0.6);\n                        // Handle\n                        ctx.strokeStyle = '#666';\n                        ctx.lineWidth = 2;\n                        ctx.beginPath();\n                        ctx.arc(0, -size * 0.6, size * 0.4, Math.PI * 0.2, Math.PI * 0.8);\n                        ctx.stroke();\n                    } else if (type === 'sakuraPetal') {\n                        // Pink petal\n                        ctx.fillStyle = '#ffb7c5';\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size * 0.6, size * 0.3, rotation, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (type === 'shimenawa') {\n                        // Sacred rope\n                        ctx.strokeStyle = '#daa520';\n                        ctx.lineWidth = size * 0.2;\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.6, 0);\n                        ctx.bezierCurveTo(-size * 0.3, -size * 0.4, size * 0.3, size * 0.4, size * 0.6, 0);\n                        ctx.stroke();\n                    } else if (type === 'omamori') {\n                        // Charm\n                        ctx.fillStyle = '#ff4444';\n                        ctx.fillRect(-size * 0.3, -size * 0.5, size * 0.6, size * 0.8);\n                        ctx.fillStyle = '#gold';\n                        ctx.fillRect(-size * 0.2, -size * 0.4, size * 0.4, size * 0.15);\n                    } else if (type === 'ema') {\n                        // Wooden plaque\n                        ctx.fillStyle = '#deb887';\n                        ctx.beginPath();\n                        ctx.moveTo(0, -size * 0.6);\n                        ctx.lineTo(size * 0.5, -size * 0.2);\n                        ctx.lineTo(size * 0.5, size * 0.5);\n                        ctx.lineTo(-size * 0.5, size * 0.5);\n                        ctx.lineTo(-size * 0.5, -size * 0.2);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else if (type === 'incense') {\n                        // Incense stick\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-1, -size * 0.6, 2, size * 1.2);\n                        ctx.fillStyle = '#ff6600';\n                        ctx.beginPath();\n                        ctx.arc(0, -size * 0.6, 3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else {\n                        // Default cube for unknown items\n                        ctx.fillStyle = '#888';\n                        ctx.fillRect(-size * 0.5, -size * 0.5, size, size);\n                    }\n                    ctx.restore();\n                    return;\n                }\n                \n                // Block items - draw isometric cube\n                const s = size * 0.8;\n                \n                // Top face\n                ctx.fillStyle = colors.top;\n                ctx.beginPath();\n                ctx.moveTo(0, -s);\n                ctx.lineTo(s, -s/2);\n                ctx.lineTo(0, 0);\n                ctx.lineTo(-s, -s/2);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Left face\n                ctx.fillStyle = colors.side;\n                ctx.beginPath();\n                ctx.moveTo(-s, -s/2);\n                ctx.lineTo(0, 0);\n                ctx.lineTo(0, s);\n                ctx.lineTo(-s, s/2);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Right face\n                ctx.fillStyle = this.darkenColor(colors.side, 0.7);\n                ctx.beginPath();\n                ctx.moveTo(0, 0);\n                ctx.lineTo(s, -s/2);\n                ctx.lineTo(s, s/2);\n                ctx.lineTo(0, s);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Outline\n                ctx.strokeStyle = 'rgba(0,0,0,0.4)';\n                ctx.lineWidth = 1;\n                ctx.beginPath();\n                ctx.moveTo(0, -s);\n                ctx.lineTo(s, -s/2);\n                ctx.lineTo(s, s/2);\n                ctx.lineTo(0, s);\n                ctx.lineTo(-s, s/2);\n                ctx.lineTo(-s, -s/2);\n                ctx.closePath();\n                ctx.stroke();\n                \n                ctx.restore();\n            },\n            \n\n            // Use seeds to calm birds\n            useSeeds() {\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.id === 'seeds' && slot.count > 0) {\n                    slot.count--;\n                    if (slot.count <= 0) {\n                        this.inventory.hotbar[this.selectedSlot] = null;\n                        this.selectedItem = null;\n                    }\n                    this.updateHotbarDisplay();\n                    \n                    // Calm birds for 10 seconds (600 frames)\n                    this.seedCalmTimer = 600;\n                    \n                    // Visual effect - toss seeds\n                    for (let i = 0; i < 10; i++) {\n                        this.particles.push({\n                            x: this.camera.x + (Math.random() - 0.5) * 2,\n                            y: this.camera.y - 0.5,\n                            z: this.camera.z + (Math.random() - 0.5) * 2,\n                            vx: (Math.random() - 0.5) * 0.2,\n                            vy: 0.1 + Math.random() * 0.1,\n                            vz: (Math.random() - 0.5) * 0.2,\n                            life: 60,\n                            type: 'spark',\n                            size: 2\n                        });\n                    }\n                    return true;\n                }\n                return false;\n            },\n            \n            // Shoot the berdger (burger launcher)\n            shootBerdger() {\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.id === 'berdger') {\n                    // Berdger has infinite ammo - it's invincible!\n                    // Use the same direction calculation as raycast\n                    const pitch = this.camera.rotX;\n                    const yaw = this.camera.rotY;\n                    const cosPitch = Math.cos(pitch);\n                    const sinPitch = Math.sin(pitch);\n                    \n                    const dirX = -Math.sin(yaw) * cosPitch;\n                    const dirY = -sinPitch;  // Fixed: now matches raycast\n                    const dirZ = Math.cos(yaw) * cosPitch;\n                    \n                    // Rapid fire burgers!\n                    this.particles.push({\n                        x: this.camera.x + dirX * 0.5,\n                        y: this.camera.y + dirY * 0.5,\n                        z: this.camera.z + dirZ * 0.5,\n                        vx: dirX * 0.8,\n                        vy: dirY * 0.8,\n                        vz: dirZ * 0.8,\n                        life: 120,\n                        type: 'burger',\n                        size: 8,\n                        trail: []\n                    });\n                    return true;\n                }\n                return false;\n            },\n            \n            // Throw an apple at birds\n            throwApple() {\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.id === 'apple' && slot.count > 0) {\n                    slot.count--;\n                    if (slot.count <= 0) {\n                        this.inventory.hotbar[this.selectedSlot] = null;\n                        this.selectedItem = null;\n                    }\n                    this.updateHotbarDisplay();\n                    \n                    // Use the same direction as raycast\n                    const pitch = this.camera.rotX;\n                    const yaw = this.camera.rotY;\n                    const cosPitch = Math.cos(pitch);\n                    const sinPitch = Math.sin(pitch);\n                    \n                    const dirX = -Math.sin(yaw) * cosPitch;\n                    const dirY = -sinPitch;\n                    const dirZ = Math.cos(yaw) * cosPitch;\n                    \n                    // Throw apple\n                    this.particles.push({\n                        x: this.camera.x + dirX * 0.5,\n                        y: this.camera.y + dirY * 0.5,\n                        z: this.camera.z + dirZ * 0.5,\n                        vx: dirX * 0.6,\n                        vy: dirY * 0.6 + 0.1, // Slight arc\n                        vz: dirZ * 0.6,\n                        life: 180,\n                        type: 'apple',\n                        size: 6,\n                        gravity: -0.008\n                    });\n                    return true;\n                }\n                return false;\n            },\n            \n            // Check and complete ritual\n            checkRitual() {\n                if (this.ritualComplete) return;\n                \n                // Check if player has all ritual items\n                const hasItems = {};\n                for (const item of this.ritualItems) {\n                    hasItems[item] = false;\n                }\n                \n                for (let i = 0; i < 9; i++) {\n                    const slot = this.inventory.hotbar[i];\n                    if (slot && this.ritualItems.includes(slot.id)) {\n                        hasItems[slot.id] = true;\n                    }\n                }\n                \n                const allPresent = this.ritualItems.every(item => hasItems[item]);\n                \n                if (allPresent) {\n                    // Complete the Omamori ritual!\n                    this.ritualComplete = true;\n                    this.ritualBlessingActive = true;\n                    this.ritualBlessingTimer = 36000; // 10 minutes at 60fps\n                    \n                    // Consume ritual items\n                    for (let i = 0; i < 9; i++) {\n                        const slot = this.inventory.hotbar[i];\n                        if (slot && this.ritualItems.includes(slot.id)) {\n                            this.inventory.hotbar[i] = null;\n                        }\n                    }\n                    this.updateHotbarDisplay();\n                    \n                    // Reward: All birds become permanently calmed and friendly\n                    for (const pest of this.pestBirds) {\n                        pest.anger = 0;\n                        pest.state = 'circling';\n                    }\n                    \n                    // Grand visual effect\n                    for (let i = 0; i < 50; i++) {\n                        this.particles.push({\n                            x: this.camera.x + (Math.random() - 0.5) * 8,\n                            y: this.camera.y + Math.random() * 5,\n                            z: this.camera.z + (Math.random() - 0.5) * 8,\n                            vx: (Math.random() - 0.5) * 0.1,\n                            vy: 0.05 + Math.random() * 0.1,\n                            vz: (Math.random() - 0.5) * 0.1,\n                            life: 120 + Math.random() * 60,\n                            type: 'petal',\n                            size: 4 + Math.random() * 3,\n                            rotation: Math.random() * Math.PI * 2,\n                            rotSpeed: (Math.random() - 0.5) * 0.2,\n                            flutter: Math.random() * Math.PI * 2\n                        });\n                    }\n                    \n                    return true;\n                }\n                return false;\n            },\n            \n            // Interact with ritual socket blocks\n            interactWithSocket(x, y, z, socketType) {\n                // Map socket types to required items\n                const socketItemMap = {\n                    'petalSocket': 'sakuraPetal',\n                    'ropeSocket': 'shimenawa',\n                    'charmSocket': 'omamori',\n                    'plaqueSocket': 'ema',\n                    'incenseSocket': 'incense'\n                };\n                \n                // Map socket types to filled versions\n                const filledSocketMap = {\n                    'petalSocket': 'petalSocketFilled',\n                    'ropeSocket': 'ropeSocketFilled',\n                    'charmSocket': 'charmSocketFilled',\n                    'plaqueSocket': 'plaqueSocketFilled',\n                    'incenseSocket': 'incenseSocketFilled'\n                };\n                \n                const requiredItem = socketItemMap[socketType];\n                if (!requiredItem) return;\n                \n                // Check if already filled\n                if (socketType.includes('Filled')) return;\n                \n                // Check if player has the required item\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.id === requiredItem && slot.count > 0) {\n                    // Place item on socket\n                    slot.count--;\n                    if (slot.count <= 0) {\n                        this.inventory.hotbar[this.selectedSlot] = null;\n                    }\n                    this.updateHotbarDisplay();\n                    \n                    // Change block to filled version\n                    this.setBlock(x, y, z, filledSocketMap[socketType]);\n                    \n                    // Track socket completion\n                    if (!this.socketsFilled) this.socketsFilled = {};\n                    this.socketsFilled[socketType] = true;\n                    \n                    // Visual effect\n                    for (let i = 0; i < 20; i++) {\n                        this.particles.push({\n                            x: x + 0.5 + (Math.random() - 0.5) * 0.5,\n                            y: y + 1 + Math.random() * 0.5,\n                            z: z + 0.5 + (Math.random() - 0.5) * 0.5,\n                            vx: (Math.random() - 0.5) * 0.1,\n                            vy: 0.1 + Math.random() * 0.1,\n                            vz: (Math.random() - 0.5) * 0.1,\n                            life: 60 + Math.random() * 40,\n                            type: 'spark',\n                            size: 3 + Math.random() * 2\n                        });\n                    }\n                    \n                    // Check if all sockets are filled\n                    const allSocketsFilled = Object.keys(socketItemMap).every(\n                        socket => this.socketsFilled && this.socketsFilled[socket]\n                    );\n                    \n                    if (allSocketsFilled && !this.ritualComplete) {\n                        // COMPLETE THE TEMPLE RITUAL!\n                        this.ritualComplete = true;\n                        this.ritualBlessingActive = true;\n                        this.ritualBlessingTimer = 60 * 60 * 10; // 10 minutes at 60fps\n                        \n                        // Trigger the creative reward\n                        this.triggerRitualReward();\n                        \n                        // Calm all birds\n                        if (this.pestBirds) {\n                            for (const pest of this.pestBirds) {\n                                pest.anger = 0;\n                                pest.state = 'fleeing';\n                                pest.stateTimer = 600;\n                            }\n                        }\n                        \n                        // Score bonus\n                        if (this.survivalStats) {\n                            this.survivalStats.score += 5000;\n                            this.survivalStats.currentObjective = { text: 'Blessing active - birds flee!', type: 'complete' };\n                            this.updateSurvivalHUD();\n                        }\n                        \n                        // Grand visual effect\n                        for (let i = 0; i < 100; i++) {\n                            this.particles.push({\n                                x: x + 0.5 + (Math.random() - 0.5) * 10,\n                                y: y + Math.random() * 8,\n                                z: z + 0.5 + (Math.random() - 0.5) * 10,\n                                vx: (Math.random() - 0.5) * 0.15,\n                                vy: 0.1 + Math.random() * 0.15,\n                                vz: (Math.random() - 0.5) * 0.15,\n                                life: 180 + Math.random() * 120,\n                                type: 'petal',\n                                size: 4 + Math.random() * 4,\n                                rotation: Math.random() * Math.PI * 2,\n                                rotSpeed: (Math.random() - 0.5) * 0.2,\n                                flutter: Math.random() * Math.PI * 2\n                            });\n                        }\n                    }\n                }\n            },\n            \n            // Open chest UI - simply take all items\n            openChest(x, y, z) {\n                if (!this.chestContents) this.chestContents = {};\n                \n                const chestKey = `${x},${y},${z}`;\n                const contents = this.chestContents[chestKey];\n                \n                if (contents && Array.isArray(contents) && contents.length > 0) {\n                    // Take all items from chest\n                    for (const item of contents) {\n                        if (!item) continue;\n                        const itemType = item.type || item.id;\n                        const itemCount = item.count || 1;\n                        \n                        if (itemType) {\n                            if (!this.addToInventory(itemType, itemCount)) {\n                                // Inventory full - drop item\n                                this.dropItem(x + 0.5, y + 1.5, z + 0.5, itemType, itemCount);\n                            }\n                        }\n                    }\n                    // Empty the chest\n                    this.chestContents[chestKey] = [];\n                    this.updateHotbarDisplay();\n                }\n            },\n            \n            // Drop currently held item\n            dropHeldItem() {\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.count > 0) {\n                    // Drop one item in front of player\n                    const dirX = -Math.sin(this.camera.rotY);\n                    const dirZ = Math.cos(this.camera.rotY);\n                    const itemId = slot.id || slot.type;\n                    this.dropItem(\n                        this.camera.x + dirX * 1.5,\n                        this.camera.y,\n                        this.camera.z + dirZ * 1.5,\n                        itemId,\n                        1\n                    );\n                    \n                    slot.count--;\n                    if (slot.count <= 0) {\n                        this.inventory.hotbar[this.selectedSlot] = null;\n                        this.selectedItem = null;\n                    }\n                    this.updateHotbarDisplay();\n                }\n            },\n            \n            // Debug console system\n            debugConsoleOpen: false,\n            debugNoclip: false,\n            debugGodMode: false,\n            debugShowCoords: false,\n            debugFly: false,\n            debugMoveSpeed: null,\n            \n            toggleDebugConsole() {\n                this.debugConsoleOpen = !this.debugConsoleOpen;\n                const consoleEl = document.getElementById('debugConsole');\n                if (consoleEl) {\n                    consoleEl.classList.toggle('active', this.debugConsoleOpen);\n                    if (this.debugConsoleOpen) {\n                        const input = document.getElementById('debugInput');\n                        if (input) {\n                            setTimeout(() => input.focus(), 50);\n                        }\n                        this.debugLog('Debug console opened. Type \"help\" for commands.', 'info');\n                    }\n                }\n            },\n            \n            setupDebugConsole() {\n                const input = document.getElementById('debugInput') as HTMLInputElement;\n                if (input) {\n                    input.addEventListener('keydown', (e) => {\n                        if (e.key === 'Enter') {\n                            const cmd = input.value.trim();\n                            if (cmd) {\n                                this.executeDebugCommand(cmd);\n                                input.value = '';\n                            }\n                        }\n                        if (e.key === '`' || e.key === '~') {\n                            e.preventDefault();\n                            this.toggleDebugConsole();\n                        }\n                        e.stopPropagation();\n                    });\n                    input.addEventListener('keyup', (e) => e.stopPropagation());\n                }\n            },\n            \n            debugLog(msg, type = 'normal') {\n                const output = document.getElementById('debugOutput');\n                if (output) {\n                    const div = document.createElement('div');\n                    div.className = type;\n                    div.textContent = `> ${msg}`;\n                    output.appendChild(div);\n                    output.scrollTop = output.scrollHeight;\n                    \n                    // Limit log size\n                    while (output.children.length > 100) {\n                        output.removeChild(output.firstChild);\n                    }\n                }\n            },\n            \n            executeDebugCommand(cmd) {\n                const parts = cmd.toLowerCase().split(' ');\n                const command = parts[0];\n                const args = parts.slice(1);\n                \n                this.debugLog(cmd, 'normal');\n                \n                switch (command) {\n                    case 'help':\n                        this.debugLog('Commands:', 'info');\n                        this.debugLog('  noclip - Toggle flying through walls', 'info');\n                        this.debugLog('  god - Toggle invincibility', 'info');\n                        this.debugLog('  coords - Toggle coordinate display', 'info');\n                        this.debugLog('  tp <x> <y> <z> - Teleport to position', 'info');\n                        this.debugLog('  give <item> [count] - Give item', 'info');\n                        this.debugLog('  spawn <mob> [count] - Spawn mobs', 'info');\n                        this.debugLog('    mobs: bird, fish, cat, creeper, bluebird', 'info');\n                        this.debugLog('  time <ms> - Set bird event timer', 'info');\n                        this.debugLog('  kill - Kill all mobs', 'info');\n                        this.debugLog('  clear - Clear console', 'info');\n                        this.debugLog('  pos - Show current position', 'info');\n                        this.debugLog('  fly - Toggle flight mode', 'info');\n                        this.debugLog('  speed <value> - Set move speed', 'info');\n                        this.debugLog('  ritual - Complete ritual instantly', 'info');\n                        this.debugLog('  score <value> - Set score', 'info');\n                        this.debugLog('  temple - Teleport to ritual temple', 'info');\n                        break;\n                        \n                    case 'noclip':\n                        this.debugNoclip = !this.debugNoclip;\n                        this.debugLog(`Noclip: ${this.debugNoclip ? 'ON' : 'OFF'}`, this.debugNoclip ? 'success' : 'warn');\n                        break;\n                        \n                    case 'god':\n                        this.debugGodMode = !this.debugGodMode;\n                        this.debugLog(`God mode: ${this.debugGodMode ? 'ON' : 'OFF'}`, this.debugGodMode ? 'success' : 'warn');\n                        break;\n                        \n                    case 'coords':\n                        this.debugShowCoords = !this.debugShowCoords;\n                        this.debugLog(`Coords display: ${this.debugShowCoords ? 'ON' : 'OFF'}`, 'success');\n                        break;\n                        \n                    case 'fly':\n                        this.debugFly = !this.debugFly;\n                        this.debugLog(`Fly mode: ${this.debugFly ? 'ON' : 'OFF'}`, this.debugFly ? 'success' : 'warn');\n                        break;\n                        \n                    case 'tp':\n                        if (args.length >= 3) {\n                            const x = parseFloat(args[0]);\n                            const y = parseFloat(args[1]);\n                            const z = parseFloat(args[2]);\n                            if (!isNaN(x) && !isNaN(y) && !isNaN(z)) {\n                                this.camera.x = x;\n                                this.camera.y = y;\n                                this.camera.z = z;\n                                this.velocity = { x: 0, y: 0, z: 0 };\n                                this.debugLog(`Teleported to ${x.toFixed(1)}, ${y.toFixed(1)}, ${z.toFixed(1)}`, 'success');\n                            } else {\n                                this.debugLog('Invalid coordinates', 'error');\n                            }\n                        } else {\n                            this.debugLog('Usage: tp <x> <y> <z>', 'error');\n                        }\n                        break;\n                        \n                    case 'temple':\n                        if (this.ritualTempleLocation) {\n                            this.camera.x = this.ritualTempleLocation.x + 5;\n                            this.camera.y = this.ritualTempleLocation.y + 3;\n                            this.camera.z = this.ritualTempleLocation.z + 5;\n                            this.velocity = { x: 0, y: 0, z: 0 };\n                            this.debugLog('Teleported to Ritual Temple', 'success');\n                        } else {\n                            this.debugLog('Temple not found', 'error');\n                        }\n                        break;\n                        \n                    case 'pos':\n                        this.debugLog(`Position: ${this.camera.x.toFixed(2)}, ${this.camera.y.toFixed(2)}, ${this.camera.z.toFixed(2)}`, 'info');\n                        this.debugLog(`Rotation: ${(this.camera.rotX * 180 / Math.PI).toFixed(1)}¬∞, ${(this.camera.rotY * 180 / Math.PI).toFixed(1)}¬∞`, 'info');\n                        break;\n                        \n                    case 'give':\n                        if (args.length >= 1) {\n                            const itemId = args[0];\n                            const count = args.length >= 2 ? parseInt(args[1]) : 1;\n                            if (this.blockColors[itemId] || this.itemTypes[itemId]) {\n                                this.addToInventory(itemId, count);\n                                this.debugLog(`Given ${count}x ${itemId}`, 'success');\n                            } else {\n                                this.debugLog(`Unknown item: ${itemId}`, 'error');\n                                this.debugLog('Items: ' + Object.keys(this.itemTypes).slice(0, 10).join(', ') + '...', 'info');\n                            }\n                        } else {\n                            this.debugLog('Usage: give <item> [count]', 'error');\n                        }\n                        break;\n                        \n                    case 'spawn':\n                        const mobType = args[0];\n                        const spawnCount = args.length >= 2 ? parseInt(args[1]) : 1;\n                        const validMobs = ['bird', 'pest', 'fish', 'cat', 'creeper', 'bluebird'];\n                        \n                        if (mobType === 'bird' || mobType === 'pest') {\n                            for (let i = 0; i < spawnCount; i++) this.spawnPestBird();\n                            this.debugLog(`Spawned ${spawnCount} pest bird(s)`, 'success');\n                        } else if (mobType === 'fish') {\n                            for (let i = 0; i < spawnCount; i++) this.spawnFish();\n                            this.debugLog(`Spawned ${spawnCount} fish`, 'success');\n                        } else if (mobType === 'cat') {\n                            for (let i = 0; i < spawnCount; i++) this.spawnCat();\n                            this.debugLog(`Spawned ${spawnCount} cat(s)`, 'success');\n                        } else if (mobType === 'creeper') {\n                            for (let i = 0; i < spawnCount; i++) this.spawnCreeper();\n                            this.debugLog(`Spawned ${spawnCount} creeper(s)`, 'success');\n                        } else if (mobType === 'bluebird') {\n                            for (let i = 0; i < spawnCount; i++) this.spawnBlueBird();\n                            this.debugLog(`Spawned ${spawnCount} blue bird(s)`, 'success');\n                        } else {\n                            this.debugLog('Usage: spawn <mob> [count]', 'error');\n                            this.debugLog('Mobs: ' + validMobs.join(', '), 'info');\n                        }\n                        break;\n                        \n                    case 'kill':\n                        let totalKilled = 0;\n                        totalKilled += this.pestBirds ? this.pestBirds.length : 0;\n                        totalKilled += this.blueBirds ? this.blueBirds.length : 0;\n                        totalKilled += this.creepers ? this.creepers.length : 0;\n                        this.pestBirds = [];\n                        this.blueBirds = [];\n                        this.creepers = [];\n                        this.debugLog(`Killed ${totalKilled} mobs`, 'success');\n                        break;\n                        \n                    case 'time':\n                        if (args.length >= 1) {\n                            const time = parseInt(args[0]);\n                            if (!isNaN(time) && this.birdEvent) {\n                                this.birdEvent.timer = time;\n                                this.debugLog(`Bird event timer set to ${time}ms`, 'success');\n                            }\n                        } else {\n                            this.debugLog('Usage: time <ms>', 'error');\n                        }\n                        break;\n                        \n                    case 'clear':\n                        const outputEl = document.getElementById('debugOutput');\n                        if (outputEl) outputEl.innerHTML = '';\n                        break;\n                        \n                    case 'speed':\n                        if (args.length >= 1) {\n                            this.debugMoveSpeed = parseFloat(args[0]);\n                            this.debugLog(`Speed set to ${this.debugMoveSpeed}`, 'success');\n                        } else {\n                            this.debugLog('Usage: speed <value> (default: 0.12)', 'error');\n                        }\n                        break;\n                        \n                    case 'ritual':\n                        this.ritualComplete = true;\n                        this.ritualBlessingActive = true;\n                        this.ritualBlessingTimer = 60 * 60 * 10;\n                        this.socketsFilled = {\n                            'petalSocket': true, 'ropeSocket': true, 'charmSocket': true,\n                            'plaqueSocket': true, 'incenseSocket': true\n                        };\n                        this.triggerRitualReward();\n                        this.debugLog('Ritual completed!', 'success');\n                        break;\n                        \n                    case 'score':\n                        if (args.length >= 1 && this.survivalStats) {\n                            this.survivalStats.score = parseInt(args[0]);\n                            this.updateSurvivalHUD();\n                            this.debugLog(`Score set to ${this.survivalStats.score}`, 'success');\n                        }\n                        break;\n                        \n                    default:\n                        this.debugLog(`Unknown command: ${command}`, 'error');\n                }\n            },\n            \n            // Ritual reward - creative bonus for completing the temple ritual\n            triggerRitualReward() {\n                // Show blessing effect\n                if (this.birdEvent) {\n                    this.showBirdAlert('üå∏ DIVINE BLESSING ACTIVATED! üå∏');\n                }\n                \n                // 1. Grant player ritual flight ability (separate from debug fly)\n                this.ritualFlight = true;\n                this.ritualFlightTimer = 60 * 60 * 2; // 2 minutes of flight\n                \n                // 2. Create protective barrier that repels birds\n                this.ritualBarrierActive = true;\n                \n                // 3. Give player special items\n                this.addToInventory('berdger', 1);\n                this.addToInventory('apple', 32);\n                \n                // 4. Massive score bonus\n                if (this.survivalStats) {\n                    this.survivalStats.score += 10000;\n                    this.survivalStats.wave++;\n                    this.survivalStats.currentObjective = { text: '‚ú® Divine protection active!', type: 'blessed' };\n                    this.updateSurvivalHUD();\n                }\n                \n                // 5. All pest birds flee\n                for (const pest of this.pestBirds) {\n                    pest.state = 'fleeing';\n                    pest.stateTimer = 1200; // 20 seconds flee\n                    pest.anger = 0;\n                }\n                \n                // 6. Spawn golden particles around player\n                for (let i = 0; i < 100; i++) {\n                    this.particles.push({\n                        x: this.camera.x + (Math.random() - 0.5) * 10,\n                        y: this.camera.y + Math.random() * 8 - 2,\n                        z: this.camera.z + (Math.random() - 0.5) * 10,\n                        vx: (Math.random() - 0.5) * 0.15,\n                        vy: 0.1 + Math.random() * 0.2,\n                        vz: (Math.random() - 0.5) * 0.15,\n                        life: 200 + Math.random() * 100,\n                        type: 'blessing',\n                        size: 4 + Math.random() * 4\n                    });\n                }\n            },\n            \n            // Batch pickup notification system\n            pickupQueue: {},\n            pickupTimer: null,\n            \n            queuePickupNotification(type, count) {\n                if (!this.pickupQueue[type]) {\n                    this.pickupQueue[type] = 0;\n                }\n                this.pickupQueue[type] += count;\n                \n                // Clear existing timer and set new one\n                if (this.pickupTimer) {\n                    clearTimeout(this.pickupTimer);\n                }\n                \n                // Wait 500ms for more pickups before showing notification\n                this.pickupTimer = setTimeout(() => {\n                    this.flushPickupNotifications();\n                }, 500);\n            },\n            \n            flushPickupNotifications() {\n                const container = document.getElementById('pickupNotification');\n                if (!container) return;\n                \n                const itemNames = {\n                    grass: 'Grass Block', dirt: 'Dirt', stone: 'Stone', wood: 'Wood',\n                    appleLeaves: 'Apple Leaves', leaves: 'Leaves', sand: 'Sand', brick: 'Brick',\n                    ak47: 'AK-47', water_bucket: 'Water Bucket', lava_bucket: 'Lava Bucket',\n                    obsidian: 'Obsidian', cherryWood: 'Cherry Wood', cherryLeaves: 'Cherry Leaves',\n                    chest: 'Chest', seeds: 'Seeds', berdger: 'The Berdger', apple: 'Apple',\n                    sakuraPetal: 'Cherry Petal', shimenawa: 'Sacred Rope', omamori: 'Charm',\n                    ema: 'Wish Plaque', incense: 'Incense', whiteBrick: 'White Brick',\n                    redBrick: 'Red Brick', glowstone: 'Glowstone', ritualStone: 'Ritual Stone'\n                };\n                \n                for (const [type, count] of Object.entries(this.pickupQueue)) {\n                    if (count === 0) continue;\n                    \n                    const notification = document.createElement('div');\n                    notification.className = 'pickup-item';\n                    \n                    // Create mini block canvas\n                    const miniCanvas = document.createElement('canvas');\n                    miniCanvas.width = 24;\n                    miniCanvas.height = 24;\n                    this.drawMiniBlock(miniCanvas, type);\n                    \n                    notification.innerHTML = `\n                        <span class=\"pickup-icon\"></span>\n                        <span>+${count} ${itemNames[type] || type}</span>\n                    `;\n                    notification.querySelector('.pickup-icon').appendChild(miniCanvas);\n                    \n                    container.appendChild(notification);\n                    \n                    // Remove after animation\n                    setTimeout(() => {\n                        if (notification.parentNode) {\n                            notification.parentNode.removeChild(notification);\n                        }\n                    }, 2000);\n                }\n                \n                // Clear queue\n                this.pickupQueue = {};\n                this.pickupTimer = null;\n            },\n            \n            // Fluid dynamics simulation - not yet implemented\n            // Fluid dynamics simulation - spreads water/lava realistically\n            // Set fluid level at position\n            setFluidLevel(x, y, z, level) {\n                const key = `${x},${y},${z}`;\n                if (level <= 0) {\n                    delete this.fluidLevels[key];\n                } else {\n                    this.fluidLevels[key] = Math.min(8, Math.max(1, level));\n                }\n            },\n            \n            getFluidLevel(x, y, z) {\n                return this.fluidLevels[`${x},${y},${z}`] || 0;\n            },\n            \n            updateFluids() {\n                // Process fluid updates slowly for visible spreading effect\n                if (!this.fluidUpdateTimer) this.fluidUpdateTimer = 0;\n                this.fluidUpdateTimer++;\n                if (this.fluidUpdateTimer < 8) return;  // Update every 8 frames (~7.5 updates/sec)\n                this.fluidUpdateTimer = 0;\n                \n                // Process 1-2 fluid blocks per update cycle for gradual spread\n                const maxUpdates = 2;\n                let processed = 0;\n                \n                while (this.fluidUpdates.length > 0 && processed < maxUpdates) {\n                    const fluid = this.fluidUpdates.shift();\n                    processed++;\n                    \n                    // Skip if block is no longer fluid (was replaced by player)\n                    const currentBlock = this.getBlock(fluid.x, fluid.y, fluid.z);\n                    if (!currentBlock || !this.fluidBlocks.includes(currentBlock)) {\n                        // Clean up fluid level if block was removed\n                        this.setFluidLevel(fluid.x, fluid.y, fluid.z, 0);\n                        continue;\n                    }\n                    \n                    const currentLevel = fluid.level || 8;\n                    \n                    // Priority 1: Flow DOWN (gravity)\n                    const belowBlock = this.getBlock(fluid.x, fluid.y - 1, fluid.z);\n                    \n                    // Check for water/lava interactions when flowing down\n                    if (belowBlock === 'water' && fluid.type === 'lava') {\n                        // Lava falling onto water = STONE\n                        this.setBlock(fluid.x, fluid.y - 1, fluid.z, 'stone');\n                        this.setFluidLevel(fluid.x, fluid.y - 1, fluid.z, 0);\n                        continue;\n                    } else if (belowBlock === 'lava' && fluid.type === 'water') {\n                        // Water falling onto lava = OBSIDIAN\n                        this.setBlock(fluid.x, fluid.y - 1, fluid.z, 'obsidian');\n                        this.setFluidLevel(fluid.x, fluid.y - 1, fluid.z, 0);\n                        continue;\n                    }\n                    \n                    if (!belowBlock) {\n                        // Empty space below - flow down with full level (falling fluid is full)\n                        this.setBlock(fluid.x, fluid.y - 1, fluid.z, fluid.type);\n                        this.setFluidLevel(fluid.x, fluid.y - 1, fluid.z, 8);\n                        this.fluidUpdates.push({\n                            x: fluid.x,\n                            y: fluid.y - 1,\n                            z: fluid.z,\n                            type: fluid.type,\n                            level: 8  // Falling fluid has full level\n                        });\n                        continue;  // Prioritize downward flow\n                    }\n                    \n                    // Priority 2: Spread HORIZONTALLY (only if can't flow down)\n                    // Horizontal spread decreases level by 1\n                    const spreadLevel = currentLevel - 1;\n                    if (spreadLevel <= 0) continue;  // Can't spread further\n                    \n                    if (belowBlock && !this.fluidBlocks.includes(belowBlock)) {\n                        // Solid block below - spread horizontally\n                        const directions = [\n                            { x: 1, z: 0 },\n                            { x: -1, z: 0 },\n                            { x: 0, z: 1 },\n                            { x: 0, z: -1 }\n                        ];\n                        \n                        // Randomize spread direction for natural look\n                        for (let i = directions.length - 1; i > 0; i--) {\n                            const j = Math.floor(Math.random() * (i + 1));\n                            [directions[i], directions[j]] = [directions[j], directions[i]];\n                        }\n                        \n                        for (const dir of directions) {\n                            const nx = fluid.x + dir.x;\n                            const nz = fluid.z + dir.z;\n                            const neighborBlock = this.getBlock(nx, fluid.y, nz);\n                            const neighborLevel = this.getFluidLevel(nx, fluid.y, nz);\n                            \n                            // Water + Lava horizontal interaction\n                            if (fluid.type === 'lava' && neighborBlock === 'water') {\n                                // Lava touching water horizontally = stone (at neighbor)\n                                this.setBlock(nx, fluid.y, nz, 'stone');\n                                this.setFluidLevel(nx, fluid.y, nz, 0);\n                                continue;\n                            } else if (fluid.type === 'water' && neighborBlock === 'lava') {\n                                // Water touching lava horizontally = stone (at neighbor) \n                                this.setBlock(nx, fluid.y, nz, 'stone');\n                                this.setFluidLevel(nx, fluid.y, nz, 0);\n                                continue;\n                            }\n                            \n                            // Spread to empty spaces or lower-level same fluid\n                            if (!neighborBlock) {\n                                this.setBlock(nx, fluid.y, nz, fluid.type);\n                                this.setFluidLevel(nx, fluid.y, nz, spreadLevel);\n                                this.fluidUpdates.push({\n                                    x: nx,\n                                    y: fluid.y,\n                                    z: nz,\n                                    type: fluid.type,\n                                    level: spreadLevel\n                                });\n                            } else if (neighborBlock === fluid.type && neighborLevel < spreadLevel) {\n                                // Flow into lower-level same fluid\n                                this.setFluidLevel(nx, fluid.y, nz, spreadLevel);\n                                this.fluidUpdates.push({\n                                    x: nx,\n                                    y: fluid.y,\n                                    z: nz,\n                                    type: fluid.type,\n                                    level: spreadLevel\n                                });\n                            }\n                        }\n                    }\n                }\n            },\n            \n            // Toggle inventory screen\n            toggleInventory() {\n                this.inventoryOpen = !this.inventoryOpen;\n                const invScreen = document.getElementById('inventoryScreen');\n                if (invScreen) {\n                    invScreen.classList.toggle('active', this.inventoryOpen);\n                }\n                \n                if (this.inventoryOpen) {\n                    this.inventoryHeldItem = null; // Clear held item when opening\n                    this.renderInventory();\n                    // Release pointer lock but DON'T pause - game continues in background\n                    if (document.pointerLockElement) {\n                        document.exitPointerLock();\n                    }\n                } else {\n                    this.inventoryHeldItem = null; // Clear held item when closing\n                    // Set flag to prevent pause from pointer lock release\n                    this.justClosedInventory = true;\n                    setTimeout(() => { this.justClosedInventory = false; }, 100);\n                    // Re-request pointer lock when closing inventory\n                    if (!this.isPaused) {\n                        this.canvas.requestPointerLock();\n                    }\n                }\n            },\n            \n            // Render inventory UI\n            renderInventory() {\n                const invScreen = document.getElementById('inventoryScreen');\n                if (!invScreen) return;\n                \n                // Helper to get readable item name\n                const getItemName = (slot) => {\n                    if (!slot) return '';\n                    const id = slot.id || slot.type;\n                    const names = {\n                        grass: 'Grass Block', dirt: 'Dirt', stone: 'Stone', wood: 'Wood',\n                        leaves: 'Leaves', water: 'Water', sand: 'Sand', brick: 'Brick',\n                        ak47: 'AK-47', water_bucket: 'Water Bucket', lava_bucket: 'Lava Bucket',\n                        lava: 'Lava', obsidian: 'Obsidian', cherryWood: 'Cherry Wood',\n                        cherryLeaves: 'Cherry Leaves', chest: 'Chest',\n                        ritualChest: 'Ritual Chest', buildingChest: 'Building Chest',\n                        seeds: 'Seeds', berdger: 'The Berdger',\n                        sakuraPetal: 'Sacred Cherry Petal', shimenawa: 'Sacred Rope',\n                        omamori: 'Protective Charm', ema: 'Wooden Wish Plaque',\n                        incense: 'Purifying Incense'\n                    };\n                    return names[id] || id;\n                };\n                \n                let html = '<div class=\"inventory-container\">';\n                html += '<h2>Inventory</h2>';\n                \n                // Crafting section\n                html += '<div class=\"crafting-section\">';\n                html += '<h3>Crafting</h3>';\n                html += '<div class=\"recipe-list\">';\n                for (const recipe of this.recipes) {\n                    const canCraft = this.canCraftRecipe(recipe);\n                    html += `<div class=\"recipe ${canCraft ? 'craftable' : 'disabled'}\" data-recipe=\"${recipe.name}\">`;\n                    html += `<span class=\"recipe-name\">${recipe.name}</span>`;\n                    html += `<span class=\"recipe-ingredients\">`;\n                    recipe.ingredients.forEach(ing => {\n                        html += `${ing.count}x ${ing.id} `;\n                    });\n                    html += `</span>`;\n                    html += `<span class=\"recipe-result\">‚Üí ${recipe.result.count}x ${recipe.result.id}</span>`;\n                    if (canCraft) {\n                        html += `<button class=\"craft-btn\" onclick=\"minecraftGame.craftRecipe('${recipe.name}')\">Craft</button>`;\n                    }\n                    html += '</div>';\n                }\n                html += '</div></div>';\n                \n                // Hotbar\n                html += '<div class=\"inv-hotbar\">';\n                html += '<h3>Hotbar</h3>';\n                html += '<div class=\"inv-slots\" id=\"hotbarSlots\">';\n                this.inventory.hotbar.forEach((slot, i) => {\n                    const emoji = this.getItemEmoji(slot);\n                    const hasItem = slot && slot.count > 0;\n                    const isHeld = this.inventoryHeldItem && this.inventoryHeldItem.source === 'hotbar' && this.inventoryHeldItem.index === i;\n                    const tooltip = hasItem ? getItemName(slot) : '';\n                    html += `<div class=\"inv-slot ${i === this.selectedSlot ? 'selected' : ''} ${hasItem ? 'has-item' : ''} ${isHeld ? 'held' : ''}\" \n                        data-source=\"hotbar\" data-index=\"${i}\" ${tooltip ? `data-tooltip=\"${tooltip}\"` : ''}\n                        draggable=\"${hasItem}\">${emoji}<span class=\"count\">${slot ? slot.count : ''}</span></div>`;\n                });\n                html += '</div></div>';\n                \n                // Main inventory\n                html += '<div class=\"inv-main\">';\n                html += '<h3>Storage</h3>';\n                html += '<div class=\"inv-slots\" id=\"storageSlots\">';\n                for (let i = 0; i < 27; i++) {\n                    const slot = this.inventory.main[i];\n                    const hasItem = slot && slot.count > 0;\n                    const isHeld = this.inventoryHeldItem && this.inventoryHeldItem.source === 'main' && this.inventoryHeldItem.index === i;\n                    if (slot) {\n                        const emoji = this.getItemEmoji(slot);\n                        const tooltip = getItemName(slot);\n                        html += `<div class=\"inv-slot has-item ${isHeld ? 'held' : ''}\" data-source=\"main\" data-index=\"${i}\" ${tooltip ? `data-tooltip=\"${tooltip}\"` : ''} draggable=\"true\">${emoji}<span class=\"count\">${slot.count}</span></div>`;\n                    } else {\n                        html += `<div class=\"inv-slot empty\" data-source=\"main\" data-index=\"${i}\" draggable=\"false\"></div>`;\n                    }\n                }\n                html += '</div></div>';\n                \n                html += '<p class=\"inv-hint\">Click items to pick up/place | Drag also works | Press E or ESC to close</p>';\n                html += '</div>';\n                \n                invScreen.innerHTML = html;\n                \n                // Setup drag and drop handlers\n                this.setupInventoryDragDrop();\n            },\n            \n            setupInventoryDragDrop() {\n                const invScreen = document.getElementById('inventoryScreen');\n                const slots = document.querySelectorAll('#inventoryScreen .inv-slot');\n                \n                // Track held item for click-to-move\n                if (!this.inventoryHeldItem) this.inventoryHeldItem = null;\n                \n                // Prevent page scrolling when scrolling inside inventory\n                const invContainer = invScreen.querySelector('.inventory-container');\n                if (invContainer) {\n                    invContainer.addEventListener('wheel', (e) => {\n                        e.stopPropagation();\n                        // Allow scrolling inside the container but prevent it from bubbling\n                        const { scrollTop, scrollHeight, clientHeight } = invContainer;\n                        const atTop = scrollTop === 0;\n                        const atBottom = scrollTop + clientHeight >= scrollHeight;\n                        \n                        // Only prevent default if we're trying to scroll beyond bounds\n                        if ((atTop && (e as WheelEvent).deltaY < 0) || (atBottom && (e as WheelEvent).deltaY > 0)) {\n                            e.preventDefault();\n                        }\n                    }, { passive: false });\n                }\n                \n                // Prevent scroll on the inventory screen during drag operations\n                invScreen.addEventListener('dragover', (e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                });\n                \n                invScreen.addEventListener('drop', (e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                });\n                \n                slots.forEach(slot => {\n                    // Click to select/place items (more reliable than drag)\n                    slot.addEventListener('click', (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        \n                        const source = (slot as HTMLElement).dataset.source;\n                        const index = parseInt((slot as HTMLElement).dataset.index);\n                        const slotArray = source === 'hotbar' ? this.inventory.hotbar : this.inventory.main;\n                        const clickedItem = slotArray[index];\n                        \n                        if (this.inventoryHeldItem) {\n                            // Place held item in this slot (swap if occupied)\n                            this.swapInventorySlots(\n                                this.inventoryHeldItem.source,\n                                this.inventoryHeldItem.index,\n                                source,\n                                index\n                            );\n                            this.inventoryHeldItem = null;\n                            this.renderInventory();\n                            this.updateHotbar();\n                            this.updateHotbarDisplay();\n                        } else if (clickedItem && clickedItem.count > 0) {\n                            // Pick up this item\n                            this.inventoryHeldItem = { source, index };\n                            this.renderInventory();\n                        }\n                    });\n                    \n                    // Also support drag and drop\n                    slot.addEventListener('dragstart', (e) => {\n                        e.stopPropagation();\n                        const source = (slot as HTMLElement).dataset.source;\n                        const index = parseInt((slot as HTMLElement).dataset.index);\n                        this.draggedItem = { source, index };\n                        slot.classList.add('dragging');\n                        (e as DragEvent).dataTransfer.effectAllowed = 'move';\n                        (e as DragEvent).dataTransfer.setDragImage(slot, 20, 20);\n                    });\n                    \n                    slot.addEventListener('dragend', (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        slot.classList.remove('dragging');\n                        this.draggedItem = null;\n                    });\n                    \n                    slot.addEventListener('dragover', (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        (e as DragEvent).dataTransfer.dropEffect = 'move';\n                        slot.classList.add('drag-over');\n                    });\n                    \n                    slot.addEventListener('dragleave', (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        slot.classList.remove('drag-over');\n                    });\n                    \n                    slot.addEventListener('drop', (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        slot.classList.remove('drag-over');\n                        \n                        if (!this.draggedItem) return;\n                        \n                        const targetSource = (slot as HTMLElement).dataset.source;\n                        const targetIndex = parseInt((slot as HTMLElement).dataset.index);\n                        \n                        // Store scroll position\n                        const invContainer = document.querySelector('.inventory-container');\n                        const scrollTop = invContainer ? invContainer.scrollTop : 0;\n                        \n                        // Swap items between source and target\n                        this.swapInventorySlots(\n                            this.draggedItem.source, \n                            this.draggedItem.index,\n                            targetSource,\n                            targetIndex\n                        );\n                        \n                        this.draggedItem = null;\n                        this.renderInventory();\n                        this.updateHotbar();\n                        this.updateHotbarDisplay();\n                        \n                        // Restore scroll position\n                        const newContainer = document.querySelector('.inventory-container');\n                        if (newContainer) {\n                            newContainer.scrollTop = scrollTop;\n                        }\n                    });\n                });\n            },\n            \n            swapInventorySlots(srcType, srcIdx, destType, destIdx) {\n                const srcArray = srcType === 'hotbar' ? this.inventory.hotbar : this.inventory.main;\n                const destArray = destType === 'hotbar' ? this.inventory.hotbar : this.inventory.main;\n                \n                // Get items\n                const srcItem = srcArray[srcIdx];\n                const destItem = destArray[destIdx];\n                \n                // Swap\n                srcArray[srcIdx] = destItem;\n                destArray[destIdx] = srcItem;\n                \n                // Update selected block/item if hotbar changed\n                if (srcType === 'hotbar' || destType === 'hotbar') {\n                    const currentSlot = this.inventory.hotbar[this.selectedSlot];\n                    if (currentSlot) {\n                        if (currentSlot.type === 'block') {\n                            this.selectedBlock = currentSlot.id;\n                            this.selectedItem = null;\n                        } else if (currentSlot.type === 'weapon') {\n                            this.selectedItem = currentSlot.id;\n                            this.selectedBlock = null;\n                        }\n                    } else {\n                        this.selectedBlock = null;\n                        this.selectedItem = null;\n                    }\n                }\n            },\n            \n            getItemEmoji(slot) {\n                if (!slot) return '';\n                const id = slot.id || slot.type;\n                const emojis = {\n                    grass: 'üåø', dirt: 'üü´', stone: 'ü™®', wood: 'ü™µ',\n                    leaves: 'üå∏', water: 'üíß', sand: 'üèñÔ∏è', brick: 'üß±',\n                    ak47: 'üî´', water_bucket: 'ü™£', lava_bucket: 'ü´ß',\n                    lava: 'üî•', obsidian: 'üü£', cherryWood: 'ü™µ', cherryLeaves: 'üå∏',\n                    chest: 'üì¶', ritualChest: 'üì¶', buildingChest: 'üì¶',\n                    seeds: 'üåæ', berdger: 'üçî',\n                    sakuraPetal: 'üå∏', shimenawa: 'ü™¢', omamori: 'üéÄ',\n                    ema: 'ü™ß', incense: 'üïØÔ∏è'\n                };\n                return emojis[id] || '‚ùì';\n            },\n            \n            canCraftRecipe(recipe) {\n                for (const ingredient of recipe.ingredients) {\n                    const total = this.countItem(ingredient.id);\n                    if (total < ingredient.count) return false;\n                }\n                return true;\n            },\n            \n            countItem(itemId) {\n                let count = 0;\n                for (const slot of this.inventory.hotbar) {\n                    if (slot && slot.id === itemId) count += slot.count;\n                }\n                for (const slot of this.inventory.main) {\n                    if (slot && slot.id === itemId) count += slot.count;\n                }\n                return count;\n            },\n            \n            craftRecipe(recipeName) {\n                const recipe = this.recipes.find(r => r.name === recipeName);\n                if (!recipe || !this.canCraftRecipe(recipe)) return;\n                \n                // Remove ingredients\n                for (const ingredient of recipe.ingredients) {\n                    this.removeItem(ingredient.id, ingredient.count);\n                }\n                \n                // Add result\n                this.addItem(recipe.result);\n                \n                // Re-render inventory\n                this.renderInventory();\n            },\n            \n            removeItem(itemId, count) {\n                let remaining = count;\n                \n                // Remove from hotbar first\n                for (const slot of this.inventory.hotbar) {\n                    if (slot && slot.id === itemId && remaining > 0) {\n                        const remove = Math.min(slot.count, remaining);\n                        slot.count -= remove;\n                        remaining -= remove;\n                    }\n                }\n                \n                // Then from main inventory\n                for (const slot of this.inventory.main) {\n                    if (slot && slot.id === itemId && remaining > 0) {\n                        const remove = Math.min(slot.count, remaining);\n                        slot.count -= remove;\n                        remaining -= remove;\n                    }\n                }\n            },\n            \n            addItem(item) {\n                // Try to stack with existing items first\n                for (const slot of this.inventory.hotbar) {\n                    if (slot && slot.id === item.id && slot.count < 64) {\n                        const add = Math.min(64 - slot.count, item.count);\n                        slot.count += add;\n                        item.count -= add;\n                        if (item.count <= 0) return;\n                    }\n                }\n                \n                for (const slot of this.inventory.main) {\n                    if (slot && slot.id === item.id && slot.count < 64) {\n                        const add = Math.min(64 - slot.count, item.count);\n                        slot.count += add;\n                        item.count -= add;\n                        if (item.count <= 0) return;\n                    }\n                }\n                \n                // Find empty slot\n                for (let i = 0; i < this.inventory.main.length; i++) {\n                    if (!this.inventory.main[i]) {\n                        this.inventory.main[i] = { ...item };\n                        return;\n                    }\n                }\n            },\n            \n            raycast() {\n                // Calculate ray direction from camera angles\n                // rotY = yaw (horizontal), rotX = pitch (vertical)\n                const pitch = this.camera.rotX;\n                const yaw = this.camera.rotY;\n                \n                const cosPitch = Math.cos(pitch);\n                const sinPitch = Math.sin(pitch);\n                const cosYaw = Math.cos(yaw);\n                const sinYaw = Math.sin(yaw);\n                \n                // Direction vector (matches movement and projection)\n                const dx = -sinYaw * cosPitch;\n                const dy = -sinPitch;\n                const dz = cosYaw * cosPitch;\n                \n                // Normalize direction (important for accurate distance calculation)\n                const len = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                const dirX = dx / len;\n                const dirY = dy / len;\n                const dirZ = dz / len;\n                \n                // Ray origin - start slightly in front of camera to avoid self-intersection\n                const startOffset = 0.1;\n                let x = this.camera.x + dirX * startOffset;\n                let y = this.camera.y + dirY * startOffset;\n                let z = this.camera.z + dirZ * startOffset;\n                \n                // Current voxel position\n                let voxelX = Math.floor(x);\n                let voxelY = Math.floor(y);\n                let voxelZ = Math.floor(z);\n                \n                // Step direction (+1 or -1)\n                const stepX = dirX >= 0 ? 1 : -1;\n                const stepY = dirY >= 0 ? 1 : -1;\n                const stepZ = dirZ >= 0 ? 1 : -1;\n                \n                // Distance between voxel boundaries along each axis\n                const tDeltaX = Math.abs(1 / dirX);\n                const tDeltaY = Math.abs(1 / dirY);\n                const tDeltaZ = Math.abs(1 / dirZ);\n                \n                // Distance to first voxel boundary\n                let tMaxX, tMaxY, tMaxZ;\n                \n                if (dirX > 0) {\n                    tMaxX = (voxelX + 1 - x) / dirX;\n                } else if (dirX < 0) {\n                    tMaxX = (voxelX - x) / dirX;\n                } else {\n                    tMaxX = Infinity;\n                }\n                \n                if (dirY > 0) {\n                    tMaxY = (voxelY + 1 - y) / dirY;\n                } else if (dirY < 0) {\n                    tMaxY = (voxelY - y) / dirY;\n                } else {\n                    tMaxY = Infinity;\n                }\n                \n                if (dirZ > 0) {\n                    tMaxZ = (voxelZ + 1 - z) / dirZ;\n                } else if (dirZ < 0) {\n                    tMaxZ = (voxelZ - z) / dirZ;\n                } else {\n                    tMaxZ = Infinity;\n                }\n                \n                // Track the face we entered from (for block placement)\n                let enteredFace = null;\n                \n                // Maximum reach distance (in blocks)\n                const maxDistance = 6;\n                let t = 0;\n                \n                // Track last non-fluid entry face for proper placement\n                let lastSolidFace = null;\n                \n                // Track if ray passed through water\n                let throughWater = false;\n                let throughLava = false;\n                \n                // DDA traversal loop\n                for (let i = 0; i < 100; i++) { // safety limit\n                    // Check current voxel for block\n                    const block = this.getBlock(voxelX, voxelY, voxelZ);\n                    if (block) {\n                        // Skip fluid blocks - continue raycast through them\n                        if (block === 'water' || block === 'lava') {\n                            // Track which fluid we passed through\n                            if (block === 'water') throughWater = true;\n                            if (block === 'lava') throughLava = true;\n                            // Don't update lastSolidFace, just continue\n                        } else {\n                            // Hit a solid block! Calculate placement position\n                            let placePos = null;\n                            // Use lastSolidFace if we came through fluids, otherwise use enteredFace\n                            const placeFace = lastSolidFace || enteredFace;\n                            if (placeFace) {\n                                placePos = {\n                                    x: voxelX + placeFace.x,\n                                    y: voxelY + placeFace.y,\n                                    z: voxelZ + placeFace.z\n                                };\n                            }\n                            \n                            return {\n                                hit: { x: voxelX, y: voxelY, z: voxelZ },\n                                place: placePos,\n                                block: block,\n                                throughWater: throughWater,\n                                throughLava: throughLava\n                            };\n                        }\n                    } else {\n                        // Empty space - update lastSolidFace\n                        lastSolidFace = enteredFace;\n                    }\n                    \n                    // Step to next voxel (choose axis with smallest tMax)\n                    if (tMaxX < tMaxY && tMaxX < tMaxZ) {\n                        t = tMaxX;\n                        if (t > maxDistance) break;\n                        voxelX += stepX;\n                        tMaxX += tDeltaX;\n                        enteredFace = { x: -stepX, y: 0, z: 0 };\n                    } else if (tMaxY < tMaxZ) {\n                        t = tMaxY;\n                        if (t > maxDistance) break;\n                        voxelY += stepY;\n                        tMaxY += tDeltaY;\n                        enteredFace = { x: 0, y: -stepY, z: 0 };\n                    } else {\n                        t = tMaxZ;\n                        if (t > maxDistance) break;\n                        voxelZ += stepZ;\n                        tMaxZ += tDeltaZ;\n                        enteredFace = { x: 0, y: 0, z: -stepZ };\n                    }\n                }\n                \n                // No block hit within range\n                return null;\n            },\n            \n            update() {\n                if (!this.isActive || this.isPaused) return;\n                \n                // Update weapon cooldowns\n                if (this.shootCooldown > 0) this.shootCooldown--;\n                if (this.muzzleFlash > 0) this.muzzleFlash--;\n                \n                // Update ritual flight timer (separate from debug fly)\n                if (this.ritualFlightTimer > 0) {\n                    this.ritualFlightTimer--;\n                    if (this.ritualFlightTimer <= 0) {\n                        this.ritualFlight = false;\n                    }\n                }\n                \n                const baseSpeed = this.debugMoveSpeed || 0.12;\n                const canFly = this.debugNoclip || this.debugFly || this.ritualFlight;\n                const speed = canFly ? baseSpeed * 2 : baseSpeed;\n                // Forward direction matches camera view: (-sin(rotY), cos(rotY))\n                const sin = Math.sin(this.camera.rotY);\n                const cos = Math.cos(this.camera.rotY);\n                \n                // --- NOCLIP/FLY MODE ---\n                if (this.debugNoclip || this.debugFly) {\n                    let moveX = 0, moveY = 0, moveZ = 0;\n                    \n                    // Forward/backward (W/S) - includes vertical component when looking up/down\n                    if (this.keys['w']) {\n                        moveX -= sin * Math.cos(this.camera.rotX) * speed;\n                        moveY -= Math.sin(this.camera.rotX) * speed;\n                        moveZ += cos * Math.cos(this.camera.rotX) * speed;\n                    }\n                    if (this.keys['s']) {\n                        moveX += sin * Math.cos(this.camera.rotX) * speed;\n                        moveY += Math.sin(this.camera.rotX) * speed;\n                        moveZ -= cos * Math.cos(this.camera.rotX) * speed;\n                    }\n                    // Strafe (A/D)\n                    if (this.keys['a']) {\n                        moveX -= cos * speed;\n                        moveZ -= sin * speed;\n                    }\n                    if (this.keys['d']) {\n                        moveX += cos * speed;\n                        moveZ += sin * speed;\n                    }\n                    // Up/Down (Space/Shift)\n                    if (this.keys[' ']) moveY += speed;\n                    if (this.keys['shift']) moveY -= speed;\n                    \n                    // Apply movement (no collision in noclip, collision in debug fly)\n                    if (this.debugNoclip) {\n                        this.camera.x += moveX;\n                        this.camera.y += moveY;\n                        this.camera.z += moveZ;\n                    } else {\n                        // Debug fly mode still has collision\n                        this.camera.x += moveX;\n                        this.camera.y += moveY;\n                        this.camera.z += moveZ;\n                    }\n                    \n                    // Reset velocity\n                    this.velocity = { x: 0, y: 0, z: 0 };\n                    return; // Skip normal physics\n                }\n                \n                // --- RITUAL FLIGHT MODE (with collision) ---\n                if (this.ritualFlight) {\n                    let moveX = 0, moveY = 0, moveZ = 0;\n                    \n                    // Horizontal movement\n                    if (this.keys['w']) {\n                        moveX -= sin * speed;\n                        moveZ += cos * speed;\n                    }\n                    if (this.keys['s']) {\n                        moveX += sin * speed;\n                        moveZ -= cos * speed;\n                    }\n                    if (this.keys['a']) {\n                        moveX -= cos * speed;\n                        moveZ -= sin * speed;\n                    }\n                    if (this.keys['d']) {\n                        moveX += cos * speed;\n                        moveZ += sin * speed;\n                    }\n                    // Vertical flight controls\n                    if (this.keys[' ']) moveY += speed;\n                    if (this.keys['shift']) moveY -= speed;\n                    \n                    // Apply with simple collision check\n                    const newX = this.camera.x + moveX;\n                    const newY = this.camera.y + moveY;\n                    const newZ = this.camera.z + moveZ;\n                    \n                    const feetY = Math.floor(newY - this.playerEyeHeight);\n                    const headY = Math.floor(newY);\n                    const px = Math.floor(newX);\n                    const pz = Math.floor(newZ);\n                    \n                    let canMove = true;\n                    for (let checkY = feetY; checkY <= headY; checkY++) {\n                        const block = this.getBlock(px, checkY, pz);\n                        if (block && !this.fluidBlocks.includes(block)) {\n                            canMove = false;\n                            break;\n                        }\n                    }\n                    \n                    if (canMove) {\n                        this.camera.x = newX;\n                        this.camera.y = newY;\n                        this.camera.z = newZ;\n                    }\n                    \n                    this.velocity = { x: 0, y: 0, z: 0 };\n                    return; // Skip normal physics\n                }\n                \n                // --- FLUID DETECTION ---\n                const playerFeetY = this.camera.y - this.playerEyeHeight;\n                const playerHeadY = playerFeetY + this.playerHeight;\n                const px = Math.floor(this.camera.x);\n                const pz = Math.floor(this.camera.z);\n                \n                // Check fluid at feet, waist, and head\n                const feetBlock = this.getBlock(px, Math.floor(playerFeetY), pz);\n                const waistBlock = this.getBlock(px, Math.floor(playerFeetY + 0.9), pz);\n                const headBlock = this.getBlock(px, Math.floor(playerHeadY - 0.1), pz);\n                \n                const feetInWater = feetBlock === 'water';\n                const feetInLava = feetBlock === 'lava';\n                const waistInWater = waistBlock === 'water';\n                const waistInLava = waistBlock === 'lava';\n                const headInWater = headBlock === 'water';\n                const headInLava = headBlock === 'lava';\n                \n                // Determine swimming state (in fluid at feet or waist level)\n                const inWater = feetInWater || waistInWater;\n                const inLava = feetInLava || waistInLava;\n                const swimming = inWater || inLava;\n                const submerged = headInWater || headInLava;\n                \n                // Store fluid state for rendering effects\n                this.inWater = inWater || headInWater;\n                this.inLava = inLava || headInLava;\n                this.swimming = swimming;\n                this.headSubmergedWater = headInWater;  // Only show blue overlay when head is underwater\n                this.headSubmergedLava = headInLava;    // Only show lava overlay when head is in lava\n                \n                // Apply speed modifier when in fluid\n                let speedMod = 1.0;\n                if (inWater) speedMod = 0.65;  // Water slows to 65%\n                if (inLava) speedMod = 0.35;   // Lava slows to 35%\n                \n                let moveX = 0;\n                let moveZ = 0;\n                const walkSpeed = baseSpeed;\n                \n                // Forward/backward (W/S)\n                if (this.keys['w']) {\n                    moveX -= sin * walkSpeed * speedMod;\n                    moveZ += cos * walkSpeed * speedMod;\n                }\n                if (this.keys['s']) {\n                    moveX += sin * walkSpeed * speedMod;\n                    moveZ -= cos * walkSpeed * speedMod;\n                }\n                // Strafe left/right (A/D) - perpendicular to view\n                if (this.keys['a']) {\n                    moveX -= cos * walkSpeed * speedMod;\n                    moveZ -= sin * walkSpeed * speedMod;\n                }\n                if (this.keys['d']) {\n                    moveX += cos * walkSpeed * speedMod;\n                    moveZ += sin * walkSpeed * speedMod;\n                }\n                \n                // Track old position\n                const oldX = this.camera.x;\n                const oldZ = this.camera.z;\n                \n                // Improved collision detection with smaller steps and wall sliding\n                const playerRadius = 0.25; // Slightly smaller for tighter spaces\n                const playerHeight = 1.8;\n                \n                // First, check if we're currently stuck and need to escape\n                if (this.collidesAt(this.camera.x, this.camera.y, this.camera.z, playerRadius, playerHeight)) {\n                    // EMERGENCY UNSTUCK - aggressive push out\n                    let escaped = false;\n                    for (let pushDist = 0.1; pushDist <= 1.5 && !escaped; pushDist += 0.1) {\n                        const escapeAngles = [0, 45, 90, 135, 180, 225, 270, 315];\n                        for (const angle of escapeAngles) {\n                            const rad = angle * Math.PI / 180;\n                            const testX = this.camera.x + Math.cos(rad) * pushDist;\n                            const testZ = this.camera.z + Math.sin(rad) * pushDist;\n                            if (!this.collidesAt(testX, this.camera.y, testZ, playerRadius, playerHeight)) {\n                                this.camera.x = testX;\n                                this.camera.z = testZ;\n                                escaped = true;\n                                break;\n                            }\n                        }\n                        // Also try pushing up\n                        if (!escaped && !this.collidesAt(this.camera.x, this.camera.y + pushDist, this.camera.z, playerRadius, playerHeight)) {\n                            this.camera.y += pushDist;\n                            escaped = true;\n                        }\n                    }\n                }\n                \n                // Try full movement first\n                let finalX = this.camera.x;\n                let finalZ = this.camera.z;\n                \n                // Step-based collision for smoother wall sliding\n                const steps = 8; // More steps for smoother collision\n                const stepX = moveX / steps;\n                const stepZ = moveZ / steps;\n                \n                for (let i = 0; i < steps; i++) {\n                    // Try X movement with slight margin\n                    const testX = finalX + stepX;\n                    if (!this.collidesAt(testX, this.camera.y, finalZ, playerRadius, playerHeight)) {\n                        finalX = testX;\n                    } else {\n                        // Try to slide along the wall with reduced speed\n                        const slideX = stepX * 0.5;\n                        if (!this.collidesAt(finalX + slideX, this.camera.y, finalZ, playerRadius, playerHeight)) {\n                            finalX += slideX;\n                        }\n                    }\n                    \n                    // Try Z movement with slight margin\n                    const testZ = finalZ + stepZ;\n                    if (!this.collidesAt(finalX, this.camera.y, testZ, playerRadius, playerHeight)) {\n                        finalZ = testZ;\n                    } else {\n                        // Try to slide along the wall with reduced speed\n                        const slideZ = stepZ * 0.5;\n                        if (!this.collidesAt(finalX, this.camera.y, finalZ + slideZ, playerRadius, playerHeight)) {\n                            finalZ += slideZ;\n                        }\n                    }\n                }\n                \n                // Final safety check - if still stuck, try small adjustments\n                if (this.collidesAt(finalX, this.camera.y, finalZ, playerRadius, playerHeight)) {\n                    // Don't move at all if we'd get stuck\n                    finalX = this.camera.x;\n                    finalZ = this.camera.z;\n                }\n                \n                this.camera.x = finalX;\n                this.camera.z = finalZ;\n                \n                // Track distance\n                const dx = this.camera.x - oldX;\n                const dz = this.camera.z - oldZ;\n                this.stats.distance += Math.sqrt(dx * dx + dz * dz);\n                \n                // --- GRAVITY / SWIMMING PHYSICS ---\n                if (swimming) {\n                    // SWIMMING MODE: Buoyancy and fluid drag\n                    const buoyancy = inLava ? 0.008 : 0.012;  // Lava is denser, less buoyancy\n                    const swimDrag = inLava ? 0.92 : 0.95;    // More drag in lava\n                    \n                    // Natural buoyancy pushes player up\n                    this.velocity.y += buoyancy;\n                    \n                    // SPACE = swim up\n                    if (this.keys[' ']) {\n                        const swimUpSpeed = inLava ? 0.04 : 0.06;\n                        this.velocity.y += swimUpSpeed;\n                    }\n                    \n                    // SHIFT = swim down\n                    if (this.keys['shift']) {\n                        const swimDownSpeed = inLava ? 0.03 : 0.04;\n                        this.velocity.y -= swimDownSpeed;\n                    }\n                    \n                    // Clamp swim velocity\n                    const maxSwimSpeed = inLava ? 0.12 : 0.15;\n                    this.velocity.y = Math.max(-maxSwimSpeed, Math.min(maxSwimSpeed, this.velocity.y));\n                    \n                    // Apply drag (velocity decays over time in fluid)\n                    this.velocity.y *= swimDrag;\n                    \n                    // Surface boost - when at surface and pressing space, jump out\n                    if (!submerged && this.keys[' '] && this.velocity.y < 0.15) {\n                        this.velocity.y = 0.2;\n                    }\n                } else {\n                    // NORMAL MODE: Standard gravity\n                    this.velocity.y += this.gravity;\n                }\n                \n                const newY = this.camera.y + this.velocity.y;\n                \n                // Ground collision - camera is at hip/waist level (playerEyeHeight above ground)\n                const groundY = this.getGroundHeightBelow(this.camera.x, this.camera.z, this.camera.y) + this.playerEyeHeight + 0.5;\n                if (newY < groundY) {\n                    this.camera.y = groundY;\n                    this.velocity.y = 0;\n                    this.isJumping = false;\n                    \n                    // Continuous jumping - if space is held and on ground, jump immediately\n                    if (this.keys[' '] && !swimming) {\n                        this.velocity.y = 0.28;\n                        this.isJumping = true;\n                        this.stats.jumps++;\n                    }\n                } else {\n                    this.camera.y = newY;\n                }\n                \n                // Ceiling collision\n                const ceilingY = this.getCeilingAbove(this.camera.x, this.camera.z, this.camera.y);\n                if (ceilingY !== null && this.camera.y > ceilingY - 0.5) {\n                    this.camera.y = ceilingY - 0.5;\n                    this.velocity.y = 0;\n                }\n                \n                // World boundary forcefield - keep player inside\n                if (this.worldBounds) {\n                    const margin = 0.5;  // Keep player slightly inside boundary\n                    const bounce = 0.3;  // Bounce back force\n                    \n                    if (this.camera.x < this.worldBounds.minX + margin) {\n                        this.camera.x = this.worldBounds.minX + margin;\n                        this.velocity.x = Math.abs(this.velocity.x || 0) * bounce;\n                    }\n                    if (this.camera.x > this.worldBounds.maxX - margin) {\n                        this.camera.x = this.worldBounds.maxX - margin;\n                        this.velocity.x = -Math.abs(this.velocity.x || 0) * bounce;\n                    }\n                    if (this.camera.z < this.worldBounds.minZ + margin) {\n                        this.camera.z = this.worldBounds.minZ + margin;\n                        this.velocity.z = Math.abs(this.velocity.z || 0) * bounce;\n                    }\n                    if (this.camera.z > this.worldBounds.maxZ - margin) {\n                        this.camera.z = this.worldBounds.maxZ - margin;\n                        this.velocity.z = -Math.abs(this.velocity.z || 0) * bounce;\n                    }\n                    // Prevent falling below world\n                    if (this.camera.y < this.worldBounds.minY + this.playerEyeHeight) {\n                        this.camera.y = this.worldBounds.minY + this.playerEyeHeight;\n                        this.velocity.y = 0.15;  // Bounce up\n                    }\n                }\n                \n                // Trippy filter animation\n                if (this.settings.filter === 'trippy') {\n                    this.applyFilters();\n                }\n            },\n            \n            // Check if player would collide with blocks at position\n            collidesAt(x, y, z, radius, height) {\n                const feetY = y - this.playerEyeHeight; // Camera is at waist level\n                // Check corners and center at multiple heights\n                const checkPoints = [\n                    { x: x - radius, z: z - radius },\n                    { x: x + radius, z: z - radius },\n                    { x: x - radius, z: z + radius },\n                    { x: x + radius, z: z + radius },\n                    { x: x, z: z }\n                ];\n                \n                for (const point of checkPoints) {\n                    const bx = Math.floor(point.x);\n                    const bz = Math.floor(point.z);\n                    // Check at feet, middle, and head level\n                    for (let checkY = Math.floor(feetY); checkY < Math.floor(feetY + height); checkY++) {\n                        const block = this.getBlock(bx, checkY, bz);\n                        // Fluids don't block movement - player can walk/swim through them\n                        if (block && !this.fluidBlocks.includes(block)) {\n                            return true;\n                        }\n                    }\n                }\n                return false;\n            },\n            \n            // Get ground height directly below player (not teleporting to trees)\n            getGroundHeightBelow(x, z, currentY) {\n                const bx = Math.floor(x);\n                const bz = Math.floor(z);\n                const startY = Math.floor(currentY - this.playerEyeHeight); // Start from feet level\n                \n                for (let y = startY; y >= 0; y--) {\n                    const block = this.getBlock(bx, y, bz);\n                    // Fluids don't count as ground - player sinks through them\n                    if (block && !this.fluidBlocks.includes(block)) {\n                        return y + 1;\n                    }\n                }\n                return 0;\n            },\n            \n            // Get ceiling above player\n            getCeilingAbove(x, z, currentY) {\n                const bx = Math.floor(x);\n                const bz = Math.floor(z);\n                const headY = Math.floor(currentY);\n                \n                for (let y = headY; y <= headY + 3; y++) {\n                    const block = this.getBlock(bx, y, bz);\n                    // Fluids don't count as ceiling\n                    if (block && !this.fluidBlocks.includes(block)) {\n                        return y;\n                    }\n                }\n                return null;\n            },\n            \n            render() {\n                if (!this.isActive) return;\n                \n                const ctx = this.ctx;\n                const width = this.canvas.width;\n                const height = this.canvas.height;\n                \n                // Calculate eye height for sneaking\n                const renderCamY = this.camera.y + this.getEyeHeight();\n                \n                // Sky gradient (cached when dimensions match)\n                if (!this.cachedSky || this.cachedSky.w !== width || this.cachedSky.h !== height || this.cachedSky.lighting !== this.settings.lighting) {\n                    const skyGrad = ctx.createLinearGradient(0, 0, 0, height);\n                    if (this.settings.lighting) {\n                        skyGrad.addColorStop(0, '#1a0a1a');\n                        skyGrad.addColorStop(0.5, '#2d1f3d');\n                        skyGrad.addColorStop(1, '#ffb7c5');\n                    } else {\n                        skyGrad.addColorStop(0, '#111');\n                        skyGrad.addColorStop(1, '#333');\n                    }\n                    this.cachedSky = { grad: skyGrad, w: width, h: height, lighting: this.settings.lighting };\n                }\n                ctx.fillStyle = this.cachedSky.grad;\n                ctx.fillRect(0, 0, width, height);\n                \n                // Cache camera values for this frame\n                const camX = this.camera.x;\n                const camY = renderCamY; // Use adjusted height for sneaking\n                const camZ = this.camera.z;\n                const cosY = Math.cos(-this.camera.rotY);\n                const sinY = Math.sin(-this.camera.rotY);\n                const cosX = Math.cos(-this.camera.rotX);\n                const sinX = Math.sin(-this.camera.rotX);\n                const halfW = width / 2;\n                const halfH = height / 2;\n                const fov = 400;\n                const renderDist = this.settings.renderDistance;\n                const renderDistSq = renderDist * renderDist;\n                \n                // Inline project function for speed\n                const project = (x, y, z) => {\n                    const dx = x - camX;\n                    const dy = y - camY;\n                    const dz = z - camZ;\n                    const rx = dx * cosY - dz * sinY;\n                    const rz = dx * sinY + dz * cosY;\n                    const ry = dy * cosX - rz * sinX;\n                    const finalZ = dy * sinX + rz * cosX;\n                    if (finalZ <= 0.1) return null;\n                    return { x: halfW + (rx / finalZ) * fov, y: halfH - (ry / finalZ) * fov, z: finalZ };\n                };\n                \n                // Collect visible blocks with frustum culling\n                const blocks = [];\n                const camDirX = -Math.sin(this.camera.rotY);\n                const camDirZ = Math.cos(this.camera.rotY);\n                \n                // Performance: Cache world keys if not changed\n                const worldKeys = Object.keys(this.world);\n                \n                for (let i = 0; i < worldKeys.length; i++) {\n                    const key = worldKeys[i];\n                    const [x, y, z] = key.split(',').map(Number);\n                    const dx = x + 0.5 - camX;\n                    const dy = y + 0.5 - camY;\n                    const dz = z + 0.5 - camZ;\n                    const distSq = dx * dx + dy * dy + dz * dz;\n                    \n                    // Distance culling\n                    if (distSq > renderDistSq) continue;\n                    \n                    // Basic frustum culling - skip blocks behind camera\n                    const dot = dx * camDirX + dz * camDirZ;\n                    if (dot < -3 && distSq > 16) continue; // Behind camera and not too close\n                    \n                    blocks.push({ x, y, z, dist: distSq, type: this.world[key] });\n                }\n                \n                // Sort back-to-front (painter's algorithm)\n                blocks.sort((a, b) => b.dist - a.dist);\n                \n                // Render blocks with face culling\n                const getBlock = (x, y, z) => this.world[`${x},${y},${z}`];\n                const isTransparent = (block) => !block || this.fluidBlocks.includes(block);\n                const getFluidLevel = (x, y, z) => this.fluidLevels[`${x},${y},${z}`] || 8;\n                const animTime = Date.now() * 0.002; // Animation time for flowing effect\n                \n                // Separate opaque and transparent blocks for proper rendering\n                const opaqueBlocks = [];\n                const transparentBlocks = [];\n                \n                for (let i = 0; i < blocks.length; i++) {\n                    const block = blocks[i];\n                    const colors = this.blockColors[block.type];\n                    if (colors && colors.transparent) {\n                        transparentBlocks.push(block);\n                    } else {\n                        opaqueBlocks.push(block);\n                    }\n                }\n                \n                // PROPER RENDERING ORDER for painter's algorithm:\n                // 1. Sort transparent blocks back-to-front (furthest first)\n                // 2. Sort opaque blocks back-to-front (furthest first) \n                // 3. Draw transparent blocks first (they're behind)\n                // 4. Draw opaque blocks last (they overwrite and properly occlude)\n                \n                // ANGULAR OCCLUSION SYSTEM - check if block is visible from camera angle\n                // Uses corner visibility testing for proper edge handling\n                const isBlockOccluded = (x, y, z) => {\n                    // Test 8 corners of the block plus center\n                    const testPoints = [\n                        [x + 0.5, y + 0.5, z + 0.5], // center\n                        [x + 0.1, y + 0.1, z + 0.1], // corners with small inset\n                        [x + 0.9, y + 0.1, z + 0.1],\n                        [x + 0.1, y + 0.9, z + 0.1],\n                        [x + 0.9, y + 0.9, z + 0.1],\n                        [x + 0.1, y + 0.1, z + 0.9],\n                        [x + 0.9, y + 0.1, z + 0.9],\n                        [x + 0.1, y + 0.9, z + 0.9],\n                        [x + 0.9, y + 0.9, z + 0.9],\n                    ];\n                    \n                    // Block is visible if ANY corner/point is visible\n                    for (const [px, py, pz] of testPoints) {\n                        const dx = px - camX;\n                        const dy = py - camY;\n                        const dz = pz - camZ;\n                        const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                        \n                        let pointOccluded = false;\n                        // Ray march with finer steps near camera and target\n                        const steps = Math.min(8, Math.ceil(dist / 2));\n                        for (let i = 1; i < steps; i++) {\n                            const t = i / steps;\n                            const checkX = Math.floor(camX + dx * t);\n                            const checkY = Math.floor(camY + dy * t);\n                            const checkZ = Math.floor(camZ + dz * t);\n                            \n                            // Skip if we're checking the target block itself\n                            if (checkX === x && checkY === y && checkZ === z) continue;\n                            \n                            const checkBlock = getBlock(checkX, checkY, checkZ);\n                            // Solid non-fluid, non-transparent block occludes\n                            if (checkBlock && !this.fluidBlocks.includes(checkBlock)) {\n                                // Check if this block type has transparency property\n                                const blockColors = this.blockColors[checkBlock];\n                                if (!blockColors || !blockColors.transparent) {\n                                    pointOccluded = true;\n                                    break;\n                                }\n                            }\n                        }\n                        \n                        // If this point is visible, the block is visible\n                        if (!pointOccluded) return false;\n                    }\n                    \n                    // All points occluded = block is occluded\n                    return true;\n                };\n                \n                // Filter out occluded transparent blocks\n                const visibleTransparent = transparentBlocks.filter(b => !isBlockOccluded(b.x, b.y, b.z));\n                \n                // Sort each group - furthest (largest dist) first\n                visibleTransparent.sort((a, b) => b.dist - a.dist);\n                opaqueBlocks.sort((a, b) => b.dist - a.dist);\n                \n                // CORRECT ORDER: Draw opaque blocks FIRST, then transparent blocks\n                // This allows transparent blocks to see opaque blocks behind them\n                const allBlocks = [...opaqueBlocks, ...visibleTransparent];\n                \n                for (let i = 0; i < allBlocks.length; i++) {\n                    const block = allBlocks[i];\n                    const { x, y, z, type } = block;\n                    const colors = this.blockColors[type];\n                    if (!colors) continue;\n                    \n                    const isFluid = this.fluidBlocks.includes(type);\n                    const fluidLevel = isFluid ? getFluidLevel(x, y, z) : 8;\n                    // Fluids should fill their block space properly - topY calculation\n                    const topY = y + (fluidLevel / 8);\n                    \n                    // Check adjacent blocks\n                    const adjTop = getBlock(x, y + 1, z);\n                    const adjBottom = getBlock(x, y - 1, z);\n                    const adjFront = getBlock(x, y, z + 1);\n                    const adjBack = getBlock(x, y, z - 1);\n                    const adjLeft = getBlock(x - 1, y, z);\n                    const adjRight = getBlock(x + 1, y, z);\n                    \n                    let hasTop, hasBottom, hasFront, hasBack, hasLeft, hasRight;\n                    \n                    if (isFluid) {\n                        // For fluids, show top if not covered by same fluid above\n                        hasTop = !adjTop || adjTop !== type;\n                        hasBottom = !adjBottom || !this.fluidBlocks.includes(adjBottom);\n                        \n                        // For sides, show face if:\n                        // 1. No adjacent block, or\n                        // 2. Adjacent is different type (including different fluid), or  \n                        // 3. Adjacent is same fluid but at a LOWER level (we need to show our side above their top)\n                        const myLevel = fluidLevel;\n                        \n                        const frontLevel = adjFront === type ? getFluidLevel(x, y, z + 1) : 0;\n                        const backLevel = adjBack === type ? getFluidLevel(x, y, z - 1) : 0;\n                        const leftLevel = adjLeft === type ? getFluidLevel(x - 1, y, z) : 0;\n                        const rightLevel = adjRight === type ? getFluidLevel(x + 1, y, z) : 0;\n                        \n                        hasFront = !adjFront || (adjFront !== type) || (frontLevel < myLevel);\n                        hasBack = !adjBack || (adjBack !== type) || (backLevel < myLevel);\n                        hasLeft = !adjLeft || (adjLeft !== type) || (leftLevel < myLevel);\n                        hasRight = !adjRight || (adjRight !== type) || (rightLevel < myLevel);\n                    } else {\n                        // Solid blocks: show face if adjacent is empty OR is transparent (fluid)\n                        hasTop = isTransparent(adjTop);\n                        hasBottom = isTransparent(adjBottom);\n                        hasFront = isTransparent(adjFront);\n                        hasBack = isTransparent(adjBack);\n                        hasLeft = isTransparent(adjLeft);\n                        hasRight = isTransparent(adjRight);\n                    }\n                    \n                    // Skip fully hidden blocks\n                    if (!hasTop && !hasBottom && !hasFront && !hasBack && !hasLeft && !hasRight) continue;\n                    \n                    // Define visible faces\n                    const faces = [];\n                    \n                    // Front face (+Z)\n                    if (hasFront) {\n                        faces.push({ v: [[x, y, z+1], [x+1, y, z+1], [x+1, topY, z+1], [x, topY, z+1]], color: colors.side, dark: 1, isTop: false });\n                    }\n                    // Back face (-Z)\n                    if (hasBack) {\n                        faces.push({ v: [[x+1, y, z], [x, y, z], [x, topY, z], [x+1, topY, z]], color: colors.side, dark: 0.7, isTop: false });\n                    }\n                    // Top face (+Y)\n                    if (hasTop) {\n                        faces.push({ v: [[x, topY, z], [x+1, topY, z], [x+1, topY, z+1], [x, topY, z+1]], color: colors.top, dark: 1, isTop: true });\n                    }\n                    // Bottom face (-Y)\n                    if (hasBottom) {\n                        faces.push({ v: [[x, y, z+1], [x+1, y, z+1], [x+1, y, z], [x, y, z]], color: colors.bottom, dark: 0.7, isTop: false });\n                    }\n                    // Left face (-X)\n                    if (hasLeft) {\n                        faces.push({ v: [[x, y, z], [x, y, z+1], [x, topY, z+1], [x, topY, z]], color: colors.side, dark: 0.85, isTop: false });\n                    }\n                    // Right face (+X)\n                    if (hasRight) {\n                        faces.push({ v: [[x+1, y, z+1], [x+1, y, z], [x+1, topY, z], [x+1, topY, z+1]], color: colors.side, dark: 0.85, isTop: false });\n                    }\n                    \n                    // Render visible faces\n                    for (let f = 0; f < faces.length; f++) {\n                        const face = faces[f];\n                        const pts = [];\n                        let valid = true;\n                        \n                        for (let v = 0; v < 4; v++) {\n                            const p = project(face.v[v][0], face.v[v][1], face.v[v][2]);\n                            if (!p) { valid = false; break; }\n                            pts.push(p);\n                        }\n                        if (!valid || pts.length !== 4) continue;\n                        \n                        // Apply shadow and get base color\n                        let fillColor = face.color;\n                        if (this.settings.shadows && face.dark < 1) {\n                            fillColor = this.darkenColor(face.color, face.dark);\n                        }\n                        \n                        // Animated fluid rendering\n                        if (isFluid && colors.animated) {\n                            if (type === 'water') {\n                                // ADVANCED WATER RENDERING with Screen-Space Reflections\n                                // Implements simplified SSR, Fresnel, caustics, and player reflection\n                                \n                                const time = animTime;\n                                \n                                // Multi-octave Gerstner wave simulation\n                                const wave1 = Math.sin(time + x * 0.7 + z * 0.5) * 0.4;\n                                const wave2 = Math.sin(time * 0.8 - x * 0.3 + z * 0.7) * 0.3;\n                                const wave3 = Math.sin(time * 1.3 + x * 0.5 - z * 0.3) * 0.2;\n                                const combinedWave = (wave1 + wave2 + wave3) / 3 + 0.5;\n                                \n                                // Calculate view vector for Fresnel\n                                const dx = x + 0.5 - camX;\n                                const dy = y + 0.5 - camY;\n                                const dz = z + 0.5 - camZ;\n                                const dist = Math.sqrt(dx*dx + dy*dy + dz*dz);\n                                \n                                // Normal-based view angle\n                                const viewDotNormal = Math.abs(dy / (dist || 1));\n                                \n                                // Schlick's Fresnel approximation\n                                const F0 = 0.02; // Water's base reflectivity\n                                const fresnel = F0 + (1 - F0) * Math.pow(1 - viewDotNormal, 5);\n                                \n                                // SCREEN-SPACE REFLECTION approximation\n                                // Check if player would be reflected in this water block\n                                let playerReflection = 0;\n                                const playerDx = this.camera.x - (x + 0.5);\n                                const playerDz = this.camera.z - (z + 0.5);\n                                const playerDistToWater = Math.sqrt(playerDx * playerDx + playerDz * playerDz);\n                                \n                                // Player is reflected if close to water and water is below player\n                                if (playerDistToWater < 5 && this.camera.y > y + 1) {\n                                    // Reflection strength based on distance and angle\n                                    const reflectStrengthDist = 1 - (playerDistToWater / 5);\n                                    playerReflection = reflectStrengthDist * fresnel * 0.3;\n                                }\n                                \n                                // Environment reflection sampling\n                                const skyColors = [\n                                    { r: 255, g: 183, b: 197 }, // Sunset pink\n                                    { r: 255, g: 218, b: 185 }, // Peach\n                                    { r: 135, g: 206, b: 235 }  // Sky blue\n                                ];\n                                const skyIndex = Math.min(2, Math.floor((1 - viewDotNormal) * 3));\n                                const sky = skyColors[skyIndex];\n                                \n                                // Base water color with depth absorption\n                                const depthFactor = Math.min(1, dist / 20);\n                                const waterR = 30 + depthFactor * 15;\n                                const waterG = 80 + depthFactor * 20;\n                                const waterB = 160 - depthFactor * 30;\n                                \n                                // Player color for reflection (brown shirt tone)\n                                const playerColor = { r: 100, g: 60, b: 40 };\n                                \n                                // Blend reflection and refraction based on Fresnel\n                                const reflectStrength = Math.min(0.7, fresnel * 1.5);\n                                let r = Math.floor(waterR * (1 - reflectStrength) + sky.r * reflectStrength);\n                                let g = Math.floor(waterG * (1 - reflectStrength) + sky.g * reflectStrength);\n                                let b = Math.floor(waterB * (1 - reflectStrength) + sky.b * reflectStrength);\n                                \n                                // Add player reflection tint\n                                if (playerReflection > 0) {\n                                    r = Math.floor(r * (1 - playerReflection) + playerColor.r * playerReflection);\n                                    g = Math.floor(g * (1 - playerReflection) + playerColor.g * playerReflection);\n                                    b = Math.floor(b * (1 - playerReflection) + playerColor.b * playerReflection);\n                                }\n                                \n                                // Specular highlights (Blinn-Phong)\n                                const sunDir = { x: 0.5, y: 0.8, z: 0.3 };\n                                const viewDir = { x: dx/dist, y: dy/dist, z: dz/dist };\n                                const halfVec = {\n                                    x: sunDir.x + viewDir.x,\n                                    y: sunDir.y + viewDir.y,\n                                    z: sunDir.z + viewDir.z\n                                };\n                                const halfLen = Math.sqrt(halfVec.x*halfVec.x + halfVec.y*halfVec.y + halfVec.z*halfVec.z);\n                                const specularBase = Math.max(0, halfVec.y / halfLen);\n                                const specular = Math.pow(specularBase, 32) * combinedWave * 0.6;\n                                \n                                // Caustics effect\n                                const caustic1 = Math.sin(time * 2 + x * 1.5) * Math.cos(time * 1.5 + z * 1.5);\n                                const caustic2 = Math.sin(time * 1.7 - x * 1.2 + z * 0.8);\n                                const caustics = (caustic1 * caustic2 + 1) * 0.1;\n                                \n                                // Final color with all effects\n                                const brightness = 0.85 + combinedWave * 0.15 + specular + caustics;\n                                const finalR = Math.min(255, Math.floor(r * brightness + specular * 200));\n                                const finalG = Math.min(255, Math.floor(g * brightness + specular * 180));\n                                const finalB = Math.min(255, Math.floor(b * brightness + specular * 150));\n                                \n                                // Dynamic transparency\n                                const baseAlpha = 0.55;\n                                const fresnelAlpha = fresnel * 0.35;\n                                const alpha = Math.min(0.9, baseAlpha + fresnelAlpha);\n                                \n                                fillColor = `rgba(${finalR}, ${finalG}, ${finalB}, ${alpha})`;\n                                \n                            } else if (type === 'lava') {\n                                // Animated lava with glowing/pulsing effect\n                                const glowPhase = animTime * 1.5 + x * 0.3 + z * 0.3;\n                                const glow = 0.8 + Math.sin(glowPhase) * 0.2;\n                                const r = Math.floor(255 * glow);\n                                const g = Math.floor((80 + Math.sin(glowPhase * 2) * 30) * glow);\n                                const b = Math.floor(30 * (1 - glow * 0.5));\n                                fillColor = `rgb(${Math.min(255, r)}, ${Math.min(255, g)}, ${b})`;\n                            }\n                        }\n                        \n                        ctx.fillStyle = fillColor;\n                        ctx.beginPath();\n                        ctx.moveTo(pts[0].x, pts[0].y);\n                        ctx.lineTo(pts[1].x, pts[1].y);\n                        ctx.lineTo(pts[2].x, pts[2].y);\n                        ctx.lineTo(pts[3].x, pts[3].y);\n                        ctx.closePath();\n                        ctx.fill();\n                        \n                        // Add subtle edge lines for better depth perception (not for fluids)\n                        if (!isFluid) {\n                            ctx.strokeStyle = this.darkenColor(fillColor, 0.7);\n                            ctx.lineWidth = 0.5;\n                            ctx.stroke();\n                        }\n                    }\n                }\n                \n                // Render world boundary forcefield\n                if (this.worldBounds) {\n                    const bounds = this.worldBounds;\n                    const time = Date.now() * 0.003;\n                    \n                    // Only render forcefield walls that are visible (within render distance)\n                    const wallSegments = [];\n                    const segmentSize = 5;  // Size of each forcefield segment\n                    \n                    // Check each boundary wall\n                    const walls = [\n                        { axis: 'x', value: bounds.minX, dir: 1 },   // West wall\n                        { axis: 'x', value: bounds.maxX, dir: -1 },  // East wall\n                        { axis: 'z', value: bounds.minZ, dir: 1 },   // North wall\n                        { axis: 'z', value: bounds.maxZ, dir: -1 }   // South wall\n                    ];\n                    \n                    for (const wall of walls) {\n                        // Check if wall is within render distance\n                        let distToWall;\n                        if (wall.axis === 'x') {\n                            distToWall = Math.abs(camX - wall.value);\n                        } else {\n                            distToWall = Math.abs(camZ - wall.value);\n                        }\n                        \n                        if (distToWall > renderDist * 1.5) continue;  // Skip walls too far away\n                        \n                        // Generate forcefield segments for this wall - skip segments way below player\n                        const minRenderY = Math.max(bounds.minY, camY - 10); // Don't render too far below player\n                        for (let y = minRenderY; y < bounds.maxY; y += segmentSize) {\n                            const perpStart = wall.axis === 'x' ? bounds.minZ : bounds.minX;\n                            const perpEnd = wall.axis === 'x' ? bounds.maxZ : bounds.maxX;\n                            \n                            for (let p = perpStart; p < perpEnd; p += segmentSize) {\n                                // Check if segment is within render distance\n                                let segX, segZ;\n                                if (wall.axis === 'x') {\n                                    segX = wall.value;\n                                    segZ = p + segmentSize / 2;\n                                } else {\n                                    segX = p + segmentSize / 2;\n                                    segZ = wall.value;\n                                }\n                                \n                                const segDist = Math.sqrt((segX - camX) ** 2 + (segZ - camZ) ** 2);\n                                if (segDist > renderDist) continue;\n                                \n                                // Define quad corners\n                                let corners;\n                                const yTop = Math.min(y + segmentSize, bounds.maxY);\n                                const pEnd = Math.min(p + segmentSize, perpEnd);\n                                \n                                if (wall.axis === 'x') {\n                                    corners = [\n                                        [wall.value, y, p],\n                                        [wall.value, y, pEnd],\n                                        [wall.value, yTop, pEnd],\n                                        [wall.value, yTop, p]\n                                    ];\n                                } else {\n                                    corners = [\n                                        [p, y, wall.value],\n                                        [pEnd, y, wall.value],\n                                        [pEnd, yTop, wall.value],\n                                        [p, yTop, wall.value]\n                                    ];\n                                }\n                                \n                                // Project corners\n                                const pts = [];\n                                let valid = true;\n                                for (const c of corners) {\n                                    const pt = project(c[0], c[1], c[2]);\n                                    if (!pt) { valid = false; break; }\n                                    pts.push(pt);\n                                }\n                                if (!valid || pts.length < 4) continue;\n                                \n                                // Calculate animated glow intensity\n                                const gridPhase = ((p + y) * 0.2 + time) % (Math.PI * 2);\n                                const alpha = 0.15 + 0.1 * Math.sin(gridPhase);\n                                \n                                // Draw forcefield panel with cyan/magenta energy effect\n                                const hue = (time * 30 + p + y) % 360;\n                                ctx.fillStyle = `hsla(${180 + Math.sin(time + p * 0.1) * 20}, 100%, 60%, ${alpha})`;\n                                ctx.beginPath();\n                                ctx.moveTo(pts[0].x, pts[0].y);\n                                ctx.lineTo(pts[1].x, pts[1].y);\n                                ctx.lineTo(pts[2].x, pts[2].y);\n                                ctx.lineTo(pts[3].x, pts[3].y);\n                                ctx.closePath();\n                                ctx.fill();\n                                \n                                // Draw grid lines\n                                ctx.strokeStyle = `hsla(180, 100%, 70%, ${alpha * 2})`;\n                                ctx.lineWidth = 1;\n                                ctx.stroke();\n                            }\n                        }\n                    }\n                    \n                    // Bottom forcefield (floor at minY) - only if player can see it\n                    const bottomY = bounds.minY;\n                    const canSeeFloor = camY > bottomY + 3; // Player must be above floor to see it\n                    \n                    if (canSeeFloor) {\n                        for (let x = bounds.minX; x < bounds.maxX; x += segmentSize) {\n                        for (let z = bounds.minZ; z < bounds.maxZ; z += segmentSize) {\n                            const segDist = Math.sqrt((x + segmentSize/2 - camX) ** 2 + (z + segmentSize/2 - camZ) ** 2);\n                            if (segDist > renderDist) continue;\n                            \n                            const xEnd = Math.min(x + segmentSize, bounds.maxX);\n                            const zEnd = Math.min(z + segmentSize, bounds.maxZ);\n                            \n                            const corners = [\n                                [x, bottomY, z],\n                                [xEnd, bottomY, z],\n                                [xEnd, bottomY, zEnd],\n                                [x, bottomY, zEnd]\n                            ];\n                            \n                            const pts = [];\n                            let valid = true;\n                            for (const c of corners) {\n                                const pt = project(c[0], c[1], c[2]);\n                                if (!pt) { valid = false; break; }\n                                pts.push(pt);\n                            }\n                            if (!valid || pts.length < 4) continue;\n                            \n                            const gridPhase = ((x + z) * 0.2 + time) % (Math.PI * 2);\n                            const alpha = 0.1 + 0.08 * Math.sin(gridPhase);\n                            \n                            ctx.fillStyle = `hsla(${280 + Math.sin(time + x * 0.1) * 20}, 100%, 50%, ${alpha})`;\n                            ctx.beginPath();\n                            ctx.moveTo(pts[0].x, pts[0].y);\n                            ctx.lineTo(pts[1].x, pts[1].y);\n                            ctx.lineTo(pts[2].x, pts[2].y);\n                            ctx.lineTo(pts[3].x, pts[3].y);\n                            ctx.closePath();\n                            ctx.fill();\n                            \n                            ctx.strokeStyle = `hsla(280, 100%, 60%, ${alpha * 2})`;\n                            ctx.lineWidth = 1;\n                            ctx.stroke();\n                        }\n                    }\n                    } // End canSeeFloor check\n                }\n                \n                // Render birds\n                for (const bird of this.birds) {\n                    // Check if bird is in front of camera\n                    const dx = bird.x - camX;\n                    const dy = bird.y - camY;\n                    const dz = bird.z - camZ;\n                    const dot = dx * camDirX + dz * camDirZ;\n                    if (dot < 0) continue; // Behind camera\n                    \n                    const distSq = dx * dx + dy * dy + dz * dz;\n                    if (distSq > renderDistSq) continue; // Too far\n                    \n                    // Project bird center\n                    const center = project(bird.x, bird.y, bird.z);\n                    if (!center) continue;\n                    \n                    // Calculate screen size based on distance\n                    const screenSize = (bird.size * fov) / center.z;\n                    if (screenSize < 2) continue; // Too small to render\n                    \n                    // Wing flap animation\n                    const wingAngle = Math.sin(bird.wingPhase) * 0.5;\n                    \n                    // Bird facing direction (tangent to circular path)\n                    const facingAngle = bird.angle + Math.PI / 2;\n                    \n                    // Draw bird body (dark pink/magenta for sakura theme)\n                    ctx.fillStyle = '#d85a8a';\n                    ctx.beginPath();\n                    ctx.ellipse(center.x, center.y, screenSize * 0.8, screenSize * 0.4, 0, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Draw wings\n                    ctx.fillStyle = '#ff9ec4';\n                    const wingSpan = screenSize * 1.5;\n                    const wingHeight = screenSize * 0.6 * (1 + wingAngle);\n                    \n                    // Left wing\n                    ctx.beginPath();\n                    ctx.moveTo(center.x, center.y);\n                    ctx.quadraticCurveTo(\n                        center.x - wingSpan * 0.5, center.y - wingHeight,\n                        center.x - wingSpan, center.y + screenSize * 0.2\n                    );\n                    ctx.quadraticCurveTo(\n                        center.x - wingSpan * 0.5, center.y + screenSize * 0.1,\n                        center.x, center.y\n                    );\n                    ctx.fill();\n                    \n                    // Right wing\n                    ctx.beginPath();\n                    ctx.moveTo(center.x, center.y);\n                    ctx.quadraticCurveTo(\n                        center.x + wingSpan * 0.5, center.y - wingHeight,\n                        center.x + wingSpan, center.y + screenSize * 0.2\n                    );\n                    ctx.quadraticCurveTo(\n                        center.x + wingSpan * 0.5, center.y + screenSize * 0.1,\n                        center.x, center.y\n                    );\n                    ctx.fill();\n                    \n                    // Draw head\n                    ctx.fillStyle = '#d85a8a';\n                    ctx.beginPath();\n                    ctx.arc(center.x + screenSize * 0.6, center.y - screenSize * 0.1, screenSize * 0.3, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Beak\n                    ctx.fillStyle = '#ffaa00';\n                    ctx.beginPath();\n                    ctx.moveTo(center.x + screenSize * 0.9, center.y - screenSize * 0.1);\n                    ctx.lineTo(center.x + screenSize * 1.2, center.y);\n                    ctx.lineTo(center.x + screenSize * 0.9, center.y + screenSize * 0.1);\n                    ctx.fill();\n                }\n                \n                // Render pest birds (smaller, always close to player)\n                for (const pest of this.pestBirds) {\n                    // Project pest bird\n                    const center = project(pest.x, pest.y, pest.z);\n                    if (!center) continue;\n                    \n                    // Calculate screen size (these are smaller)\n                    const screenSize = (pest.size * fov) / center.z;\n                    if (screenSize < 1) continue;\n                    \n                    // Frantic wing flap - faster when angry\n                    const wingAngle = Math.sin(pest.wingPhase) * 0.7;\n                    \n                    // Body color - gets redder with anger (0-5 anger levels)\n                    const anger = pest.anger || 0;\n                    const angerRed = Math.min(255, 107 + anger * 30); // 107 to 255\n                    const angerGreen = Math.max(0, 68 - anger * 10);   // 68 to 18\n                    const angerBlue = Math.max(0, 35 - anger * 7);     // 35 to 0\n                    \n                    const isSwooping = pest.state === 'swooping';\n                    const bodyColor = anger > 0 \n                        ? `rgb(${angerRed}, ${angerGreen}, ${angerBlue})`\n                        : (isSwooping ? '#8b4513' : '#6b4423');\n                    const wingColor = anger > 0\n                        ? `rgb(${Math.min(255, angerRed + 30)}, ${angerGreen + 20}, ${angerBlue + 10})`\n                        : (isSwooping ? '#a0522d' : '#8b7355');\n                    \n                    // Draw body (smaller, rounder - like a sparrow)\n                    ctx.fillStyle = bodyColor;\n                    ctx.beginPath();\n                    ctx.ellipse(center.x, center.y, screenSize * 0.6, screenSize * 0.5, 0, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Angry glow effect for high anger birds\n                    if (anger >= 3) {\n                        ctx.shadowColor = '#ff0000';\n                        ctx.shadowBlur = anger * 3;\n                    }\n                    \n                    // Draw frantic wings\n                    ctx.fillStyle = wingColor;\n                    const wingSpan = screenSize * 1.2;\n                    const wingHeight = screenSize * 0.8 * (1 + wingAngle);\n                    \n                    // Left wing\n                    ctx.beginPath();\n                    ctx.moveTo(center.x, center.y);\n                    ctx.quadraticCurveTo(\n                        center.x - wingSpan * 0.4, center.y - wingHeight,\n                        center.x - wingSpan, center.y\n                    );\n                    ctx.quadraticCurveTo(\n                        center.x - wingSpan * 0.4, center.y + screenSize * 0.2,\n                        center.x, center.y\n                    );\n                    ctx.fill();\n                    \n                    // Right wing\n                    ctx.beginPath();\n                    ctx.moveTo(center.x, center.y);\n                    ctx.quadraticCurveTo(\n                        center.x + wingSpan * 0.4, center.y - wingHeight,\n                        center.x + wingSpan, center.y\n                    );\n                    ctx.quadraticCurveTo(\n                        center.x + wingSpan * 0.4, center.y + screenSize * 0.2,\n                        center.x, center.y\n                    );\n                    ctx.fill();\n                    \n                    // Head\n                    ctx.fillStyle = bodyColor;\n                    ctx.beginPath();\n                    ctx.arc(center.x + screenSize * 0.4, center.y - screenSize * 0.15, screenSize * 0.25, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Beady eye\n                    ctx.fillStyle = '#000';\n                    ctx.beginPath();\n                    ctx.arc(center.x + screenSize * 0.45, center.y - screenSize * 0.2, screenSize * 0.08, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Small pointy beak\n                    ctx.fillStyle = '#ff6600';\n                    ctx.beginPath();\n                    ctx.moveTo(center.x + screenSize * 0.6, center.y - screenSize * 0.15);\n                    ctx.lineTo(center.x + screenSize * 0.85, center.y - screenSize * 0.1);\n                    ctx.lineTo(center.x + screenSize * 0.6, center.y - screenSize * 0.05);\n                    ctx.fill();\n                    \n                    // Tail feathers\n                    ctx.fillStyle = wingColor;\n                    ctx.beginPath();\n                    ctx.moveTo(center.x - screenSize * 0.4, center.y);\n                    ctx.lineTo(center.x - screenSize * 0.9, center.y - screenSize * 0.1);\n                    ctx.lineTo(center.x - screenSize * 0.95, center.y + screenSize * 0.05);\n                    ctx.lineTo(center.x - screenSize * 0.85, center.y + screenSize * 0.15);\n                    ctx.lineTo(center.x - screenSize * 0.4, center.y + screenSize * 0.1);\n                    ctx.fill();\n                    \n                    // Reset shadow\n                    ctx.shadowBlur = 0;\n                    ctx.shadowColor = 'transparent';\n                }\n                \n                // Render blue birds\n                if (this.blueBirds) {\n                    for (const bird of this.blueBirds) {\n                        const center = project(bird.x, bird.y, bird.z);\n                        if (!center) continue;\n                        \n                        const screenSize = Math.max(8, 25 / center.z);\n                        const wingAngle = Math.sin(bird.wingPhase) * 0.6;\n                        const wingHeight = screenSize * 0.5 * (1 + wingAngle);\n                        \n                        // Blue body\n                        ctx.fillStyle = '#1e90ff';\n                        ctx.beginPath();\n                        ctx.ellipse(center.x, center.y, screenSize * 0.5, screenSize * 0.3, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Wings\n                        ctx.fillStyle = '#00bfff';\n                        const wingSpan = screenSize * 1.2;\n                        ctx.beginPath();\n                        ctx.moveTo(center.x, center.y);\n                        ctx.quadraticCurveTo(center.x - wingSpan * 0.5, center.y - wingHeight, center.x - wingSpan, center.y);\n                        ctx.quadraticCurveTo(center.x - wingSpan * 0.5, center.y + screenSize * 0.2, center.x, center.y);\n                        ctx.fill();\n                        ctx.beginPath();\n                        ctx.moveTo(center.x, center.y);\n                        ctx.quadraticCurveTo(center.x + wingSpan * 0.5, center.y - wingHeight, center.x + wingSpan, center.y);\n                        ctx.quadraticCurveTo(center.x + wingSpan * 0.5, center.y + screenSize * 0.2, center.x, center.y);\n                        ctx.fill();\n                        \n                        // Angry eye\n                        ctx.fillStyle = '#ff0000';\n                        ctx.beginPath();\n                        ctx.arc(center.x + screenSize * 0.3, center.y - screenSize * 0.1, screenSize * 0.15, 0, Math.PI * 2);\n                        ctx.fill();\n                    }\n                }\n                \n                // Render fish\n                if (this.fish) {\n                    for (const fish of this.fish) {\n                        const center = project(fish.x, fish.y, fish.z);\n                        if (!center) continue;\n                        \n                        const screenSize = Math.max(4, fish.size * 30 / center.z);\n                        const swimOffset = Math.sin(fish.swimPhase) * 0.2;\n                        \n                        ctx.save();\n                        ctx.translate(center.x, center.y);\n                        ctx.rotate(Math.atan2(fish.vz, fish.vx) + swimOffset);\n                        \n                        // Body\n                        ctx.fillStyle = fish.color;\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, screenSize, screenSize * 0.4, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Tail\n                        ctx.beginPath();\n                        ctx.moveTo(-screenSize * 0.8, 0);\n                        ctx.lineTo(-screenSize * 1.5, -screenSize * 0.4);\n                        ctx.lineTo(-screenSize * 1.5, screenSize * 0.4);\n                        ctx.closePath();\n                        ctx.fill();\n                        \n                        // Eye\n                        ctx.fillStyle = '#000';\n                        ctx.beginPath();\n                        ctx.arc(screenSize * 0.5, -screenSize * 0.1, screenSize * 0.15, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        ctx.restore();\n                    }\n                }\n                \n                // Render cats\n                if (this.cats) {\n                    for (const cat of this.cats) {\n                        const center = project(cat.x, cat.y + 0.3, cat.z);\n                        if (!center) continue;\n                        \n                        const screenSize = Math.max(10, 40 / center.z);\n                        const walkBob = Math.sin(cat.walkPhase) * screenSize * 0.05;\n                        \n                        // Body\n                        ctx.fillStyle = cat.color;\n                        ctx.beginPath();\n                        ctx.ellipse(center.x, center.y + walkBob, screenSize * 0.6, screenSize * 0.4, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Head\n                        ctx.beginPath();\n                        ctx.arc(center.x + screenSize * 0.5, center.y - screenSize * 0.2 + walkBob, screenSize * 0.35, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Ears\n                        ctx.beginPath();\n                        ctx.moveTo(center.x + screenSize * 0.3, center.y - screenSize * 0.5 + walkBob);\n                        ctx.lineTo(center.x + screenSize * 0.4, center.y - screenSize * 0.2 + walkBob);\n                        ctx.lineTo(center.x + screenSize * 0.5, center.y - screenSize * 0.5 + walkBob);\n                        ctx.fill();\n                        ctx.beginPath();\n                        ctx.moveTo(center.x + screenSize * 0.6, center.y - screenSize * 0.5 + walkBob);\n                        ctx.lineTo(center.x + screenSize * 0.7, center.y - screenSize * 0.2 + walkBob);\n                        ctx.lineTo(center.x + screenSize * 0.5, center.y - screenSize * 0.5 + walkBob);\n                        ctx.fill();\n                        \n                        // Eyes\n                        ctx.fillStyle = '#00ff00';\n                        ctx.beginPath();\n                        ctx.ellipse(center.x + screenSize * 0.4, center.y - screenSize * 0.25 + walkBob, screenSize * 0.08, screenSize * 0.12, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.beginPath();\n                        ctx.ellipse(center.x + screenSize * 0.6, center.y - screenSize * 0.25 + walkBob, screenSize * 0.08, screenSize * 0.12, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Tail\n                        ctx.strokeStyle = cat.color;\n                        ctx.lineWidth = screenSize * 0.1;\n                        ctx.lineCap = 'round';\n                        ctx.beginPath();\n                        ctx.moveTo(center.x - screenSize * 0.5, center.y + walkBob);\n                        ctx.quadraticCurveTo(center.x - screenSize * 0.8, center.y - screenSize * 0.3, center.x - screenSize * 0.7, center.y - screenSize * 0.5);\n                        ctx.stroke();\n                    }\n                }\n                \n                // Render creepers\n                if (this.creepers) {\n                    for (const creeper of this.creepers) {\n                        const center = project(creeper.x, creeper.y + 0.8, creeper.z);\n                        if (!center) continue;\n                        \n                        const screenSize = Math.max(15, 50 / center.z);\n                        \n                        // Flash white when fusing\n                        const bodyColor = (creeper.state === 'fusing' && creeper.flashing) ? '#ffffff' : '#00aa00';\n                        \n                        // Body (tall rectangle)\n                        ctx.fillStyle = bodyColor;\n                        ctx.fillRect(center.x - screenSize * 0.3, center.y - screenSize * 0.5, screenSize * 0.6, screenSize);\n                        \n                        // Head\n                        ctx.fillRect(center.x - screenSize * 0.35, center.y - screenSize * 0.9, screenSize * 0.7, screenSize * 0.5);\n                        \n                        // Face (creepy)\n                        ctx.fillStyle = '#000';\n                        // Eyes\n                        ctx.fillRect(center.x - screenSize * 0.25, center.y - screenSize * 0.8, screenSize * 0.15, screenSize * 0.15);\n                        ctx.fillRect(center.x + screenSize * 0.1, center.y - screenSize * 0.8, screenSize * 0.15, screenSize * 0.15);\n                        // Mouth (frown)\n                        ctx.fillRect(center.x - screenSize * 0.2, center.y - screenSize * 0.55, screenSize * 0.1, screenSize * 0.15);\n                        ctx.fillRect(center.x + screenSize * 0.1, center.y - screenSize * 0.55, screenSize * 0.1, screenSize * 0.15);\n                        ctx.fillRect(center.x - screenSize * 0.1, center.y - screenSize * 0.5, screenSize * 0.2, screenSize * 0.1);\n                        \n                        // Legs\n                        ctx.fillStyle = bodyColor;\n                        ctx.fillRect(center.x - screenSize * 0.3, center.y + screenSize * 0.4, screenSize * 0.2, screenSize * 0.3);\n                        ctx.fillRect(center.x + screenSize * 0.1, center.y + screenSize * 0.4, screenSize * 0.2, screenSize * 0.3);\n                    }\n                }\n                \n                // Render particles (only those in front of visible blocks)\n                for (const p of this.particles) {\n                    const center = project(p.x, p.y, p.z);\n                    if (!center) continue;\n                    \n                    // Check if particle is behind a block using simple raycast\n                    // Only check bullets since they're the main issue\n                    if (p.type === 'bullet') {\n                        const dx = p.x - this.camera.x;\n                        const dy = p.y - this.camera.y;\n                        const dz = p.z - this.camera.z;\n                        const dist = Math.sqrt(dx*dx + dy*dy + dz*dz);\n                        \n                        // Simple occlusion check - sample a few points between camera and bullet\n                        let occluded = false;\n                        for (let t = 0.3; t < 0.95; t += 0.2) {\n                            const checkX = this.camera.x + dx * t;\n                            const checkY = this.camera.y + dy * t;\n                            const checkZ = this.camera.z + dz * t;\n                            const block = this.getBlock(Math.floor(checkX), Math.floor(checkY), Math.floor(checkZ));\n                            if (block && !this.fluidBlocks.includes(block)) {\n                                occluded = true;\n                                break;\n                            }\n                        }\n                        if (occluded) continue;\n                        \n                        // Bullet trail\n                        if (p.trail.length > 1) {\n                            ctx.strokeStyle = 'rgba(255, 200, 50, 0.8)';\n                            ctx.lineWidth = 2;\n                            ctx.beginPath();\n                            let started = false;\n                            for (let i = 0; i < p.trail.length; i++) {\n                                const tp = project(p.trail[i].x, p.trail[i].y, p.trail[i].z);\n                                if (tp) {\n                                    if (!started) {\n                                        ctx.moveTo(tp.x, tp.y);\n                                        started = true;\n                                    } else {\n                                        ctx.lineTo(tp.x, tp.y);\n                                    }\n                                }\n                            }\n                            if (started) {\n                                ctx.lineTo(center.x, center.y);\n                                ctx.stroke();\n                            }\n                        }\n                        \n                        // Bullet head\n                        const bulletSize = Math.max(2, 8 / center.z);\n                        ctx.fillStyle = '#ffcc00';\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, bulletSize, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (p.type === 'ricochet' || p.type === 'spark') {\n                        const size = Math.max(1, (p.size || 3) * 20 / center.z);\n                        const alpha = Math.min(1, p.life / 15);\n                        ctx.fillStyle = `rgba(255, ${150 + Math.random() * 100}, 50, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (p.type === 'blessing') {\n                        // Divine blessing particles - golden with sparkle\n                        const size = Math.max(2, (p.size || 4) * 20 / center.z);\n                        const alpha = Math.min(1, p.life / 30);\n                        const sparkle = Math.sin(p.life * 0.3) * 0.5 + 0.5;\n                        \n                        // Outer glow\n                        ctx.fillStyle = `rgba(255, 215, 0, ${alpha * 0.3})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size * 2, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Inner core\n                        ctx.fillStyle = `rgba(255, ${200 + sparkle * 55}, ${100 + sparkle * 155}, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Central bright spot\n                        ctx.fillStyle = `rgba(255, 255, 255, ${alpha * sparkle})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size * 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (p.type === 'explosion') {\n                        // Creeper explosion particles - fiery orange/yellow\n                        const size = Math.max(3, (p.size || 5) * 25 / center.z);\n                        const alpha = Math.min(1, p.life / 20);\n                        const flicker = Math.random() * 0.3 + 0.7;\n                        \n                        // Outer fire glow\n                        ctx.fillStyle = `rgba(255, 100, 0, ${alpha * 0.4})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size * 1.5, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Inner fire core\n                        ctx.fillStyle = `rgba(255, ${150 + Math.random() * 100}, 0, ${alpha * flicker})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Hot center\n                        ctx.fillStyle = `rgba(255, 255, ${Math.random() * 100}, ${alpha * 0.8})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size * 0.4, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (p.type === 'feather') {\n                        const size = Math.max(2, 15 / center.z);\n                        const alpha = Math.min(1, p.life / 20);\n                        ctx.save();\n                        ctx.translate(center.x, center.y);\n                        ctx.rotate(p.rotation);\n                        ctx.fillStyle = `rgba(139, 90, 43, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size * 2, size * 0.5, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Feather spine\n                        ctx.strokeStyle = `rgba(100, 60, 30, ${alpha})`;\n                        ctx.lineWidth = 1;\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 2, 0);\n                        ctx.lineTo(size * 2, 0);\n                        ctx.stroke();\n                        ctx.restore();\n                    } else if (p.type === 'petal') {\n                        // Cherry blossom petal - pink and flutter\n                        // Check occlusion - don't render petals behind walls\n                        const dx = p.x - this.camera.x;\n                        const dy = p.y - this.camera.y;\n                        const dz = p.z - this.camera.z;\n                        let occluded = false;\n                        for (let t = 0.2; t < 0.9; t += 0.25) {\n                            const checkX = this.camera.x + dx * t;\n                            const checkY = this.camera.y + dy * t;\n                            const checkZ = this.camera.z + dz * t;\n                            const block = this.getBlock(Math.floor(checkX), Math.floor(checkY), Math.floor(checkZ));\n                            if (block && !this.fluidBlocks.includes(block)) {\n                                occluded = true;\n                                break;\n                            }\n                        }\n                        if (occluded) continue;\n                        \n                        const size = Math.max(2, (p.size || 4) * 15 / center.z);\n                        const alpha = Math.min(1, p.life / 50);\n                        ctx.save();\n                        ctx.translate(center.x, center.y);\n                        ctx.rotate(p.rotation);\n                        // Petal shape\n                        ctx.fillStyle = `rgba(255, 183, 197, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size * 1.5, size * 0.7, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Darker center\n                        ctx.fillStyle = `rgba(255, 150, 170, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size * 0.5, size * 0.3, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.restore();\n                    } else if (p.type === 'burger') {\n                        // Burger projectile - draw a burger!\n                        const size = Math.max(3, (p.size || 8) * 20 / center.z);\n                        ctx.save();\n                        ctx.translate(center.x, center.y);\n                        // Bun top\n                        ctx.fillStyle = '#D2691E';\n                        ctx.beginPath();\n                        ctx.ellipse(0, -size * 0.3, size, size * 0.5, 0, Math.PI, 0);\n                        ctx.fill();\n                        // Patty\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-size, -size * 0.2, size * 2, size * 0.4);\n                        // Lettuce\n                        ctx.fillStyle = '#228B22';\n                        ctx.fillRect(-size * 0.9, size * 0.1, size * 1.8, size * 0.15);\n                        // Bun bottom\n                        ctx.fillStyle = '#DEB887';\n                        ctx.beginPath();\n                        ctx.ellipse(0, size * 0.3, size, size * 0.4, 0, 0, Math.PI);\n                        ctx.fill();\n                        ctx.restore();\n                    } else if (p.type === 'burgerSplat') {\n                        // Burger splatter\n                        const size = Math.max(2, (p.size || 4) * 10 / center.z);\n                        const alpha = Math.min(1, p.life / 10);\n                        const colors = ['#D2691E', '#654321', '#228B22', '#FF6347'];\n                        ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)].replace(')', `, ${alpha})`).replace('rgb', 'rgba');\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (p.type === 'apple') {\n                        // Apple projectile - draw a red apple\n                        const size = Math.max(3, (p.size || 6) * 18 / center.z);\n                        ctx.save();\n                        ctx.translate(center.x, center.y);\n                        // Apple body\n                        ctx.fillStyle = '#dc143c';\n                        ctx.beginPath();\n                        ctx.arc(0, 0, size, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Highlight\n                        ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';\n                        ctx.beginPath();\n                        ctx.arc(-size * 0.3, -size * 0.3, size * 0.4, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Stem\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-1, -size - 3, 2, 4);\n                        // Leaf\n                        ctx.fillStyle = '#228b22';\n                        ctx.beginPath();\n                        ctx.ellipse(3, -size - 1, 4, 2, 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.restore();\n                    } else if (p.type === 'appleSplat') {\n                        // Apple splatter\n                        const size = Math.max(2, (p.size || 3) * 8 / center.z);\n                        const alpha = Math.min(1, p.life / 10);\n                        ctx.fillStyle = `rgba(220, 20, 60, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size, 0, Math.PI * 2);\n                        ctx.fill();\n                    }\n                }\n                \n                // Render dropped items (with distance culling and occlusion) - 3D block models\n                if (this.droppedItems) {\n                    const maxItemDistSq = 400; // 20 blocks squared - reduced for performance\n                    for (const item of this.droppedItems) {\n                        // Distance culling - skip items too far away\n                        const dx = item.x - camX;\n                        const dy = item.y - camY;\n                        const dz = item.z - camZ;\n                        const distSq = dx * dx + dy * dy + dz * dz;\n                        if (distSq > maxItemDistSq) continue;\n                        \n                        // Occlusion check - don't render items through walls\n                        let occluded = false;\n                        const dist = Math.sqrt(distSq);\n                        for (let t = 0.15; t < 0.9; t += 0.2) {\n                            const checkX = camX + dx * t;\n                            const checkY = camY + dy * t;\n                            const checkZ = camZ + dz * t;\n                            const block = this.getBlock(Math.floor(checkX), Math.floor(checkY), Math.floor(checkZ));\n                            if (block && !this.fluidBlocks.includes(block)) {\n                                occluded = true;\n                                break;\n                            }\n                        }\n                        if (occluded) continue;\n                        \n                        const bobOffset = Math.sin(item.bobPhase) * 0.1;\n                        const center = project(item.x, item.y + bobOffset, item.z);\n                        if (!center || center.z <= 0) continue;\n                        \n                        const baseSize = Math.max(6, 30 / center.z);\n                        \n                        // Draw 3D item based on type\n                        this.drawDroppedItem3D(ctx, center.x, center.y, baseSize, item.type, item.bobPhase);\n                        \n                        // Count badge if more than 1\n                        if (item.count > 1) {\n                            ctx.font = `bold ${Math.max(8, baseSize * 0.5)}px monospace`;\n                            ctx.fillStyle = '#fff';\n                            ctx.strokeStyle = '#000';\n                            ctx.lineWidth = 2;\n                            ctx.textAlign = 'center';\n                            ctx.strokeText(item.count.toString(), center.x + baseSize * 0.5, center.y + baseSize * 0.4);\n                            ctx.fillText(item.count.toString(), center.x + baseSize * 0.5, center.y + baseSize * 0.4);\n                        }\n                    }\n                }\n                \n                // Draw block highlight (targeted block wireframe)\n                if (!this.isPaused && this.pointerLocked) {\n                    const hit = this.raycast();\n                    if (hit && hit.hit) {\n                        const bx = hit.hit.x;\n                        const by = hit.hit.y;\n                        const bz = hit.hit.z;\n                        \n                        // Define all 8 corners of the block (slightly expanded for visibility)\n                        const e = 0.005; // expansion amount\n                        const corners = [\n                            [bx - e, by - e, bz - e],\n                            [bx + 1 + e, by - e, bz - e],\n                            [bx + 1 + e, by + 1 + e, bz - e],\n                            [bx - e, by + 1 + e, bz - e],\n                            [bx - e, by - e, bz + 1 + e],\n                            [bx + 1 + e, by - e, bz + 1 + e],\n                            [bx + 1 + e, by + 1 + e, bz + 1 + e],\n                            [bx - e, by + 1 + e, bz + 1 + e]\n                        ];\n                        \n                        const projected = corners.map(c => project(c[0], c[1], c[2]));\n                        \n                        // Draw edges if all corners are visible\n                        if (projected.every(p => p !== null)) {\n                            // Change color based on what we're looking through\n                            let strokeColor = 'rgba(0, 0, 0, 0.8)';\n                            let lineWidth = 2;\n                            \n                            if (hit.throughWater) {\n                                // Blue tint when looking through water\n                                strokeColor = 'rgba(74, 144, 217, 0.7)';\n                                lineWidth = 3;\n                            } else if (hit.throughLava) {\n                                // Orange tint when looking through lava\n                                strokeColor = 'rgba(255, 100, 0, 0.7)';\n                                lineWidth = 3;\n                            }\n                            \n                            ctx.strokeStyle = strokeColor;\n                            ctx.lineWidth = lineWidth;\n                            \n                            const edges = [\n                                [0,1], [1,2], [2,3], [3,0], // back face\n                                [4,5], [5,6], [6,7], [7,4], // front face\n                                [0,4], [1,5], [2,6], [3,7]  // connecting edges\n                            ];\n                            \n                            ctx.beginPath();\n                            for (const [a, b] of edges) {\n                                ctx.moveTo(projected[a].x, projected[a].y);\n                                ctx.lineTo(projected[b].x, projected[b].y);\n                            }\n                            ctx.stroke();\n                        }\n                        \n                        // Show tooltip for ritual socket blocks\n                        const targetBlock = this.getBlock(bx, by, bz);\n                        this.updateBlockTooltip(targetBlock);\n                    } else {\n                        this.updateBlockTooltip(null);\n                    }\n                }\n                \n                // Debug info display\n                if (this.debugShowCoords) {\n                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n                    ctx.fillRect(width - 200, 10, 190, 80);\n                    ctx.fillStyle = '#0f0';\n                    ctx.font = '12px monospace';\n                    ctx.textAlign = 'left';\n                    ctx.fillText(`X: ${this.camera.x.toFixed(2)}`, width - 190, 28);\n                    ctx.fillText(`Y: ${this.camera.y.toFixed(2)}`, width - 190, 43);\n                    ctx.fillText(`Z: ${this.camera.z.toFixed(2)}`, width - 190, 58);\n                    ctx.fillText(`Blocks: ${Object.keys(this.world).length}`, width - 190, 73);\n                    ctx.fillText(`Birds: ${this.pestBirds.length}`, width - 190, 88);\n                }\n                \n                // Player model (first person body when looking down)\n                this.renderPlayerModel(ctx, halfW, halfH, width, height);\n                \n                // Crosshair\n                if (!this.isPaused && this.pointerLocked) {\n                    ctx.strokeStyle = '#fff';\n                    ctx.lineWidth = 2;\n                    ctx.beginPath();\n                    ctx.moveTo(halfW - 10, halfH);\n                    ctx.lineTo(halfW + 10, halfH);\n                    ctx.moveTo(halfW, halfH - 10);\n                    ctx.lineTo(halfW, halfH + 10);\n                    ctx.stroke();\n                }\n                \n                // Bird event alert\n                if (this.birdEvent && this.birdEvent.alertMessage && this.birdEvent.alertFade > 0) {\n                    const alpha = Math.min(1, this.birdEvent.alertFade / 1000);\n                    const pulse = 0.8 + Math.sin(Date.now() * 0.01) * 0.2;\n                    \n                    ctx.save();\n                    ctx.globalAlpha = alpha;\n                    \n                    // Background box\n                    ctx.fillStyle = `rgba(0, 0, 0, ${0.7 * pulse})`;\n                    const alertWidth = Math.min(width * 0.8, 500);\n                    const alertHeight = 60;\n                    const alertX = (width - alertWidth) / 2;\n                    const alertY = 80;\n                    \n                    ctx.fillRect(alertX, alertY, alertWidth, alertHeight);\n                    \n                    // Border\n                    ctx.strokeStyle = `rgba(255, 100, 100, ${pulse})`;\n                    ctx.lineWidth = 3;\n                    ctx.strokeRect(alertX, alertY, alertWidth, alertHeight);\n                    \n                    // Text\n                    ctx.fillStyle = `rgba(255, 255, 255, ${pulse})`;\n                    ctx.font = 'bold 20px monospace';\n                    ctx.textAlign = 'center';\n                    ctx.fillText(this.birdEvent.alertMessage, width / 2, alertY + 38);\n                    \n                    ctx.restore();\n                }\n                \n                // Bird event timer display (small, top right)\n                if (this.birdEvent && !this.isPaused) {\n                    const timeLeft = Math.max(0, this.birdEvent.timer);\n                    const minutes = Math.floor(timeLeft / 60000);\n                    const seconds = Math.floor((timeLeft % 60000) / 1000);\n                    const timeStr = `üê¶ ${minutes}:${seconds.toString().padStart(2, '0')}`;\n                    \n                    ctx.save();\n                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\n                    ctx.fillRect(width - 100, 10, 90, 25);\n                    ctx.fillStyle = timeLeft < 60000 ? '#ff6666' : '#fff';\n                    ctx.font = '14px monospace';\n                    ctx.textAlign = 'right';\n                    ctx.fillText(timeStr, width - 15, 28);\n                    ctx.restore();\n                }\n                \n                // Render AK-47 if selected - Traditional FPS horizontal gun\n                if (this.selectedItem === 'ak47' && !this.isPaused) {\n                    const s = Math.min(width, height) * 0.0055;\n                    \n                    // Position gun in lower right corner, pointing left toward center\n                    const baseX = width * 0.75;\n                    const baseY = height * 0.78;\n                    \n                    ctx.save();\n                    ctx.translate(baseX, baseY);\n                    ctx.rotate(-0.1); // Slight upward angle\n                    \n                    // === HAND (holding grip) ===\n                    ctx.fillStyle = '#d4a574';  // Skin tone\n                    ctx.beginPath();\n                    ctx.ellipse(45 * s, 25 * s, 18 * s, 12 * s, 0.3, 0, Math.PI * 2);\n                    ctx.fill();\n                    // Fingers wrapped around grip\n                    ctx.fillStyle = '#c49a6c';\n                    for (let i = 0; i < 4; i++) {\n                        ctx.beginPath();\n                        ctx.ellipse((35 + i * 7) * s, 35 * s, 4 * s, 8 * s, 0.2, 0, Math.PI * 2);\n                        ctx.fill();\n                    }\n                    // Thumb\n                    ctx.fillStyle = '#d4a574';\n                    ctx.beginPath();\n                    ctx.ellipse(30 * s, 15 * s, 6 * s, 10 * s, -0.5, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // === STOCK (right side, behind receiver) ===\n                    ctx.fillStyle = '#5a3d2b';\n                    ctx.beginPath();\n                    ctx.moveTo(80 * s, -5 * s);\n                    ctx.lineTo(160 * s, 0 * s);\n                    ctx.lineTo(165 * s, 25 * s);\n                    ctx.lineTo(155 * s, 30 * s);\n                    ctx.lineTo(80 * s, 25 * s);\n                    ctx.closePath();\n                    ctx.fill();\n                    \n                    // Stock wood grain\n                    ctx.fillStyle = '#6b4d3b';\n                    ctx.fillRect(100 * s, 2 * s, 50 * s, 8 * s);\n                    ctx.fillRect(95 * s, 15 * s, 55 * s, 6 * s);\n                    \n                    // Stock butt plate\n                    ctx.fillStyle = '#333';\n                    ctx.fillRect(155 * s, -2 * s, 8 * s, 30 * s);\n                    \n                    // === RECEIVER (main body) ===\n                    ctx.fillStyle = '#2a2a2a';\n                    ctx.fillRect(-30 * s, -8 * s, 115 * s, 30 * s);\n                    \n                    // Receiver top cover\n                    ctx.fillStyle = '#3a3a3a';\n                    ctx.fillRect(-25 * s, -12 * s, 100 * s, 8 * s);\n                    \n                    // Ejection port\n                    ctx.fillStyle = '#1a1a1a';\n                    ctx.fillRect(15 * s, -6 * s, 25 * s, 12 * s);\n                    \n                    // === BARREL & HANDGUARD ===\n                    ctx.fillStyle = '#1a1a1a';\n                    ctx.fillRect(-140 * s, -4 * s, 115 * s, 14 * s);\n                    \n                    // Barrel\n                    ctx.fillStyle = '#111';\n                    ctx.fillRect(-180 * s, 0 * s, 45 * s, 8 * s);\n                    \n                    // Barrel hole\n                    ctx.fillStyle = '#000';\n                    ctx.beginPath();\n                    ctx.ellipse(-182 * s, 4 * s, 3 * s, 3 * s, 0, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Gas tube\n                    ctx.fillStyle = '#333';\n                    ctx.fillRect(-130 * s, -10 * s, 100 * s, 5 * s);\n                    \n                    // Handguard ventilation holes\n                    ctx.fillStyle = '#111';\n                    for (let i = 0; i < 4; i++) {\n                        ctx.beginPath();\n                        ctx.ellipse((-120 + i * 22) * s, 3 * s, 6 * s, 3 * s, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                    }\n                    \n                    // === FRONT SIGHT ===\n                    ctx.fillStyle = '#1a1a1a';\n                    ctx.fillRect(-145 * s, -20 * s, 6 * s, 18 * s);\n                    ctx.fillRect(-148 * s, -22 * s, 12 * s, 4 * s);\n                    \n                    // === REAR SIGHT ===\n                    ctx.fillRect(-5 * s, -18 * s, 15 * s, 8 * s);\n                    \n                    // === MAGAZINE (curved) ===\n                    ctx.fillStyle = '#333';\n                    ctx.beginPath();\n                    ctx.moveTo(10 * s, 22 * s);\n                    ctx.lineTo(35 * s, 22 * s);\n                    ctx.quadraticCurveTo(45 * s, 50 * s, 35 * s, 80 * s);\n                    ctx.lineTo(15 * s, 85 * s);\n                    ctx.quadraticCurveTo(5 * s, 55 * s, 10 * s, 22 * s);\n                    ctx.closePath();\n                    ctx.fill();\n                    \n                    // Magazine ridges\n                    ctx.strokeStyle = '#222';\n                    ctx.lineWidth = 1.5 * s;\n                    for (let i = 0; i < 4; i++) {\n                        ctx.beginPath();\n                        ctx.moveTo((12 + i * 2) * s, (35 + i * 12) * s);\n                        ctx.lineTo((32 + i * 1) * s, (38 + i * 12) * s);\n                        ctx.stroke();\n                    }\n                    \n                    // === GRIP ===\n                    ctx.fillStyle = '#5a3d2b';\n                    ctx.beginPath();\n                    ctx.moveTo(45 * s, 22 * s);\n                    ctx.lineTo(65 * s, 22 * s);\n                    ctx.lineTo(70 * s, 65 * s);\n                    ctx.lineTo(45 * s, 70 * s);\n                    ctx.closePath();\n                    ctx.fill();\n                    \n                    // Grip texture\n                    ctx.fillStyle = '#4a2d1b';\n                    for (let i = 0; i < 5; i++) {\n                        ctx.fillRect(50 * s, (28 + i * 8) * s, 12 * s, 3 * s);\n                    }\n                    \n                    // === TRIGGER GUARD ===\n                    ctx.strokeStyle = '#2a2a2a';\n                    ctx.lineWidth = 3 * s;\n                    ctx.beginPath();\n                    ctx.arc(25 * s, 35 * s, 15 * s, -0.8, 2.2);\n                    ctx.stroke();\n                    \n                    // Trigger\n                    ctx.fillStyle = '#222';\n                    ctx.fillRect(22 * s, 28 * s, 4 * s, 12 * s);\n                    \n                    // === MUZZLE FLASH ===\n                    if (this.muzzleFlash > 0) {\n                        const flashSize = 25 + Math.random() * 20;\n                        const flashX = -190 * s;\n                        const flashY = 4 * s;\n                        \n                        // Outer glow\n                        ctx.fillStyle = 'rgba(255, 100, 0, 0.5)';\n                        ctx.beginPath();\n                        ctx.arc(flashX, flashY, flashSize * s * 1.5, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Orange middle\n                        ctx.fillStyle = 'rgba(255, 150, 0, 0.8)';\n                        ctx.beginPath();\n                        ctx.arc(flashX, flashY, flashSize * s, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Yellow core\n                        ctx.fillStyle = '#ffff00';\n                        ctx.beginPath();\n                        ctx.arc(flashX, flashY, flashSize * s * 0.4, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Flash spikes pointing left (toward screen center)\n                        ctx.strokeStyle = '#ffff88';\n                        ctx.lineWidth = 2;\n                        for (let i = 0; i < 6; i++) {\n                            const angle = Math.PI + (Math.random() - 0.5) * 1.5;\n                            const len = (20 + Math.random() * 35) * s;\n                            ctx.beginPath();\n                            ctx.moveTo(flashX, flashY);\n                            ctx.lineTo(flashX + Math.cos(angle) * len, flashY + Math.sin(angle) * len);\n                            ctx.stroke();\n                        }\n                    }\n                    \n                    ctx.restore();\n                }\n                \n                // Fluid overlay effects - only when HEAD is submerged\n                if (this.headSubmergedWater) {\n                    // Blue tint when head is underwater\n                    ctx.fillStyle = 'rgba(0, 100, 200, 0.25)';\n                    ctx.fillRect(0, 0, width, height);\n                }\n                \n                if (this.headSubmergedLava) {\n                    // Intense orange/red overlay with animated flames\n                    const time = Date.now() * 0.005;\n                    \n                    // Base lava tint\n                    ctx.fillStyle = 'rgba(255, 80, 0, 0.4)';\n                    ctx.fillRect(0, 0, width, height);\n                    \n                    // Animated flame edges\n                    ctx.fillStyle = 'rgba(255, 50, 0, 0.6)';\n                    \n                    // Bottom flames\n                    for (let i = 0; i < 12; i++) {\n                        const x = (i / 12) * width;\n                        const flameHeight = 60 + Math.sin(time + i * 0.8) * 30 + Math.sin(time * 1.5 + i) * 20;\n                        ctx.beginPath();\n                        ctx.moveTo(x - 30, height);\n                        ctx.quadraticCurveTo(x, height - flameHeight, x + 30, height);\n                        ctx.fill();\n                    }\n                    \n                    // Top flames (dripping down)\n                    ctx.fillStyle = 'rgba(255, 100, 0, 0.5)';\n                    for (let i = 0; i < 8; i++) {\n                        const x = (i / 8) * width + 40;\n                        const flameHeight = 40 + Math.sin(time * 0.8 + i * 1.2) * 25;\n                        ctx.beginPath();\n                        ctx.moveTo(x - 25, 0);\n                        ctx.quadraticCurveTo(x, flameHeight, x + 25, 0);\n                        ctx.fill();\n                    }\n                    \n                    // Side flames\n                    ctx.fillStyle = 'rgba(255, 60, 0, 0.5)';\n                    for (let i = 0; i < 6; i++) {\n                        const y = (i / 6) * height;\n                        const flameWidth = 40 + Math.sin(time + i) * 20;\n                        // Left side\n                        ctx.beginPath();\n                        ctx.moveTo(0, y - 30);\n                        ctx.quadraticCurveTo(flameWidth, y, 0, y + 30);\n                        ctx.fill();\n                        // Right side\n                        ctx.beginPath();\n                        ctx.moveTo(width, y - 30);\n                        ctx.quadraticCurveTo(width - flameWidth, y, width, y + 30);\n                        ctx.fill();\n                    }\n                    \n                    // Vignette effect\n                    const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width * 0.7);\n                    gradient.addColorStop(0, 'rgba(255, 50, 0, 0)');\n                    gradient.addColorStop(0.7, 'rgba(255, 30, 0, 0.3)');\n                    gradient.addColorStop(1, 'rgba(200, 0, 0, 0.6)');\n                    ctx.fillStyle = gradient;\n                    ctx.fillRect(0, 0, width, height);\n                }\n            },\n            \n            project(x, y, z) {\n                const dx = x - this.camera.x;\n                const dy = y - this.camera.y;\n                const dz = z - this.camera.z;\n                \n                const cosY = Math.cos(-this.camera.rotY);\n                const sinY = Math.sin(-this.camera.rotY);\n                const rx = dx * cosY - dz * sinY;\n                const rz = dx * sinY + dz * cosY;\n                \n                const cosX = Math.cos(-this.camera.rotX);\n                const sinX = Math.sin(-this.camera.rotX);\n                const ry = dy * cosX - rz * sinX;\n                const finalZ = dy * sinX + rz * cosX;\n                \n                if (finalZ <= 0.1) return null;\n                \n                const fov = 400;\n                const screenX = this.canvas.width / 2 + (rx / finalZ) * fov;\n                const screenY = this.canvas.height / 2 - (ry / finalZ) * fov;\n                \n                return { x: screenX, y: screenY, z: finalZ };\n            },\n            \n            // Update block tooltip display\n            updateBlockTooltip(blockType) {\n                const tooltip = document.getElementById('blockTooltip');\n                if (!tooltip) return;\n                \n                const socketInfo = {\n                    'petalSocket': { name: 'Petal Socket', item: 'Requires: Sakura Petal', desc: 'Place a cherry blossom petal here' },\n                    'ropeSocket': { name: 'Rope Socket', item: 'Requires: Sacred Rope', desc: 'Place a shimenawa rope here' },\n                    'charmSocket': { name: 'Charm Socket', item: 'Requires: Omamori', desc: 'Place the protective charm here' },\n                    'plaqueSocket': { name: 'Plaque Socket', item: 'Requires: Wish Plaque', desc: 'Place a wooden ema here' },\n                    'incenseSocket': { name: 'Incense Socket', item: 'Requires: Incense', desc: 'Place purifying incense here' },\n                    'petalSocketFilled': { name: 'Petal Socket ‚úì', item: 'FILLED', desc: 'Cherry petal placed!' },\n                    'ropeSocketFilled': { name: 'Rope Socket ‚úì', item: 'FILLED', desc: 'Sacred rope placed!' },\n                    'charmSocketFilled': { name: 'Charm Socket ‚úì', item: 'FILLED', desc: 'Charm placed!' },\n                    'plaqueSocketFilled': { name: 'Plaque Socket ‚úì', item: 'FILLED', desc: 'Wish plaque placed!' },\n                    'incenseSocketFilled': { name: 'Incense Socket ‚úì', item: 'FILLED', desc: 'Incense placed!' }\n                };\n                \n                const info = blockType ? socketInfo[blockType] : null;\n                if (info) {\n                    tooltip.classList.add('active');\n                    tooltip.querySelector('.tooltip-title').textContent = info.name;\n                    const isFilled = info.item === 'FILLED';\n                    tooltip.querySelector('.tooltip-desc').innerHTML = \n                        `<span style=\"color:${isFilled ? '#4f4' : '#ffd700'}\">${info.item}</span><br>${info.desc}`;\n                } else {\n                    tooltip.classList.remove('active');\n                }\n            },\n            \n            // Render player model (first-person body visible when looking down)\n            renderPlayerModel(ctx, centerX, centerY, width, height) {\n                // Only show body when looking down\n                const lookDownAmount = Math.max(0, this.camera.rotX * 2); // 0 to 1 as player looks down\n                if (lookDownAmount < 0.05) {\n                    // Always show hands with held item even when not looking down\n                    this.renderHeldItem(ctx, centerX, centerY, width, height);\n                    return;\n                }\n                \n                const alpha = Math.min(1, lookDownAmount);\n                \n                ctx.save();\n                \n                // Body position based on look angle\n                const bodyY = height - 50 + (1 - lookDownAmount) * 200;\n                \n                // Draw the 3D body with shading\n                this.drawPlayerBody3D(ctx, centerX, bodyY, alpha, lookDownAmount);\n                \n                ctx.restore();\n                \n                // Always render held item\n                this.renderHeldItem(ctx, centerX, centerY, width, height);\n            },\n            \n            // Render held item in first person\n            renderHeldItem(ctx, centerX, centerY, width, height) {\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (!slot) return;\n                \n                const itemId = slot.id;\n                const bobOffset = Math.sin(Date.now() * 0.003) * 3;\n                \n                // Hand position (bottom right of screen)\n                const handX = width - 120;\n                const handY = height - 100 + bobOffset;\n                const size = 60;\n                \n                ctx.save();\n                ctx.translate(handX, handY);\n                ctx.rotate(-0.2); // Slight tilt\n                \n                // Draw hand\n                ctx.fillStyle = '#ffdab9'; // Skin tone\n                ctx.beginPath();\n                ctx.ellipse(0, 20, 25, 35, 0.3, 0, Math.PI * 2);\n                ctx.fill();\n                \n                // Draw item based on type\n                const colors = this.blockColors[itemId];\n                \n                if (colors) {\n                    // Block item - draw 3D cube\n                    const s = size * 0.5;\n                    ctx.translate(0, -10);\n                    \n                    // Top face\n                    ctx.fillStyle = colors.top;\n                    ctx.beginPath();\n                    ctx.moveTo(0, -s);\n                    ctx.lineTo(s, -s/2);\n                    ctx.lineTo(0, 0);\n                    ctx.lineTo(-s, -s/2);\n                    ctx.closePath();\n                    ctx.fill();\n                    \n                    // Left face\n                    ctx.fillStyle = colors.side;\n                    ctx.beginPath();\n                    ctx.moveTo(-s, -s/2);\n                    ctx.lineTo(0, 0);\n                    ctx.lineTo(0, s);\n                    ctx.lineTo(-s, s/2);\n                    ctx.closePath();\n                    ctx.fill();\n                    \n                    // Right face\n                    ctx.fillStyle = this.darkenColor(colors.side, 0.7);\n                    ctx.beginPath();\n                    ctx.moveTo(0, 0);\n                    ctx.lineTo(s, -s/2);\n                    ctx.lineTo(s, s/2);\n                    ctx.lineTo(0, s);\n                    ctx.closePath();\n                    ctx.fill();\n                } else {\n                    // Non-block item\n                    if (itemId === 'ak47') {\n                        ctx.fillStyle = '#333';\n                        ctx.fillRect(-30, -20, 80, 15);\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-10, -5, 25, 25);\n                        ctx.fillStyle = '#222';\n                        ctx.fillRect(10, -5, 8, 20);\n                    } else if (itemId === 'berdger') {\n                        // Burger\n                        ctx.fillStyle = '#daa520';\n                        ctx.beginPath();\n                        ctx.ellipse(0, -15, 25, 12, 0, Math.PI, 0);\n                        ctx.fill();\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-22, -8, 44, 10);\n                        ctx.fillStyle = '#228b22';\n                        ctx.fillRect(-20, 0, 40, 5);\n                        ctx.fillStyle = '#daa520';\n                        ctx.beginPath();\n                        ctx.ellipse(0, 10, 23, 10, 0, 0, Math.PI);\n                        ctx.fill();\n                    } else if (itemId === 'apple') {\n                        ctx.fillStyle = '#dc143c';\n                        ctx.beginPath();\n                        ctx.arc(0, -5, 20, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-2, -30, 4, 10);\n                        ctx.fillStyle = '#228b22';\n                        ctx.beginPath();\n                        ctx.ellipse(5, -28, 8, 4, 0.5, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (itemId === 'water_bucket' || itemId === 'lava_bucket') {\n                        ctx.fillStyle = '#888';\n                        ctx.beginPath();\n                        ctx.moveTo(-20, -25);\n                        ctx.lineTo(20, -25);\n                        ctx.lineTo(15, 15);\n                        ctx.lineTo(-15, 15);\n                        ctx.closePath();\n                        ctx.fill();\n                        ctx.fillStyle = itemId === 'water_bucket' ? '#4a90d9' : '#ff6600';\n                        ctx.fillRect(-15, -15, 30, 25);\n                    } else if (itemId === 'seeds') {\n                        ctx.fillStyle = '#daa520';\n                        for (let i = 0; i < 5; i++) {\n                            ctx.beginPath();\n                            ctx.ellipse(Math.cos(i) * 10, Math.sin(i) * 8 - 10, 4, 6, i, 0, Math.PI * 2);\n                            ctx.fill();\n                        }\n                    }\n                }\n                \n                ctx.restore();\n            },\n            \n            // Draw the player body in 3D style with shading\n            drawPlayerBody3D(ctx, centerX, bodyY, alpha, lookAmount) {\n                ctx.save();\n                \n                // 3D depth effect - darker on edges\n                const edgeShade = 0.7;\n                \n                // Torso - cherry blossom pink themed with 3D shading\n                const gradient = ctx.createLinearGradient(centerX - 50, bodyY, centerX + 50, bodyY);\n                gradient.addColorStop(0, `rgba(180, 130, 150, ${alpha})`);\n                gradient.addColorStop(0.3, `rgba(255, 183, 197, ${alpha})`);\n                gradient.addColorStop(0.7, `rgba(255, 183, 197, ${alpha})`);\n                gradient.addColorStop(1, `rgba(180, 130, 150, ${alpha})`);\n                ctx.fillStyle = gradient;\n                \n                // Draw torso as trapezoid with rounded corners\n                ctx.beginPath();\n                ctx.moveTo(centerX - 35, bodyY + 5);\n                ctx.lineTo(centerX + 35, bodyY + 5);\n                ctx.quadraticCurveTo(centerX + 50, bodyY + 40, centerX + 45, bodyY + 80);\n                ctx.lineTo(centerX - 45, bodyY + 80);\n                ctx.quadraticCurveTo(centerX - 50, bodyY + 40, centerX - 35, bodyY + 5);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Collar V-neck\n                ctx.fillStyle = `rgba(255, 240, 245, ${alpha * 0.8})`;\n                ctx.beginPath();\n                ctx.moveTo(centerX - 20, bodyY + 5);\n                ctx.lineTo(centerX, bodyY + 25);\n                ctx.lineTo(centerX + 20, bodyY + 5);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Arms with 3D shading\n                const armGradient = ctx.createRadialGradient(centerX - 55, bodyY + 30, 0, centerX - 55, bodyY + 30, 30);\n                armGradient.addColorStop(0, `rgba(255, 228, 205, ${alpha})`);\n                armGradient.addColorStop(1, `rgba(220, 180, 160, ${alpha})`);\n                ctx.fillStyle = armGradient;\n                ctx.beginPath();\n                ctx.ellipse(centerX - 52, bodyY + 35, 14, 28, -0.2, 0, Math.PI * 2);\n                ctx.fill();\n                \n                const armGradient2 = ctx.createRadialGradient(centerX + 55, bodyY + 30, 0, centerX + 55, bodyY + 30, 30);\n                armGradient2.addColorStop(0, `rgba(255, 228, 205, ${alpha})`);\n                armGradient2.addColorStop(1, `rgba(220, 180, 160, ${alpha})`);\n                ctx.fillStyle = armGradient2;\n                ctx.beginPath();\n                ctx.ellipse(centerX + 52, bodyY + 35, 14, 28, 0.2, 0, Math.PI * 2);\n                ctx.fill();\n                \n                // Hands\n                ctx.fillStyle = `rgba(255, 218, 195, ${alpha})`;\n                ctx.beginPath();\n                ctx.arc(centerX - 55, bodyY + 60, 12, 0, Math.PI * 2);\n                ctx.fill();\n                ctx.beginPath();\n                ctx.arc(centerX + 55, bodyY + 60, 12, 0, Math.PI * 2);\n                ctx.fill();\n                \n                // Legs with jeans texture effect\n                const jeansGradient = ctx.createLinearGradient(centerX - 40, bodyY + 75, centerX + 40, bodyY + 75);\n                jeansGradient.addColorStop(0, `rgba(50, 70, 100, ${alpha})`);\n                jeansGradient.addColorStop(0.3, `rgba(70, 90, 120, ${alpha})`);\n                jeansGradient.addColorStop(0.7, `rgba(70, 90, 120, ${alpha})`);\n                jeansGradient.addColorStop(1, `rgba(50, 70, 100, ${alpha})`);\n                ctx.fillStyle = jeansGradient;\n                \n                // Left leg\n                ctx.beginPath();\n                ctx.roundRect(centerX - 38, bodyY + 78, 28, 55, 3);\n                ctx.fill();\n                \n                // Right leg\n                ctx.beginPath();\n                ctx.roundRect(centerX + 10, bodyY + 78, 28, 55, 3);\n                ctx.fill();\n                \n                // Boots with shine\n                ctx.fillStyle = `rgba(100, 60, 30, ${alpha})`;\n                ctx.beginPath();\n                ctx.roundRect(centerX - 42, bodyY + 128, 35, 20, 4);\n                ctx.fill();\n                ctx.beginPath();\n                ctx.roundRect(centerX + 7, bodyY + 128, 35, 20, 4);\n                ctx.fill();\n                \n                // Boot shine\n                ctx.fillStyle = `rgba(255, 255, 255, ${alpha * 0.2})`;\n                ctx.beginPath();\n                ctx.ellipse(centerX - 30, bodyY + 133, 8, 3, 0, 0, Math.PI * 2);\n                ctx.fill();\n                ctx.beginPath();\n                ctx.ellipse(centerX + 20, bodyY + 133, 8, 3, 0, 0, Math.PI * 2);\n                ctx.fill();\n                \n                ctx.restore();\n            },\n            \n            darkenColor(hex, factor) {\n                // Use cache to avoid repeated hex parsing\n                const key = hex + factor;\n                if (!this.colorCache) this.colorCache = {};\n                if (this.colorCache[key]) return this.colorCache[key];\n                \n                const r = Math.floor(parseInt(hex.slice(1, 3), 16) * factor);\n                const g = Math.floor(parseInt(hex.slice(3, 5), 16) * factor);\n                const b = Math.floor(parseInt(hex.slice(5, 7), 16) * factor);\n                const result = `rgb(${r},${g},${b})`;\n                this.colorCache[key] = result;\n                return result;\n            },\n            \n            gameLoop(timestamp) {\n                // Completely stop loop when game is inactive\n                if (!this.isActive) {\n                    this.gameLoopId = null;\n                    return;\n                }\n                \n                // Initialize lastFrameTime if needed\n                if (!this.lastFrameTime) this.lastFrameTime = timestamp;\n                \n                // Calculate frame interval based on target FPS\n                const targetInterval = 1000 / this.settings.targetFps;\n                const elapsed = timestamp - this.lastFrameTime;\n                \n                // Only update if enough time has passed for target FPS\n                if (elapsed >= targetInterval) {\n                    this.lastFrameTime = timestamp - (elapsed % targetInterval);\n                    \n                    // Update FPS counter\n                    this.fpsCounter.frames++;\n                    if (timestamp - this.fpsCounter.lastTime >= 1000) {\n                        this.fpsCounter.fps = this.fpsCounter.frames;\n                        this.fpsCounter.frames = 0;\n                        this.fpsCounter.lastTime = timestamp;\n                        \n                        // Update debug console FPS\n                        const debugFps = document.getElementById('debugFps');\n                        if (debugFps) {\n                            debugFps.textContent = `${this.fpsCounter.fps} FPS`;\n                        }\n                    }\n                    \n                    // Only update physics if not paused\n                    if (!this.isPaused) {\n                        this.update();\n                        this.updateBirds();\n                        this.updateParticles();\n                        this.updateFluids();  // Fluid spreading simulation\n                        this.updateWind();    // Wind dynamics\n                        this.updatePetals();  // Cherry blossom petals\n                        this.updateDroppedItems();  // Ground items\n                        this.render();\n                        \n                        // Render FPS counter\n                        if (this.settings.showFps) {\n                            this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\n                            this.ctx.fillRect(this.canvas.width - 70, this.canvas.height - 25, 65, 20);\n                            this.ctx.fillStyle = '#00ff00';\n                            this.ctx.font = '12px monospace';\n                            this.ctx.textAlign = 'right';\n                            this.ctx.fillText(`${this.fpsCounter.fps} FPS`, this.canvas.width - 10, this.canvas.height - 10);\n                            this.ctx.textAlign = 'left';\n                        }\n                    }\n                }\n                \n                // Store the ID so we can cancel it on stop\n                this.gameLoopId = requestAnimationFrame((ts) => this.gameLoop(ts));\n            },\n            \n            start() {\n                // Initialize world on first start (deferred from page load)\n                this.fullInit();\n                \n                this.isActive = true;\n                this.isPaused = false;\n                this.pointerLocked = false;\n                this.stats = { blocksPlaced: 0, blocksBroken: 0, distance: 0, jumps: 0, startTime: Date.now() };\n                document.getElementById('minecraftGame').classList.add('active');\n                document.getElementById('pauseMenu').classList.remove('active');\n                document.getElementById('gameUI').style.display = 'flex';\n                \n                // Find safe spawn location using a spiral search\n                const findSafeSpawn = () => {\n                    const preferredX = 0;\n                    const preferredZ = -8;\n                    \n                    // Helper to check if a position is safe for spawning\n                    const isSpawnSafe = (x, z) => {\n                        // Find ground level\n                        let groundY = null;\n                        for (let checkY = 40; checkY >= 0; checkY--) {\n                            const block = this.getBlock(x, checkY, z);\n                            if (block && block !== 'water' && block !== 'lava') {\n                                groundY = checkY;\n                                break;\n                            }\n                        }\n                        \n                        if (groundY === null) return null; // No ground found\n                        \n                        const feetY = groundY + 1;\n                        const bodyY = groundY + 2;\n                        const headY = groundY + 3;\n                        \n                        // Check if there's space for the player (2 blocks of air above ground)\n                        const feetBlock = this.getBlock(x, feetY, z);\n                        const bodyBlock = this.getBlock(x, bodyY, z);\n                        \n                        // Both spaces must be empty or fluid (can spawn in water but not in solid)\n                        const feetClear = !feetBlock || feetBlock === 'water' || feetBlock === 'lava';\n                        const bodyClear = !bodyBlock || bodyBlock === 'water' || bodyBlock === 'lava';\n                        \n                        // Prefer spawning on dry land\n                        const groundBlock = this.getBlock(x, groundY, z);\n                        const isDryLand = groundBlock !== 'water' && groundBlock !== 'lava' && groundBlock !== 'sand';\n                        \n                        if (feetClear && bodyClear) {\n                            return {\n                                x: x,\n                                y: feetY + this.playerEyeHeight,\n                                z: z,\n                                priority: isDryLand ? 1 : 2 // Prefer dry land\n                            };\n                        }\n                        \n                        return null;\n                    };\n                    \n                    // Try preferred location first\n                    let bestSpawn = isSpawnSafe(preferredX, preferredZ);\n                    if (bestSpawn && bestSpawn.priority === 1) {\n                        return bestSpawn;\n                    }\n                    \n                    // Spiral search outward from preferred location\n                    const maxRadius = 30;\n                    for (let radius = 1; radius <= maxRadius; radius++) {\n                        for (let dx = -radius; dx <= radius; dx++) {\n                            for (let dz = -radius; dz <= radius; dz++) {\n                                // Only check perimeter of current radius\n                                if (Math.abs(dx) !== radius && Math.abs(dz) !== radius) continue;\n                                \n                                const spawn = isSpawnSafe(preferredX + dx, preferredZ + dz);\n                                if (spawn) {\n                                    if (spawn.priority === 1) {\n                                        return spawn; // Found perfect spot\n                                    }\n                                    if (!bestSpawn || spawn.priority < bestSpawn.priority) {\n                                        bestSpawn = spawn;\n                                    }\n                                }\n                            }\n                        }\n                        \n                        // If we found something decent, use it\n                        if (bestSpawn && radius > 5) {\n                            return bestSpawn;\n                        }\n                    }\n                    \n                    // Fallback - spawn high in the sky\n                    return { x: 0, y: 30, z: 0 };\n                };\n                \n                const spawnPos = findSafeSpawn();\n                this.camera = { x: spawnPos.x + 0.5, y: spawnPos.y, z: spawnPos.z + 0.5, rotX: -0.3, rotY: 0 };\n                (this.canvas as HTMLElement).style.filter = '';\n                \n                // Reset player state\n                this.velocity = { x: 0, y: 0, z: 0 };\n                this.isJumping = false;\n                this.inWater = false;\n                this.inLava = false;\n                this.swimming = false;\n                this.headSubmergedWater = false;\n                this.headSubmergedLava = false;\n                \n                // Clear any lingering particles/fluids from previous session\n                this.particles = [];\n                this.fluidUpdates = [];\n                \n                // Initialize bird event system\n                this.birdEvent = {\n                    timer: 5 * 60 * 1000, // 5 minutes in ms\n                    lastUpdate: Date.now(),\n                    currentEvent: 0,\n                    events: [\n                        {\n                            name: 'SWARM',\n                            description: 'the birds will swarm!',\n                            action: () => this.triggerBirdSwarm()\n                        },\n                        {\n                            name: 'RAGE',\n                            description: 'the birds will rage!',\n                            action: () => this.triggerBirdRage()\n                        },\n                        {\n                            name: 'MULTIPLY',\n                            description: 'the birds will multiply!',\n                            action: () => this.triggerBirdMultiply()\n                        },\n                        {\n                            name: 'CREEPER INVASION',\n                            description: 'creepers will stalk you!',\n                            action: () => this.triggerCreeperInvasion()\n                        }\n                    ],\n                    alertShown: { five: false, three: false, one: false, thirty: false, ten: false },\n                    alertMessage: null,\n                    alertFade: 0\n                };\n                \n                // Initialize survival game stats\n                this.survivalStats = {\n                    score: 0,\n                    wave: 1,\n                    birdsDefeated: 0,\n                    objectiveTimer: 0,\n                    currentObjective: null,\n                    objectives: [\n                        { text: 'Survive the bird apocalypse!', type: 'survive' },\n                        { text: 'Find the Ritual Temple', type: 'find_temple' },\n                        { text: 'Collect 5 apples', type: 'collect', item: 'apple', count: 5 },\n                        { text: 'Knock back 10 birds', type: 'knockback', count: 10 },\n                        { text: 'Complete the Omamori ritual', type: 'ritual' }\n                    ]\n                };\n                this.survivalStats.currentObjective = this.survivalStats.objectives[0];\n                this.updateSurvivalHUD();\n                \n                // Hide main site animations to save GPU compositing\n                const petalCanvas = document.getElementById('petalCanvas');\n                if (petalCanvas) (petalCanvas as HTMLElement).style.display = 'none';\n                \n                // Hide flame particles container\n                const flameParticles = document.getElementById('flameParticles');\n                if (flameParticles) (flameParticles as HTMLElement).style.visibility = 'hidden';\n                \n                // Lock page scrolling while game is active\n                (document.body as HTMLElement).style.overflow = 'hidden';\n                (document.documentElement as HTMLElement).style.overflow = 'hidden';\n                \n                // Show click-to-play - user must click to lock pointer\n                document.getElementById('clickToPlay').classList.add('active');\n                \n                // Start game loop (cancel any existing one first)\n                if (this.gameLoopId) {\n                    cancelAnimationFrame(this.gameLoopId);\n                }\n                \n                // Force hotbar refresh with delay to ensure DOM is ready\n                setTimeout(() => {\n                    this.updateHotbarDisplay();\n                    this.updateHotbar();\n                }, 50);\n                \n                this.gameLoop();\n            },\n            \n            pause() {\n                if (!this.isActive) return;\n                this.isPaused = true;\n                document.getElementById('pauseMenu').classList.add('active');\n                document.getElementById('gameUI').style.display = 'none';\n                document.getElementById('clickToPlay').classList.remove('active');\n                this.showSubmenu('menuMain');\n                \n                // Exit pointer lock if still locked\n                if (document.pointerLockElement) {\n                    document.exitPointerLock();\n                }\n            },\n            \n            resume() {\n                this.isPaused = false;\n                document.getElementById('pauseMenu').classList.remove('active');\n                document.getElementById('gameUI').style.display = 'flex';\n                \n                // Must show click-to-play because we need a new user gesture to re-lock\n                // (Browser security: can't re-lock immediately after ESC release)\n                document.getElementById('clickToPlay').classList.add('active');\n            },\n            \n            updateFullscreenButton() {\n                const btn = document.getElementById('btnFullscreen');\n                const isFs = document.fullscreenElement || document.webkitFullscreenElement;\n                btn.textContent = isFs ? 'Windowed' : 'Fullscreen';\n                \n                // Update canvas size based on fullscreen state\n                if (isFs) {\n                    this.canvas.width = window.innerWidth;\n                    this.canvas.height = window.innerHeight;\n                } else {\n                    this.canvas.width = 800;\n                    this.canvas.height = 450;\n                }\n            },\n            \n            stop() {\n                // Cancel any pending animation frame\n                if (this.gameLoopId) {\n                    cancelAnimationFrame(this.gameLoopId);\n                    this.gameLoopId = null;\n                }\n                \n                this.isActive = false;\n                this.isPaused = false;\n                this.pointerLocked = false;\n                \n                // Clear runtime resources to free memory\n                this.particles = [];\n                this.fluidUpdates = [];\n                this.fluidUpdateTimer = 0;\n                this.birdPruneTimer = 0;\n                this.inWater = false;\n                this.inLava = false;\n                this.swimming = false;\n                this.headSubmergedWater = false;\n                this.headSubmergedLava = false;\n                \n                // Reset pest bird anger (calm down for next session)\n                if (this.pestBirds) {\n                    for (const pest of this.pestBirds) {\n                        pest.anger = 0;\n                        pest.timesShot = 0;\n                        pest.state = 'circling';\n                    }\n                }\n                \n                // Reset canvas\n                this.canvas.width = 800;\n                this.canvas.height = 450;\n                \n                // Clear the canvas to free GPU memory\n                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n                \n                // Hide UI elements\n                document.getElementById('minecraftGame').classList.remove('active');\n                document.getElementById('pauseMenu').classList.remove('active');\n                document.getElementById('clickToPlay').classList.remove('active');\n                document.getElementById('inventoryScreen').classList.remove('active');\n                this.inventoryOpen = false;\n                (this.canvas as HTMLElement).style.filter = '';\n                \n                // Exit pointer lock\n                if (document.pointerLockElement) {\n                    document.exitPointerLock();\n                }\n                \n                // Exit fullscreen if active\n                if (document.fullscreenElement || document.webkitFullscreenElement) {\n                    if (document.exitFullscreen) {\n                        document.exitFullscreen();\n                    } else if (document.webkitExitFullscreen) {\n                        document.webkitExitFullscreen();\n                    }\n                }\n                \n                // Reset key states to prevent stuck keys\n                this.keys = {};\n                \n                // Unlock page scrolling\n                (document.body as HTMLElement).style.overflow = '';\n                (document.documentElement as HTMLElement).style.overflow = '';\n                \n                // Restore main site animations\n                const petalCanvas = document.getElementById('petalCanvas');\n                if (petalCanvas) (petalCanvas as HTMLElement).style.display = 'block';\n                \n                // Show flame particles container\n                const flameParticles = document.getElementById('flameParticles');\n                if (flameParticles) (flameParticles as HTMLElement).style.visibility = 'visible';\n            }\n};\n\n/**\n * SakuraCraftGame Class\n * Provides a typed class-based interface to the game\n */\nexport class SakuraCraftGame {\n  private _game: ISakuraCraftEngine & Record<string, any>;\n  private _initialized: boolean;\n\n  constructor() {\n    this._game = minecraftGame;\n    this._initialized = false;\n  }\n\n  /**\n   * Initialize the game with options\n   */\n  init(options: SakuraCraftInitOptions = {}): this {\n    // Inject HTML if not present\n    if (!document.getElementById('minecraftGame')) {\n      let container: HTMLElement = document.body;\n      if (options.container) {\n        container = typeof options.container === 'string'\n          ? (document.querySelector(options.container) as HTMLElement) || document.body\n          : options.container;\n      }\n      injectGameHTML(container);\n    }\n    \n    // Initialize the game engine\n    this._game.init();\n    this._initialized = true;\n    \n    // Setup trigger element\n    if (options.trigger) {\n      const triggerEl = typeof options.trigger === 'string'\n        ? document.querySelector(options.trigger) as HTMLElement | null\n        : options.trigger;\n      if (triggerEl) {\n        triggerEl.addEventListener('click', () => this.start());\n        (triggerEl as HTMLElement).style.cursor = 'pointer';\n      }\n    }\n    \n    // Setup close button\n    document.getElementById('closeMinecraft')?.addEventListener('click', () => this.stop());\n    \n    // Setup click to play\n    document.getElementById('clickToPlay')?.addEventListener('click', () => {\n      if (this._game.isActive && !this._game.isPaused && this._game.canvas) {\n        this._game.canvas.requestPointerLock();\n      }\n    });\n    \n    // Cleanup on page unload\n    window.addEventListener('beforeunload', () => {\n      if (this._game.isActive) this.stop();\n    });\n    \n    return this;\n  }\n\n  /**\n   * Start the game\n   */\n  start(): this {\n    if (!this._initialized) {\n      this.init();\n    }\n    this._game.start();\n    return this;\n  }\n\n  /**\n   * Stop the game\n   */\n  stop(): this {\n    this._game.stop();\n    return this;\n  }\n\n  /**\n   * Pause the game\n   */\n  pause(): this {\n    this._game.pause();\n    return this;\n  }\n\n  /**\n   * Resume the game\n   */\n  resume(): this {\n    this._game.resume();\n    return this;\n  }\n\n  /**\n   * Get game stats\n   */\n  getStats(): GameStats {\n    return { ...this._game.stats };\n  }\n\n  /**\n   * Get game settings\n   */\n  get settings(): GameSettings {\n    return this._game.settings;\n  }\n\n  /**\n   * Update game settings\n   */\n  set settings(value: Partial<GameSettings>) {\n    Object.assign(this._game.settings, value);\n  }\n\n  /**\n   * Check if game is active\n   */\n  get isActive(): boolean {\n    return this._game.isActive;\n  }\n\n  /**\n   * Check if game is paused\n   */\n  get isPaused(): boolean {\n    return this._game.isPaused;\n  }\n\n  /**\n   * Get the underlying game engine for advanced usage\n   */\n  get engine(): ISakuraCraftEngine & Record<string, any> {\n    return this._game;\n  }\n}\n\n// Default export\nexport default SakuraCraftGame;\n","/**\n * SakuraCraft - A voxel-based browser game with cherry blossom aesthetics\n * \n * @module SakuraCraft\n * @example\n * // ES Module usage\n * import SakuraCraft from 'sakuracraft';\n * const game = new SakuraCraft();\n * game.init({ trigger: '#playButton' });\n */\n\nimport { SakuraCraftGame, minecraftGame } from './game/SakuraCraftGame';\n\n// Re-export types\nexport type * from './types';\n\n// Export the game class and raw engine\nexport { SakuraCraftGame, minecraftGame };\n\n// Default export is the class\nexport default SakuraCraftGame;\n\n// Auto-expose to window in browser context\ndeclare global {\n  interface Window {\n    SakuraCraft: typeof SakuraCraftGame;\n    SakuraCraftGame: typeof SakuraCraftGame;\n    sakuraCraft?: SakuraCraftGame;\n  }\n}\n\nif (typeof window !== 'undefined') {\n  window.SakuraCraft = SakuraCraftGame;\n  window.SakuraCraftGame = SakuraCraftGame;\n  \n  // Auto-initialize if script has data-auto-init attribute\n  const currentScript = document.currentScript as HTMLScriptElement | null;\n  if (currentScript?.hasAttribute('data-auto-init')) {\n    const trigger = currentScript.getAttribute('data-trigger');\n    document.addEventListener('DOMContentLoaded', () => {\n      const game = new SakuraCraftGame();\n      game.init({ trigger: trigger ?? undefined });\n      window.sakuraCraft = game;\n    });\n  }\n}\n"],"names":["gameTemplate","injectGameHTML","container","wrapper","minecraftGame","perm","i","fade","t","lerp","a","b","grad","hash","x","y","h","u","v","X","Y","A","B","octaves","value","amplitude","frequency","maxValue","worldSize","waterLevel","baseHeight","heightMap","biomeMap","z","n1","n2","distFromCenter","edgeFalloff","height","key","biomeNoise","isBeach","isDesert","ritualChestCount","rx","rz","rKey","rHeight","ritualItem","sx","sz","sKey","sHeight","tree","appleCount","templeX","templeZ","templeKey","templeHeight","buildingTypes","wcdonaldsPlaced","qx","qz","minX","minZ","numBuildings","bx","bz","attempts","groundY","block","h1","h2","h3","h4","type","baseY","dx","dz","dy","steepleX","steepleZ","crossY","row","existingBlock","wX","wZ","wY","chestKey","radius","by","blockX","blockY","blockZ","width","depth","centerX","centerZ","searchRadius","angle","testX","testZ","numBirds","numPests","playerX","playerY","playerZ","birdsCalmed","pest","angerWingBonus","angerSpeedMult","angerRadiusMult","angerSwoopChance","prevX","prevY","prevZ","birdBlock","speed","recoveryThreshold","numToSpawn","newAngle","newRadius","swoopT","pullT","retreatDist","hoverAngle","targetX","targetY","targetZ","smoothing","maxBirdSpeed","moveSpeed","scale","bird","dist","newX","newY","newZ","fish","cat","creeper","force","roll","dropType","dropCount","now","delta","timeLeft","nextEvent","message","event","numCreepers","waterPos","scoreEl","waveEl","objEl","cx","cz","slotIdx","slot","hit","blockType","isChest","contents","item","hitBlock","heldSlot","heldId","fluidType","placePos","px","pz","feetY","headY","wouldCollide","checkY","index","e","invSlot","err","id","toggle","isOn","fps","menuId","m","elapsed","mins","secs","filter","isSelected","canvas","durBar","fill","percent","pitch","yaw","dirX","dirY","dirZ","bulletSpeed","bullet","knockbackForce","hitBird","hitDist","birdDirX","birdDirY","birdDirZ","ricochetSpeed","ry","len","playerKnockback","toBirdX","toBirdZ","toBirdDist","spawnRoll","birdsToSpawn","p","j","gustStrength","gustAngle","currentPetals","maxPetals","petalsToSpawn","spawnRange","spawnChance","spreadX","spreadZ","heightBonus","count","itemType","canAdd","itemDef","itemNames","notification","ctx","colors","w","cy","size","sy","blockSize","topColor","sideColor","rightColor","bobPhase","rotation","s","cosPitch","sinPitch","hasItems","socketType","socketItemMap","filledSocketMap","requiredItem","socket","itemCount","itemId","consoleEl","input","cmd","msg","output","div","parts","command","args","mobType","spawnCount","validMobs","totalKilled","time","outputEl","miniCanvas","level","maxUpdates","processed","fluid","currentBlock","currentLevel","belowBlock","spreadLevel","directions","dir","nx","nz","neighborBlock","neighborLevel","invScreen","getItemName","html","recipe","canCraft","ing","emoji","hasItem","isHeld","tooltip","slots","invContainer","scrollTop","scrollHeight","clientHeight","atTop","atBottom","source","clickedItem","targetSource","targetIndex","newContainer","srcType","srcIdx","destType","destIdx","srcArray","destArray","srcItem","destItem","currentSlot","ingredient","recipeName","r","remaining","remove","add","cosYaw","startOffset","voxelX","voxelY","voxelZ","stepX","stepY","stepZ","tDeltaX","tDeltaY","tDeltaZ","tMaxX","tMaxY","tMaxZ","enteredFace","maxDistance","lastSolidFace","throughWater","throughLava","placeFace","baseSpeed","sin","cos","moveX","moveY","moveZ","canMove","playerFeetY","playerHeadY","feetBlock","waistBlock","headBlock","feetInWater","feetInLava","waistInWater","waistInLava","headInWater","headInLava","inWater","inLava","swimming","submerged","speedMod","walkSpeed","oldX","oldZ","playerRadius","playerHeight","escaped","pushDist","escapeAngles","rad","finalX","finalZ","steps","slideX","slideZ","buoyancy","swimDrag","swimUpSpeed","swimDownSpeed","maxSwimSpeed","ceilingY","checkPoints","point","currentY","startY","renderCamY","skyGrad","camX","camY","camZ","cosY","sinY","cosX","sinX","halfW","halfH","fov","renderDist","renderDistSq","project","blocks","camDirX","camDirZ","worldKeys","distSq","getBlock","isTransparent","getFluidLevel","animTime","opaqueBlocks","transparentBlocks","isBlockOccluded","testPoints","py","pointOccluded","checkX","checkZ","checkBlock","blockColors","visibleTransparent","allBlocks","isFluid","fluidLevel","topY","adjTop","adjBottom","adjFront","adjBack","adjLeft","adjRight","hasTop","hasBottom","hasFront","hasBack","hasLeft","hasRight","myLevel","frontLevel","backLevel","leftLevel","rightLevel","faces","f","face","pts","valid","fillColor","wave1","wave2","wave3","combinedWave","viewDotNormal","F0","fresnel","playerReflection","playerDx","playerDz","playerDistToWater","skyColors","skyIndex","sky","depthFactor","waterR","waterG","waterB","playerColor","reflectStrength","g","sunDir","viewDir","halfVec","halfLen","specularBase","specular","caustic1","caustic2","caustics","brightness","finalR","finalG","finalB","baseAlpha","fresnelAlpha","alpha","glowPhase","glow","bounds","segmentSize","walls","wall","distToWall","minRenderY","perpStart","perpEnd","segX","segZ","corners","yTop","pEnd","c","pt","gridPhase","bottomY","xEnd","zEnd","center","screenSize","wingAngle","wingSpan","wingHeight","anger","angerRed","angerGreen","angerBlue","isSwooping","bodyColor","wingColor","swimOffset","walkBob","occluded","started","tp","bulletSize","sparkle","flicker","bobOffset","baseSize","projected","strokeColor","lineWidth","edges","targetBlock","pulse","alertWidth","alertHeight","alertX","alertY","minutes","seconds","timeStr","baseX","flashSize","flashX","flashY","flameHeight","flameWidth","gradient","screenX","screenY","info","isFilled","centerY","lookDownAmount","bodyY","handX","handY","lookAmount","armGradient","armGradient2","jeansGradient","hex","factor","result","timestamp","targetInterval","debugFps","ts","spawnPos","isSpawnSafe","bodyBlock","feetClear","bodyClear","groundBlock","isDryLand","bestSpawn","maxRadius","spawn","petalCanvas","flameParticles","btn","isFs","SakuraCraftGame","__publicField","options","triggerEl","_a","_b","currentScript","trigger","game"],"mappings":"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"}