{"version":3,"file":"sakuracraft.es.js","sources":["../src/game/SakuraCraftGame.ts","../src/index.ts"],"sourcesContent":["/**\n * SakuraCraft Game Engine\n * A voxel-based browser game with cherry blossom aesthetics\n * \n * TypeScript version with full type annotations\n */\n\nimport type {\n  GameStats,\n  GameSettings,\n  SakuraCraftInitOptions,\n  ISakuraCraftEngine\n} from '../types';\n\nimport '../styles/game.css';\n\n// Extend Document and HTMLElement interfaces for webkit fullscreen APIs\ndeclare global {\n  interface Document {\n    webkitFullscreenElement?: Element;\n    webkitExitFullscreen?: () => Promise<void>;\n  }\n  \n  interface HTMLElement {\n    webkitRequestFullscreen?: () => Promise<void>;\n  }\n}\n\n// Game HTML template\nconst gameTemplate = `\n<!-- SakuraCraft Game HTML Template -->\n<!-- This file is inserted into the DOM when the game initializes -->\n\n<div class=\"minecraft-overlay\" id=\"minecraftGame\">\n  <div class=\"minecraft-title\">üå∏ SakuraCraft üå∏</div>\n  <div class=\"minecraft-container\">\n    <button class=\"minecraft-close\" id=\"closeMinecraft\">‚úï Close</button>\n    <canvas id=\"gameCanvas\" class=\"minecraft-canvas\" width=\"800\" height=\"500\"></canvas>\n    \n    <!-- Click to Play Overlay (required for pointer lock) -->\n    <div class=\"click-to-play active\" id=\"clickToPlay\">\n      <div class=\"click-to-play-text\">üéÆ Click to Play</div>\n      <div class=\"click-to-play-hint\">Mouse will be captured ‚Ä¢ Press ESC to pause</div>\n    </div>\n    \n    <!-- Pause Menu -->\n    <div class=\"pause-menu\" id=\"pauseMenu\">\n      <!-- Main Menu -->\n      <div class=\"pause-submenu active\" id=\"menuMain\">\n        <div class=\"pause-title\">‚è∏ Paused</div>\n        <div class=\"pause-buttons\">\n          <button class=\"pause-btn resume\" id=\"btnResume\">Resume</button>\n          <button class=\"pause-btn fullscreen\" id=\"btnFullscreen\">Fullscreen</button>\n          <button class=\"pause-btn disabled\" id=\"btnAccount\">Sign In</button>\n          <button class=\"pause-btn\" id=\"btnStats\">Stats</button>\n          <button class=\"pause-btn\" id=\"btnOptions\">Options</button>\n          <button class=\"pause-btn quit\" id=\"btnQuit\">Quit Game</button>\n        </div>\n      </div>\n      \n      <!-- Stats Menu -->\n      <div class=\"pause-submenu\" id=\"menuStats\">\n        <div class=\"submenu-title\">üìä Statistics</div>\n        <div class=\"submenu-content\">\n          <div class=\"stat-row\">\n            <span>Blocks Placed</span>\n            <span class=\"stat-value\" id=\"statPlaced\">0</span>\n          </div>\n          <div class=\"stat-row\">\n            <span>Blocks Broken</span>\n            <span class=\"stat-value\" id=\"statBroken\">0</span>\n          </div>\n          <div class=\"stat-row\">\n            <span>Distance Walked</span>\n            <span class=\"stat-value\" id=\"statDistance\">0m</span>\n          </div>\n          <div class=\"stat-row\">\n            <span>Jumps</span>\n            <span class=\"stat-value\" id=\"statJumps\">0</span>\n          </div>\n          <div class=\"stat-row\">\n            <span>Play Time</span>\n            <span class=\"stat-value\" id=\"statTime\">0:00</span>\n          </div>\n        </div>\n        <button class=\"back-btn\" id=\"statsBack\">‚Üê Back</button>\n      </div>\n      \n      <!-- Options Menu -->\n      <div class=\"pause-submenu\" id=\"menuOptions\">\n        <div class=\"submenu-title\">‚öôÔ∏è Options</div>\n        <div class=\"submenu-content\">\n          <div class=\"option-row\">\n            <span>Brightness</span>\n            <input type=\"range\" class=\"option-slider\" id=\"optBrightness\" min=\"50\" max=\"150\" value=\"100\">\n          </div>\n          <div class=\"option-row\">\n            <span>Color Filter</span>\n            <select class=\"option-select\" id=\"optFilter\">\n              <option value=\"none\">Normal</option>\n              <option value=\"sepia\">Sepia</option>\n              <option value=\"grayscale\">Black & White</option>\n              <option value=\"trippy\">Trippy Hyperbolic</option>\n            </select>\n          </div>\n          <div class=\"option-row\">\n            <span>Render Distance</span>\n            <select class=\"option-select\" id=\"optRenderDist\">\n              <option value=\"12\">Near (Fast)</option>\n              <option value=\"18\">Medium</option>\n              <option value=\"25\" selected>Far</option>\n              <option value=\"35\">Ultra</option>\n            </select>\n          </div>\n          <div class=\"option-row\">\n            <span>Shadows</span>\n            <div class=\"option-toggle on\" id=\"optShadows\" data-on=\"true\"></div>\n          </div>\n          <div class=\"option-row\">\n            <span>Enhanced Lighting</span>\n            <div class=\"option-toggle on\" id=\"optLighting\" data-on=\"true\"></div>\n          </div>\n          <div class=\"option-row\">\n            <span>Anti-Aliasing</span>\n            <div class=\"option-toggle\" id=\"optAA\" data-on=\"false\"></div>\n          </div>\n          <div class=\"option-row\">\n            <span>Show FPS</span>\n            <div class=\"option-toggle on\" id=\"optShowFps\" data-on=\"true\"></div>\n          </div>\n          <div class=\"option-row\">\n            <span>Target FPS: <span id=\"targetFpsValue\">60</span></span>\n            <input type=\"range\" min=\"15\" max=\"240\" value=\"60\" class=\"option-slider\" id=\"optTargetFps\">\n          </div>\n        </div>\n        <button class=\"back-btn\" id=\"optionsBack\">‚Üê Back</button>\n      </div>\n    </div>\n    \n    <!-- Inventory Screen -->\n    <div class=\"inventory-screen\" id=\"inventoryScreen\">\n      <!-- Content populated by JavaScript -->\n    </div>\n    \n    <div class=\"minecraft-ui\" id=\"gameUI\">\n      <div class=\"hotbar-slot selected\" data-block=\"grass\"></div>\n      <div class=\"hotbar-slot\" data-block=\"dirt\"></div>\n      <div class=\"hotbar-slot\" data-block=\"stone\"></div>\n      <div class=\"hotbar-slot\" data-block=\"wood\"></div>\n      <div class=\"hotbar-slot\" data-block=\"brick\"></div>\n      <div class=\"hotbar-slot\" data-item=\"water_bucket\"></div>\n      <div class=\"hotbar-slot\" data-item=\"lava_bucket\"></div>\n      <div class=\"hotbar-slot\" data-item=\"ka69\"></div>\n      <div class=\"hotbar-slot\" data-empty=\"true\"></div>\n    </div>\n    <div class=\"pickup-notification\" id=\"pickupNotification\"></div>\n    \n    <!-- Survival HUD -->\n    <div id=\"survivalHUD\" style=\"position:absolute;top:10px;left:10px;color:#fff;font-family:monospace;font-size:14px;text-shadow:1px 1px 2px #000;pointer-events:none;\">\n      <div id=\"scoreDisplay\">Score: 0</div>\n      <div id=\"waveDisplay\">Wave: 1</div>\n      <div id=\"objectiveDisplay\"></div>\n    </div>\n    \n    <!-- Debug Console -->\n    <div class=\"debug-console\" id=\"debugConsole\">\n      <div class=\"debug-console-header\">\n        <span>Debug Console (\\` to toggle)</span>\n        <span id=\"debugFps\">0 FPS</span>\n      </div>\n      <div class=\"debug-console-output\" id=\"debugOutput\"></div>\n      <div class=\"debug-console-input\">\n        <span>&gt;</span>\n        <input type=\"text\" id=\"debugInput\" placeholder=\"Type command...\">\n      </div>\n    </div>\n    \n    <!-- Block Tooltip -->\n    <div class=\"block-tooltip\" id=\"blockTooltip\">\n      <div class=\"tooltip-title\"></div>\n      <div class=\"tooltip-desc\"></div>\n    </div>\n  </div>\n  <div class=\"minecraft-instructions\">\n    WASD move | SPACE jump/swim | SHIFT swim down | Q drop | R ritual | SCROLL hotbar | LEFT break | RIGHT use/place | E inventory | \\` debug\n  </div>\n</div>\n`;\n\n/**\n * Inject the game HTML into the DOM\n */\nfunction injectGameHTML(container: HTMLElement = document.body): void {\n  const wrapper = document.createElement('div');\n  wrapper.innerHTML = gameTemplate;\n  while (wrapper.firstChild) {\n    container.appendChild(wrapper.firstChild);\n  }\n}\n\n/**\n * The core game engine object with type annotations\n * Using 'any' for complex internal state to maintain compatibility\n */\nexport const minecraftGame: ISakuraCraftEngine & Record<string, any> = {\n            canvas: null,\n            ctx: null,\n            isActive: false,\n            isPaused: false,\n            camera: { x: 0, y: 5, z: 0, rotX: 0, rotY: 0, sneaking: false, normalHeight: 0.6, sneakHeight: 0.2 },\n            velocity: { x: 0, y: 0, z: 0 },\n            world: {},\n            keys: {},\n            isJumping: false,\n            gravity: -0.035,  // Stronger gravity for snappier jumps\n            lastPos: { x: 0, z: 0 },\n            pointerLocked: false,\n            \n            // Fluid state\n            inWater: false,\n            inLava: false,\n            swimming: false,\n            headSubmergedWater: false,\n            headSubmergedLava: false,\n            \n            // Player dimensions - camera at waist/hip level\n            playerEyeHeight: 1.2,  // How high camera is above feet\n            playerHeight: 1.8,     // Total player height\n            \n            // Birds and mobs\n            birds: [],\n            pestBirds: [],\n            blueBirds: [],\n            fish: [],\n            cats: [],\n            creepers: [],\n            \n            // Dialogue and Quest System\n            dialogueOpen: false,\n            currentDialogueNPC: null,\n            journalOpen: false,\n            quests: [],  // Active and completed quests\n            questData: {\n                // Gunsmith questline\n                'meet_gunsmith': {\n                    id: 'meet_gunsmith',\n                    title: 'The Mysterious Wizard',\n                    description: 'A wandering gunsmith has appeared! Perhaps he knows something about the bird invasion?',\n                    objectives: ['Speak with the Gunsmith'],\n                    status: 'active',  // active, completed, failed\n                    stage: 0,  // 0 = not started, 1 = in progress, 2 = completed\n                    reward: null\n                },\n                'birds_origin': {\n                    id: 'birds_origin',\n                    title: 'Origin of the Feathered Menace',\n                    description: 'The Gunsmith believes there\\'s a source to this madness. Find clues about where these birds are coming from.',\n                    objectives: [\n                        'Survive 3 bird waves',\n                        'Collect 50 bird drops',\n                        'Return to the Gunsmith'\n                    ],\n                    status: 'locked',  // Not started yet\n                    stage: 0,\n                    progress: { waves: 0, drops: 0, returned: false },\n                    reward: 'Ancient Map Fragment'\n                }\n            },\n            \n            // Gunsmith dialogue state\n            gunsmithDialogueStage: 0,  // Tracks conversation progress\n            gunsmithMetBefore: false,  // Has player met them?\n            \n            // Items and inventory\n            selectedSlot: 0,  // 0-8 for hotbar slots\n            selectedBlock: 'grass',\n            selectedItem: null,  // For non-block items like ka69\n            hotbarTooltip: { visible: false, text: '', timestamp: 0 },  // Tooltip when scrolling hotbar\n            \n            // Inventory system\n            inventory: {\n                // Hotbar slots (9 slots)\n                hotbar: [\n                    { type: 'block', id: 'grass', count: 64 },\n                    { type: 'block', id: 'dirt', count: 64 },\n                    { type: 'block', id: 'stone', count: 64 },\n                    { type: 'block', id: 'wood', count: 64 },\n                    { type: 'block', id: 'brick', count: 64 },\n                    { type: 'bucket', id: 'water_bucket', count: 5 },\n                    { type: 'bucket', id: 'lava_bucket', count: 5 },\n                    { type: 'weapon', id: 'ka69', count: 1, durability: 100, maxDurability: 100 },\n                    null  // Empty slot\n                ],\n                // Main inventory (27 slots - 3 rows of 9)\n                main: [\n                    { type: 'block', id: 'leaves', count: 64 },\n                    { type: 'block', id: 'sand', count: 64 },\n                    null, null, null, null, null, null, null,\n                    null, null, null, null, null, null, null, null, null,\n                    null, null, null, null, null, null, null, null, null\n                ],\n                // Crafting result\n                craftingResult: null\n            },\n            \n            // Crafting recipes\n            recipes: [\n                { ingredients: [{ id: 'wood', count: 4 }], result: { type: 'block', id: 'wood', count: 16 }, name: 'Planks' },\n                { ingredients: [{ id: 'stone', count: 8 }], result: { type: 'block', id: 'brick', count: 4 }, name: 'Bricks' },\n                { ingredients: [{ id: 'sand', count: 4 }], result: { type: 'block', id: 'stone', count: 2 }, name: 'Sandstone' },\n                { ingredients: [{ id: 'wood', count: 8 }], result: { type: 'block', id: 'chest', count: 1 }, name: 'Chest' }\n            ],\n            \n            // Fluid blocks that need updating\n            fluidUpdates: [],\n            fluidLevels: {},  // Stores fluid level 1-8 at each position\n            fluidUpdateTimer: 0,\n            \n            // Bird anger system\n            birdPruneTimer: 0,\n            \n            // Weapon properties\n            shootCooldown: 0,\n            muzzleFlash: 0,\n            particles: [],  // Bullet particles\n            \n            // UI state\n            inventoryOpen: false,\n            draggedItem: null,\n            dragSource: null,\n            \n            // Stats\n            stats: {\n                blocksPlaced: 0,\n                blocksBroken: 0,\n                distance: 0,\n                jumps: 0,\n                startTime: 0\n            },\n            \n            // Graphics settings\n            settings: {\n                brightness: 100,\n                filter: 'none',\n                renderDistance: 20,\n                shadows: true,\n                lighting: true,\n                antialiasing: false,\n                showFps: true,\n                targetFps: 60\n            },\n            \n            // FPS tracking\n            fpsCounter: {\n                frames: 0,\n                lastTime: 0,\n                fps: 0\n            },\n            \n            // Simple 2D noise function (value noise with interpolation)\n            noise2D: (function() {\n                // Permutation table\n                const perm = [];\n                for (let i = 0; i < 512; i++) {\n                    perm[i] = Math.floor(Math.random() * 256);\n                }\n                \n                function fade(t) { return t * t * t * (t * (t * 6 - 15) + 10); }\n                function lerp(a, b, t) { return a + t * (b - a); }\n                function grad(hash, x, y) {\n                    const h = hash & 3;\n                    const u = h < 2 ? x : y;\n                    const v = h < 2 ? y : x;\n                    return ((h & 1) ? -u : u) + ((h & 2) ? -v : v);\n                }\n                \n                return function(x, y) {\n                    const X = Math.floor(x) & 255;\n                    const Y = Math.floor(y) & 255;\n                    x -= Math.floor(x);\n                    y -= Math.floor(y);\n                    const u = fade(x);\n                    const v = fade(y);\n                    const A = perm[X] + Y;\n                    const B = perm[X + 1] + Y;\n                    return lerp(\n                        lerp(grad(perm[A], x, y), grad(perm[B], x - 1, y), u),\n                        lerp(grad(perm[A + 1], x, y - 1), grad(perm[B + 1], x - 1, y - 1), u),\n                        v\n                    );\n                };\n            })(),\n            \n            // Fractal Brownian Motion for more natural terrain\n            fbm(x, y, octaves = 4) {\n                let value = 0;\n                let amplitude = 1;\n                let frequency = 1;\n                let maxValue = 0;\n                \n                for (let i = 0; i < octaves; i++) {\n                    value += this.noise2D(x * frequency, y * frequency) * amplitude;\n                    maxValue += amplitude;\n                    amplitude *= 0.5;\n                    frequency *= 2;\n                }\n                \n                return value / maxValue;\n            },\n            \n            blockColors: {\n                grass: { top: '#7cba5f', side: '#8b6b4a', bottom: '#6b4423', useTexture: true, texture: 'grass' },\n                dirt: { top: '#8b6b4a', side: '#8b6b4a', bottom: '#8b6b4a', useTexture: true, texture: 'dirt' },\n                stone: { top: '#888888', side: '#777777', bottom: '#666666' },\n                wood: { top: '#a0825a', side: '#6b4423', bottom: '#6b4423', useTexture: true, texture: 'wood' },\n                leaves: { top: 'rgba(50, 180, 50, 0.85)', side: 'rgba(40, 160, 40, 0.85)', bottom: 'rgba(30, 140, 30, 0.85)', transparent: true, useTexture: true, texture: 'leaves' },\n                appleLeaves: { top: 'rgba(50, 180, 50, 0.85)', side: 'rgba(40, 160, 40, 0.85)', bottom: 'rgba(30, 140, 30, 0.85)', transparent: true, useTexture: true, texture: 'leaves' },\n                water: { top: 'rgba(74, 144, 217, 0.7)', side: 'rgba(58, 128, 201, 0.7)', bottom: 'rgba(42, 112, 185, 0.7)', transparent: true, animated: true },\n                sand: { top: '#e6d9a0', side: '#d9cc93', bottom: '#ccbf86' },\n                brick: { top: '#b35050', side: '#a04040', bottom: '#903030', useTexture: true, texture: 'brick' },\n                lava: { top: '#ff6600', side: '#ff4400', bottom: '#cc3300', animated: true },\n                obsidian: { top: '#1a0a2e', side: '#140820', bottom: '#0a0410' },\n                cherryWood: { top: '#c4a07a', side: '#8b5a5a', bottom: '#8b5a5a', useTexture: true, texture: 'wood' },\n                cherryLeaves: { top: 'rgba(255, 183, 197, 0.85)', side: 'rgba(255, 192, 203, 0.85)', bottom: 'rgba(255, 144, 165, 0.85)', transparent: true },\n                chest: { top: '#8b6914', side: '#a0780a', bottom: '#705010' },\n                ritualChest: { top: '#4a0080', side: '#6a00b0', bottom: '#300060' },\n                buildingChest: { top: '#c0c0c0', side: '#a0a0a0', bottom: '#808080' },\n                // Ritual Temple blocks\n                ritualStone: { top: '#4a4a6a', side: '#3a3a5a', bottom: '#2a2a4a' },\n                petalSocket: { top: '#ffb7c5', side: '#8b5a5a', bottom: '#5a3a3a' },\n                ropeSocket: { top: '#8b7355', side: '#6b5a45', bottom: '#4b3a25' },\n                charmSocket: { top: '#ffd700', side: '#daa520', bottom: '#b8860b' },\n                plaqueSocket: { top: '#deb887', side: '#c4a07a', bottom: '#8b7355' },\n                incenseSocket: { top: '#9370db', side: '#7b68ee', bottom: '#6a5acd' },\n                // Filled socket blocks (glowing versions)\n                petalSocketFilled: { top: '#ff69b4', side: '#ff1493', bottom: '#c71585' },\n                ropeSocketFilled: { top: '#daa520', side: '#b8860b', bottom: '#8b6914' },\n                charmSocketFilled: { top: '#fff700', side: '#ffd700', bottom: '#ffb700' },\n                plaqueSocketFilled: { top: '#f4a460', side: '#d2691e', bottom: '#a0522d' },\n                incenseSocketFilled: { top: '#da70d6', side: '#ba55d3', bottom: '#9932cc' },\n                // Church blocks\n                whiteBrick: { top: '#f0f0f0', side: '#e0e0e0', bottom: '#d0d0d0' },\n                redBrick: { top: '#b35050', side: '#a04040', bottom: '#903030' },\n                glowstone: { top: '#ffdd88', side: '#eebb66', bottom: '#ddaa44' }\n            },\n            \n            // Texture cache for procedurally generated patterns\n            textureCache: {},\n            \n            // Item definitions with properties\n            itemTypes: {\n                // Building materials\n                grass: { stackable: true, maxStack: 64 },\n                dirt: { stackable: true, maxStack: 64 },\n                stone: { stackable: true, maxStack: 64 },\n                wood: { stackable: true, maxStack: 64 },\n                leaves: { stackable: true, maxStack: 64 },\n                appleLeaves: { stackable: true, maxStack: 64 },\n                sand: { stackable: true, maxStack: 64 },\n                brick: { stackable: true, maxStack: 64 },\n                cherryWood: { stackable: true, maxStack: 64 },\n                cherryLeaves: { stackable: true, maxStack: 64 },\n                chest: { stackable: true, maxStack: 16 },\n                obsidian: { stackable: true, maxStack: 64 },\n                whiteBrick: { stackable: true, maxStack: 64 },\n                redBrick: { stackable: true, maxStack: 64 },\n                glowstone: { stackable: true, maxStack: 64 },\n                ritualStone: { stackable: true, maxStack: 64 },\n                // Consumables/Throwables\n                apple: { stackable: true, maxStack: 64, throwable: true, description: 'Throw at birds to knock them away' },\n                // Buckets\n                water_bucket: { stackable: true, maxStack: 16 },\n                lava_bucket: { stackable: true, maxStack: 16 },\n                // Tools with durability\n                ka69: { stackable: false, maxStack: 1, durability: 100, maxDurability: 100, description: 'Shoots bullets at birds' },\n                seeds: { stackable: true, maxStack: 64, description: 'Calms angry birds temporarily' },\n                berdger: { stackable: false, maxStack: 1, invincible: true, description: 'The legendary bird repellent - infinite uses!' },\n                // Ritual items (Omamori charm components)\n                sakuraPetal: { stackable: true, maxStack: 16, description: 'Sacred cherry blossom petal', ritual: true },\n                shimenawa: { stackable: true, maxStack: 1, description: 'Sacred rope', ritual: true },\n                omamori: { stackable: true, maxStack: 1, description: 'Protective charm base', ritual: true },\n                ema: { stackable: true, maxStack: 1, description: 'Wooden wish plaque', ritual: true },\n                incense: { stackable: true, maxStack: 1, description: 'Purifying incense', ritual: true }\n            },\n            \n            // Fluids that player can pass through\n            fluidBlocks: ['water', 'lava'],\n            \n            // Ritual system - Omamori Blessing (Japanese protective charm ritual)\n            ritualItems: ['sakuraPetal', 'shimenawa', 'omamori', 'ema', 'incense'],\n            ritualComplete: false,\n            ritualBlessingActive: false,\n            ritualBlessingTimer: 0,\n            ritualFlight: false,\n            ritualFlightTimer: 0,\n            ritualBarrierActive: false,\n            \n            init() {\n                // Lightweight init - just get canvas reference\n                // World generation is deferred to start() to avoid lagging main site\n                this.canvas = document.getElementById('gameCanvas');\n                this.ctx = this.canvas.getContext('2d', {\n                    alpha: false,  // No transparency = better performance\n                    desynchronized: true  // Hint for performance\n                });\n                \n                // RENDERING QUALITY IMPROVEMENTS\n                // Enable anti-aliasing and high-quality rendering\n                this.ctx.imageSmoothingEnabled = true;\n                this.ctx.imageSmoothingQuality = 'high';\n                \n                this.initialized = false;  // Track if world has been generated\n                this.gameLoopId = null;    // Track animation frame for cleanup\n                this.lastFrameTime = 0;    // For FPS limiting\n            },\n            \n            // Full initialization - called only when game starts\n            fullInit() {\n                if (this.initialized) return;  // Don't regenerate if already done\n                \n                this.generateWorld();\n                this.setupControls();\n                this.setupMenus();\n                this.setupDebugConsole();\n                this.initialized = true;\n                \n                // Force initial hotbar render with multiple attempts for reliability\n                this.updateHotbarDisplay();\n                setTimeout(() => this.updateHotbarDisplay(), 50);\n                setTimeout(() => this.updateHotbarDisplay(), 150);\n                setTimeout(() => this.updateHotbarDisplay(), 300);\n            },\n            \n            generateWorld() {\n                this.world = {};\n                this.fluidLevels = {};  // Clear fluid levels\n                this.droppedItems = []; // Items on ground\n                this.cherryTrees = [];  // Cherry blossom tree locations\n                this.petalParticles = []; // Cherry blossom petals\n                \n                const worldSize = 50; // -50 to 50 = 101x101 blocks\n                const waterLevel = 6;\n                const baseHeight = 8;\n                \n                // Store world bounds for forcefield - ON the last block, not past it\n                this.worldBounds = {\n                    minX: -worldSize,\n                    maxX: worldSize + 1,\n                    minZ: -worldSize,\n                    maxZ: worldSize + 1,\n                    minY: 0,\n                    maxY: 50\n                };\n                \n                // Wind system for petals and birds\n                this.wind = {\n                    x: 0,\n                    z: 0,\n                    targetX: 0,\n                    targetZ: 0,\n                    gustTimer: 0,\n                    strength: 0.02\n                };\n                \n                // Building placements storage\n                this.buildings = [];\n                \n                // Fluid simulation queue\n                this.fluidQueue = [];\n                \n                // Pre-calculate height map for faster generation\n                const heightMap = {};\n                const biomeMap = {};\n                \n                // First pass: calculate heights\n                for (let x = -worldSize; x <= worldSize; x++) {\n                    for (let z = -worldSize; z <= worldSize; z++) {\n                        const n1 = this.fbm(x * 0.03, z * 0.03, 2) * 10;\n                        const n2 = this.fbm(x * 0.05 + 100, z * 0.05 + 100, 2) * 5;\n                        \n                        const distFromCenter = Math.sqrt(x * x + z * z) / worldSize;\n                        const edgeFalloff = Math.max(0, 1 - distFromCenter * 0.5);\n                        \n                        let height = Math.floor(baseHeight + (n1 + n2) * edgeFalloff);\n                        height = Math.max(1, Math.min(22, height));\n                        \n                        const key = `${x},${z}`;\n                        heightMap[key] = height;\n                        biomeMap[key] = this.noise2D(x * 0.03 + 500, z * 0.03 + 500);\n                    }\n                }\n                \n                // Second pass: generate blocks using cached heights\n                for (let x = -worldSize; x <= worldSize; x++) {\n                    for (let z = -worldSize; z <= worldSize; z++) {\n                        const key = `${x},${z}`;\n                        const height = heightMap[key];\n                        const biomeNoise = biomeMap[key];\n                        \n                        const isBeach = height <= waterLevel + 1 && height >= waterLevel - 1;\n                        const isDesert = biomeNoise > 0.3 && height > waterLevel + 2;\n                        \n                        // Generate column - only surface blocks for speed\n                        // Just 3 layers of stone at bottom\n                        for (let y = Math.max(0, height - 3); y < height - 1; y++) {\n                            this.setBlock(x, y, z, 'stone');\n                        }\n                        \n                        // Surface layers based on biome\n                        if (isBeach || (height <= waterLevel)) {\n                            this.setBlock(x, height - 1, z, 'sand');\n                            this.setBlock(x, height, z, 'sand');\n                        } else if (isDesert) {\n                            this.setBlock(x, height - 1, z, 'sand');\n                            this.setBlock(x, height, z, 'sand');\n                        } else {\n                            this.setBlock(x, height - 1, z, 'dirt');\n                            this.setBlock(x, height, z, 'grass');\n                        }\n                        \n                        // Water - source blocks at full level\n                        if (height < waterLevel) {\n                            for (let y = height + 1; y <= waterLevel; y++) {\n                                this.setBlock(x, y, z, 'water');\n                                this.setFluidLevel(x, y, z, 8);  // Full level for natural water\n                            }\n                        }\n                    }\n                }\n                \n                // Trees - separate pass, sparser\n                for (let x = -worldSize; x <= worldSize; x += 2) { // Skip every other for speed\n                    for (let z = -worldSize; z <= worldSize; z += 2) {\n                        const key = `${x},${z}`;\n                        const height = heightMap[key];\n                        const biomeNoise = biomeMap[key];\n                        const isBeach = height <= waterLevel + 1;\n                        const isDesert = biomeNoise > 0.3;\n                        \n                        if (height > waterLevel + 1 && !isDesert && !isBeach) {\n                            const treeNoise = this.noise2D(x * 0.4 + 300, z * 0.4 + 300);\n                            if (treeNoise > 0.5 && Math.random() < 0.12) {\n                                // Check if area is clear (no overlapping structures) AND within bounds\n                                const treeSize = 5;\n                                const treeX = x - 2;\n                                const treeZ = z - 2;\n                                \n                                // Check if tree would be within world bounds\n                                const inBounds = this.worldBounds && \n                                    treeX >= this.worldBounds.minX + 2 &&\n                                    treeX + treeSize <= this.worldBounds.maxX - 2 &&\n                                    treeZ >= this.worldBounds.minZ + 2 &&\n                                    treeZ + treeSize <= this.worldBounds.maxZ - 2;\n                                \n                                if (inBounds && !this.checkStructureCollision(treeX, height + 1, treeZ, treeSize, 8, treeSize)) {\n                                    // 25% chance for cherry blossom tree\n                                    if (Math.random() < 0.25) {\n                                        this.generateCherryTree(x, height + 1, z);\n                                    } else {\n                                        this.generateTree(x, height + 1, z);\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n                \n                // Spawn ritual item chests (rare, ~5 in world)\n                const ritualChestCount = 5;\n                for (let i = 0; i < ritualChestCount; i++) {\n                    const rx = Math.floor(Math.random() * worldSize * 2) - worldSize;\n                    const rz = Math.floor(Math.random() * worldSize * 2) - worldSize;\n                    const rKey = `${rx},${rz}`;\n                    const rHeight = heightMap[rKey] || baseHeight;\n                    if (rHeight > waterLevel) {\n                        this.setBlock(rx, rHeight + 1, rz, 'ritualChest');\n                        // Store chest contents\n                        const ritualItem = this.ritualItems[i % this.ritualItems.length];\n                        this.chestContents = this.chestContents || {};\n                        this.chestContents[`${rx},${rHeight + 1},${rz}`] = [\n                            { type: ritualItem, count: 1 }\n                        ];\n                    }\n                }\n                \n                // Spawn seeds around the world (uncommon ground items)\n                for (let i = 0; i < 30; i++) {\n                    const sx = Math.floor(Math.random() * worldSize * 2) - worldSize;\n                    const sz = Math.floor(Math.random() * worldSize * 2) - worldSize;\n                    const sKey = `${sx},${sz}`;\n                    const sHeight = heightMap[sKey] || baseHeight;\n                    if (sHeight > waterLevel) {\n                        this.droppedItems.push({\n                            x: sx + 0.5,\n                            y: sHeight + 1.2,\n                            z: sz + 0.5,\n                            type: 'seeds',\n                            count: 1 + Math.floor(Math.random() * 3),\n                            bobPhase: Math.random() * Math.PI * 2\n                        });\n                    }\n                }\n                \n                // Spawn apples under apple trees\n                if (this.appleTrees) {\n                    for (const tree of this.appleTrees) {\n                        // 50% chance of apples under each tree\n                        if (Math.random() < 0.5) {\n                            const appleCount = 1 + Math.floor(Math.random() * 3);\n                            for (let i = 0; i < appleCount; i++) {\n                                this.droppedItems.push({\n                                    x: tree.x + (Math.random() - 0.5) * 4,\n                                    y: tree.y - 3,\n                                    z: tree.z + (Math.random() - 0.5) * 4,\n                                    type: 'apple',\n                                    count: 1,\n                                    bobPhase: Math.random() * Math.PI * 2\n                                });\n                            }\n                        }\n                    }\n                }\n                \n                // Generate buildings\n                this.generateBuildings(worldSize);\n                \n                // Generate ONE Ritual Temple in a random far location\n                let templeX, templeZ;\n                do {\n                    templeX = Math.floor(Math.random() * (worldSize - 20)) + 15;\n                    templeZ = Math.floor(Math.random() * (worldSize - 20)) + 15;\n                    if (Math.random() < 0.5) templeX = -templeX;\n                    if (Math.random() < 0.5) templeZ = -templeZ;\n                } while (Math.abs(templeX) < 20 || Math.abs(templeZ) < 20);\n                \n                const templeKey = `${templeX},${templeZ}`;\n                const templeHeight = heightMap[templeKey] || baseHeight;\n                this.generateRitualTemple(templeX, templeHeight + 1, templeZ);\n                \n                // Initialize birds\n                this.initBirds();\n                this.initPestBirds();\n            },\n            \n            generateBuildings(worldSize) {\n                // Building types\n                const buildingTypes = ['church', 'house1', 'house2', 'house3', 'grocery', 'wcdonalds'];\n                \n                // Quadrant-based generation: 2-6 buildings per 25x25 area\n                const quadrantSize = 25;\n                let wcdonaldsPlaced = false;\n                \n                for (let qx = -Math.floor(worldSize / quadrantSize); qx <= Math.floor(worldSize / quadrantSize); qx++) {\n                    for (let qz = -Math.floor(worldSize / quadrantSize); qz <= Math.floor(worldSize / quadrantSize); qz++) {\n                        // Skip center quadrant (spawn area)\n                        if (qx === 0 && qz === 0) continue;\n                        \n                        const minX = qx * quadrantSize;\n                        const minZ = qz * quadrantSize;\n                        \n                        // 2-6 buildings per quadrant\n                        const numBuildings = 2 + Math.floor(Math.random() * 5);\n                        \n                        for (let i = 0; i < numBuildings; i++) {\n                            const bx = minX + 3 + Math.floor(Math.random() * (quadrantSize - 6));\n                            const bz = minZ + 3 + Math.floor(Math.random() * (quadrantSize - 6));\n                            \n                            // Force WcDonald's if not placed yet and this is a good spot\n                            if (!wcdonaldsPlaced && Math.random() < 0.3) {\n                                if (this.tryPlaceBuilding(bx, bz, ['wcdonalds'])) {\n                                    wcdonaldsPlaced = true;\n                                    continue;\n                                }\n                            }\n                            \n                            this.tryPlaceBuilding(bx, bz, buildingTypes);\n                        }\n                    }\n                }\n                \n                // Guarantee at least one WcDonald's if not placed\n                if (!wcdonaldsPlaced) {\n                    for (let attempts = 0; attempts < 50; attempts++) {\n                        const bx = 25 + Math.floor(Math.random() * 20);\n                        const bz = 25 + Math.floor(Math.random() * 20);\n                        if (this.tryPlaceBuilding(bx, bz, ['wcdonalds'])) {\n                            break;\n                        }\n                    }\n                }\n            },\n            \n            tryPlaceBuilding(x, z, buildingTypes) {\n                // Check world bounds - don't spawn near forcefield\n                if (this.worldBounds) {\n                    const buffer = 10; // Stay 10 blocks away from forcefield\n                    const bounds = this.worldBounds;\n                    if (x < bounds.minX + buffer || x > bounds.maxX - buffer ||\n                        z < bounds.minZ + buffer || z > bounds.maxZ - buffer) {\n                        return false; // Too close to world edge\n                    }\n                }\n                \n                const groundY = this.getHighestBlock(x, z);\n                if (!groundY || groundY < 7) return false;\n                \n                const block = this.getBlock(x, groundY, z);\n                if (block === 'water' || block === 'sand') return false;\n                \n                // Quick flatness check\n                const h1 = this.getHighestBlock(x + 3, z) || groundY;\n                const h2 = this.getHighestBlock(x - 3, z) || groundY;\n                const h3 = this.getHighestBlock(x, z + 3) || groundY;\n                const h4 = this.getHighestBlock(x, z - 3) || groundY;\n                if (Math.max(Math.abs(h1 - groundY), Math.abs(h2 - groundY), Math.abs(h3 - groundY), Math.abs(h4 - groundY)) > 2) return false;\n                \n                // Check overlap\n                for (const b of this.buildings) {\n                    if (Math.sqrt((x - b.x) ** 2 + (z - b.z) ** 2) < 15) return false;\n                }\n                \n                const type = buildingTypes[Math.floor(Math.random() * buildingTypes.length)];\n                const baseY = groundY + 1;\n                \n                this.buildings.push({ x, z, type, y: baseY });\n                \n                switch (type) {\n                    case 'church': this.generateChurch(x, baseY, z); break;\n                    case 'house1': this.generateHouse1(x, baseY, z); break;\n                    case 'house2': this.generateHouse2(x, baseY, z); break;\n                    case 'house3': this.generateHouse3(x, baseY, z); break;\n                    case 'grocery': this.generateGrocery(x, baseY, z); break;\n                    case 'wcdonalds': this.generateWcDonalds(x, baseY, z); break;\n                }\n                return true;\n            },\n            \n            // Ruined Church - tall with steeple and intact cross\n            generateChurch(x, y, z) {\n                const w = 7, d = 12, h = 8;\n                const ruinFactor = 0.3; // 30% of blocks are missing\n                \n                // Floor\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'stone');\n                    }\n                }\n                \n                // Walls with random holes\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h; dy++) {\n                            const isWall = dx === 0 || dx === w - 1 || dz === 0 || dz === d - 1;\n                            if (isWall && Math.random() > ruinFactor) {\n                                // Door opening\n                                if (dz === d - 1 && dx >= 2 && dx <= 4 && dy < 3) continue;\n                                // Window openings\n                                if ((dx === 0 || dx === w - 1) && dy >= 2 && dy <= 4 && (dz === 3 || dz === 8)) continue;\n                                this.setBlock(x + dx, y + dy, z + dz, 'stone');\n                            }\n                        }\n                    }\n                }\n                \n                // Steeple (partially collapsed but supporting structure for cross)\n                const steepleX = x + 3, steepleZ = z + 2;\n                for (let dy = h; dy < h + 5; dy++) {\n                    // Main pillar always intact to support cross\n                    this.setBlock(steepleX, y + dy, steepleZ, 'stone');\n                    if (dy < h + 3) {\n                        // Side supports may be ruined\n                        if (Math.random() > ruinFactor) {\n                            this.setBlock(steepleX + 1, y + dy, steepleZ, 'stone');\n                        }\n                        if (Math.random() > ruinFactor) {\n                            this.setBlock(steepleX - 1, y + dy, steepleZ, 'stone');\n                        }\n                    }\n                }\n                \n                // CROSS - Always intact! (This identifies it as a church)\n                const crossY = y + h + 5;\n                // Vertical part of cross\n                this.setBlock(steepleX, crossY, steepleZ, 'stone');\n                this.setBlock(steepleX, crossY + 1, steepleZ, 'stone');\n                this.setBlock(steepleX, crossY + 2, steepleZ, 'stone');\n                // Horizontal part of cross\n                this.setBlock(steepleX - 1, crossY + 1, steepleZ, 'stone');\n                this.setBlock(steepleX + 1, crossY + 1, steepleZ, 'stone');\n            },\n            \n            // Small cottage house\n            generateHouse1(x, y, z) {\n                const w = 5, d = 6, h = 4;\n                const ruinFactor = 0.25;\n                \n                // Floor\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'wood');\n                    }\n                }\n                \n                // Walls (wood)\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h; dy++) {\n                            const isWall = dx === 0 || dx === w - 1 || dz === 0 || dz === d - 1;\n                            if (isWall && Math.random() > ruinFactor) {\n                                // Door\n                                if (dz === d - 1 && dx === 2 && dy < 2) continue;\n                                // Window\n                                if (dx === 0 && dy === 1 && dz === 2) continue;\n                                this.setBlock(x + dx, y + dy, z + dz, 'wood');\n                            }\n                        }\n                    }\n                }\n                \n                // Roof (leaves - like thatch)\n                for (let dx = -1; dx <= w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        if (Math.random() > ruinFactor) {\n                            this.setBlock(x + dx, y + h, z + dz, 'leaves');\n                        }\n                    }\n                }\n            },\n            \n            // Two-story house\n            generateHouse2(x, y, z) {\n                const w = 6, d = 7, h = 6;\n                const ruinFactor = 0.3;\n                \n                // Foundation\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'stone');\n                    }\n                }\n                \n                // Brick walls\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h; dy++) {\n                            const isWall = dx === 0 || dx === w - 1 || dz === 0 || dz === d - 1;\n                            if (isWall && Math.random() > ruinFactor) {\n                                // Door\n                                if (dz === d - 1 && dx >= 2 && dx <= 3 && dy < 2) continue;\n                                // Windows\n                                if ((dx === 0 || dx === w - 1) && (dy === 1 || dy === 4) && (dz === 2 || dz === 4)) continue;\n                                this.setBlock(x + dx, y + dy, z + dz, 'brick');\n                            }\n                        }\n                    }\n                }\n                \n                // Floor between stories\n                for (let dx = 1; dx < w - 1; dx++) {\n                    for (let dz = 1; dz < d - 1; dz++) {\n                        if (Math.random() > ruinFactor * 2) {\n                            this.setBlock(x + dx, y + 3, z + dz, 'wood');\n                        }\n                    }\n                }\n            },\n            \n            // L-shaped house\n            generateHouse3(x, y, z) {\n                const ruinFactor = 0.35;\n                \n                // Main section\n                for (let dx = 0; dx < 5; dx++) {\n                    for (let dz = 0; dz < 8; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'stone');\n                        for (let dy = 0; dy < 4; dy++) {\n                            const isWall = dx === 0 || dx === 4 || dz === 0 || dz === 7;\n                            if (isWall && Math.random() > ruinFactor) {\n                                if (dz === 7 && dx === 2 && dy < 2) continue; // Door\n                                this.setBlock(x + dx, y + dy, z + dz, 'brick');\n                            }\n                        }\n                    }\n                }\n                \n                // L extension\n                for (let dx = 5; dx < 9; dx++) {\n                    for (let dz = 0; dz < 5; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'stone');\n                        for (let dy = 0; dy < 4; dy++) {\n                            const isWall = dx === 8 || dz === 0 || dz === 4 || (dx === 5 && dz > 4);\n                            if (isWall && Math.random() > ruinFactor) {\n                                this.setBlock(x + dx, y + dy, z + dz, 'brick');\n                            }\n                        }\n                    }\n                }\n            },\n            \n            // Abandoned grocery store\n            generateGrocery(x, y, z) {\n                const w = 10, d = 8, h = 4;\n                const ruinFactor = 0.25;\n                \n                // Concrete floor\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'stone');\n                    }\n                }\n                \n                // Walls\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h; dy++) {\n                            const isWall = dx === 0 || dx === w - 1 || dz === 0 || dz === d - 1;\n                            if (isWall && Math.random() > ruinFactor) {\n                                // Wide entrance\n                                if (dz === d - 1 && dx >= 3 && dx <= 6 && dy < 3) continue;\n                                // Windows (front)\n                                if (dz === d - 1 && (dx === 1 || dx === 8) && dy >= 1 && dy <= 2) continue;\n                                this.setBlock(x + dx, y + dy, z + dz, 'stone');\n                            }\n                        }\n                    }\n                }\n                \n                // Shelving units (partial)\n                for (let row = 0; row < 2; row++) {\n                    for (let dz = 2; dz < 6; dz++) {\n                        if (Math.random() > 0.4) {\n                            this.setBlock(x + 3 + row * 3, y, z + dz, 'wood');\n                            if (Math.random() > 0.5) {\n                                this.setBlock(x + 3 + row * 3, y + 1, z + dz, 'wood');\n                            }\n                        }\n                    }\n                }\n                \n                // \"GROCERY\" sign (just some blocks on roof)\n                for (let dx = 2; dx < 8; dx++) {\n                    if (Math.random() > 0.3) {\n                        this.setBlock(x + dx, y + h, z + d - 1, 'stone');\n                    }\n                }\n            },\n            \n            // WcDonald's - the knockoff! (W instead of M, same colors)\n            generateWcDonalds(x, y, z) {\n                const w = 9, d = 9, h = 4;\n                const ruinFactor = 0.2;\n                \n                // FIRST: Clear interior space (remove any terrain blocks inside building)\n                for (let dx = 1; dx < w - 1; dx++) {\n                    for (let dz = 1; dz < d - 1; dz++) {\n                        for (let dy = 0; dy < h + 2; dy++) {\n                            const existingBlock = this.getBlock(x + dx, y + dy, z + dz);\n                            // Remove any solid non-air blocks inside\n                            if (existingBlock && existingBlock !== 'water' && existingBlock !== 'lava') {\n                                this.setBlock(x + dx, y + dy, z + dz, null);\n                            }\n                        }\n                    }\n                }\n                \n                // Red foundation/floor\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y - 1, z + dz, 'brick'); // Red brick as red\n                    }\n                }\n                \n                // Walls (mix of brick and stone for that fast food look)\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h; dy++) {\n                            const isWall = dx === 0 || dx === w - 1 || dz === 0 || dz === d - 1;\n                            if (isWall && Math.random() > ruinFactor) {\n                                // Double door entrance\n                                if (dz === d - 1 && dx >= 3 && dx <= 5 && dy < 3) continue;\n                                // Drive-thru window\n                                if (dx === w - 1 && dz >= 2 && dz <= 4 && dy === 1) continue;\n                                // Use brick for bottom, stone for top\n                                this.setBlock(x + dx, y + dy, z + dz, dy < 2 ? 'brick' : 'stone');\n                            }\n                        }\n                    }\n                }\n                \n                // The famous \"W\" arches (golden... well, sand-colored)\n                // W shape using sand blocks (yellow-ish) - ALWAYS SOLID, no ruin\n                const wX = x + 4;\n                const wZ = z + d;\n                const wY = y + h;\n                \n                // Build the W shape - guaranteed to always appear\n                // Left vertical leg\n                this.setBlock(wX - 2, wY, wZ, 'sand');\n                this.setBlock(wX - 2, wY + 1, wZ, 'sand');\n                this.setBlock(wX - 2, wY + 2, wZ, 'sand');\n                this.setBlock(wX - 2, wY + 3, wZ, 'sand');\n                \n                // Left diagonal down to center\n                this.setBlock(wX - 1, wY, wZ, 'sand');\n                this.setBlock(wX - 1, wY + 1, wZ, 'sand');\n                \n                // Center bottom (the V dip)\n                this.setBlock(wX, wY, wZ, 'sand');\n                \n                // Right diagonal up from center  \n                this.setBlock(wX + 1, wY, wZ, 'sand');\n                this.setBlock(wX + 1, wY + 1, wZ, 'sand');\n                \n                // Right vertical leg\n                this.setBlock(wX + 2, wY, wZ, 'sand');\n                this.setBlock(wX + 2, wY + 1, wZ, 'sand');\n                this.setBlock(wX + 2, wY + 2, wZ, 'sand');\n                this.setBlock(wX + 2, wY + 3, wZ, 'sand');\n                \n                // Counter inside\n                for (let dx = 2; dx < 7; dx++) {\n                    if (Math.random() > 0.3) {\n                        this.setBlock(x + dx, y, z + 2, 'brick');\n                    }\n                }\n                \n                // Some tables (wood blocks)\n                if (Math.random() > 0.4) this.setBlock(x + 2, y, z + 5, 'wood');\n                if (Math.random() > 0.4) this.setBlock(x + 6, y, z + 5, 'wood');\n                if (Math.random() > 0.4) this.setBlock(x + 4, y, z + 6, 'wood');\n                \n                // Special WcDonalds chest behind counter - may contain the legendary Berdger!\n                this.setBlock(x + 4, y, z + 1, 'buildingChest');\n                this.chestContents = this.chestContents || {};\n                const chestKey = `${x + 4},${y},${z + 1}`;\n                // 30% chance for berdger, otherwise seeds\n                if (Math.random() < 0.3) {\n                    this.chestContents[chestKey] = [{ type: 'berdger', count: 1 }];\n                } else {\n                    this.chestContents[chestKey] = [{ type: 'seeds', count: 3 + Math.floor(Math.random() * 5) }];\n                }\n            },\n            \n            getHighestBlock(x, z) {\n                for (let y = 30; y >= 0; y--) {\n                    if (this.getBlock(x, y, z)) return y;\n                }\n                return null;\n            },\n            \n\n            \n            // Check if bird would collide with blocks\n            checkBirdCollision(x, y, z, radius = 0.5) {\n                // Check blocks around bird position\n                const bx = Math.floor(x);\n                const by = Math.floor(y);\n                const bz = Math.floor(z);\n                \n                // Check 3x3x3 area around bird\n                for (let dx = -1; dx <= 1; dx++) {\n                    for (let dy = -1; dy <= 1; dy++) {\n                        for (let dz = -1; dz <= 1; dz++) {\n                            const block = this.getBlock(bx + dx, by + dy, bz + dz);\n                            // getBlock returns undefined for air, so check if block exists and is solid\n                            if (block && block !== 'water') {\n                                // Calculate distance to block center\n                                const blockX = bx + dx + 0.5;\n                                const blockY = by + dy + 0.5;\n                                const blockZ = bz + dz + 0.5;\n                                const dist = Math.sqrt(\n                                    (x - blockX) ** 2 + \n                                    (y - blockY) ** 2 + \n                                    (z - blockZ) ** 2\n                                );\n                                if (dist < radius + 0.7) return true; // Collision\n                            }\n                        }\n                    }\n                }\n                return false; // No collision\n            },\n            \n            // Check if area is clear for structure placement\n            checkStructureCollision(x, y, z, width, height, depth) {\n                // Check if this area overlaps with any existing structures\n                for (let dx = 0; dx < width; dx++) {\n                    for (let dy = 0; dy < height; dy++) {\n                        for (let dz = 0; dz < depth; dz++) {\n                            const block = this.getBlock(x + dx, y + dy, z + dz);\n                            // If there's already a block here (not air), area is occupied\n                            if (block) {\n                                return true; // Collision detected\n                            }\n                        }\n                    }\n                }\n                return false; // Area is clear\n            },\n            \n            // Find nearest clear spot for structure\n            findClearSpot(centerX, centerZ, width, depth, searchRadius = 20) {\n                // Try to find a clear spot near the center\n                for (let radius = 0; radius < searchRadius; radius++) {\n                    // Try positions in a circle around center\n                    for (let angle = 0; angle < Math.PI * 2; angle += Math.PI / 8) {\n                        const testX = Math.floor(centerX + Math.cos(angle) * radius);\n                        const testZ = Math.floor(centerZ + Math.sin(angle) * radius);\n                        const groundY = this.getGroundHeight(testX, testZ);\n                        \n                        // Check if this spot is clear\n                        if (!this.checkStructureCollision(testX, groundY, testZ, width, 10, depth)) {\n                            return { x: testX, y: groundY, z: testZ };\n                        }\n                    }\n                }\n                \n                // Fallback: return original position\n                const groundY = this.getGroundHeight(centerX, centerZ);\n                return { x: centerX, y: groundY, z: centerZ };\n            },\n\n            \n            // Toggle sneak mode\n            toggleSneak() {\n                this.camera.sneaking = !this.camera.sneaking;\n                console.log('Sneaking:', this.camera.sneaking);\n            },\n            \n            // Get current eye height based on sneak state\n            getEyeHeight() {\n                if (!this.camera.sneaking) {\n                    return this.camera.normalHeight || 0.6; // Use camera property\n                }\n                return this.camera.sneakHeight || 0.2; // Use camera property\n            },\n            initBirds() {\n                this.birds = [];\n                const numBirds = 12; // Good number for small world\n                \n                for (let i = 0; i < numBirds; i++) {\n                    this.birds.push({\n                        x: (Math.random() - 0.5) * 80,\n                        y: 15 + Math.random() * 10,\n                        z: (Math.random() - 0.5) * 80,\n                        // Movement pattern\n                        baseY: 15 + Math.random() * 10,\n                        angle: Math.random() * Math.PI * 2,\n                        radius: 5 + Math.random() * 15,\n                        speed: 0.01 + Math.random() * 0.02,\n                        wobble: Math.random() * Math.PI * 2,\n                        wobbleSpeed: 0.05 + Math.random() * 0.05,\n                        // Visual\n                        wingPhase: Math.random() * Math.PI * 2,\n                        size: 0.3 + Math.random() * 0.2\n                    });\n                }\n            },\n            \n            // Initialize pest birds (small annoying birds that follow player)\n            initPestBirds() {\n                this.pestBirds = [];\n                const numPests = 3;\n                \n                for (let i = 0; i < numPests; i++) {\n                    this.pestBirds.push({\n                        x: 0, y: 12, z: 0,\n                        // Velocity for knockback\n                        vx: 0, vy: 0, vz: 0,\n                        // Target offset from player\n                        targetOffsetX: 0,\n                        targetOffsetY: 0,\n                        targetOffsetZ: 0,\n                        // Behavior state\n                        state: 'circling', // 'circling', 'swooping', 'retreating', 'hovering', 'knockback'\n                        stateTimer: Math.random() * 100,\n                        // Movement\n                        angle: (i / numPests) * Math.PI * 2, // Spread them out\n                        circleRadius: 2 + Math.random(),\n                        baseCircleRadius: 2 + Math.random(),\n                        circleSpeed: 0.08 + Math.random() * 0.04,\n                        swoopProgress: 0,\n                        // Visual\n                        wingPhase: Math.random() * Math.PI * 2,\n                        size: 0.15 + Math.random() * 0.05, // Smaller than regular birds\n                        chirpTimer: Math.random() * 60,\n                        knockbackSpin: 0,\n                        // Anger system - gets angrier when shot\n                        anger: 0,           // 0-5 anger level\n                        timesShot: 0,       // How many times this bird has been shot\n                        spawnThreshold: 4 + Math.floor(Math.random() * 4)  // 4-7 shots to spawn reinforcements\n                    });\n                }\n            },\n            \n            updatePestBirds() {\n                const playerX = this.camera.x;\n                const playerY = this.camera.y;\n                const playerZ = this.camera.z;\n                \n                // Check for seed calming effect\n                if (!this.seedCalmTimer) this.seedCalmTimer = 0;\n                if (this.seedCalmTimer > 0) {\n                    this.seedCalmTimer--;\n                }\n                const birdsCalmed = this.seedCalmTimer > 0;\n                \n                // Prune excess birds every ~30 seconds (1800 frames at 60fps)\n                if (!this.birdPruneTimer) this.birdPruneTimer = 0;\n                this.birdPruneTimer++;\n                if (this.birdPruneTimer >= 1800) {\n                    this.birdPruneTimer = 0;\n                    if (this.pestBirds.length > 15) {\n                        // Keep the 15 angriest birds\n                        this.pestBirds.sort((a, b) => b.anger - a.anger);\n                        this.pestBirds = this.pestBirds.slice(0, 15);\n                    }\n                }\n                \n                for (const pest of this.pestBirds) {\n                    // Handle rage mode timer\n                    if (pest.rageMode && pest.rageTimer) {\n                        pest.rageTimer--;\n                        if (pest.rageTimer <= 0) {\n                            pest.rageMode = false;\n                            pest.speed = 0.06; // Reset to normal speed\n                        }\n                    }\n                    \n                    // Rage mode makes birds more aggressive\n                    \n                    // Wind affects all bird movement\n                    if (this.wind && pest.state !== 'knockback') {\n                        pest.x += this.wind.x * 0.5;\n                        pest.z += this.wind.z * 0.5;\n                    }\n                    \n                    // If calmed by seeds, birds retreat and become passive\n                    if (birdsCalmed && pest.state !== 'knockback') {\n                        pest.state = 'retreating';\n                        pest.stateTimer = Math.max(pest.stateTimer, 60);\n                        pest.anger = Math.max(0, pest.anger - 0.01); // Slowly calm down\n                    }\n                    \n                    pest.stateTimer--;\n                    \n                    // Anger affects wing flap speed\n                    const angerWingBonus = pest.anger * 0.1;\n                    pest.wingPhase += (pest.state === 'knockback' ? 0.8 : 0.5) + angerWingBonus;\n                    pest.chirpTimer--;\n                    \n                    // Calculate anger-based multipliers\n                    const angerSpeedMult = 1 + pest.anger * 0.3;      // Up to 2.5x faster at max anger\n                    const angerRadiusMult = 1 - pest.anger * 0.1;    // Gets closer when angry (down to 0.5x)\n                    const angerSwoopChance = 0.3 + pest.anger * 0.15; // Up to 0.9 swoop chance at max anger\n                    \n                    // Handle knockback state with physics including wall ricochet\n                    if (pest.state === 'knockback') {\n                        // Store previous position for collision detection\n                        const prevX = pest.x, prevY = pest.y, prevZ = pest.z;\n                        \n                        // Apply velocity\n                        pest.x += pest.vx;\n                        pest.y += pest.vy;\n                        pest.z += pest.vz;\n                        \n                        // WALL COLLISION AND RICOCHET\n                        const birdBlock = this.getBlock(Math.floor(pest.x), Math.floor(pest.y), Math.floor(pest.z));\n                        if (birdBlock && birdBlock !== 'water' && birdBlock !== 'lava') {\n                            // Hit a block - check which face and ricochet\n                            const isLeaves = birdBlock.includes('Leaves') || birdBlock.includes('leaves');\n                            \n                            if (isLeaves) {\n                                // Leaves catch birds and slow them significantly\n                                pest.vx *= 0.4;\n                                pest.vy *= 0.4;\n                                pest.vz *= 0.4;\n                                pest.stateTimer = Math.min(pest.stateTimer, 90); // Stuck briefly\n                                pest.caughtInLeaves = true;\n                            } else {\n                                // Solid block - ricochet with energy loss\n                                const blockX = Math.floor(pest.x);\n                                const blockY = Math.floor(pest.y);\n                                const blockZ = Math.floor(pest.z);\n                                \n                                // Determine which face was hit and bounce\n                                if (!this.getBlock(blockX, Math.floor(prevY), Math.floor(prevZ))) {\n                                    pest.vx *= -0.7; // X wall hit\n                                    pest.x = prevX;\n                                } else if (!this.getBlock(Math.floor(prevX), blockY, Math.floor(prevZ))) {\n                                    pest.vy *= -0.7; // Y wall/floor/ceiling hit\n                                    pest.y = prevY;\n                                } else if (!this.getBlock(Math.floor(prevX), Math.floor(prevY), blockZ)) {\n                                    pest.vz *= -0.7; // Z wall hit\n                                    pest.z = prevZ;\n                                } else {\n                                    // Corner - reverse all\n                                    pest.vx *= -0.5;\n                                    pest.vy *= -0.5;\n                                    pest.vz *= -0.5;\n                                    pest.x = prevX; pest.y = prevY; pest.z = prevZ;\n                                }\n                                \n                                // Add ricochet particle\n                                this.particles.push({\n                                    x: pest.x, y: pest.y, z: pest.z,\n                                    vx: (Math.random() - 0.5) * 0.1,\n                                    vy: Math.random() * 0.1,\n                                    vz: (Math.random() - 0.5) * 0.1,\n                                    life: 20, type: 'spark', size: 2\n                                });\n                            }\n                        }\n                        \n                        // If caught in leaves, slowly release\n                        if (pest.caughtInLeaves) {\n                            pest.vx *= 0.9;\n                            pest.vy *= 0.9;\n                            pest.vz *= 0.9;\n                            pest.vy += 0.01; // Slowly float up out of tree\n                            if (Math.abs(pest.vx) < 0.01 && Math.abs(pest.vz) < 0.01) {\n                                pest.caughtInLeaves = false;\n                            }\n                        } else {\n                            // Normal drag and gravity\n                            pest.vx *= 0.95;\n                            pest.vy *= 0.95;\n                            pest.vy -= 0.01; // Gravity\n                            pest.vz *= 0.95;\n                        }\n                        \n                        // Spin animation\n                        pest.knockbackSpin += 0.3;\n                        \n                        // Recover when velocity is low enough - angrier birds recover faster\n                        const speed = Math.sqrt(pest.vx * pest.vx + pest.vy * pest.vy + pest.vz * pest.vz);\n                        const recoveryThreshold = 0.05 + pest.anger * 0.02;\n                        if (speed < recoveryThreshold || pest.stateTimer <= 0) {\n                            // Getting shot makes the bird ANGRIER!\n                            pest.anger = Math.min(5, pest.anger + 1);\n                            pest.timesShot++;\n                            \n                            // Spawn reinforcements when threshold reached\n                            if (pest.timesShot === pest.spawnThreshold && this.pestBirds.length < 15) {\n                                const numToSpawn = 2 + Math.floor(Math.random() * 2); // 2-3 new birds\n                                for (let i = 0; i < numToSpawn; i++) {\n                                    const newAngle = Math.random() * Math.PI * 2;\n                                    const newRadius = 3 + Math.random() * 2;\n                                    this.pestBirds.push({\n                                        x: this.camera.x + Math.cos(newAngle) * newRadius,\n                                        y: this.camera.y + 1 + Math.random(),\n                                        z: this.camera.z + Math.sin(newAngle) * newRadius,\n                                        vx: 0, vy: 0, vz: 0,\n                                        targetOffsetX: 0, targetOffsetY: 0, targetOffsetZ: 0,\n                                        state: 'circling',\n                                        stateTimer: 20 + Math.random() * 30,\n                                        angle: newAngle,\n                                        circleRadius: newRadius,\n                                        baseCircleRadius: newRadius,\n                                        circleSpeed: 0.06 + Math.random() * 0.04,\n                                        swoopProgress: 0,\n                                        wingPhase: Math.random() * Math.PI * 2,\n                                        size: 0.2 + Math.random() * 0.05,\n                                        chirpTimer: Math.random() * 60,\n                                        knockbackSpin: 0,\n                                        anger: 2 + Math.floor(Math.random() * 2), // Spawned already angry (2-3)\n                                        timesShot: 0,\n                                        spawnThreshold: 4 + Math.floor(Math.random() * 4)\n                                    });\n                                }\n                            }\n                            \n                            pest.state = 'retreating';\n                            pest.stateTimer = Math.max(30, 120 - pest.anger * 20); // Shorter retreat when angry\n                            pest.circleRadius = (pest.baseCircleRadius + 4) * angerRadiusMult;\n                            pest.vx = pest.vy = pest.vz = 0;\n                            pest.knockbackSpin = 0;\n                            pest.caughtInLeaves = false;\n                        }\n                        continue; // Skip normal movement\n                    }\n                    \n                    // State machine for pest behavior\n                    switch (pest.state) {\n                        case 'circling':\n                            // Circle around player's head - faster and closer when angry\n                            pest.angle += pest.circleSpeed * angerSpeedMult;\n                            pest.targetOffsetX = Math.cos(pest.angle) * pest.circleRadius * angerRadiusMult;\n                            pest.targetOffsetZ = Math.sin(pest.angle) * pest.circleRadius * angerRadiusMult;\n                            pest.targetOffsetY = 0.5 + Math.sin(pest.angle * 2) * 0.3;\n                            \n                            // Gradually return to base radius\n                            pest.circleRadius += (pest.baseCircleRadius - pest.circleRadius) * 0.01;\n                            \n                            // Randomly decide to swoop - more likely when angry\n                            if (pest.stateTimer <= 0) {\n                                if (Math.random() < angerSwoopChance) {\n                                    pest.state = 'swooping';\n                                    pest.swoopProgress = 0;\n                                    pest.stateTimer = 60;\n                                } else if (Math.random() < 0.2) {\n                                    pest.state = 'hovering';\n                                    pest.stateTimer = Math.max(20, 40 - pest.anger * 5) + Math.random() * 40;\n                                } else {\n                                    pest.stateTimer = Math.max(15, 30 - pest.anger * 5) + Math.random() * 60;\n                                }\n                            }\n                            break;\n                            \n                        case 'swooping':\n                            // Dive at the player's face! Faster when angry\n                            pest.swoopProgress += 0.05 * angerSpeedMult;\n                            const swoopT = pest.swoopProgress;\n                            \n                            if (swoopT < 0.5) {\n                                // Diving in\n                                pest.targetOffsetX = Math.cos(pest.angle) * pest.circleRadius * (1 - swoopT * 2);\n                                pest.targetOffsetZ = Math.sin(pest.angle) * pest.circleRadius * (1 - swoopT * 2);\n                                pest.targetOffsetY = 0.5 - swoopT;\n                            } else {\n                                // Pulling away\n                                const pullT = (swoopT - 0.5) * 2;\n                                pest.targetOffsetX = Math.cos(pest.angle) * pest.circleRadius * pullT;\n                                pest.targetOffsetZ = Math.sin(pest.angle) * pest.circleRadius * pullT;\n                                pest.targetOffsetY = -0.5 + pullT;\n                            }\n                            \n                            if (pest.swoopProgress >= 1) {\n                                pest.state = 'retreating';\n                                pest.stateTimer = 30;\n                            }\n                            break;\n                            \n                        case 'retreating':\n                            // Back off temporarily\n                            pest.angle += pest.circleSpeed * 0.5;\n                            const retreatDist = pest.circleRadius + 2;\n                            pest.targetOffsetX = Math.cos(pest.angle) * retreatDist;\n                            pest.targetOffsetZ = Math.sin(pest.angle) * retreatDist;\n                            pest.targetOffsetY = 1 + Math.sin(pest.angle * 3) * 0.2;\n                            \n                            // Gradually return to base radius\n                            pest.circleRadius += (pest.baseCircleRadius - pest.circleRadius) * 0.02;\n                            \n                            if (pest.stateTimer <= 0) {\n                                pest.state = 'circling';\n                                pest.stateTimer = 60 + Math.random() * 60;\n                            }\n                            break;\n                            \n                        case 'hovering':\n                            // Hover annoyingly in front of player's face\n                            const hoverAngle = Math.sin(Date.now() * 0.01) * 0.3;\n                            pest.targetOffsetX = Math.sin(this.camera.rotY + hoverAngle) * -1.5;\n                            pest.targetOffsetZ = Math.cos(this.camera.rotY + hoverAngle) * -1.5;\n                            pest.targetOffsetY = 0.2 + Math.sin(Date.now() * 0.02) * 0.1;\n                            \n                            if (pest.stateTimer <= 0) {\n                                pest.state = 'circling';\n                                pest.stateTimer = 80 + Math.random() * 40;\n                            }\n                            break;\n                    }\n                    \n                    // Smoothly move toward target position with max speed cap\n                    const targetX = playerX + pest.targetOffsetX;\n                    const targetY = playerY + pest.targetOffsetY;\n                    const targetZ = playerZ + pest.targetOffsetZ;\n                    \n                    const smoothing = pest.state === 'swooping' ? 0.15 : 0.08;\n                    let dx = (targetX - pest.x) * smoothing;\n                    let dy = (targetY - pest.y) * smoothing;\n                    let dz = (targetZ - pest.z) * smoothing;\n                    \n                    // Cap maximum speed so player can outrun angry birds\n                    // Player moves at ~0.1 per frame when running, birds max at 0.08\n                    // Rage mode allows birds to match player speed temporarily\n                    const baseMaxSpeed = 0.08;\n                    const maxBirdSpeed = pest.rageMode ? 0.12 : baseMaxSpeed; // Rage birds can be faster!\n                    const moveSpeed = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                    if (moveSpeed > maxBirdSpeed) {\n                        const scale = maxBirdSpeed / moveSpeed;\n                        dx *= scale;\n                        dy *= scale;\n                        dz *= scale;\n                    }\n                    \n                    pest.x += dx;\n                    pest.y += dy;\n                    pest.z += dz;\n                }\n            },\n            \n            updateBirds() {\n                for (const bird of this.birds) {\n                    // Handle swarm mode timer\n                    if (bird.swarmMode && bird.swarmTimer) {\n                        bird.swarmTimer--;\n                        if (bird.swarmTimer <= 0) {\n                            bird.swarmMode = false;\n                        }\n                    }\n                    \n                    // Swarm mode: birds converge on player\n                    if (bird.swarmMode) {\n                        // Move towards player\n                        const dx = this.camera.x - bird.x;\n                        const dy = this.camera.y - bird.y;\n                        const dz = this.camera.z - bird.z;\n                        const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                        \n                        if (dist > 3) {\n                            // Try to move, but check for collisions\n                            const newX = bird.x + (dx / dist) * 0.15;\n                            const newY = bird.y + (dy / dist) * 0.1;\n                            const newZ = bird.z + (dz / dist) * 0.15;\n                            \n                            // Move in X if no collision\n                            if (!this.checkBirdCollision(newX, bird.y, bird.z, 0.3)) {\n                                bird.x = newX;\n                            } else {\n                                // Try going around - move perpendicular\n                                bird.x += (dz / dist) * 0.1; // Move sideways\n                            }\n                            \n                            // Move in Y if no collision\n                            if (!this.checkBirdCollision(bird.x, newY, bird.z, 0.3)) {\n                                bird.y = newY;\n                            }\n                            \n                            // Move in Z if no collision\n                            if (!this.checkBirdCollision(bird.x, bird.y, newZ, 0.3)) {\n                                bird.z = newZ;\n                            } else {\n                                // Try going around - move perpendicular\n                                bird.z += (dx / dist) * 0.1; // Move sideways\n                            }\n                        } else {\n                            // Circle close to player\n                            bird.angle += 0.1;\n                            bird.x = this.camera.x + Math.cos(bird.angle) * 3;\n                            bird.z = this.camera.z + Math.sin(bird.angle) * 3;\n                            bird.y = this.camera.y + Math.sin(bird.wobble) * 0.5;\n                        }\n                        \n                        bird.wobble += bird.wobbleSpeed * 2;\n                        bird.wingPhase += 0.5; // Faster flapping\n                    } else {\n                        // Normal flight pattern\n                        // Circular flight pattern with wobble\n                        bird.angle += bird.speed;\n                        bird.wobble += bird.wobbleSpeed;\n                        \n                        // Center point slowly drifts\n                        const centerX = Math.sin(bird.angle * 0.1) * 20;\n                        const centerZ = Math.cos(bird.angle * 0.1) * 20;\n                        \n                        // Base position\n                        let bx = centerX + Math.cos(bird.angle) * bird.radius;\n                        let bz = centerZ + Math.sin(bird.angle) * bird.radius;\n                        \n                        // Wind affects bird position\n                        if (this.wind) {\n                            bx += this.wind.x * 15;\n                            bz += this.wind.z * 15;\n                        }\n                        \n                        bird.x = bx;\n                        bird.z = bz;\n                        bird.y = bird.baseY + Math.sin(bird.wobble) * 2;\n                        \n                        // Wing flapping\n                        bird.wingPhase += 0.3;\n                    }\n                }\n                \n                // Also update pest birds\n                this.updatePestBirds();\n                \n                // Update other mobs\n                this.updateBlueBirds();\n                this.updateFish();\n                this.updateCats();\n                this.updateRepairNPC();\n                this.updateCreepers();\n                \n                // Friendly birds can drop items\n                this.updateFriendlyBirdDrops();\n                \n                // Update bird event timer\n                this.updateBirdEventTimer();\n            },\n            \n            // Blue birds - aggressive birds that knockback player\n            updateBlueBirds() {\n                if (!this.blueBirds) this.blueBirds = [];\n                \n                for (let i = this.blueBirds.length - 1; i >= 0; i--) {\n                    const bird = this.blueBirds[i];\n                    \n                    bird.wingPhase += 0.6;\n                    if (bird.attackCooldown > 0) bird.attackCooldown--;\n                    \n                    // Chase player aggressively\n                    const dx = this.camera.x - bird.x;\n                    const dy = this.camera.y - bird.y;\n                    const dz = this.camera.z - bird.z;\n                    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                    \n                    if (dist > 1.5) {\n                        // Move towards player\n                        bird.vx += (dx / dist) * 0.02;\n                        bird.vy += (dy / dist) * 0.015;\n                        bird.vz += (dz / dist) * 0.02;\n                    }\n                    \n                    // Apply velocity with drag - check collisions\n                    const newX = bird.x + bird.vx;\n                    const newY = bird.y + bird.vy;\n                    const newZ = bird.z + bird.vz;\n                    \n                    if (!this.checkBirdCollision(newX, bird.y, bird.z, 0.3)) {\n                        bird.x = newX;\n                    } else {\n                        bird.vx *= -0.5; // Bounce off walls\n                    }\n                    \n                    if (!this.checkBirdCollision(bird.x, newY, bird.z, 0.3)) {\n                        bird.y = newY;\n                    } else {\n                        bird.vy *= -0.5; // Bounce off ceiling/floor\n                    }\n                    \n                    if (!this.checkBirdCollision(bird.x, bird.y, newZ, 0.3)) {\n                        bird.z = newZ;\n                    } else {\n                        bird.vz *= -0.5; // Bounce off walls\n                    }\n                    bird.vx *= 0.9;\n                    bird.vy *= 0.9;\n                    bird.vz *= 0.9;\n                    \n                    // Attack player - knockback\n                    if (dist < 2 && bird.attackCooldown <= 0) {\n                        // Knockback player slightly\n                        this.velocity.x += (this.camera.x - bird.x) * 0.1;\n                        this.velocity.y += 0.15;\n                        this.velocity.z += (this.camera.z - bird.z) * 0.1;\n                        bird.attackCooldown = 60; // 1 second cooldown\n                    }\n                    \n                    // Despawn if too far\n                    if (dist > 60) {\n                        this.blueBirds.splice(i, 1);\n                    }\n                }\n            },\n            \n            // Fish in water\n            updateFish() {\n                if (!this.fish) this.fish = [];\n                \n                for (let i = this.fish.length - 1; i >= 0; i--) {\n                    const fish = this.fish[i];\n                    fish.swimPhase += 0.15;\n                    \n                    // Swim in water\n                    const block = this.getBlock(Math.floor(fish.x), Math.floor(fish.y), Math.floor(fish.z));\n                    if (block !== 'water') {\n                        // Not in water - try to find water\n                        fish.vy -= 0.01; // Fall\n                    } else {\n                        // In water - swim around\n                        fish.vx += (Math.random() - 0.5) * 0.01;\n                        fish.vz += (Math.random() - 0.5) * 0.01;\n                        fish.vy += (Math.random() - 0.5) * 0.005;\n                    }\n                    \n                    fish.x += fish.vx;\n                    fish.y += fish.vy;\n                    fish.z += fish.vz;\n                    fish.vx *= 0.95;\n                    fish.vy *= 0.95;\n                    fish.vz *= 0.95;\n                    \n                    // Limit speed\n                    const speed = Math.sqrt(fish.vx * fish.vx + fish.vz * fish.vz);\n                    if (speed > 0.08) {\n                        fish.vx = (fish.vx / speed) * 0.08;\n                        fish.vz = (fish.vz / speed) * 0.08;\n                    }\n                }\n            },\n            \n            // Cats follow player\n            updateCats() {\n                if (!this.cats) this.cats = [];\n                \n                for (const cat of this.cats) {\n                    cat.walkPhase += 0.1;\n                    cat.meowTimer--;\n                    \n                    const dx = this.camera.x - cat.x;\n                    const dz = this.camera.z - cat.z;\n                    const dist = Math.sqrt(dx * dx + dz * dz);\n                    \n                    // Follow player if too far\n                    if (dist > cat.followDistance + 2) {\n                        cat.state = 'following';\n                        cat.vx += (dx / dist) * 0.01;\n                        cat.vz += (dz / dist) * 0.01;\n                    } else if (dist < cat.followDistance) {\n                        cat.state = 'idle';\n                    }\n                    \n                    // Apply movement with ground detection\n                    cat.x += cat.vx;\n                    cat.z += cat.vz;\n                    cat.vx *= 0.85;\n                    cat.vz *= 0.85;\n                    \n                    // Gravity and ground collision\n                    cat.vy -= 0.02;\n                    cat.y += cat.vy;\n                    \n                    const groundY = Math.floor(cat.y);\n                    if (this.getBlock(Math.floor(cat.x), groundY, Math.floor(cat.z))) {\n                        cat.y = groundY + 1;\n                        cat.vy = 0;\n                    }\n                    \n                    // Random meow\n                    if (cat.meowTimer <= 0) {\n                        cat.meowTimer = 200 + Math.random() * 400;\n                        // Add meow particle/effect if desired\n                    }\n                }\n            },\n            \n            // Update wandering repair NPC\n            spawnRepairNPC() {\n                if (this.repairNPC) return; // Only one NPC at a time\n                \n                if (!this.worldBounds) return;\n                \n                // Spawn within safe bounds (10 blocks from forcefield to avoid edge)\n                const bounds = this.worldBounds;\n                const safeMinX = bounds.minX + 10;\n                const safeMaxX = bounds.maxX - 10;\n                const safeMinZ = bounds.minZ + 10;\n                const safeMaxZ = bounds.maxZ - 10;\n                \n                // Find valid spawn location with proper surface block\n                let spawnX = 0, spawnY = 0, spawnZ = 0;\n                let foundValidSpawn = false;\n                const maxAttempts = 100; // Try many times to find valid spot\n                \n                for (let attempts = 0; attempts < maxAttempts; attempts++) {\n                    // Try random position 15-25 blocks from player\n                    const angle = Math.random() * Math.PI * 2;\n                    const dist = 15 + Math.random() * 10;\n                    let testX = this.camera.x + Math.cos(angle) * dist;\n                    let testZ = this.camera.z + Math.sin(angle) * dist;\n                    \n                    // Clamp to safe bounds\n                    testX = Math.max(safeMinX, Math.min(safeMaxX, testX));\n                    testZ = Math.max(safeMinZ, Math.min(safeMaxZ, testZ));\n                    \n                    const bx = Math.floor(testX);\n                    const bz = Math.floor(testZ);\n                    \n                    // Search downward from Y=25 to find valid surface\n                    for (let y = 25; y >= 1; y--) {\n                        const blockType = this.getBlock(bx, y, bz);\n                        \n                        // MUST be grass or sand - nothing else is valid!\n                        if (blockType === 'grass' || blockType === 'sand') {\n                            // Check that there's air above (3 blocks clearance)\n                            const air1 = !this.getBlock(bx, y + 1, bz);\n                            const air2 = !this.getBlock(bx, y + 2, bz);\n                            const air3 = !this.getBlock(bx, y + 3, bz);\n                            \n                            if (air1 && air2 && air3) {\n                                // Found perfect spot! Spawn standing on this block\n                                spawnX = testX;\n                                spawnY = y + 1; // Stand on top of the grass/sand block\n                                spawnZ = testZ;\n                                foundValidSpawn = true;\n                                break;\n                            }\n                        }\n                    }\n                    \n                    if (foundValidSpawn) break; // Success!\n                }\n                \n                if (!foundValidSpawn) {\n                    this.debugLog('‚ö†Ô∏è Failed to find valid spawn location for gunsmith after 100 attempts', 'warn');\n                    return;\n                }\n                \n                // Spawn at the validated position (not Y=30!)\n                this.repairNPC = {\n                    x: spawnX,\n                    y: spawnY, // Actual validated ground level + 1\n                    z: spawnZ,\n                    vx: 0,\n                    vy: 0,\n                    vz: 0,\n                    onGround: true, // Already on ground\n                    wanderTargetX: spawnX,\n                    wanderTargetZ: spawnZ,\n                    nextWanderTime: Date.now() + 3000,\n                    showPrompt: false,\n                    lastSpoke: 0\n                };\n                \n                const blockBelow = this.getBlock(Math.floor(spawnX), Math.floor(spawnY - 1), Math.floor(spawnZ));\n                this.debugLog('‚ú® A wandering gunsmith has appeared!', 'success');\n                this.debugLog(`Spawned at (${spawnX.toFixed(1)}, ${spawnY}, ${spawnZ.toFixed(1)}) on ${blockBelow}`, 'info');\n            },\n            \n            updateRepairNPC() {\n                if (!this.repairNPC) {\n                    // Spawn NPC occasionally (1% chance per update if none exists)\n                    // Spawns after wave 0 (immediately available)\n                    if (Math.random() < 0.01) {\n                        this.spawnRepairNPC();\n                    }\n                    return;\n                }\n                \n                const npc = this.repairNPC;\n                \n                // Keep NPC within safe bounds\n                if (this.worldBounds) {\n                    const bounds = this.worldBounds;\n                    const safeMinX = bounds.minX + 3;\n                    const safeMaxX = bounds.maxX - 3;\n                    const safeMinZ = bounds.minZ + 3;\n                    const safeMaxZ = bounds.maxZ - 3;\n                    \n                    // Clamp position\n                    npc.x = Math.max(safeMinX, Math.min(safeMaxX, npc.x));\n                    npc.z = Math.max(safeMinZ, Math.min(safeMaxZ, npc.z));\n                    \n                    // If wander target is outside bounds, pick a new one\n                    if (npc.wanderTargetX && (\n                        npc.wanderTargetX < safeMinX || npc.wanderTargetX > safeMaxX ||\n                        npc.wanderTargetZ < safeMinZ || npc.wanderTargetZ > safeMaxZ\n                    )) {\n                        npc.wanderTargetX = null; // Force new target\n                    }\n                }\n                \n                // Gravity\n                npc.vy -= 0.03;\n                npc.y += npc.vy;\n                \n                // Ground collision\n                const groundY = this.getGroundHeightBelow(npc.x, npc.z, npc.y);\n                if (npc.y <= groundY) {\n                    npc.y = groundY;\n                    npc.vy = 0;\n                    npc.onGround = true;\n                } else {\n                    npc.onGround = false;\n                }\n                \n                // Wandering behavior\n                if (Date.now() > npc.nextWanderTime || !npc.wanderTargetX) {\n                    // Pick new random target nearby\n                    const angle = Math.random() * Math.PI * 2;\n                    const dist = 5 + Math.random() * 10;\n                    npc.wanderTargetX = npc.x + Math.cos(angle) * dist;\n                    npc.wanderTargetZ = npc.z + Math.sin(angle) * dist;\n                    npc.nextWanderTime = Date.now() + (3000 + Math.random() * 4000);\n                }\n                \n                // Move toward wander target\n                if (npc.wanderTargetX !== null) {\n                    const dx = npc.wanderTargetX - npc.x;\n                    const dz = npc.wanderTargetZ - npc.z;\n                    const dist = Math.sqrt(dx * dx + dz * dz);\n                    \n                    if (dist > 0.5) {\n                        const speed = 0.04;\n                        npc.vx = (dx / dist) * speed;\n                        npc.vz = (dz / dist) * speed;\n                    } else {\n                        npc.vx = 0;\n                        npc.vz = 0;\n                        npc.wanderTargetX = null; // Reached target\n                    }\n                }\n                \n                // Apply movement\n                npc.x += npc.vx;\n                npc.z += npc.vz;\n                \n                // Check for player interaction distance\n                const distToPlayer = Math.sqrt(\n                    (npc.x - this.camera.x) ** 2 + \n                    (npc.z - this.camera.z) ** 2\n                );\n                \n                npc.showPrompt = distToPlayer < 3;\n                \n                // Despawn if too far from player\n                if (distToPlayer > 60) {\n                    this.repairNPC = null;\n                    this.debugLog('The repair NPC wandered away...', 'info');\n                }\n            },\n            \n            // Creepers stalk and explode\n            updateCreepers() {\n                if (!this.creepers) this.creepers = [];\n                \n                for (let i = this.creepers.length - 1; i >= 0; i--) {\n                    const creeper = this.creepers[i];\n                    creeper.walkPhase += 0.08;\n                    \n                    const dx = this.camera.x - creeper.x;\n                    const dz = this.camera.z - creeper.z;\n                    const dist = Math.sqrt(dx * dx + dz * dz);\n                    \n                    if (creeper.state === 'stalking') {\n                        // Walk towards player slowly\n                        if (dist > 2) {\n                            creeper.vx += (dx / dist) * 0.003;\n                            creeper.vz += (dz / dist) * 0.003;\n                        } else {\n                            // Close enough - start fuse!\n                            creeper.state = 'fusing';\n                            creeper.fuseTimer = 0;\n                        }\n                    } else if (creeper.state === 'fusing') {\n                        creeper.fuseTimer++;\n                        \n                        // Flash warning\n                        creeper.flashing = Math.floor(creeper.fuseTimer / 5) % 2 === 0;\n                        \n                        if (creeper.fuseTimer >= creeper.fuseMax) {\n                            // EXPLODE!\n                            this.creeperExplode(creeper);\n                            this.creepers.splice(i, 1);\n                            continue;\n                        }\n                        \n                        // Player can escape\n                        if (dist > 4) {\n                            creeper.state = 'stalking';\n                            creeper.fuseTimer = 0;\n                        }\n                    }\n                    \n                    // Apply movement\n                    creeper.x += creeper.vx;\n                    creeper.z += creeper.vz;\n                    creeper.vx *= 0.9;\n                    creeper.vz *= 0.9;\n                    \n                    // Gravity\n                    creeper.vy -= 0.02;\n                    creeper.y += creeper.vy;\n                    \n                    const groundY = Math.floor(creeper.y);\n                    if (this.getBlock(Math.floor(creeper.x), groundY, Math.floor(creeper.z))) {\n                        creeper.y = groundY + 1;\n                        creeper.vy = 0;\n                    }\n                }\n            },\n            \n            // Creeper explosion\n            creeperExplode(creeper) {\n                // Launch player\n                const dx = this.camera.x - creeper.x;\n                const dz = this.camera.z - creeper.z;\n                const dist = Math.sqrt(dx * dx + dz * dz);\n                if (dist < 6) {\n                    const force = (6 - dist) / 6 * 1.5;\n                    this.velocity.x += (dx / dist) * force;\n                    this.velocity.y += 0.8;\n                    this.velocity.z += (dz / dist) * force;\n                }\n                \n                // Explosion particles\n                for (let i = 0; i < 30; i++) {\n                    this.particles.push({\n                        x: creeper.x, y: creeper.y + 0.5, z: creeper.z,\n                        vx: (Math.random() - 0.5) * 0.3,\n                        vy: Math.random() * 0.3,\n                        vz: (Math.random() - 0.5) * 0.3,\n                        life: 30 + Math.random() * 20,\n                        type: 'explosion',\n                        size: 3 + Math.random() * 3\n                    });\n                }\n                \n                // Spawn blue bird horde!\n                for (let i = 0; i < 5; i++) {\n                    this.spawnBlueBird();\n                }\n                \n                // Alert\n                if (this.birdEvent) {\n                    this.showBirdAlert('üí• CREEPER EXPLODED! Blue birds incoming! üí•');\n                }\n            },\n            \n            // Friendly birds drop items\n            updateFriendlyBirdDrops() {\n                if (!this.birdDropTimer) this.birdDropTimer = 0;\n                this.birdDropTimer++;\n                \n                // Every ~10 seconds, chance for friendly bird to drop item\n                if (this.birdDropTimer >= 600) {\n                    this.birdDropTimer = 0;\n                    \n                    for (const bird of this.birds) {\n                        // 30% chance per bird\n                        if (Math.random() < 0.3) {\n                            // Determine drop\n                            const roll = Math.random();\n                            let dropType = 'seeds';\n                            let dropCount = 1 + Math.floor(Math.random() * 3);\n                            \n                            if (roll < 0.05) {\n                                // 5% rare item\n                                dropType = ['berdger', 'omamori', 'shimenawa'][Math.floor(Math.random() * 3)];\n                                dropCount = 1;\n                            } else if (roll < 0.2) {\n                                // 15% apple\n                                dropType = 'apple';\n                                dropCount = 1 + Math.floor(Math.random() * 2);\n                            }\n                            \n                            // Drop item near player\n                            this.dropItem(\n                                bird.x + (Math.random() - 0.5) * 2,\n                                bird.y - 2,\n                                bird.z + (Math.random() - 0.5) * 2,\n                                dropType, dropCount\n                            );\n                            \n                            // Only one drop per cycle\n                            break;\n                        }\n                    }\n                }\n            },\n            \n            // Bird event timer system\n            updateBirdEventTimer() {\n                if (!this.birdEvent) return;\n                \n                const now = Date.now();\n                const delta = now - this.birdEvent.lastUpdate;\n                this.birdEvent.lastUpdate = now;\n                this.birdEvent.timer -= delta;\n                \n                // Fade out alerts\n                if (this.birdEvent.alertFade > 0) {\n                    this.birdEvent.alertFade -= delta;\n                    if (this.birdEvent.alertFade <= 0) {\n                        this.birdEvent.alertMessage = null;\n                    }\n                }\n                \n                const timeLeft = this.birdEvent.timer;\n                const nextEvent = this.birdEvent.events[this.birdEvent.currentEvent];\n                \n                // Show alerts at specific times\n                if (timeLeft <= 5 * 60 * 1000 && timeLeft > 4 * 60 * 1000 && !this.birdEvent.alertShown.five) {\n                    this.showBirdAlert(`‚ö†Ô∏è In 5 minutes, ${nextEvent.description} ‚ö†Ô∏è`);\n                    this.birdEvent.alertShown.five = true;\n                }\n                if (timeLeft <= 3 * 60 * 1000 && timeLeft > 2 * 60 * 1000 && !this.birdEvent.alertShown.three) {\n                    this.showBirdAlert(`‚ö†Ô∏è In 3 minutes, ${nextEvent.description} ‚ö†Ô∏è`);\n                    this.birdEvent.alertShown.three = true;\n                }\n                if (timeLeft <= 1 * 60 * 1000 && timeLeft > 50 * 1000 && !this.birdEvent.alertShown.one) {\n                    this.showBirdAlert(`‚ö†Ô∏è In 1 minute, ${nextEvent.description} ‚ö†Ô∏è`);\n                    this.birdEvent.alertShown.one = true;\n                }\n                if (timeLeft <= 30 * 1000 && timeLeft > 20 * 1000 && !this.birdEvent.alertShown.thirty) {\n                    this.showBirdAlert(`‚ö†Ô∏è In 30 seconds, ${nextEvent.description.toUpperCase()} ‚ö†Ô∏è`);\n                    this.birdEvent.alertShown.thirty = true;\n                }\n                if (timeLeft <= 10 * 1000 && timeLeft > 5 * 1000 && !this.birdEvent.alertShown.ten) {\n                    this.showBirdAlert(`üî• In 10 seconds, ${nextEvent.description.toUpperCase()} üî•`);\n                    this.birdEvent.alertShown.ten = true;\n                }\n                \n                // Trigger event when timer reaches 0\n                if (timeLeft <= 0) {\n                    this.triggerBirdEvent();\n                }\n            },\n            \n            showBirdAlert(message) {\n                this.birdEvent.alertMessage = message;\n                this.birdEvent.alertFade = 4000; // 4 seconds\n            },\n            \n            triggerBirdEvent() {\n                const event = this.birdEvent.events[this.birdEvent.currentEvent];\n                this.showBirdAlert(`üê¶ BIRD EVENT: ${event.name}! üê¶`);\n                event.action();\n                \n                // Reset timer and move to next event\n                this.birdEvent.timer = 5 * 60 * 1000; // Reset to 5 minutes\n                this.birdEvent.currentEvent = (this.birdEvent.currentEvent + 1) % this.birdEvent.events.length;\n                this.birdEvent.alertShown = { five: false, three: false, one: false, thirty: false, ten: false };\n            },\n            \n            // Bird Event 1: Swarm - all birds converge on player\n            triggerBirdSwarm() {\n                // Make all decorative birds become aggressive for 30 seconds\n                for (const bird of this.birds) {\n                    bird.swarmMode = true;\n                    bird.swarmTimer = 30 * 60; // 30 seconds at 60fps\n                }\n                // Also spawn extra pest birds\n                for (let i = 0; i < 5; i++) {\n                    this.spawnPestBird();\n                }\n            },\n            \n            // Bird Event 2: Rage - pest birds become faster and more aggressive\n            triggerBirdRage() {\n                // Boost all pest birds\n                if (this.pestBirds) {\n                    for (const bird of this.pestBirds) {\n                        bird.rageMode = true;\n                        bird.rageTimer = 45 * 60; // 45 seconds\n                        bird.speed = (bird.speed || 0.06) * 1.5;\n                    }\n                }\n                // Spawn some extra angry birds\n                for (let i = 0; i < 3; i++) {\n                    const bird = this.spawnPestBird();\n                    if (bird) {\n                        bird.rageMode = true;\n                        bird.rageTimer = 45 * 60;\n                    }\n                }\n            },\n            \n            // Bird Event 3: Multiply - spawn many birds everywhere\n            triggerBirdMultiply() {\n                // Spawn lots of pest birds at random locations around the player\n                for (let i = 0; i < 10; i++) {\n                    const angle = Math.random() * Math.PI * 2;\n                    const dist = 10 + Math.random() * 20;\n                    const bird = this.spawnPestBird();\n                    if (bird) {\n                        bird.x = this.camera.x + Math.cos(angle) * dist;\n                        bird.z = this.camera.z + Math.sin(angle) * dist;\n                        bird.y = this.camera.y + 5 + Math.random() * 10;\n                    }\n                }\n            },\n            \n            // Bird Event 4: Creeper Invasion - spawn stalking creepers\n            triggerCreeperInvasion() {\n                this.showBirdAlert('üí• CREEPERS ARE STALKING YOU! üí•');\n                // Spawn 2-4 creepers around the player\n                const numCreepers = 2 + Math.floor(Math.random() * 3);\n                for (let i = 0; i < numCreepers; i++) {\n                    this.spawnCreeper();\n                }\n            },\n            \n            spawnPestBird() {\n                if (!this.pestBirds) this.pestBirds = [];\n                const bird = {\n                    x: this.camera.x + (Math.random() - 0.5) * 30,\n                    y: this.camera.y + 10 + Math.random() * 10,\n                    z: this.camera.z + (Math.random() - 0.5) * 30,\n                    vx: 0, vy: 0, vz: 0,\n                    state: 'hunting',\n                    wingPhase: Math.random() * Math.PI * 2,\n                    speed: 0.06,\n                    angryTimer: 60 * 60 * 5 // 5 minutes\n                };\n                this.pestBirds.push(bird);\n                return bird;\n            },\n            \n            // Spawn blue bird (more aggressive, can knockback player)\n            spawnBlueBird() {\n                if (!this.blueBirds) this.blueBirds = [];\n                const bird = {\n                    x: this.camera.x + (Math.random() - 0.5) * 20,\n                    y: this.camera.y + 5 + Math.random() * 8,\n                    z: this.camera.z + (Math.random() - 0.5) * 20,\n                    vx: 0, vy: 0, vz: 0,\n                    state: 'aggressive',\n                    wingPhase: Math.random() * Math.PI * 2,\n                    speed: 0.1, // Faster than normal birds\n                    attackCooldown: 0\n                };\n                this.blueBirds.push(bird);\n                return bird;\n            },\n            \n            // Spawn fish in water\n            spawnFish() {\n                if (!this.fish) this.fish = [];\n                // Find water to spawn in\n                let waterPos = null;\n                for (let attempts = 0; attempts < 50; attempts++) {\n                    const x = Math.floor(this.camera.x + (Math.random() - 0.5) * 40);\n                    const z = Math.floor(this.camera.z + (Math.random() - 0.5) * 40);\n                    for (let y = 20; y >= 0; y--) {\n                        if (this.getBlock(x, y, z) === 'water') {\n                            waterPos = { x: x + 0.5, y: y + 0.5, z: z + 0.5 };\n                            break;\n                        }\n                    }\n                    if (waterPos) break;\n                }\n                \n                if (!waterPos) {\n                    // Spawn near player in any case\n                    waterPos = { \n                        x: this.camera.x + (Math.random() - 0.5) * 10, \n                        y: 7, \n                        z: this.camera.z + (Math.random() - 0.5) * 10 \n                    };\n                }\n                \n                const fish = {\n                    x: waterPos.x, y: waterPos.y, z: waterPos.z,\n                    vx: (Math.random() - 0.5) * 0.05,\n                    vy: 0,\n                    vz: (Math.random() - 0.5) * 0.05,\n                    swimPhase: Math.random() * Math.PI * 2,\n                    color: Math.random() > 0.5 ? '#ff6347' : '#ffd700', // Orange or gold\n                    size: 0.3 + Math.random() * 0.2\n                };\n                this.fish.push(fish);\n                return fish;\n            },\n            \n            // Spawn cat that follows player\n            spawnCat() {\n                if (!this.cats) this.cats = [];\n                const cat = {\n                    x: this.camera.x + (Math.random() - 0.5) * 10,\n                    y: this.camera.y - 1,\n                    z: this.camera.z + (Math.random() - 0.5) * 10,\n                    vx: 0, vy: 0, vz: 0,\n                    state: 'idle',\n                    walkPhase: 0,\n                    color: ['#ffa500', '#808080', '#000000', '#ffffff'][Math.floor(Math.random() * 4)], // Orange, gray, black, white\n                    meowTimer: Math.random() * 300 + 200,\n                    followDistance: 3 + Math.random() * 2\n                };\n                this.cats.push(cat);\n                return cat;\n            },\n            \n            // Spawn creeper (explodes, spawns blue birds)\n            spawnCreeper() {\n                if (!this.creepers) this.creepers = [];\n                const creeper = {\n                    x: this.camera.x + (Math.random() > 0.5 ? 15 : -15) + (Math.random() - 0.5) * 10,\n                    y: this.camera.y,\n                    z: this.camera.z + (Math.random() > 0.5 ? 15 : -15) + (Math.random() - 0.5) * 10,\n                    vx: 0, vy: 0, vz: 0,\n                    state: 'stalking',\n                    fuseTimer: 0,\n                    fuseMax: 90, // 1.5 seconds fuse\n                    walkPhase: 0,\n                    health: 3\n                };\n                this.creepers.push(creeper);\n                return creeper;\n            },\n            \n            // Update survival HUD\n            updateSurvivalHUD() {\n                if (!this.survivalStats) return;\n                \n                const scoreEl = document.getElementById('scoreDisplay');\n                const waveEl = document.getElementById('waveDisplay');\n                const objEl = document.getElementById('objectiveDisplay');\n                \n                if (scoreEl) scoreEl.textContent = `Score: ${this.survivalStats.score}`;\n                if (waveEl) waveEl.textContent = `Wave: ${this.survivalStats.wave}`;\n                if (objEl && this.survivalStats.currentObjective) {\n                    objEl.textContent = `Objective: ${this.survivalStats.currentObjective.text}`;\n                }\n            },\n            \n            // Generate Ritual Temple - only one per world\n            generateRitualTemple(x, y, z) {\n                const w = 11;\n                const h = 8;\n                const d = 11;\n                \n                // Mark temple location\n                this.ritualTempleLocation = { x, y, z };\n                \n                // Clear space\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        for (let dy = 0; dy < h + 2; dy++) {\n                            this.setBlock(x + dx, y + dy, z + dz, null);\n                        }\n                    }\n                }\n                \n                // Floor\n                for (let dx = 0; dx < w; dx++) {\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x + dx, y, z + dz, 'ritualStone');\n                    }\n                }\n                \n                // Walls\n                for (let dy = 1; dy < h; dy++) {\n                    for (let dx = 0; dx < w; dx++) {\n                        this.setBlock(x + dx, y + dy, z, 'ritualStone');\n                        this.setBlock(x + dx, y + dy, z + d - 1, 'ritualStone');\n                    }\n                    for (let dz = 0; dz < d; dz++) {\n                        this.setBlock(x, y + dy, z + dz, 'ritualStone');\n                        this.setBlock(x + w - 1, y + dy, z + dz, 'ritualStone');\n                    }\n                }\n                \n                // Entrance\n                this.setBlock(x + w/2|0, y + 1, z, null);\n                this.setBlock(x + w/2|0, y + 2, z, null);\n                this.setBlock(x + w/2|0, y + 3, z, null);\n                \n                // Ritual socket blocks in center (5 sockets for 5 ritual items)\n                const cx = x + w/2|0;\n                const cz = z + d/2|0;\n                \n                this.setBlock(cx, y + 1, cz, 'charmSocket');      // Center - Omamori\n                this.setBlock(cx - 2, y + 1, cz, 'petalSocket');  // Left - Sakura Petal\n                this.setBlock(cx + 2, y + 1, cz, 'ropeSocket');   // Right - Shimenawa\n                this.setBlock(cx, y + 1, cz - 2, 'plaqueSocket'); // Back - Ema\n                this.setBlock(cx, y + 1, cz + 2, 'incenseSocket'); // Front - Incense\n                \n                // Glowing pillars\n                for (let dy = 1; dy <= 4; dy++) {\n                    this.setBlock(x + 2, y + dy, z + 2, 'glowstone');\n                    this.setBlock(x + w - 3, y + dy, z + 2, 'glowstone');\n                    this.setBlock(x + 2, y + dy, z + d - 3, 'glowstone');\n                    this.setBlock(x + w - 3, y + dy, z + d - 3, 'glowstone');\n                }\n            },\n            \n            // Generate apple tree with green leaves and chance to drop apples\n            generateTree(x, y, z) {\n                for (let h = 0; h < 4; h++) {\n                    this.setBlock(x, y + h, z, 'wood');\n                }\n                for (let dx = -2; dx <= 2; dx++) {\n                    for (let dz = -2; dz <= 2; dz++) {\n                        for (let dy = 3; dy <= 5; dy++) {\n                            if (Math.abs(dx) + Math.abs(dz) + Math.abs(dy - 4) < 4) {\n                                if (!(dx === 0 && dz === 0 && dy < 4)) {\n                                    this.setBlock(x + dx, y + dy, z + dz, 'appleLeaves');\n                                }\n                            }\n                        }\n                    }\n                }\n                // Store apple tree for occasional apple drops\n                if (!this.appleTrees) this.appleTrees = [];\n                this.appleTrees.push({ x, y: y + 4, z });\n            },\n            \n            // Generate cherry blossom tree (larger, more dramatic)\n            generateCherryTree(x, y, z) {\n                // Taller trunk with pink-tinted wood\n                for (let h = 0; h < 6; h++) {\n                    this.setBlock(x, y + h, z, 'cherryWood');\n                }\n                \n                // Wider, more dramatic canopy\n                for (let dx = -3; dx <= 3; dx++) {\n                    for (let dz = -3; dz <= 3; dz++) {\n                        for (let dy = 4; dy <= 8; dy++) {\n                            const dist = Math.abs(dx) + Math.abs(dz) + Math.abs(dy - 6);\n                            if (dist < 5 && Math.random() > 0.15) {\n                                if (!(dx === 0 && dz === 0 && dy < 5)) {\n                                    this.setBlock(x + dx, y + dy, z + dz, 'cherryLeaves');\n                                }\n                            }\n                        }\n                    }\n                }\n                \n                // Store tree location for petal spawning\n                this.cherryTrees.push({ x, y: y + 6, z });\n            },\n            \n            setBlock(x, y, z, type) {\n                const key = `${x},${y},${z}`;\n                if (type === null) {\n                    delete this.world[key];\n                } else {\n                    this.world[key] = type;\n                }\n            },\n            \n            getBlock(x, y, z) {\n                return this.world[`${x},${y},${z}`] || null;\n            },\n            \n            setupControls() {\n                // Keyboard controls\n                document.addEventListener('keydown', (e) => {\n                    // Debug console accessible even when paused/inactive\n                    if (e.key === '`' || e.key === '~') {\n                        e.preventDefault();\n                        this.toggleDebugConsole();\n                        return;\n                    }\n                    \n                    if (!this.isActive) return;\n                    \n                    // Block all game input when debug console is open\n                    if (this.debugConsoleOpen) return;\n                    \n                    // CRITICAL: Prevent Ctrl+W from closing tab (standard for browser games)\n                    if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'w') {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        // W key still registered for movement below\n                    }\n                    \n                    if (e.key === 'Escape') {\n                        e.preventDefault();\n                        \n                        // Priority order: dialogue > journal > inventory > pause\n                        if (this.dialogueOpen) {\n                            this.closeDialogue();\n                            return;\n                        }\n                        \n                        if (this.journalOpen) {\n                            this.toggleJournal();\n                            return;\n                        }\n                        \n                        // If inventory is open, close it instead of pausing\n                        if (this.inventoryOpen) {\n                            this.toggleInventory();\n                            return;\n                        }\n                        \n                        if (this.isPaused) {\n                            this.resume();\n                        } else {\n                            this.pause();\n                        }\n                        return;\n                    }\n                    \n                    if (this.isPaused) return;\n                    \n                    this.keys[e.key.toLowerCase()] = true;\n                    \n                    // Hotbar selection (1-9)\n                    const slotKeys = ['1', '2', '3', '4', '5', '6', '7', '8', '9'];\n                    const slotIdx = slotKeys.indexOf(e.key);\n                    if (slotIdx !== -1) {\n                        this.selectedSlot = slotIdx;\n                        const slot = this.inventory.hotbar[slotIdx];\n                        if (slot) {\n                            if (slot.type === 'block') {\n                                this.selectedBlock = slot.id;\n                                this.selectedItem = null;\n                            } else if (slot.type === 'weapon') {\n                                this.selectedItem = slot.id;\n                                this.selectedBlock = null;\n                            }\n                        }\n                        this.updateHotbar();\n                    }\n                    \n                    // E key - Check for NPC interaction first, then inventory\n                    if (e.key.toLowerCase() === 'e') {\n                        // Check if near repair NPC\n                        if (this.repairNPC) {\n                            const distToNPC = Math.sqrt(\n                                (this.repairNPC.x - this.camera.x) ** 2 + \n                                (this.repairNPC.z - this.camera.z) ** 2\n                            );\n                            \n                            if (distToNPC < 3) {\n                                // Player is near NPC - open dialogue\n                                this.openDialogue('gunsmith');\n                                return; // Don't open inventory\n                            }\n                        }\n                        \n                        // Normal inventory toggle\n                        this.toggleInventory();\n                    }\n                    \n                    // J key - Open journal/quest log\n                    if (e.key.toLowerCase() === 'j' && !e.repeat) {\n                        this.toggleJournal();\n                    }\n                    \n                    // Toggle sneak with C\n                    if (e.key.toLowerCase() === 'c' && !e.repeat) {\n                        this.toggleSneak();\n                    }\n                    \n                    // Hold to sneak with Ctrl\n                    if (e.key === 'Control' && !e.repeat) {\n                        if (!this.camera.sneaking) {\n                            this.toggleSneak();\n                            this.camera.sneakingWithCtrl = true; // Track that we enabled via Ctrl\n                        }\n                    }\n                    \n                    // Drop item with Q\n                    if (e.key.toLowerCase() === 'q') {\n                        this.dropHeldItem();\n                    }\n                    \n                    // Check ritual with R\n                    if (e.key.toLowerCase() === 'r') {\n                        if (this.checkRitual()) {\n                            console.log('Omamori Ritual Complete! Birds are blessed and calmed.');\n                        }\n                    }\n                    \n\n                    \n                    // Jump is handled in update() for continuous jumping while holding space\n                    \n                    e.preventDefault();\n                });\n                \n                document.addEventListener('keyup', (e) => {\n                    this.keys[e.key.toLowerCase()] = false;\n                    \n                    // Release Ctrl sneak\n                    if (e.key === 'Control' && this.camera.sneakingWithCtrl) {\n                        this.camera.sneakingWithCtrl = false;\n                        if (this.camera.sneaking) {\n                            this.toggleSneak(); // Turn off sneak\n                        }\n                    }\n                });\n                \n                // ===== POINTER LOCK CONTROLS (Industry Standard for Browser FPS) =====\n                // Pointer Lock is the ONLY way to truly capture mouse across monitors\n                \n                this.pointerLocked = false;\n                \n                // Pointer lock state change handler\n                document.addEventListener('pointerlockchange', () => {\n                    this.pointerLocked = document.pointerLockElement === this.canvas;\n                    \n                    if (this.pointerLocked) {\n                        // Successfully locked - hide overlay\n                        document.getElementById('clickToPlay').classList.remove('active');\n                    } else {\n                        // Lock released (user pressed ESC or we exited)\n                        // If game is active and not paused and inventory/console/dialogue is NOT open\n                        // and we didn't just close the inventory, pause\n                        if (this.isActive && !this.isPaused && !this.inventoryOpen && !this.debugConsoleOpen && !this.dialogueOpen && !this.journalOpen && !this.justClosedInventory) {\n                            this.pause();\n                        }\n                    }\n                });\n                \n                // Pointer lock error handler\n                document.addEventListener('pointerlockerror', () => {\n                    console.log('Pointer lock failed');\n                    // Show the click overlay so user can try again\n                    if (this.isActive && !this.isPaused) {\n                        document.getElementById('clickToPlay').classList.add('active');\n                    }\n                });\n                \n                // Mouse button handler - works during pointer lock\n                this.canvas.addEventListener('mousedown', (e) => {\n                    if (!this.isActive || this.isPaused) return;\n                    \n                    // Don't break/place blocks while debug console is open\n                    if (this.debugConsoleOpen) return;\n                    \n                    // If inventory is open, handle inventory clicks\n                    if (this.inventoryOpen) {\n                        // TODO: Handle inventory slot clicks\n                        return;\n                    }\n                    \n                    // If not locked, any click should request pointer lock\n                    if (!this.pointerLocked) {\n                        this.canvas.requestPointerLock();\n                        return;\n                    }\n                    \n                    if (e.button === 0) {\n                        // Left click - BREAK block\n                        const hit = this.raycast();\n                        if (hit && hit.hit) {\n                            const blockType = this.getBlock(hit.hit.x, hit.hit.y, hit.hit.z);\n                            \n                            // Cannot break water or lava\n                            if (blockType === 'water' || blockType === 'lava') {\n                                return;\n                            }\n                            \n                            // Helper to check if block is a chest\n                            const isChest = (b) => b && (b === 'chest' || b === 'ritualChest' || b === 'buildingChest' || b.toLowerCase().includes('chest'));\n                            \n                            // Helper to check if block is a socket (indestructible)\n                            const isSocket = (b) => b && b.includes('Socket');\n                            if (isSocket(blockType)) {\n                                return; // Can't break socket blocks\n                            }\n                            \n                            this.setBlock(hit.hit.x, hit.hit.y, hit.hit.z, null);\n                            this.stats.blocksBroken++;\n                            \n                            // Score for breaking blocks\n                            if (this.survivalStats) {\n                                this.survivalStats.score += 1;\n                                this.updateSurvivalHUD();\n                            }\n                            \n                            // Drop the block as an item (if it's a normal block, not chest)\n                            if (blockType && !isChest(blockType)) {\n                                // Special drops for certain blocks\n                                if (blockType === 'appleLeaves') {\n                                    // Apple leaves have chance to drop apple\n                                    this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, 'appleLeaves', 1);\n                                    if (Math.random() < 0.15) {\n                                        this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, 'apple', 1);\n                                    }\n                                } else if (blockType === 'cherryLeaves') {\n                                    // Cherry leaves have chance to drop sakura petals\n                                    this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, 'cherryLeaves', 1);\n                                    if (Math.random() < 0.1) {\n                                        this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, 'sakuraPetal', 1);\n                                    }\n                                } else {\n                                    this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, blockType, 1);\n                                }\n                            } else if (isChest(blockType)) {\n                                // Breaking a chest drops its contents\n                                const chestKey = `${hit.hit.x},${hit.hit.y},${hit.hit.z}`;\n                                const contents = this.chestContents && this.chestContents[chestKey];\n                                if (contents && Array.isArray(contents)) {\n                                    for (const item of contents) {\n                                        if (item && item.type) {\n                                            this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, item.type, item.count || 1);\n                                        }\n                                    }\n                                    delete this.chestContents[chestKey];\n                                }\n                                // Also drop the chest itself\n                                this.dropItem(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5, 'chest', 1);\n                            }\n                        }\n                    } else if (e.button === 2) {\n                        // Right click - PLACE block, SHOOT, USE item, or interact\n                        // First check for chest interaction\n                        const hit = this.raycast();\n                        if (hit && hit.hit) {\n                            const hitBlock = this.getBlock(hit.hit.x, hit.hit.y, hit.hit.z);\n                            // Check for any type of chest (case-insensitive)\n                            if (hitBlock && (hitBlock === 'chest' || hitBlock === 'ritualChest' || hitBlock === 'buildingChest' || hitBlock.toLowerCase().includes('chest'))) {\n                                this.openChest(hit.hit.x, hit.hit.y, hit.hit.z);\n                                return;\n                            }\n                            \n                            // Check for ritual socket blocks\n                            if (hitBlock && hitBlock.includes('Socket')) {\n                                this.interactWithSocket(hit.hit.x, hit.hit.y, hit.hit.z, hitBlock);\n                                return;\n                            }\n                        }\n                        \n                        // Check held item\n                        const heldSlot = this.inventory.hotbar[this.selectedSlot];\n                        const heldId = heldSlot ? heldSlot.id : null;\n                        \n                        if (this.selectedItem === 'ka69') {\n                            // Shoot the KA-69!\n                            this.shootAK47();\n                        } else if (heldId === 'berdger') {\n                            // Shoot the Berdger! (infinite burgers)\n                            this.shootBerdger();\n                        } else if (heldId === 'apple') {\n                            // Throw an apple at birds\n                            this.throwApple();\n                        } else if (heldId === 'seeds') {\n                            // Use seeds to calm birds\n                            this.useSeeds();\n                        } else if (this.selectedItem === 'water_bucket' || this.selectedItem === 'lava_bucket') {\n                            // Pour bucket\n                            const hit = this.raycast();\n                            if (hit && hit.place) {\n                                const fluidType = this.selectedItem === 'water_bucket' ? 'water' : 'lava';\n                                const placePos = hit.place;\n                                \n                                // Don't pour inside player\n                                const px = Math.floor(this.camera.x);\n                                const pz = Math.floor(this.camera.z);\n                                const feetY = Math.floor(this.camera.y - this.playerEyeHeight);\n                                const headY = Math.floor(this.camera.y - this.playerEyeHeight + this.playerHeight);\n                                \n                                let wouldCollide = false;\n                                for (let checkY = feetY; checkY <= headY; checkY++) {\n                                    if (px === placePos.x && checkY === placePos.y && pz === placePos.z) {\n                                        wouldCollide = true;\n                                        break;\n                                    }\n                                }\n                                \n                                if (!wouldCollide) {\n                                    // Place source fluid block with full level (8)\n                                    this.setBlock(placePos.x, placePos.y, placePos.z, fluidType);\n                                    this.setFluidLevel(placePos.x, placePos.y, placePos.z, 8);\n                                    \n                                    // Add to fluid update queue for spreading\n                                    this.fluidUpdates.push({\n                                        x: placePos.x,\n                                        y: placePos.y,\n                                        z: placePos.z,\n                                        type: fluidType,\n                                        level: 8  // Source block has max level\n                                    });\n                                    \n                                    // Consume bucket\n                                    const slot = this.inventory.hotbar[this.selectedSlot];\n                                    if (slot && slot.count > 1) {\n                                        slot.count--;\n                                    } else {\n                                        this.inventory.hotbar[this.selectedSlot] = null;\n                                        this.selectedItem = null;\n                                    }\n                                    this.updateHotbar();\n                                }\n                            }\n                        } else if (this.selectedBlock) {\n                            // Place block\n                            const hit = this.raycast();\n                            if (hit && hit.place) {\n                                const placePos = hit.place;\n                                \n                                // CRITICAL: Check what's at the placement position\n                                const existingBlock = this.getBlock(placePos.x, placePos.y, placePos.z);\n                                \n                                // Only allow placement if position is air, water, or lava\n                                // NEVER replace solid blocks!\n                                if (existingBlock && existingBlock !== 'water' && existingBlock !== 'lava') {\n                                    // There's a solid block here - cannot place!\n                                    return;\n                                }\n                                \n                                // Don't place block inside player\n                                const px = Math.floor(this.camera.x);\n                                const pz = Math.floor(this.camera.z);\n                                \n                                // Check if placement would be inside player body\n                                const feetY = Math.floor(this.camera.y - this.playerEyeHeight);\n                                const headY = Math.floor(this.camera.y - this.playerEyeHeight + this.playerHeight);\n                                \n                                let wouldCollide = false;\n                                for (let checkY = feetY; checkY <= headY; checkY++) {\n                                    if (px === placePos.x && checkY === placePos.y && pz === placePos.z) {\n                                        wouldCollide = true;\n                                        break;\n                                    }\n                                }\n                                \n                                if (!wouldCollide) {\n                                    this.setBlock(placePos.x, placePos.y, placePos.z, this.selectedBlock);\n                                    this.stats.blocksPlaced++;\n                                    \n                                    // Consume block from inventory\n                                    const slot = this.inventory.hotbar[this.selectedSlot];\n                                    if (slot && slot.count > 0) {\n                                        slot.count--;\n                                        if (slot.count <= 0) {\n                                            this.inventory.hotbar[this.selectedSlot] = null;\n                                            this.selectedBlock = null;\n                                        }\n                                        this.updateHotbarDisplay();\n                                    }\n                                }\n                            }\n                        }\n                    }\n                });\n                \n                // Prevent context menu from appearing\n                this.canvas.addEventListener('contextmenu', (e) => {\n                    e.preventDefault();\n                });\n                \n                // Scroll wheel - change hotbar selection\n                this.canvas.addEventListener('wheel', (e) => {\n                    if (!this.isActive || this.isPaused || this.inventoryOpen || this.debugConsoleOpen) return;\n                    e.preventDefault();\n                    \n                    // Scroll down = next slot, scroll up = previous slot\n                    if ((e as WheelEvent).deltaY > 0) {\n                        this.selectedSlot = (this.selectedSlot + 1) % 9;\n                    } else if ((e as WheelEvent).deltaY < 0) {\n                        this.selectedSlot = (this.selectedSlot + 8) % 9; // +8 is same as -1 mod 9\n                    }\n                    \n                    // Update selected item\n                    const slot = this.inventory.hotbar[this.selectedSlot];\n                    if (slot) {\n                        if (slot.type === 'block') {\n                            this.selectedBlock = slot.id;\n                            this.selectedItem = null;\n                        } else if (slot.type === 'weapon') {\n                            this.selectedItem = slot.id;\n                            this.selectedBlock = null;\n                        } else if (slot.type === 'bucket') {\n                            this.selectedItem = slot.id;\n                            this.selectedBlock = null;\n                        }\n                        \n                        // Show hotbar tooltip\n                        const itemNames = {\n                            grass: 'Grass Block', dirt: 'Dirt', stone: 'Stone', wood: 'Wood',\n                            leaves: 'Leaves', water: 'Water', sand: 'Sand', brick: 'Brick',\n                            ka69: 'KA-69', water_bucket: 'Water Bucket', lava_bucket: 'Lava Bucket',\n                            seed: 'Seed', berdger: 'Berdger', cherry_wood: 'Cherry Wood',\n                            cherry_leaves: 'Cherry Leaves', glowstone: 'Glowstone', \n                            ritual_item: 'Omamori Charm', lava: 'Lava', ice: 'Ice'\n                        };\n                        const itemId = slot.id || slot.type;\n                        const itemName = itemNames[itemId] || itemId;\n                        this.hotbarTooltip.text = itemName;\n                        this.hotbarTooltip.visible = true;\n                        this.hotbarTooltip.timestamp = Date.now();\n                        \n                        // Auto-hide after 1.5 seconds\n                        setTimeout(() => {\n                            if (Date.now() - this.hotbarTooltip.timestamp >= 1500) {\n                                this.hotbarTooltip.visible = false;\n                            }\n                        }, 1500);\n                    } else {\n                        this.selectedBlock = null;\n                        this.selectedItem = null;\n                    }\n                    this.updateHotbar();\n                }, { passive: false });\n                \n                // Also catch wheel events on the game container to prevent page scroll\n                const gameContainer = document.getElementById('minecraftGame');\n                gameContainer.addEventListener('wheel', (e) => {\n                    // Allow scrolling when console or inventory is open\n                    if (this.isActive && !this.debugConsoleOpen && !this.inventoryOpen) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                    }\n                }, { passive: false });\n                \n                // Mouse movement - use movementX/Y deltas (works across screen boundaries)\n                document.addEventListener('mousemove', (e) => {\n                    if (!this.isActive || this.isPaused || !this.pointerLocked || this.debugConsoleOpen) return;\n                    \n                    // movementX/Y provide delta movement even across screen edges\n                    this.camera.rotY -= e.movementX * 0.003;\n                    this.camera.rotX = Math.max(-1.5, Math.min(1.5, this.camera.rotX + e.movementY * 0.003));\n                });\n                \n                // Visibility change - pause when tab hidden\n                document.addEventListener('visibilitychange', () => {\n                    if (document.hidden && this.isActive && !this.isPaused) {\n                        this.pause();\n                    }\n                });\n                \n                // Window resize - update canvas if fullscreen\n                window.addEventListener('resize', () => {\n                    const isFs = document.fullscreenElement || document.webkitFullscreenElement;\n                    if (isFs && this.isActive) {\n                        this.canvas.width = window.innerWidth;\n                        this.canvas.height = window.innerHeight;\n                    }\n                });\n                \n                // Hotbar clicks\n                document.querySelectorAll('.hotbar-slot').forEach((slot, index) => {\n                    slot.addEventListener('click', (e) => {\n                        e.stopPropagation();\n                        this.selectedSlot = index;\n                        const invSlot = this.inventory.hotbar[index];\n                        if (invSlot) {\n                            if (invSlot.type === 'block') {\n                                this.selectedBlock = invSlot.id;\n                                this.selectedItem = null;\n                            } else if (invSlot.type === 'weapon') {\n                                this.selectedItem = invSlot.id;\n                                this.selectedBlock = null;\n                            }\n                        }\n                        this.updateHotbar();\n                    });\n                });\n            },\n            \n            setupMenus() {\n                // Resume button\n                document.getElementById('btnResume').addEventListener('click', () => this.resume());\n                \n                // Fullscreen toggle button\n                document.getElementById('btnFullscreen').addEventListener('click', (e) => {\n                    e.preventDefault();\n                    const container = document.getElementById('minecraftGame');\n                    const isFs = document.fullscreenElement || document.webkitFullscreenElement;\n                    \n                    if (isFs) {\n                        // Exit fullscreen\n                        if (document.exitFullscreen) {\n                            document.exitFullscreen();\n                        } else if (document.webkitExitFullscreen) {\n                            document.webkitExitFullscreen();\n                        }\n                    } else {\n                        // Enter fullscreen - must be in same click handler\n                        if (container.requestFullscreen) {\n                            container.requestFullscreen().catch(err => console.log('Fullscreen error:', err));\n                        } else if (container.webkitRequestFullscreen) {\n                            container.webkitRequestFullscreen();\n                        }\n                    }\n                    \n                    // Resume game after toggling\n                    this.resume();\n                });\n                \n                // Update button text on fullscreen change\n                document.addEventListener('fullscreenchange', () => this.updateFullscreenButton());\n                document.addEventListener('webkitfullscreenchange', () => this.updateFullscreenButton());\n                \n                // Account button (disabled)\n                document.getElementById('btnAccount').addEventListener('click', (e) => {\n                    e.preventDefault();\n                });\n                \n                // Stats button\n                document.getElementById('btnStats').addEventListener('click', () => {\n                    this.showSubmenu('menuStats');\n                    this.updateStatsDisplay();\n                });\n                \n                // Options button\n                document.getElementById('btnOptions').addEventListener('click', () => {\n                    this.showSubmenu('menuOptions');\n                });\n                \n                // Quit button\n                document.getElementById('btnQuit').addEventListener('click', () => this.stop());\n                \n                // Back buttons\n                document.getElementById('statsBack').addEventListener('click', () => this.showSubmenu('menuMain'));\n                document.getElementById('optionsBack').addEventListener('click', () => this.showSubmenu('menuMain'));\n                \n                // Options controls\n                document.getElementById('optBrightness').addEventListener('input', (e) => {\n                    this.settings.brightness = parseInt((e.target as HTMLInputElement).value);\n                    this.applyFilters();\n                });\n                \n                document.getElementById('optFilter').addEventListener('change', (e) => {\n                    this.settings.filter = (e.target as HTMLInputElement).value;\n                    this.applyFilters();\n                });\n                \n                document.getElementById('optRenderDist').addEventListener('change', (e) => {\n                    this.settings.renderDistance = parseInt((e.target as HTMLInputElement).value);\n                });\n                \n                // Toggle switches\n                ['optShadows', 'optLighting', 'optAA', 'optShowFps'].forEach(id => {\n                    document.getElementById(id).addEventListener('click', (e) => {\n                        const toggle = e.target;\n                        const isOn = (toggle as HTMLElement).dataset.on === 'true';\n                        (toggle as HTMLElement).dataset.on = (!isOn).toString();\n                        (toggle as HTMLElement).classList.toggle('on', !isOn);\n                        \n                        if (id === 'optShadows') this.settings.shadows = !isOn;\n                        if (id === 'optLighting') this.settings.lighting = !isOn;\n                        if (id === 'optAA') {\n                            this.settings.antialiasing = !isOn;\n                            (this.canvas as HTMLCanvasElement).style.imageRendering = !isOn ? 'pixelated' : 'auto';\n                        }\n                        if (id === 'optShowFps') this.settings.showFps = !isOn;\n                    });\n                });\n                \n                // Target FPS slider\n                document.getElementById('optTargetFps').addEventListener('input', (e) => {\n                    const fps = parseInt((e.target as HTMLInputElement).value);\n                    this.settings.targetFps = fps;\n                    document.getElementById('targetFpsValue').textContent = String(fps);\n                });\n            },\n            \n            showSubmenu(menuId) {\n                document.querySelectorAll('.pause-submenu').forEach(m => m.classList.remove('active'));\n                document.getElementById(menuId).classList.add('active');\n            },\n            \n            updateStatsDisplay() {\n                document.getElementById('statPlaced').textContent = this.stats.blocksPlaced;\n                document.getElementById('statBroken').textContent = this.stats.blocksBroken;\n                document.getElementById('statDistance').textContent = String(Math.floor(this.stats.distance)) + 'm';\n                document.getElementById('statJumps').textContent = this.stats.jumps;\n                \n                const elapsed = Math.floor((Date.now() - this.stats.startTime) / 1000);\n                const mins = Math.floor(elapsed / 60);\n                const secs = elapsed % 60;\n                document.getElementById('statTime').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;\n            },\n            \n            applyFilters() {\n                let filter = `brightness(${this.settings.brightness}%)`;\n                \n                switch (this.settings.filter) {\n                    case 'sepia':\n                        filter += ' sepia(80%)';\n                        break;\n                    case 'grayscale':\n                        filter += ' grayscale(100%)';\n                        break;\n                    case 'trippy':\n                        filter += ' hue-rotate(' + (Date.now() % 3600) / 10 + 'deg) saturate(200%)';\n                        break;\n                }\n                \n                (this.canvas as HTMLElement).style.filter = filter;\n            },\n            \n            updateHotbar() {\n                const slots = document.querySelectorAll('.hotbar-slot');\n                slots.forEach((slot, index) => {\n                    const isSelected = index === this.selectedSlot;\n                    slot.classList.toggle('selected', isSelected);\n                });\n            },\n            \n            // Update hotbar display with item counts and icons\n            updateHotbarDisplay() {\n                const slots = document.querySelectorAll('.hotbar-slot');\n                slots.forEach((slot, index) => {\n                    const item = this.inventory.hotbar[index];\n                    const isSelected = index === this.selectedSlot;\n                    slot.classList.toggle('selected', isSelected);\n                    \n                    // Set count attribute\n                    if (item && item.count) {\n                        slot.setAttribute('data-count', item.count);\n                    } else {\n                        slot.setAttribute('data-count', '');\n                    }\n                    \n                    // Clear and redraw canvas\n                    let canvas = slot.querySelector('canvas');\n                    if (!canvas) {\n                        canvas = document.createElement('canvas');\n                        canvas.width = 32;\n                        canvas.height = 32;\n                        (canvas as HTMLElement).style.width = '100%';\n                        (canvas as HTMLElement).style.height = '100%';\n                        (canvas as HTMLElement).style.position = 'absolute';\n                        (canvas as HTMLElement).style.top = '2px';\n                        (canvas as HTMLElement).style.left = '2px';\n                        slot.appendChild(canvas);\n                    }\n                    \n                    if (item) {\n                        this.drawMiniBlock(canvas, item.id);\n                        \n                        // Update durability bar if exists\n                        let durBar = slot.querySelector('.durability-bar');\n                        if (item.durability !== undefined && item.maxDurability) {\n                            if (!durBar) {\n                                durBar = document.createElement('div');\n                                durBar.className = 'durability-bar';\n                                durBar.innerHTML = '<div class=\"durability-fill\"></div>';\n                                slot.appendChild(durBar);\n                            }\n                            const fill = durBar.querySelector('.durability-fill');\n                            const percent = (item.durability / item.maxDurability) * 100;\n                            (fill as HTMLElement).style.width = percent + '%';\n                            (fill as HTMLElement).style.backgroundColor = percent > 50 ? '#4a4' : percent > 25 ? '#aa4' : '#a44';\n                            (durBar as HTMLElement).style.display = 'block';\n                        } else if (durBar) {\n                            (durBar as HTMLElement).style.display = 'none';\n                        }\n                    } else {\n                        // Clear canvas for empty slot\n                        const ctx = canvas.getContext('2d');\n                        ctx.clearRect(0, 0, canvas.width, canvas.height);\n                        // Hide durability bar\n                        const durBar = slot.querySelector('.durability-bar');\n                        if (durBar) (durBar as HTMLElement).style.display = 'none';\n                    }\n                });\n            },\n            \n            // Shoot the KA-69\n            shootAK47() {\n                if (this.shootCooldown > 0) return;\n                \n                // Check durability and reduce it\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.id === 'ka69') {\n                    if (slot.durability !== undefined && slot.durability <= 0) {\n                        // Gun is broken - can't shoot!\n                        this.debugLog('KA-69 is broken! Find the Repair NPC to fix it (15 seeds)', 'warn');\n                        return;\n                    }\n                    // Reduce durability\n                    if (slot.durability !== undefined) {\n                        slot.durability--;\n                        if (slot.durability <= 0) {\n                            // Gun breaks but stays in inventory\n                            slot.durability = 0; // Set to exactly 0\n                            this.debugLog('Your KA-69 broke! Find the Repair NPC (trade 15 seeds)', 'error');\n                        }\n                        this.updateHotbarDisplay();\n                    }\n                }\n                \n                this.shootCooldown = 8; // Frames between shots\n                this.muzzleFlash = 5;   // Frames of muzzle flash\n                \n                // Get shoot direction\n                const pitch = this.camera.rotX;\n                const yaw = this.camera.rotY;\n                const dirX = -Math.sin(yaw) * Math.cos(pitch);\n                const dirY = -Math.sin(pitch);\n                const dirZ = Math.cos(yaw) * Math.cos(pitch);\n                \n                // Create bullet particle\n                const bulletSpeed = 2.5;\n                const bullet = {\n                    x: this.camera.x + dirX * 0.5,\n                    y: this.camera.y + dirY * 0.5,\n                    z: this.camera.z + dirZ * 0.5,\n                    vx: dirX * bulletSpeed,\n                    vy: dirY * bulletSpeed,\n                    vz: dirZ * bulletSpeed,\n                    life: 60,\n                    type: 'bullet',\n                    trail: []\n                };\n                this.particles.push(bullet);\n                \n                // Check for bird hits and apply velocity knockback\n                const knockbackForce = 0.8;\n                let hitBird = null;\n                let hitDist = Infinity;\n                \n                // Check pest birds - find closest hit\n                for (const pest of this.pestBirds) {\n                    const dx = pest.x - this.camera.x;\n                    const dy = pest.y - this.camera.y;\n                    const dz = pest.z - this.camera.z;\n                    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                    \n                    if (dist < 15 && dist < hitDist) {\n                        const birdDirX = dx / dist;\n                        const birdDirY = dy / dist;\n                        const birdDirZ = dz / dist;\n                        const dot = dirX * birdDirX + dirY * birdDirY + dirZ * birdDirZ;\n                        \n                        if (dot > 0.9) {\n                            hitBird = pest;\n                            hitDist = dist;\n                        }\n                    }\n                }\n                \n                // Apply knockback with velocity\n                if (hitBird) {\n                    // Set velocity for knockback animation\n                    hitBird.vx = dirX * knockbackForce + (Math.random() - 0.5) * 0.2;\n                    hitBird.vy = dirY * knockbackForce + 0.3 + Math.random() * 0.2; // Add upward force\n                    hitBird.vz = dirZ * knockbackForce + (Math.random() - 0.5) * 0.2;\n                    hitBird.state = 'knockback';\n                    hitBird.stateTimer = 90;\n                    \n                    // Create ricochet particles\n                    for (let i = 0; i < 8; i++) {\n                        const ricochetSpeed = 0.15 + Math.random() * 0.2;\n                        // Reflect direction with randomness\n                        const rx = -dirX * 0.5 + (Math.random() - 0.5) * 1.5;\n                        const ry = Math.random() * 0.8 + 0.2;\n                        const rz = -dirZ * 0.5 + (Math.random() - 0.5) * 1.5;\n                        const len = Math.sqrt(rx * rx + ry * ry + rz * rz);\n                        \n                        this.particles.push({\n                            x: hitBird.x,\n                            y: hitBird.y,\n                            z: hitBird.z,\n                            vx: (rx / len) * ricochetSpeed,\n                            vy: (ry / len) * ricochetSpeed,\n                            vz: (rz / len) * ricochetSpeed,\n                            life: 25 + Math.random() * 20,\n                            type: 'ricochet',\n                            size: 2 + Math.random() * 3\n                        });\n                    }\n                    \n                    // Feather particles\n                    for (let i = 0; i < 5; i++) {\n                        this.particles.push({\n                            x: hitBird.x + (Math.random() - 0.5) * 0.3,\n                            y: hitBird.y + (Math.random() - 0.5) * 0.3,\n                            z: hitBird.z + (Math.random() - 0.5) * 0.3,\n                            vx: (Math.random() - 0.5) * 0.1,\n                            vy: 0.05 + Math.random() * 0.05,\n                            vz: (Math.random() - 0.5) * 0.1,\n                            life: 40 + Math.random() * 30,\n                            type: 'feather',\n                            rotation: Math.random() * Math.PI * 2,\n                            rotSpeed: (Math.random() - 0.5) * 0.3\n                        });\n                    }\n                    \n                    // Birds bounce player around when shot!\n                    // Small random knockback to player\n                    const playerKnockback = 0.08 + Math.random() * 0.05;\n                    this.velocity.y += 0.05 + Math.random() * 0.03;  // Small upward bump\n                    // Push player away from bird\n                    const toBirdX = hitBird.x - this.camera.x;\n                    const toBirdZ = hitBird.z - this.camera.z;\n                    const toBirdDist = Math.sqrt(toBirdX * toBirdX + toBirdZ * toBirdZ);\n                    if (toBirdDist > 0.1) {\n                        // Push player in random direction with slight bias away from bird\n                        this.camera.x -= (toBirdX / toBirdDist) * playerKnockback * 0.3 + (Math.random() - 0.5) * playerKnockback;\n                        this.camera.z -= (toBirdZ / toBirdDist) * playerKnockback * 0.3 + (Math.random() - 0.5) * playerKnockback;\n                    }\n                    \n                    // Special spawn chances!\n                    const spawnRoll = Math.random();\n                    let birdsToSpawn = 0;\n                    \n                    if (spawnRoll < 0.01) {\n                        // 1/100 chance: SWARM! 20 birds spawn\n                        birdsToSpawn = 20;\n                    } else if (spawnRoll < 0.1) {\n                        // 1/10 chance: 5 birds spawn\n                        birdsToSpawn = 5;\n                    }\n                    \n                    // Spawn the extra birds\n                    for (let i = 0; i < birdsToSpawn; i++) {\n                        const newAngle = Math.random() * Math.PI * 2;\n                        const newRadius = 2 + Math.random() * 3;\n                        this.pestBirds.push({\n                            x: hitBird.x + Math.cos(newAngle) * newRadius,\n                            y: hitBird.y + (Math.random() - 0.5) * 2,\n                            z: hitBird.z + Math.sin(newAngle) * newRadius,\n                            vx: 0, vy: 0, vz: 0,\n                            targetOffsetX: 0, targetOffsetY: 0, targetOffsetZ: 0,\n                            state: 'circling',\n                            stateTimer: 10 + Math.random() * 20,\n                            angle: newAngle,\n                            circleRadius: newRadius,\n                            baseCircleRadius: newRadius,\n                            circleSpeed: 0.07 + Math.random() * 0.05,\n                            swoopProgress: 0,\n                            wingPhase: Math.random() * Math.PI * 2,\n                            size: 0.15 + Math.random() * 0.08,\n                            chirpTimer: Math.random() * 30,\n                            knockbackSpin: 0,\n                            anger: 1 + Math.floor(Math.random() * 3), // Spawned angry (1-3)\n                            timesShot: 0,\n                            spawnThreshold: 4 + Math.floor(Math.random() * 4)\n                        });\n                    }\n                }\n                \n                // Check regular birds\n                for (const bird of this.birds) {\n                    const dx = bird.x - this.camera.x;\n                    const dy = bird.y - this.camera.y;\n                    const dz = bird.z - this.camera.z;\n                    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                    \n                    if (dist < 25) {\n                        const birdDirX = dx / dist;\n                        const birdDirY = dy / dist;\n                        const birdDirZ = dz / dist;\n                        const dot = dirX * birdDirX + dirY * birdDirY + dirZ * birdDirZ;\n                        \n                        if (dot > 0.85) {\n                            // Knock away by modifying orbit\n                            bird.radius += 8;\n                            bird.baseY += 5;\n                            \n                            // Create some ricochet sparks\n                            for (let i = 0; i < 5; i++) {\n                                this.particles.push({\n                                    x: bird.x,\n                                    y: bird.y,\n                                    z: bird.z,\n                                    vx: (Math.random() - 0.5) * 0.3,\n                                    vy: Math.random() * 0.2,\n                                    vz: (Math.random() - 0.5) * 0.3,\n                                    life: 20 + Math.random() * 15,\n                                    type: 'ricochet',\n                                    size: 2 + Math.random() * 2\n                                });\n                            }\n                        }\n                    }\n                }\n            },\n            \n            // Update particles\n            updateParticles() {\n                for (let i = this.particles.length - 1; i >= 0; i--) {\n                    const p = this.particles[i];\n                    p.life--;\n                    \n                    if (p.life <= 0) {\n                        this.particles.splice(i, 1);\n                        continue;\n                    }\n                    \n                    // Update position\n                    p.x += p.vx;\n                    p.y += p.vy;\n                    p.z += p.vz;\n                    \n                    if (p.type === 'bullet') {\n                        // Store trail positions\n                        p.trail.push({ x: p.x, y: p.y, z: p.z });\n                        if (p.trail.length > 8) p.trail.shift();\n                        \n                        // Check for block collision\n                        const bx = Math.floor(p.x);\n                        const by = Math.floor(p.y);\n                        const bz = Math.floor(p.z);\n                        if (this.getBlock(bx, by, bz)) {\n                            // Hit a block - create impact sparks\n                            for (let j = 0; j < 6; j++) {\n                                this.particles.push({\n                                    x: p.x,\n                                    y: p.y,\n                                    z: p.z,\n                                    vx: (Math.random() - 0.5) * 0.2,\n                                    vy: Math.random() * 0.15,\n                                    vz: (Math.random() - 0.5) * 0.2,\n                                    life: 15 + Math.random() * 10,\n                                    type: 'spark',\n                                    size: 2 + Math.random() * 2\n                                });\n                            }\n                            this.particles.splice(i, 1);\n                        }\n                    } else if (p.type === 'ricochet' || p.type === 'spark') {\n                        p.vy -= 0.008; // Gravity\n                        p.vx *= 0.97;\n                        p.vz *= 0.97;\n                    } else if (p.type === 'feather') {\n                        p.vy -= 0.002; // Light gravity\n                        p.vx *= 0.98;\n                        p.vz *= 0.98;\n                        p.rotation += p.rotSpeed;\n                    } else if (p.type === 'burger') {\n                        // Burger projectile - flies fast, affected slightly by gravity\n                        p.vy -= 0.003;\n                        // Check for bird collision\n                        for (const pest of this.pestBirds) {\n                            const dx = pest.x - p.x;\n                            const dy = pest.y - p.y;\n                            const dz = pest.z - p.z;\n                            const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                            if (dist < 1.5) {\n                                // Hit! Send bird flying and enrage it\n                                const knockForce = 2.5;\n                                pest.vx = (p.vx * 0.5) + (dx / dist) * knockForce;\n                                pest.vy = Math.abs(p.vy) + 0.5;\n                                pest.vz = (p.vz * 0.5) + (dz / dist) * knockForce;\n                                pest.state = 'knockback';\n                                pest.stateTimer = 120;\n                                pest.anger = Math.min(5, pest.anger + 2); // Extra anger from burgers!\n                                p.life = 0; // Burger consumed\n                                \n                                // Burger splat particles\n                                for (let j = 0; j < 8; j++) {\n                                    this.particles.push({\n                                        x: p.x, y: p.y, z: p.z,\n                                        vx: (Math.random() - 0.5) * 0.3,\n                                        vy: Math.random() * 0.2,\n                                        vz: (Math.random() - 0.5) * 0.3,\n                                        life: 20,\n                                        type: 'burgerSplat',\n                                        size: 3 + Math.random() * 3\n                                    });\n                                }\n                            }\n                        }\n                    } else if (p.type === 'burgerSplat') {\n                        p.vy -= 0.01;\n                        p.vx *= 0.95;\n                        p.vz *= 0.95;\n                    } else if (p.type === 'apple') {\n                        // Apple projectile - flies with arc, knocks birds away\n                        p.vy += (p.gravity || -0.008);\n                        // Check for bird collision\n                        for (const pest of this.pestBirds) {\n                            const dx = pest.x - p.x;\n                            const dy = pest.y - p.y;\n                            const dz = pest.z - p.z;\n                            const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                            if (dist < 1.5) {\n                                // Hit! Send bird flying but DON'T enrage it\n                                const knockForce = 3.0;\n                                pest.vx = (p.vx * 0.5) + (dx / dist) * knockForce;\n                                pest.vy = 0.8; // Pop up\n                                pest.vz = (p.vz * 0.5) + (dz / dist) * knockForce;\n                                pest.state = 'knockback';\n                                pest.stateTimer = 180; // Longer stun\n                                // Apples calm birds slightly\n                                pest.anger = Math.max(0, pest.anger - 0.5);\n                                p.life = 0;\n                                \n                                // Score for hitting bird\n                                if (this.survivalStats) {\n                                    this.survivalStats.score += 50;\n                                    this.updateSurvivalHUD();\n                                }\n                                \n                                // Apple splat particles\n                                for (let j = 0; j < 6; j++) {\n                                    this.particles.push({\n                                        x: p.x, y: p.y, z: p.z,\n                                        vx: (Math.random() - 0.5) * 0.3,\n                                        vy: Math.random() * 0.2,\n                                        vz: (Math.random() - 0.5) * 0.3,\n                                        life: 15,\n                                        type: 'appleSplat',\n                                        size: 2 + Math.random() * 2\n                                    });\n                                }\n                            }\n                        }\n                        // Check for decorative bird collision during swarm\n                        for (const bird of this.birds) {\n                            if (bird.swarmMode) {\n                                const dx = bird.x - p.x;\n                                const dy = bird.y - p.y;\n                                const dz = bird.z - p.z;\n                                const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                                if (dist < 2) {\n                                    bird.swarmMode = false;\n                                    bird.swarmTimer = 0;\n                                    p.life = 0;\n                                    if (this.survivalStats) {\n                                        this.survivalStats.score += 25;\n                                        this.updateSurvivalHUD();\n                                    }\n                                }\n                            }\n                        }\n                        // Hit ground\n                        const groundY = this.getGroundHeightBelow(p.x, p.z, p.y + 10);\n                        if (p.y <= groundY + 0.5) {\n                            p.life = 0;\n                        }\n                    } else if (p.type === 'appleSplat') {\n                        p.vy -= 0.015;\n                        p.vx *= 0.9;\n                        p.vz *= 0.9;\n                    } else if (p.type === 'petal') {\n                        // Cherry blossom petals - float and flutter with wind\n                        p.vy -= 0.0008; // Very light gravity for graceful fall\n                        p.vx += this.wind.x * 0.15;\n                        p.vz += this.wind.z * 0.15;\n                        p.vx *= 0.985;\n                        p.vz *= 0.985;\n                        p.rotation += p.rotSpeed + this.wind.x * 0.08;\n                        p.flutter += p.flutterSpeed || 0.08;\n                        \n                        // More complex flutter pattern - both horizontal sway and tumbling\n                        p.x += Math.sin(p.flutter) * 0.025;\n                        p.y += Math.cos(p.flutter * 1.3) * 0.008; // Slight vertical bob\n                        p.z += Math.cos(p.flutter * 0.7) * 0.015;\n                        \n                        // Hit ground - disappear\n                        if (p.y < this.getGroundHeightBelow(p.x, p.z, p.y + 10) + 1) {\n                            p.life = 0;\n                        }\n                    }\n                }\n            },\n            \n            // Wind system - creates natural gusts that affect petals and birds\n            updateWind() {\n                this.wind.gustTimer++;\n                \n                // Change wind direction occasionally (gusts)\n                if (this.wind.gustTimer > 120 + Math.random() * 180) {\n                    this.wind.gustTimer = 0;\n                    // New target wind direction\n                    const gustStrength = 0.01 + Math.random() * 0.04;\n                    const gustAngle = Math.random() * Math.PI * 2;\n                    this.wind.targetX = Math.cos(gustAngle) * gustStrength;\n                    this.wind.targetZ = Math.sin(gustAngle) * gustStrength;\n                }\n                \n                // Smoothly interpolate toward target\n                this.wind.x += (this.wind.targetX - this.wind.x) * 0.02;\n                this.wind.z += (this.wind.targetZ - this.wind.z) * 0.02;\n                \n                // Add small random turbulence\n                this.wind.x += (Math.random() - 0.5) * 0.002;\n                this.wind.z += (Math.random() - 0.5) * 0.002;\n            },\n            \n            // Spawn cherry blossom petals near trees\n            updatePetals() {\n                if (!this.cherryTrees || this.cherryTrees.length === 0) return;\n                \n                // Count current petals\n                const currentPetals = this.particles.filter(p => p.type === 'petal').length;\n                const maxPetals = 150; // Performance cap\n                \n                // Spawn multiple petals per frame for dense shower effect\n                const petalsToSpawn = Math.min(5, maxPetals - currentPetals); // Spawn up to 5 per frame\n                \n                for (let i = 0; i < petalsToSpawn; i++) {\n                    // 60% chance per slot to actually spawn (creates natural variation)\n                    if (Math.random() > 0.6) continue;\n                    \n                    // Pick a random cherry tree\n                    const tree = this.cherryTrees[Math.floor(Math.random() * this.cherryTrees.length)];\n                    const dist = Math.sqrt((tree.x - this.camera.x) ** 2 + (tree.z - this.camera.z) ** 2);\n                    \n                    // Spawn petals for trees within range, with falloff\n                    const spawnRange = 40;\n                    if (dist < spawnRange) {\n                        // Higher spawn chance for closer trees\n                        const spawnChance = 1 - (dist / spawnRange) * 0.5;\n                        if (Math.random() < spawnChance) {\n                            // Wider spawn area around tree canopy\n                            const spreadX = (Math.random() - 0.5) * 10;\n                            const spreadZ = (Math.random() - 0.5) * 10;\n                            \n                            // Also spawn some petals floating in the air (wind-carried)\n                            const heightBonus = Math.random() < 0.3 ? Math.random() * 8 : 0;\n                            \n                            this.particles.push({\n                                x: tree.x + spreadX,\n                                y: tree.y + Math.random() * 3 + heightBonus,\n                                z: tree.z + spreadZ,\n                                vx: this.wind.x * 1.5 + (Math.random() - 0.5) * 0.03,\n                                vy: -0.008 - Math.random() * 0.015, // Slower fall for more graceful effect\n                                vz: this.wind.z * 1.5 + (Math.random() - 0.5) * 0.03,\n                                life: 250 + Math.random() * 200, // Longer life\n                                type: 'petal',\n                                size: 2.5 + Math.random() * 2.5,\n                                rotation: Math.random() * Math.PI * 2,\n                                rotSpeed: (Math.random() - 0.5) * 0.15,\n                                flutter: Math.random() * Math.PI * 2,\n                                flutterSpeed: 0.05 + Math.random() * 0.05\n                            });\n                        }\n                    }\n                }\n                \n                // Also spawn ambient petals in the air around player (wind-blown)\n                if (currentPetals < maxPetals * 0.8 && Math.random() < 0.3) {\n                    const angle = Math.random() * Math.PI * 2;\n                    const radius = 10 + Math.random() * 20;\n                    this.particles.push({\n                        x: this.camera.x + Math.cos(angle) * radius,\n                        y: this.camera.y + 5 + Math.random() * 10,\n                        z: this.camera.z + Math.sin(angle) * radius,\n                        vx: this.wind.x * 2 + (Math.random() - 0.5) * 0.02,\n                        vy: -0.005 - Math.random() * 0.01,\n                        vz: this.wind.z * 2 + (Math.random() - 0.5) * 0.02,\n                        life: 150 + Math.random() * 100,\n                        type: 'petal',\n                        size: 2 + Math.random() * 2,\n                        rotation: Math.random() * Math.PI * 2,\n                        rotSpeed: (Math.random() - 0.5) * 0.12,\n                        flutter: Math.random() * Math.PI * 2,\n                        flutterSpeed: 0.04 + Math.random() * 0.04\n                    });\n                }\n            },\n            \n            // Drop an item on the ground\n            dropItem(x, y, z, type, count) {\n                if (!this.droppedItems) this.droppedItems = [];\n                this.droppedItems.push({\n                    x: x + (Math.random() - 0.5) * 0.3,\n                    y: y,\n                    z: z + (Math.random() - 0.5) * 0.3,\n                    vy: 0.1 + Math.random() * 0.05,\n                    type: type,\n                    count: count,\n                    bobPhase: Math.random() * Math.PI * 2,\n                    pickupDelay: 30 // Frames before can be picked up\n                });\n            },\n            \n            // Update dropped items (physics and pickup)\n            updateDroppedItems() {\n                if (!this.droppedItems) return;\n                \n                for (let i = this.droppedItems.length - 1; i >= 0; i--) {\n                    const item = this.droppedItems[i];\n                    \n                    // Pickup delay\n                    if (item.pickupDelay > 0) item.pickupDelay--;\n                    \n                    // Physics\n                    item.vy -= 0.015; // Gravity\n                    item.y += item.vy;\n                    \n                    // Ground collision\n                    const groundY = this.getGroundHeightBelow(item.x, item.z, item.y + 5) + 1.3;\n                    if (item.y < groundY) {\n                        item.y = groundY;\n                        item.vy = 0;\n                    }\n                    \n                    // Bobbing animation\n                    item.bobPhase += 0.05;\n                    \n                    // Check pickup by player\n                    if (item.pickupDelay <= 0) {\n                        const dx = item.x - this.camera.x;\n                        const dy = item.y - this.camera.y;\n                        const dz = item.z - this.camera.z;\n                        const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                        \n                        if (dist < 2) {\n                            // Try to add to inventory\n                            if (this.addToInventory(item.type, item.count)) {\n                                this.droppedItems.splice(i, 1);\n                            }\n                        }\n                    }\n                }\n            },\n            \n            // Add item to inventory (hotbar first, then main inventory)\n            addToInventory(type, count) {\n                // Determine item category\n                let itemType = 'block';  // Default\n                if (type === 'ka69' || type === 'berdger') itemType = 'weapon';\n                if (type === 'water_bucket' || type === 'lava_bucket') itemType = 'bucket';\n                if (this.ritualItems && this.ritualItems.includes(type)) itemType = 'item';\n                if (type === 'seeds' || type === 'apple') itemType = 'item';\n                \n                // Show pickup animation\n                this.showPickupNotification(type, count);\n                \n                // Try to stack with existing items in hotbar first\n                for (let i = 0; i < 9; i++) {\n                    const slot = this.inventory.hotbar[i];\n                    if (slot && (slot.id === type || slot.type === type) && slot.count < 64) {\n                        const canAdd = Math.min(count, 64 - slot.count);\n                        slot.count += canAdd;\n                        count -= canAdd;\n                        if (count <= 0) {\n                            this.updateHotbarDisplay();\n                            return true;\n                        }\n                    }\n                }\n                \n                // Try to stack with existing items in main inventory\n                for (let i = 0; i < 27; i++) {\n                    const slot = this.inventory.main[i];\n                    if (slot && (slot.id === type || slot.type === type) && slot.count < 64) {\n                        const canAdd = Math.min(count, 64 - slot.count);\n                        slot.count += canAdd;\n                        count -= canAdd;\n                        if (count <= 0) {\n                            this.updateHotbarDisplay();\n                            return true;\n                        }\n                    }\n                }\n                \n                // Find empty slot in hotbar\n                for (let i = 0; i < 9; i++) {\n                    if (!this.inventory.hotbar[i]) {\n                        const itemDef = this.itemTypes[type] || {};\n                        this.inventory.hotbar[i] = { \n                            type: itemType, \n                            id: type, \n                            count,\n                            durability: itemDef.durability,\n                            maxDurability: itemDef.maxDurability\n                        };\n                        this.updateHotbarDisplay();\n                        return true;\n                    }\n                }\n                \n                // Find empty slot in main inventory\n                for (let i = 0; i < 27; i++) {\n                    if (!this.inventory.main[i]) {\n                        const itemDef = this.itemTypes[type] || {};\n                        this.inventory.main[i] = { \n                            type: itemType, \n                            id: type, \n                            count,\n                            durability: itemDef.durability,\n                            maxDurability: itemDef.maxDurability\n                        };\n                        this.updateHotbarDisplay();\n                        return true;\n                    }\n                }\n                \n                return false; // All inventory full\n            },\n            \n            // Show pickup notification (uses batch queue for multiple pickups)\n            showPickupNotification(type, count) {\n                // Handle broken items immediately (don't batch)\n                if (count < 0) {\n                    const container = document.getElementById('pickupNotification');\n                    if (!container) return;\n                    \n                    const itemNames = {\n                        grass: 'Grass Block', dirt: 'Dirt', stone: 'Stone', wood: 'Wood',\n                        appleLeaves: 'Apple Leaves', leaves: 'Leaves', sand: 'Sand', brick: 'Brick',\n                        ka69: 'KA-69', water_bucket: 'Water Bucket', lava_bucket: 'Lava Bucket',\n                        obsidian: 'Obsidian', cherryWood: 'Cherry Wood', cherryLeaves: 'Cherry Leaves',\n                        chest: 'Chest', seeds: 'Seeds', berdger: 'The Berdger', apple: 'Apple',\n                        sakuraPetal: 'Cherry Petal', shimenawa: 'Sacred Rope', omamori: 'Charm',\n                        ema: 'Wish Plaque', incense: 'Incense', whiteBrick: 'White Brick',\n                        redBrick: 'Red Brick', glowstone: 'Glowstone', ritualStone: 'Ritual Stone'\n                    };\n                    \n                    const notification = document.createElement('div');\n                    notification.className = 'pickup-item';\n                    (notification as HTMLElement).style.borderColor = 'rgba(255, 50, 50, 0.8)';\n                    notification.innerHTML = `\n                        <span class=\"pickup-icon\">üíî</span>\n                        <span style=\"color:#ff6666\">${itemNames[type] || type} broke!</span>\n                    `;\n                    container.appendChild(notification);\n                    setTimeout(() => {\n                        if (notification.parentNode) {\n                            notification.parentNode.removeChild(notification);\n                        }\n                    }, 2000);\n                    return;\n                }\n                \n                // Use batch queue for normal pickups\n                this.queuePickupNotification(type, count);\n            },\n            \n            // Draw a mini 3D block for inventory display\n            drawMiniBlock(canvas, type) {\n                const ctx = canvas.getContext('2d');\n                const colors = this.blockColors[type];\n                const w = canvas.width;\n                const h = canvas.height;\n                \n                ctx.clearRect(0, 0, w, h);\n                \n                const cx = w / 2;\n                const cy = h / 2;\n                const size = Math.min(w, h) * 0.35;\n                \n                // Special item rendering for non-blocks\n                if (!colors) {\n                    ctx.save();\n                    ctx.translate(cx, cy);\n                    \n                    if (type === 'apple') {\n                        // Red apple\n                        ctx.fillStyle = '#dc143c';\n                        ctx.beginPath();\n                        ctx.arc(0, 0, size * 0.7, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.fillStyle = 'rgba(255,255,255,0.3)';\n                        ctx.beginPath();\n                        ctx.arc(-size * 0.2, -size * 0.2, size * 0.25, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-1, -size * 0.8, 3, size * 0.3);\n                        ctx.fillStyle = '#228b22';\n                        ctx.beginPath();\n                        ctx.ellipse(3, -size * 0.7, 4, 2, 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (type === 'seeds') {\n                        ctx.fillStyle = '#daa520';\n                        for (let i = 0; i < 5; i++) {\n                            const angle = (i / 5) * Math.PI * 2;\n                            const sx = Math.cos(angle) * size * 0.4;\n                            const sy = Math.sin(angle) * size * 0.3;\n                            ctx.beginPath();\n                            ctx.ellipse(sx, sy, 3, 5, angle, 0, Math.PI * 2);\n                            ctx.fill();\n                        }\n                    } else if (type === 'ka69') {\n                        ctx.fillStyle = '#333';\n                        ctx.fillRect(-size * 0.6, -size * 0.1, size * 1.2, size * 0.25);\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-size * 0.3, size * 0.1, size * 0.4, size * 0.4);\n                        ctx.fillStyle = '#222';\n                        ctx.fillRect(size * 0.1, size * 0.1, size * 0.15, size * 0.35);\n                    } else if (type === 'berdger') {\n                        ctx.fillStyle = '#daa520';\n                        ctx.beginPath();\n                        ctx.ellipse(0, -size * 0.3, size * 0.5, size * 0.25, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-size * 0.4, -size * 0.15, size * 0.8, size * 0.2);\n                        ctx.fillStyle = '#228b22';\n                        ctx.fillRect(-size * 0.35, -size * 0.05, size * 0.7, size * 0.1);\n                        ctx.fillStyle = '#daa520';\n                        ctx.beginPath();\n                        ctx.ellipse(0, size * 0.2, size * 0.55, size * 0.3, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (type === 'water_bucket' || type === 'lava_bucket') {\n                        ctx.fillStyle = '#888';\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.4, -size * 0.3);\n                        ctx.lineTo(size * 0.4, -size * 0.3);\n                        ctx.lineTo(size * 0.3, size * 0.5);\n                        ctx.lineTo(-size * 0.3, size * 0.5);\n                        ctx.closePath();\n                        ctx.fill();\n                        ctx.fillStyle = type === 'water_bucket' ? '#4a90d9' : '#ff6600';\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.3, -size * 0.1);\n                        ctx.lineTo(size * 0.3, -size * 0.1);\n                        ctx.lineTo(size * 0.25, size * 0.4);\n                        ctx.lineTo(-size * 0.25, size * 0.4);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else if (type === 'sakuraPetal') {\n                        ctx.fillStyle = '#ffb7c5';\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size * 0.6, size * 0.3, 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (type === 'shimenawa') {\n                        ctx.strokeStyle = '#daa520';\n                        ctx.lineWidth = 4;\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.5, 0);\n                        ctx.quadraticCurveTo(0, -size * 0.4, size * 0.5, 0);\n                        ctx.stroke();\n                    } else if (type === 'omamori') {\n                        ctx.fillStyle = '#cc0000';\n                        ctx.fillRect(-size * 0.3, -size * 0.5, size * 0.6, size);\n                        ctx.fillStyle = '#ffd700';\n                        ctx.fillRect(-size * 0.25, -size * 0.35, size * 0.5, size * 0.15);\n                    } else if (type === 'ema') {\n                        ctx.fillStyle = '#deb887';\n                        ctx.beginPath();\n                        ctx.moveTo(0, -size * 0.5);\n                        ctx.lineTo(size * 0.4, -size * 0.2);\n                        ctx.lineTo(size * 0.4, size * 0.4);\n                        ctx.lineTo(-size * 0.4, size * 0.4);\n                        ctx.lineTo(-size * 0.4, -size * 0.2);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else if (type === 'incense') {\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-1, -size * 0.6, 3, size * 1.2);\n                        ctx.fillStyle = '#ff6600';\n                        ctx.beginPath();\n                        ctx.arc(0.5, -size * 0.6, 3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else {\n                        // Unknown item - draw placeholder\n                        ctx.fillStyle = '#888';\n                        ctx.fillRect(-size * 0.4, -size * 0.4, size * 0.8, size * 0.8);\n                        ctx.fillStyle = '#444';\n                        ctx.font = '8px monospace';\n                        ctx.textAlign = 'center';\n                        ctx.fillText('?', 0, 3);\n                    }\n                    ctx.restore();\n                    return;\n                }\n                \n                // Isometric 3D block drawing for blocks\n                const blockSize = Math.min(w, h) * 0.25;\n                \n                // Handle rgba colors for transparent blocks like water\n                let topColor = colors.top;\n                let sideColor = colors.side;\n                if (typeof topColor === 'string' && topColor.includes('rgba')) {\n                    // Make opaque for icon display\n                    topColor = topColor.replace(/[\\d.]+\\)$/, '1)');\n                    sideColor = sideColor.replace(/[\\d.]+\\)$/, '1)');\n                }\n                \n                // Top face (brightest)\n                ctx.fillStyle = topColor;\n                ctx.beginPath();\n                ctx.moveTo(cx, cy - blockSize);\n                ctx.lineTo(cx + blockSize, cy - blockSize/2);\n                ctx.lineTo(cx, cy);\n                ctx.lineTo(cx - blockSize, cy - blockSize/2);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Left face (medium)\n                ctx.fillStyle = sideColor;\n                ctx.beginPath();\n                ctx.moveTo(cx - blockSize, cy - blockSize/2);\n                ctx.lineTo(cx, cy);\n                ctx.lineTo(cx, cy + blockSize);\n                ctx.lineTo(cx - blockSize, cy + blockSize/2);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Right face (darkest)\n                let rightColor;\n                try {\n                    rightColor = this.darkenColor(sideColor.replace(/rgba?\\([^)]+\\)/, '#888888'), 0.7);\n                } catch(e) {\n                    rightColor = this.darkenColor(sideColor, 0.7);\n                }\n                ctx.fillStyle = rightColor;\n                ctx.beginPath();\n                ctx.moveTo(cx, cy);\n                ctx.lineTo(cx + blockSize, cy - blockSize/2);\n                ctx.lineTo(cx + blockSize, cy + blockSize/2);\n                ctx.lineTo(cx, cy + blockSize);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Outline\n                ctx.strokeStyle = 'rgba(0,0,0,0.3)';\n                ctx.lineWidth = 0.5;\n                ctx.beginPath();\n                ctx.moveTo(cx, cy - size);\n                ctx.lineTo(cx + size, cy - size/2);\n                ctx.lineTo(cx + size, cy + size/2);\n                ctx.lineTo(cx, cy + size);\n                ctx.lineTo(cx - size, cy + size/2);\n                ctx.lineTo(cx - size, cy - size/2);\n                ctx.closePath();\n                ctx.stroke();\n            },\n            \n            // Draw 3D item for dropped items in the world\n            drawDroppedItem3D(ctx, cx, cy, size, type, bobPhase) {\n                const colors = this.blockColors[type];\n                const rotation = (bobPhase || 0) * 0.5; // Slowly rotate\n                \n                ctx.save();\n                ctx.translate(cx, cy);\n                \n                // Non-block items get special rendering\n                if (!colors) {\n                    // Special item rendering\n                    if (type === 'apple') {\n                        // Red apple\n                        ctx.fillStyle = '#dc143c';\n                        ctx.beginPath();\n                        ctx.arc(0, 0, size * 0.8, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Highlight\n                        ctx.fillStyle = 'rgba(255,255,255,0.3)';\n                        ctx.beginPath();\n                        ctx.arc(-size * 0.2, -size * 0.2, size * 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Stem\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-1, -size * 0.9, 2, size * 0.3);\n                        ctx.fillStyle = '#228b22';\n                        ctx.beginPath();\n                        ctx.ellipse(2, -size * 0.8, 3, 2, 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (type === 'seeds') {\n                        // Wheat seeds\n                        ctx.fillStyle = '#daa520';\n                        for (let i = 0; i < 5; i++) {\n                            const angle = (i / 5) * Math.PI * 2 + rotation;\n                            const sx = Math.cos(angle) * size * 0.4;\n                            const sy = Math.sin(angle) * size * 0.3;\n                            ctx.beginPath();\n                            ctx.ellipse(sx, sy, size * 0.2, size * 0.1, angle, 0, Math.PI * 2);\n                            ctx.fill();\n                        }\n                    } else if (type === 'ka69') {\n                        // Gun silhouette\n                        ctx.fillStyle = '#333';\n                        ctx.fillRect(-size * 0.8, -size * 0.15, size * 1.6, size * 0.3);\n                        ctx.fillRect(-size * 0.3, -size * 0.15, size * 0.15, size * 0.5);\n                        ctx.fillRect(size * 0.3, -size * 0.4, size * 0.5, size * 0.25);\n                    } else if (type === 'berdger') {\n                        // Mini burger\n                        ctx.fillStyle = '#D2691E';\n                        ctx.beginPath();\n                        ctx.ellipse(0, -size * 0.2, size * 0.7, size * 0.35, 0, Math.PI, 0);\n                        ctx.fill();\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-size * 0.6, -size * 0.1, size * 1.2, size * 0.25);\n                        ctx.fillStyle = '#228B22';\n                        ctx.fillRect(-size * 0.55, size * 0.1, size * 1.1, size * 0.1);\n                        ctx.fillStyle = '#DEB887';\n                        ctx.beginPath();\n                        ctx.ellipse(0, size * 0.25, size * 0.65, size * 0.3, 0, 0, Math.PI);\n                        ctx.fill();\n                    } else if (type === 'water_bucket' || type === 'lava_bucket') {\n                        // Bucket\n                        ctx.fillStyle = '#888';\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.5, -size * 0.5);\n                        ctx.lineTo(size * 0.5, -size * 0.5);\n                        ctx.lineTo(size * 0.4, size * 0.5);\n                        ctx.lineTo(-size * 0.4, size * 0.5);\n                        ctx.closePath();\n                        ctx.fill();\n                        // Contents\n                        ctx.fillStyle = type === 'water_bucket' ? '#4a90d9' : '#ff6600';\n                        ctx.fillRect(-size * 0.35, -size * 0.3, size * 0.7, size * 0.6);\n                        // Handle\n                        ctx.strokeStyle = '#666';\n                        ctx.lineWidth = 2;\n                        ctx.beginPath();\n                        ctx.arc(0, -size * 0.6, size * 0.4, Math.PI * 0.2, Math.PI * 0.8);\n                        ctx.stroke();\n                    } else if (type === 'sakuraPetal') {\n                        // Pink petal\n                        ctx.fillStyle = '#ffb7c5';\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size * 0.6, size * 0.3, rotation, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (type === 'shimenawa') {\n                        // Sacred rope\n                        ctx.strokeStyle = '#daa520';\n                        ctx.lineWidth = size * 0.2;\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.6, 0);\n                        ctx.bezierCurveTo(-size * 0.3, -size * 0.4, size * 0.3, size * 0.4, size * 0.6, 0);\n                        ctx.stroke();\n                    } else if (type === 'omamori') {\n                        // Charm\n                        ctx.fillStyle = '#ff4444';\n                        ctx.fillRect(-size * 0.3, -size * 0.5, size * 0.6, size * 0.8);\n                        ctx.fillStyle = '#gold';\n                        ctx.fillRect(-size * 0.2, -size * 0.4, size * 0.4, size * 0.15);\n                    } else if (type === 'ema') {\n                        // Wooden plaque\n                        ctx.fillStyle = '#deb887';\n                        ctx.beginPath();\n                        ctx.moveTo(0, -size * 0.6);\n                        ctx.lineTo(size * 0.5, -size * 0.2);\n                        ctx.lineTo(size * 0.5, size * 0.5);\n                        ctx.lineTo(-size * 0.5, size * 0.5);\n                        ctx.lineTo(-size * 0.5, -size * 0.2);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else if (type === 'incense') {\n                        // Incense stick\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-1, -size * 0.6, 2, size * 1.2);\n                        ctx.fillStyle = '#ff6600';\n                        ctx.beginPath();\n                        ctx.arc(0, -size * 0.6, 3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else {\n                        // Default cube for unknown items\n                        ctx.fillStyle = '#888';\n                        ctx.fillRect(-size * 0.5, -size * 0.5, size, size);\n                    }\n                    ctx.restore();\n                    return;\n                }\n                \n                // Block items - draw isometric cube\n                const s = size * 0.8;\n                \n                // Top face\n                ctx.fillStyle = colors.top;\n                ctx.beginPath();\n                ctx.moveTo(0, -s);\n                ctx.lineTo(s, -s/2);\n                ctx.lineTo(0, 0);\n                ctx.lineTo(-s, -s/2);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Left face\n                ctx.fillStyle = colors.side;\n                ctx.beginPath();\n                ctx.moveTo(-s, -s/2);\n                ctx.lineTo(0, 0);\n                ctx.lineTo(0, s);\n                ctx.lineTo(-s, s/2);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Right face\n                ctx.fillStyle = this.darkenColor(colors.side, 0.7);\n                ctx.beginPath();\n                ctx.moveTo(0, 0);\n                ctx.lineTo(s, -s/2);\n                ctx.lineTo(s, s/2);\n                ctx.lineTo(0, s);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Outline\n                ctx.strokeStyle = 'rgba(0,0,0,0.4)';\n                ctx.lineWidth = 1;\n                ctx.beginPath();\n                ctx.moveTo(0, -s);\n                ctx.lineTo(s, -s/2);\n                ctx.lineTo(s, s/2);\n                ctx.lineTo(0, s);\n                ctx.lineTo(-s, s/2);\n                ctx.lineTo(-s, -s/2);\n                ctx.closePath();\n                ctx.stroke();\n                \n                ctx.restore();\n            },\n            \n\n            // Use seeds to calm birds\n            useSeeds() {\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.id === 'seeds' && slot.count > 0) {\n                    slot.count--;\n                    if (slot.count <= 0) {\n                        this.inventory.hotbar[this.selectedSlot] = null;\n                        this.selectedItem = null;\n                    }\n                    this.updateHotbarDisplay();\n                    \n                    // Calm birds for 10 seconds (600 frames)\n                    this.seedCalmTimer = 600;\n                    \n                    // Visual effect - toss seeds\n                    for (let i = 0; i < 10; i++) {\n                        this.particles.push({\n                            x: this.camera.x + (Math.random() - 0.5) * 2,\n                            y: this.camera.y - 0.5,\n                            z: this.camera.z + (Math.random() - 0.5) * 2,\n                            vx: (Math.random() - 0.5) * 0.2,\n                            vy: 0.1 + Math.random() * 0.1,\n                            vz: (Math.random() - 0.5) * 0.2,\n                            life: 60,\n                            type: 'spark',\n                            size: 2\n                        });\n                    }\n                    return true;\n                }\n                return false;\n            },\n            \n            // Shoot the berdger (burger launcher)\n            shootBerdger() {\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.id === 'berdger') {\n                    // Berdger has infinite ammo - it's invincible!\n                    // Use the same direction calculation as raycast\n                    const pitch = this.camera.rotX;\n                    const yaw = this.camera.rotY;\n                    const cosPitch = Math.cos(pitch);\n                    const sinPitch = Math.sin(pitch);\n                    \n                    const dirX = -Math.sin(yaw) * cosPitch;\n                    const dirY = -sinPitch;  // Fixed: now matches raycast\n                    const dirZ = Math.cos(yaw) * cosPitch;\n                    \n                    // Rapid fire burgers!\n                    this.particles.push({\n                        x: this.camera.x + dirX * 0.5,\n                        y: this.camera.y + dirY * 0.5,\n                        z: this.camera.z + dirZ * 0.5,\n                        vx: dirX * 0.8,\n                        vy: dirY * 0.8,\n                        vz: dirZ * 0.8,\n                        life: 120,\n                        type: 'burger',\n                        size: 8,\n                        trail: []\n                    });\n                    return true;\n                }\n                return false;\n            },\n            \n            // Throw an apple at birds\n            throwApple() {\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.id === 'apple' && slot.count > 0) {\n                    slot.count--;\n                    if (slot.count <= 0) {\n                        this.inventory.hotbar[this.selectedSlot] = null;\n                        this.selectedItem = null;\n                    }\n                    this.updateHotbarDisplay();\n                    \n                    // Use the same direction as raycast\n                    const pitch = this.camera.rotX;\n                    const yaw = this.camera.rotY;\n                    const cosPitch = Math.cos(pitch);\n                    const sinPitch = Math.sin(pitch);\n                    \n                    const dirX = -Math.sin(yaw) * cosPitch;\n                    const dirY = -sinPitch;\n                    const dirZ = Math.cos(yaw) * cosPitch;\n                    \n                    // Throw apple\n                    this.particles.push({\n                        x: this.camera.x + dirX * 0.5,\n                        y: this.camera.y + dirY * 0.5,\n                        z: this.camera.z + dirZ * 0.5,\n                        vx: dirX * 0.6,\n                        vy: dirY * 0.6 + 0.1, // Slight arc\n                        vz: dirZ * 0.6,\n                        life: 180,\n                        type: 'apple',\n                        size: 6,\n                        gravity: -0.008\n                    });\n                    return true;\n                }\n                return false;\n            },\n            \n            // Check and complete ritual\n            checkRitual() {\n                if (this.ritualComplete) return;\n                \n                // Check if player has all ritual items\n                const hasItems = {};\n                for (const item of this.ritualItems) {\n                    hasItems[item] = false;\n                }\n                \n                for (let i = 0; i < 9; i++) {\n                    const slot = this.inventory.hotbar[i];\n                    if (slot && this.ritualItems.includes(slot.id)) {\n                        hasItems[slot.id] = true;\n                    }\n                }\n                \n                const allPresent = this.ritualItems.every(item => hasItems[item]);\n                \n                if (allPresent) {\n                    // Complete the Omamori ritual!\n                    this.ritualComplete = true;\n                    this.ritualBlessingActive = true;\n                    this.ritualBlessingTimer = 36000; // 10 minutes at 60fps\n                    \n                    // Consume ritual items\n                    for (let i = 0; i < 9; i++) {\n                        const slot = this.inventory.hotbar[i];\n                        if (slot && this.ritualItems.includes(slot.id)) {\n                            this.inventory.hotbar[i] = null;\n                        }\n                    }\n                    this.updateHotbarDisplay();\n                    \n                    // Reward: All birds become permanently calmed and friendly\n                    for (const pest of this.pestBirds) {\n                        pest.anger = 0;\n                        pest.state = 'circling';\n                    }\n                    \n                    // Grand visual effect\n                    for (let i = 0; i < 50; i++) {\n                        this.particles.push({\n                            x: this.camera.x + (Math.random() - 0.5) * 8,\n                            y: this.camera.y + Math.random() * 5,\n                            z: this.camera.z + (Math.random() - 0.5) * 8,\n                            vx: (Math.random() - 0.5) * 0.1,\n                            vy: 0.05 + Math.random() * 0.1,\n                            vz: (Math.random() - 0.5) * 0.1,\n                            life: 120 + Math.random() * 60,\n                            type: 'petal',\n                            size: 4 + Math.random() * 3,\n                            rotation: Math.random() * Math.PI * 2,\n                            rotSpeed: (Math.random() - 0.5) * 0.2,\n                            flutter: Math.random() * Math.PI * 2\n                        });\n                    }\n                    \n                    return true;\n                }\n                return false;\n            },\n            \n            // Interact with ritual socket blocks\n            interactWithSocket(x, y, z, socketType) {\n                // Map socket types to required items\n                const socketItemMap = {\n                    'petalSocket': 'sakuraPetal',\n                    'ropeSocket': 'shimenawa',\n                    'charmSocket': 'omamori',\n                    'plaqueSocket': 'ema',\n                    'incenseSocket': 'incense'\n                };\n                \n                // Map socket types to filled versions\n                const filledSocketMap = {\n                    'petalSocket': 'petalSocketFilled',\n                    'ropeSocket': 'ropeSocketFilled',\n                    'charmSocket': 'charmSocketFilled',\n                    'plaqueSocket': 'plaqueSocketFilled',\n                    'incenseSocket': 'incenseSocketFilled'\n                };\n                \n                const requiredItem = socketItemMap[socketType];\n                if (!requiredItem) return;\n                \n                // Check if already filled\n                if (socketType.includes('Filled')) return;\n                \n                // Check if player has the required item\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.id === requiredItem && slot.count > 0) {\n                    // Place item on socket\n                    slot.count--;\n                    if (slot.count <= 0) {\n                        this.inventory.hotbar[this.selectedSlot] = null;\n                    }\n                    this.updateHotbarDisplay();\n                    \n                    // Change block to filled version\n                    this.setBlock(x, y, z, filledSocketMap[socketType]);\n                    \n                    // Track socket completion\n                    if (!this.socketsFilled) this.socketsFilled = {};\n                    this.socketsFilled[socketType] = true;\n                    \n                    // Visual effect\n                    for (let i = 0; i < 20; i++) {\n                        this.particles.push({\n                            x: x + 0.5 + (Math.random() - 0.5) * 0.5,\n                            y: y + 1 + Math.random() * 0.5,\n                            z: z + 0.5 + (Math.random() - 0.5) * 0.5,\n                            vx: (Math.random() - 0.5) * 0.1,\n                            vy: 0.1 + Math.random() * 0.1,\n                            vz: (Math.random() - 0.5) * 0.1,\n                            life: 60 + Math.random() * 40,\n                            type: 'spark',\n                            size: 3 + Math.random() * 2\n                        });\n                    }\n                    \n                    // Check if all sockets are filled\n                    const allSocketsFilled = Object.keys(socketItemMap).every(\n                        socket => this.socketsFilled && this.socketsFilled[socket]\n                    );\n                    \n                    if (allSocketsFilled && !this.ritualComplete) {\n                        // COMPLETE THE TEMPLE RITUAL!\n                        this.ritualComplete = true;\n                        this.ritualBlessingActive = true;\n                        this.ritualBlessingTimer = 60 * 60 * 10; // 10 minutes at 60fps\n                        \n                        // Trigger the creative reward\n                        this.triggerRitualReward();\n                        \n                        // Calm all birds\n                        if (this.pestBirds) {\n                            for (const pest of this.pestBirds) {\n                                pest.anger = 0;\n                                pest.state = 'fleeing';\n                                pest.stateTimer = 600;\n                            }\n                        }\n                        \n                        // Score bonus\n                        if (this.survivalStats) {\n                            this.survivalStats.score += 5000;\n                            this.survivalStats.currentObjective = { text: 'Blessing active - birds flee!', type: 'complete' };\n                            this.updateSurvivalHUD();\n                        }\n                        \n                        // Grand visual effect\n                        for (let i = 0; i < 100; i++) {\n                            this.particles.push({\n                                x: x + 0.5 + (Math.random() - 0.5) * 10,\n                                y: y + Math.random() * 8,\n                                z: z + 0.5 + (Math.random() - 0.5) * 10,\n                                vx: (Math.random() - 0.5) * 0.15,\n                                vy: 0.1 + Math.random() * 0.15,\n                                vz: (Math.random() - 0.5) * 0.15,\n                                life: 180 + Math.random() * 120,\n                                type: 'petal',\n                                size: 4 + Math.random() * 4,\n                                rotation: Math.random() * Math.PI * 2,\n                                rotSpeed: (Math.random() - 0.5) * 0.2,\n                                flutter: Math.random() * Math.PI * 2\n                            });\n                        }\n                    }\n                }\n            },\n            \n            // Open chest UI - simply take all items\n            openChest(x, y, z) {\n                if (!this.chestContents) this.chestContents = {};\n                \n                const chestKey = `${x},${y},${z}`;\n                const contents = this.chestContents[chestKey];\n                \n                if (contents && Array.isArray(contents) && contents.length > 0) {\n                    // Take all items from chest\n                    for (const item of contents) {\n                        if (!item) continue;\n                        const itemType = item.type || item.id;\n                        const itemCount = item.count || 1;\n                        \n                        if (itemType) {\n                            if (!this.addToInventory(itemType, itemCount)) {\n                                // Inventory full - drop item\n                                this.dropItem(x + 0.5, y + 1.5, z + 0.5, itemType, itemCount);\n                            }\n                        }\n                    }\n                    // Empty the chest\n                    this.chestContents[chestKey] = [];\n                    this.updateHotbarDisplay();\n                }\n            },\n            \n            // Drop currently held item\n            dropHeldItem() {\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (slot && slot.count > 0) {\n                    // Drop one item in front of player\n                    const dirX = -Math.sin(this.camera.rotY);\n                    const dirZ = Math.cos(this.camera.rotY);\n                    const itemId = slot.id || slot.type;\n                    this.dropItem(\n                        this.camera.x + dirX * 1.5,\n                        this.camera.y,\n                        this.camera.z + dirZ * 1.5,\n                        itemId,\n                        1\n                    );\n                    \n                    slot.count--;\n                    if (slot.count <= 0) {\n                        this.inventory.hotbar[this.selectedSlot] = null;\n                        this.selectedItem = null;\n                    }\n                    this.updateHotbarDisplay();\n                }\n            },\n            \n            // Debug console system\n            debugConsoleOpen: false,\n            debugNoclip: false,\n            debugGodMode: false,\n            // Debug settings\n            debugSettings: {\n                showFPS: false,\n                showCoords: false,\n                showDepthOrder: false,\n                showFaceNormals: false,\n                showBoundingBoxes: false,\n                showRaycastVector: false,\n                showProjectionTest: false,\n                wireframeOnly: false,\n                disableFaceCulling: false,\n                showOverdraw: false,\n                highlightZFighting: false,\n                renderAlgorithm: 'painter' as 'painter' | 'zbuffer' | 'bsp'\n            },\n            debugFly: false,\n            debugMoveSpeed: null,\n            \n            toggleDebugConsole() {\n                this.debugConsoleOpen = !this.debugConsoleOpen;\n                const consoleEl = document.getElementById('debugConsole');\n                const canvas = document.getElementById('renderCanvas') as HTMLCanvasElement;\n                \n                console.log('[Console] Toggle debug console, now open:', this.debugConsoleOpen);\n                console.log('[Console] isPaused:', this.isPaused);\n                console.log('[Console] isActive:', this.isActive);\n                \n                if (consoleEl) {\n                    if (this.debugConsoleOpen) {\n                        // Open console\n                        consoleEl.classList.add('active');\n                        consoleEl.style.display = 'flex';\n                        \n                        // Exit pointer lock (unlock cursor)\n                        if (document.pointerLockElement) {\n                            document.exitPointerLock();\n                        }\n                        this.pointerLocked = false;\n                        \n                        // Blur game canvas to lose focus\n                        if (canvas) {\n                            canvas.blur();\n                        }\n                        \n                        // Scroll output to bottom when opening (longer timeout for reliability)\n                        const output = document.getElementById('debugOutput');\n                        const input = document.getElementById('debugInput') as HTMLInputElement;\n                        \n                        // Log welcome message first\n                        this.debugLog('Debug console opened. Type \"help\" for commands.', 'info');\n                        \n                        // Then scroll and focus with enough delay\n                        setTimeout(() => {\n                            if (output) {\n                                output.scrollTop = output.scrollHeight;\n                            }\n                            if (input) {\n                                input.focus();\n                                input.select(); // Select any text for immediate typing\n                            }\n                        }, 100); // Increased from 50ms to 100ms\n                        \n                    } else {\n                        // Close console\n                        consoleEl.classList.remove('active');\n                        consoleEl.style.display = 'none';\n                        \n                        // Hide suggestions\n                        const suggestions = document.getElementById('debugSuggestions');\n                        if (suggestions) {\n                            suggestions.classList.remove('active');\n                        }\n                        \n                        // Return focus to game canvas\n                        if (canvas) {\n                            canvas.focus();\n                            \n                            // Request pointer lock after a short delay\n                            setTimeout(() => {\n                                if (this.isActive && !this.isPaused) {\n                                    canvas.requestPointerLock();\n                                }\n                            }, 100);\n                        }\n                    }\n                }\n            },\n            \n            setupDebugConsole() {\n                console.log('[Autocomplete] Setting up debug console...');\n                \n                // Ensure console is hidden on initialization\n                const consoleEl = document.getElementById('debugConsole');\n                if (consoleEl) {\n                    consoleEl.classList.remove('active');\n                    consoleEl.style.display = 'none';\n                }\n                \n                // Store reference to this for setTimeout\n                const self = this;\n                \n                // Wait a bit to ensure HTML is fully loaded\n                setTimeout(function() {\n                    console.log('[Autocomplete] setTimeout fired, calling setupDebugConsoleActual...');\n                    self.setupDebugConsoleActual();\n                }, 100);\n            },\n            \n            setupDebugConsoleActual() {\n                console.log('[Autocomplete] Setting up autocomplete (delayed)...');\n                \n                // Verify critical elements exist\n                const debugConsole = document.getElementById('debugConsole');\n                const debugInput = document.getElementById('debugInput') as HTMLInputElement;\n                let debugSuggestions = document.getElementById('debugSuggestions');\n                \n                console.log('[Autocomplete] Element check:');\n                console.log('  - debugConsole:', debugConsole);\n                console.log('  - debugInput:', debugInput);\n                console.log('  - debugSuggestions:', debugSuggestions);\n                \n                if (!debugConsole || !debugInput) {\n                    console.error('[Autocomplete] ERROR: Required elements not found! Cannot proceed.');\n                    return;\n                }\n                \n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                // MAKE CONSOLE DRAGGABLE AND RESIZABLE\n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                const header = debugConsole.querySelector('.debug-console-header') as HTMLElement;\n                if (header) {\n                    // DRAGGING\n                    let isDragging = false;\n                    let currentX = 0;\n                    let currentY = 0;\n                    let initialX = 0;\n                    let initialY = 0;\n                    \n                    // Initialize offsets from current CSS position\n                    const computedStyle = window.getComputedStyle(debugConsole);\n                    let xOffset = parseInt(computedStyle.left) || 10;\n                    let yOffset = parseInt(computedStyle.top) || 50;\n                    \n                    header.addEventListener('mousedown', (e) => {\n                        // Don't drag if clicking on FPS counter or other interactive elements\n                        if ((e.target as HTMLElement).id === 'debugFps') return;\n                        \n                        initialX = e.clientX - xOffset;\n                        initialY = e.clientY - yOffset;\n                        isDragging = true;\n                        header.style.cursor = 'grabbing';\n                    });\n                    \n                    // RESIZING\n                    let isResizing = false;\n                    let resizeEdge = '';\n                    let startWidth = 0;\n                    let startHeight = 0;\n                    let startX = 0;\n                    let startY = 0;\n                    let startLeft = 0;\n                    let startTop = 0;\n                    \n                    const handleMouseMove = (e: MouseEvent) => {\n                        if (isResizing) {\n                            e.preventDefault();\n                            \n                            let newWidth = startWidth;\n                            let newHeight = startHeight;\n                            let newLeft = startLeft;\n                            let newTop = startTop;\n                            \n                            const dx = e.clientX - startX;\n                            const dy = e.clientY - startY;\n                            \n                            // Handle horizontal resizing\n                            if (resizeEdge.includes('e')) {\n                                newWidth = Math.max(300, startWidth + dx);\n                            } else if (resizeEdge.includes('w')) {\n                                newWidth = Math.max(300, startWidth - dx);\n                                newLeft = startLeft + (startWidth - newWidth);\n                            }\n                            \n                            // Handle vertical resizing\n                            if (resizeEdge.includes('s')) {\n                                newHeight = Math.max(200, startHeight + dy);\n                            } else if (resizeEdge.includes('n')) {\n                                newHeight = Math.max(200, startHeight - dy);\n                                newTop = startTop + (startHeight - newHeight);\n                            }\n                            \n                            debugConsole.style.width = `${newWidth}px`;\n                            debugConsole.style.maxHeight = `${newHeight}px`;\n                            debugConsole.style.left = `${newLeft}px`;\n                            debugConsole.style.top = `${newTop}px`;\n                            \n                            // Update drag offsets\n                            xOffset = newLeft;\n                            yOffset = newTop;\n                        } else if (isDragging) {\n                            e.preventDefault();\n                            currentX = e.clientX - initialX;\n                            currentY = e.clientY - initialY;\n                            xOffset = currentX;\n                            yOffset = currentY;\n                            \n                            // Keep console within viewport bounds\n                            const maxX = window.innerWidth - 100;\n                            const maxY = window.innerHeight - 50;\n                            const clampedX = Math.max(0, Math.min(currentX, maxX));\n                            const clampedY = Math.max(0, Math.min(currentY, maxY));\n                            \n                            debugConsole.style.left = `${clampedX}px`;\n                            debugConsole.style.top = `${clampedY}px`;\n                            \n                            xOffset = clampedX;\n                            yOffset = clampedY;\n                        } else {\n                            // Update cursor based on position\n                            const rect = debugConsole.getBoundingClientRect();\n                            const edge = 10; // pixels from edge to trigger resize\n                            \n                            const atTop = e.clientY - rect.top < edge;\n                            const atBottom = rect.bottom - e.clientY < edge;\n                            const atLeft = e.clientX - rect.left < edge;\n                            const atRight = rect.right - e.clientX < edge;\n                            \n                            if ((atTop && atLeft) || (atBottom && atRight)) {\n                                debugConsole.style.cursor = 'nwse-resize';\n                            } else if ((atTop && atRight) || (atBottom && atLeft)) {\n                                debugConsole.style.cursor = 'nesw-resize';\n                            } else if (atTop || atBottom) {\n                                debugConsole.style.cursor = 'ns-resize';\n                            } else if (atLeft || atRight) {\n                                debugConsole.style.cursor = 'ew-resize';\n                            } else {\n                                debugConsole.style.cursor = 'default';\n                            }\n                        }\n                    };\n                    \n                    debugConsole.addEventListener('mousedown', (e) => {\n                        // Don't resize if clicking header (that's for dragging)\n                        if ((e.target as HTMLElement).closest('.debug-console-header')) return;\n                        \n                        const rect = debugConsole.getBoundingClientRect();\n                        const edge = 10;\n                        \n                        const atTop = e.clientY - rect.top < edge;\n                        const atBottom = rect.bottom - e.clientY < edge;\n                        const atLeft = e.clientX - rect.left < edge;\n                        const atRight = rect.right - e.clientX < edge;\n                        \n                        if (atTop || atBottom || atLeft || atRight) {\n                            isResizing = true;\n                            resizeEdge = '';\n                            if (atTop) resizeEdge += 'n';\n                            if (atBottom) resizeEdge += 's';\n                            if (atLeft) resizeEdge += 'w';\n                            if (atRight) resizeEdge += 'e';\n                            \n                            startX = e.clientX;\n                            startY = e.clientY;\n                            startWidth = rect.width;\n                            startHeight = rect.height;\n                            startLeft = rect.left;\n                            startTop = rect.top;\n                            \n                            e.preventDefault();\n                        }\n                    });\n                    \n                    document.addEventListener('mousemove', handleMouseMove);\n                    \n                    document.addEventListener('mouseup', () => {\n                        if (isDragging) {\n                            isDragging = false;\n                            header.style.cursor = 'move';\n                        }\n                        if (isResizing) {\n                            isResizing = false;\n                            debugConsole.style.cursor = 'default';\n                        }\n                    });\n                    \n                    console.log('[Console] Made draggable and resizable!');\n                }\n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                // END DRAGGABLE & RESIZABLE\n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                \n                // If debugSuggestions doesn't exist, create it dynamically\n                if (!debugSuggestions) {\n                    console.log('[Autocomplete] debugSuggestions not found, creating dynamically...');\n                    debugSuggestions = document.createElement('div');\n                    debugSuggestions.id = 'debugSuggestions';\n                    debugSuggestions.className = 'debug-console-suggestions';\n                    \n                    // Insert after the input element's parent\n                    const inputContainer = debugInput.parentElement;\n                    if (inputContainer && inputContainer.nextSibling) {\n                        debugConsole.insertBefore(debugSuggestions, inputContainer.nextSibling);\n                    } else {\n                        debugConsole.appendChild(debugSuggestions);\n                    }\n                    console.log('[Autocomplete] Created debugSuggestions:', debugSuggestions);\n                }\n                \n                console.log('[Autocomplete] All elements ready, proceeding with setup...');\n                \n                // Available commands with descriptions\n                const commands = [\n                    { name: 'help', desc: 'Show all available commands' },\n                    { name: 'noclip', desc: 'Toggle flying through walls' },\n                    { name: 'god', desc: 'Toggle invincibility' },\n                    { name: 'coords', desc: 'Toggle coordinate display' },\n                    { name: 'tp', desc: 'Teleport to position or landmark' },\n                    { name: 'give', desc: 'Give yourself items' },\n                    { name: 'time', desc: 'Set game time' },\n                    { name: 'wave', desc: 'Set wave number' },\n                    { name: 'fly', desc: 'Toggle fly mode' },\n                    { name: 'speed', desc: 'Set movement speed' },\n                    { name: 'clear', desc: 'Clear console output' },\n                    { name: 'fps', desc: 'Toggle FPS display' },\n                    { name: 'render', desc: 'Rendering debug: wireframe|depthorder|normals|bounds|raycast|projection|culling|overdraw|all|none' },\n                    { name: 'algo', desc: 'Set render algorithm: painter|zbuffer|bsp' }\n                ];\n                \n                let selectedSuggestionIndex = -1;\n                let currentSuggestions: typeof commands = [];\n                \n                const input = document.getElementById('debugInput') as HTMLInputElement;\n                \n                const showSuggestions = (query: string) => {\n                    // Query element fresh each time to ensure it exists\n                    const suggestionsEl = document.getElementById('debugSuggestions');\n                    \n                    console.log('[Autocomplete] Query:', query);\n                    console.log('[Autocomplete] suggestionsEl:', suggestionsEl);\n                    \n                    if (!suggestionsEl || !query) {\n                        if (suggestionsEl) suggestionsEl.classList.remove('active');\n                        currentSuggestions = [];\n                        selectedSuggestionIndex = -1;\n                        return;\n                    }\n                    \n                    // Filter commands\n                    currentSuggestions = commands.filter(cmd => \n                        cmd.name.toLowerCase().startsWith(query.toLowerCase())\n                    );\n                    \n                    console.log('[Autocomplete] Current suggestions:', currentSuggestions);\n                    \n                    if (currentSuggestions.length === 0) {\n                        suggestionsEl.classList.remove('active');\n                        return;\n                    }\n                    \n                    // Render suggestions\n                    suggestionsEl.innerHTML = '';\n                    currentSuggestions.forEach((cmd, index) => {\n                        const item = document.createElement('div');\n                        item.className = 'debug-suggestion-item';\n                        if (index === selectedSuggestionIndex) {\n                            item.classList.add('selected');\n                        }\n                        item.innerHTML = `<span class=\"suggestion-name\">${cmd.name}</span><span class=\"suggestion-desc\">${cmd.desc}</span>`;\n                        \n                        // Click to select\n                        item.addEventListener('click', () => {\n                            input.value = cmd.name + ' ';\n                            input.focus();\n                            suggestionsEl.classList.remove('active');\n                            currentSuggestions = [];\n                            selectedSuggestionIndex = -1;\n                        });\n                        \n                        suggestionsEl.appendChild(item);\n                    });\n                    \n                    console.log('[Autocomplete] Added active class, innerHTML:', suggestionsEl.innerHTML.substring(0, 100));\n                    suggestionsEl.classList.add('active');\n                };\n                \n                const selectSuggestion = (index: number) => {\n                    const suggestionsEl = document.getElementById('debugSuggestions');\n                    if (!suggestionsEl || currentSuggestions.length === 0) return;\n                    \n                    // Update selection\n                    selectedSuggestionIndex = index;\n                    \n                    // Update UI\n                    const items = suggestionsEl.querySelectorAll('.debug-suggestion-item');\n                    items.forEach((item, i) => {\n                        if (i === selectedSuggestionIndex) {\n                            item.classList.add('selected');\n                        } else {\n                            item.classList.remove('selected');\n                        }\n                    });\n                };\n                \n                const applySuggestion = () => {\n                    if (selectedSuggestionIndex >= 0 && selectedSuggestionIndex < currentSuggestions.length) {\n                        input.value = currentSuggestions[selectedSuggestionIndex].name + ' ';\n                        const suggestionsEl = document.getElementById('debugSuggestions');\n                        if (suggestionsEl) {\n                            suggestionsEl.classList.remove('active');\n                        }\n                        currentSuggestions = [];\n                        selectedSuggestionIndex = -1;\n                    }\n                };\n                \n                if (input) {\n                    console.log('[Autocomplete] Input element found, attaching listeners');\n                    console.log('[Autocomplete] Input element:', input);\n                    \n                    const testSuggestions = document.getElementById('debugSuggestions');\n                    console.log('[Autocomplete] Suggestions element on setup:', testSuggestions);\n                    \n                    // Input event for live suggestions\n                    input.addEventListener('input', (e) => {\n                        const query = input.value.trim().split(' ')[0];\n                        console.log('[Autocomplete] Input event fired, query:', query);\n                        showSuggestions(query);\n                    });\n                    \n                    input.addEventListener('keydown', (e) => {\n                        // Arrow key navigation\n                        if (e.key === 'ArrowDown') {\n                            e.preventDefault();\n                            if (currentSuggestions.length > 0) {\n                                selectedSuggestionIndex = (selectedSuggestionIndex + 1) % currentSuggestions.length;\n                                selectSuggestion(selectedSuggestionIndex);\n                            }\n                        } else if (e.key === 'ArrowUp') {\n                            e.preventDefault();\n                            if (currentSuggestions.length > 0) {\n                                selectedSuggestionIndex = selectedSuggestionIndex <= 0 \n                                    ? currentSuggestions.length - 1 \n                                    : selectedSuggestionIndex - 1;\n                                selectSuggestion(selectedSuggestionIndex);\n                            }\n                        } else if (e.key === 'Tab') {\n                            // Tab to apply suggestion immediately\n                            e.preventDefault();\n                            if (currentSuggestions.length > 0) {\n                                // If nothing selected, select first\n                                if (selectedSuggestionIndex < 0) {\n                                    selectedSuggestionIndex = 0;\n                                }\n                                \n                                if (e.shiftKey) {\n                                    // Shift+Tab cycles backwards\n                                    selectedSuggestionIndex = selectedSuggestionIndex <= 0 \n                                        ? currentSuggestions.length - 1 \n                                        : selectedSuggestionIndex - 1;\n                                } else {\n                                    // Tab cycles forward\n                                    selectedSuggestionIndex = (selectedSuggestionIndex + 1) % currentSuggestions.length;\n                                }\n                                \n                                // Apply the selected suggestion\n                                input.value = currentSuggestions[selectedSuggestionIndex].name + ' ';\n                                const suggestionsEl = document.getElementById('debugSuggestions');\n                                if (suggestionsEl) {\n                                    suggestionsEl.classList.remove('active');\n                                }\n                                currentSuggestions = [];\n                                selectedSuggestionIndex = -1;\n                                input.focus();\n                            }\n                        } else if (e.key === 'Enter') {\n                            e.preventDefault();\n                            \n                            // If suggestion selected, apply it\n                            if (selectedSuggestionIndex >= 0) {\n                                applySuggestion();\n                            } else {\n                                // Execute command\n                                const cmd = input.value.trim();\n                                if (cmd) {\n                                    this.executeDebugCommand(cmd);\n                                    input.value = '';\n                                    const suggestionsEl = document.getElementById('debugSuggestions');\n                                    if (suggestionsEl) {\n                                        suggestionsEl.classList.remove('active');\n                                    }\n                                    currentSuggestions = [];\n                                    selectedSuggestionIndex = -1;\n                                }\n                            }\n                        } else if (e.key === '`' || e.key === '~') {\n                            e.preventDefault();\n                            this.toggleDebugConsole();\n                        } else if (e.key === 'Escape') {\n                            // Escape closes suggestions or console\n                            if (currentSuggestions.length > 0) {\n                                e.preventDefault();\n                                const suggestionsEl = document.getElementById('debugSuggestions');\n                                if (suggestionsEl) {\n                                    suggestionsEl.classList.remove('active');\n                                }\n                                currentSuggestions = [];\n                                selectedSuggestionIndex = -1;\n                            }\n                        }\n                        \n                        e.stopPropagation();\n                    });\n                    \n                    input.addEventListener('keyup', (e) => e.stopPropagation());\n                }\n            },\n            \n            debugLog(msg, type = 'normal') {\n                const output = document.getElementById('debugOutput');\n                if (output) {\n                    const div = document.createElement('div');\n                    div.className = type;\n                    div.textContent = `> ${msg}`;\n                    output.appendChild(div);\n                    output.scrollTop = output.scrollHeight;\n                    \n                    // Limit log size\n                    while (output.children.length > 100) {\n                        output.removeChild(output.firstChild);\n                    }\n                }\n            },\n            \n            executeDebugCommand(cmd) {\n                const parts = cmd.toLowerCase().split(' ');\n                const command = parts[0];\n                const args = parts.slice(1);\n                \n                this.debugLog(cmd, 'normal');\n                \n                switch (command) {\n                    case 'help':\n                        this.debugLog('Commands:', 'info');\n                        this.debugLog('  noclip - Toggle flying through walls', 'info');\n                        this.debugLog('  god - Toggle invincibility', 'info');\n                        this.debugLog('  coords - Toggle coordinate display', 'info');\n                        this.debugLog('  tp <x> <y> <z> - Teleport to position', 'info');\n                        this.debugLog('  tp <landmark> - Teleport to landmark', 'info');\n                        this.debugLog('    landmarks: ritual, gunsmith, spawn', 'info');\n                        this.debugLog('  give <item> [count] - Give item', 'info');\n                        this.debugLog('  spawn <mob> [count] - Spawn mobs', 'info');\n                        this.debugLog('    mobs: bird, fish, cat, creeper, bluebird, gunsmith', 'info');\n                        this.debugLog('  time <ms> - Set bird event timer', 'info');\n                        this.debugLog('  kill - Kill all mobs', 'info');\n                        this.debugLog('  clear - Clear console', 'info');\n                        this.debugLog('  pos - Show current position', 'info');\n                        this.debugLog('  fly - Toggle flight mode', 'info');\n                        this.debugLog('  speed <value> - Set move speed', 'info');\n                        this.debugLog('  ritual - Complete ritual instantly', 'info');\n                        this.debugLog('  score <value> - Set score', 'info');\n                        this.debugLog('  algo <type> - Set render algorithm', 'info');\n                        this.debugLog('    painter|zbuffer|bsp', 'info');\n                        this.debugLog('', 'info');\n                        this.debugLog('Rendering Debug:', 'info');\n                        this.debugLog('  render <option> - Toggle render debug', 'info');\n                        this.debugLog('    wireframe - Wireframe-only mode', 'info');\n                        this.debugLog('    depthorder - Show depth sorting', 'info');\n                        this.debugLog('    normals - Show face normals', 'info');\n                        this.debugLog('    bounds - Show bounding boxes', 'info');\n                        this.debugLog('    raycast - Show raycast vector', 'info');\n                        this.debugLog('    projection - Test projection', 'info');\n                        this.debugLog('    culling - Disable face culling', 'info');\n                        this.debugLog('    overdraw - Show overdraw heatmap', 'info');\n                        this.debugLog('    all - Toggle all render debug', 'info');\n                        this.debugLog('    none - Turn all render debug OFF', 'info');\n                        break;\n                        \n                    case 'noclip':\n                        this.debugNoclip = !this.debugNoclip;\n                        this.debugLog(`Noclip: ${this.debugNoclip ? 'ON' : 'OFF'}`, this.debugNoclip ? 'success' : 'warn');\n                        break;\n                        \n                    case 'god':\n                        this.debugGodMode = !this.debugGodMode;\n                        this.debugLog(`God mode: ${this.debugGodMode ? 'ON' : 'OFF'}`, this.debugGodMode ? 'success' : 'warn');\n                        break;\n                        \n                    case 'coords':\n                        this.debugSettings.showCoords = !this.debugSettings.showCoords;\n                        this.debugLog(`Coords display: ${this.debugSettings.showCoords ? 'ON' : 'OFF'}`, 'success');\n                        break;\n                        \n                    case 'fly':\n                        this.debugFly = !this.debugFly;\n                        this.debugLog(`Fly mode: ${this.debugFly ? 'ON' : 'OFF'}`, this.debugFly ? 'success' : 'warn');\n                        break;\n                        \n                    case 'tp':\n                        if (args.length >= 1) {\n                            // Check if first argument is a landmark\n                            const landmark = args[0].toLowerCase();\n                            \n                            if (landmark === 'ritual' || landmark === 'temple') {\n                                // Teleport to ritual temple\n                                if (this.ritualTempleLocation) {\n                                    this.camera.x = this.ritualTempleLocation.x + 5;\n                                    this.camera.y = this.ritualTempleLocation.y + 3;\n                                    this.camera.z = this.ritualTempleLocation.z + 5;\n                                    this.velocity = { x: 0, y: 0, z: 0 };\n                                    this.debugLog('Teleported to Ritual Temple', 'success');\n                                } else {\n                                    this.debugLog('Ritual temple not found', 'error');\n                                }\n                            } else if (landmark === 'gunsmith' || landmark === 'npc' || landmark === 'repair') {\n                                // Teleport to repair NPC\n                                if (this.repairNPC) {\n                                    this.camera.x = this.repairNPC.x;\n                                    this.camera.y = this.repairNPC.y + 2;\n                                    this.camera.z = this.repairNPC.z;\n                                    this.velocity = { x: 0, y: 0, z: 0 };\n                                    this.debugLog('Teleported to Gunsmith NPC', 'success');\n                                } else {\n                                    this.debugLog('Gunsmith NPC not found (not spawned yet)', 'error');\n                                }\n                            } else if (landmark === 'spawn' || landmark === 'home') {\n                                // Teleport to spawn\n                                this.camera.x = 0;\n                                this.camera.y = 10;\n                                this.camera.z = 0;\n                                this.velocity = { x: 0, y: 0, z: 0 };\n                                this.debugLog('Teleported to spawn', 'success');\n                            } else if (args.length >= 3) {\n                                // Numeric coordinates\n                                const x = parseFloat(args[0]);\n                                const y = parseFloat(args[1]);\n                                const z = parseFloat(args[2]);\n                                if (!isNaN(x) && !isNaN(y) && !isNaN(z)) {\n                                    this.camera.x = x;\n                                    this.camera.y = y;\n                                    this.camera.z = z;\n                                    this.velocity = { x: 0, y: 0, z: 0 };\n                                    this.debugLog(`Teleported to ${x.toFixed(1)}, ${y.toFixed(1)}, ${z.toFixed(1)}`, 'success');\n                                } else {\n                                    this.debugLog('Invalid coordinates', 'error');\n                                }\n                            } else {\n                                this.debugLog('Usage: tp <x> <y> <z> OR tp <landmark>', 'error');\n                                this.debugLog('Landmarks: ritual, gunsmith, spawn', 'info');\n                            }\n                        } else {\n                            this.debugLog('Usage: tp <x> <y> <z> OR tp <landmark>', 'error');\n                            this.debugLog('Landmarks: ritual, gunsmith, spawn', 'info');\n                        }\n                        break;\n                        \n                    case 'temple':\n                        if (this.ritualTempleLocation) {\n                            this.camera.x = this.ritualTempleLocation.x + 5;\n                            this.camera.y = this.ritualTempleLocation.y + 3;\n                            this.camera.z = this.ritualTempleLocation.z + 5;\n                            this.velocity = { x: 0, y: 0, z: 0 };\n                            this.debugLog('Teleported to Ritual Temple', 'success');\n                        } else {\n                            this.debugLog('Temple not found', 'error');\n                        }\n                        break;\n                        \n                    case 'pos':\n                        this.debugLog(`Position: ${this.camera.x.toFixed(2)}, ${this.camera.y.toFixed(2)}, ${this.camera.z.toFixed(2)}`, 'info');\n                        this.debugLog(`Rotation: ${(this.camera.rotX * 180 / Math.PI).toFixed(1)}¬∞, ${(this.camera.rotY * 180 / Math.PI).toFixed(1)}¬∞`, 'info');\n                        break;\n                        \n                    case 'give':\n                        if (args.length >= 1) {\n                            const itemId = args[0];\n                            const count = args.length >= 2 ? parseInt(args[1]) : 1;\n                            if (this.blockColors[itemId] || this.itemTypes[itemId]) {\n                                this.addToInventory(itemId, count);\n                                this.debugLog(`Given ${count}x ${itemId}`, 'success');\n                            } else {\n                                this.debugLog(`Unknown item: ${itemId}`, 'error');\n                                this.debugLog('Items: ' + Object.keys(this.itemTypes).slice(0, 10).join(', ') + '...', 'info');\n                            }\n                        } else {\n                            this.debugLog('Usage: give <item> [count]', 'error');\n                        }\n                        break;\n                        \n                    case 'spawn':\n                        const mobType = args[0];\n                        const spawnCount = args.length >= 2 ? parseInt(args[1]) : 1;\n                        const validMobs = ['bird', 'pest', 'fish', 'cat', 'creeper', 'bluebird', 'gunsmith'];\n                        \n                        if (mobType === 'bird' || mobType === 'pest') {\n                            for (let i = 0; i < spawnCount; i++) this.spawnPestBird();\n                            this.debugLog(`Spawned ${spawnCount} pest bird(s)`, 'success');\n                        } else if (mobType === 'fish') {\n                            for (let i = 0; i < spawnCount; i++) this.spawnFish();\n                            this.debugLog(`Spawned ${spawnCount} fish`, 'success');\n                        } else if (mobType === 'cat') {\n                            for (let i = 0; i < spawnCount; i++) this.spawnCat();\n                            this.debugLog(`Spawned ${spawnCount} cat(s)`, 'success');\n                        } else if (mobType === 'creeper') {\n                            for (let i = 0; i < spawnCount; i++) this.spawnCreeper();\n                            this.debugLog(`Spawned ${spawnCount} creeper(s)`, 'success');\n                        } else if (mobType === 'bluebird') {\n                            for (let i = 0; i < spawnCount; i++) this.spawnBlueBird();\n                            this.debugLog(`Spawned ${spawnCount} blue bird(s)`, 'success');\n                        } else if (mobType === 'gunsmith' || mobType === 'npc' || mobType === 'repair') {\n                            this.spawnRepairNPC();\n                            this.debugLog('Spawned gunsmith NPC', 'success');\n                        } else {\n                            this.debugLog('Usage: spawn <mob> [count]', 'error');\n                            this.debugLog('Mobs: ' + validMobs.join(', '), 'info');\n                        }\n                        break;\n                        \n                    case 'kill':\n                        let totalKilled = 0;\n                        totalKilled += this.pestBirds ? this.pestBirds.length : 0;\n                        totalKilled += this.blueBirds ? this.blueBirds.length : 0;\n                        totalKilled += this.creepers ? this.creepers.length : 0;\n                        this.pestBirds = [];\n                        this.blueBirds = [];\n                        this.creepers = [];\n                        this.debugLog(`Killed ${totalKilled} mobs`, 'success');\n                        break;\n                        \n                    case 'time':\n                        if (args.length >= 1) {\n                            const time = parseInt(args[0]);\n                            if (!isNaN(time) && this.birdEvent) {\n                                this.birdEvent.timer = time;\n                                this.debugLog(`Bird event timer set to ${time}ms`, 'success');\n                            }\n                        } else {\n                            this.debugLog('Usage: time <ms>', 'error');\n                        }\n                        break;\n                        \n                    case 'clear':\n                        const outputEl = document.getElementById('debugOutput');\n                        if (outputEl) outputEl.innerHTML = '';\n                        break;\n                        \n                    case 'speed':\n                        if (args.length >= 1) {\n                            this.debugMoveSpeed = parseFloat(args[0]);\n                            this.debugLog(`Speed set to ${this.debugMoveSpeed}`, 'success');\n                        } else {\n                            this.debugLog('Usage: speed <value> (default: 0.12)', 'error');\n                        }\n                        break;\n                        \n                    case 'ritual':\n                        this.ritualComplete = true;\n                        this.ritualBlessingActive = true;\n                        this.ritualBlessingTimer = 60 * 60 * 10;\n                        this.socketsFilled = {\n                            'petalSocket': true, 'ropeSocket': true, 'charmSocket': true,\n                            'plaqueSocket': true, 'incenseSocket': true\n                        };\n                        this.triggerRitualReward();\n                        this.debugLog('Ritual completed!', 'success');\n                        break;\n                        \n                    case 'score':\n                        if (args.length >= 1 && this.survivalStats) {\n                            this.survivalStats.score = parseInt(args[0]);\n                            this.updateSurvivalHUD();\n                            this.debugLog(`Score set to ${this.survivalStats.score}`, 'success');\n                        }\n                        break;\n                        \n                    // Rendering debug commands\n                    case 'render':\n                        const subcommand = args[0] ? args[0].toLowerCase() : '';\n                        \n                        if (!subcommand) {\n                            this.debugLog('Usage: render <option>', 'error');\n                            this.debugLog('Options: wireframe, depthorder, normals, bounds, raycast, projection, culling, overdraw, all, none', 'info');\n                            this.debugLog('Example: render wireframe', 'info');\n                            break;\n                        }\n                        \n                        switch (subcommand) {\n                            case 'wireframe':\n                                this.debugSettings.wireframeOnly = !this.debugSettings.wireframeOnly;\n                                this.debugLog(`Wireframe mode: ${this.debugSettings.wireframeOnly ? 'ON' : 'OFF'}`, 'success');\n                                break;\n                                \n                            case 'depthorder':\n                                this.debugSettings.showDepthOrder = !this.debugSettings.showDepthOrder;\n                                this.debugLog(`Depth order display: ${this.debugSettings.showDepthOrder ? 'ON' : 'OFF'}`, 'success');\n                                break;\n                                \n                            case 'normals':\n                                this.debugSettings.showFaceNormals = !this.debugSettings.showFaceNormals;\n                                this.debugLog(`Face normals: ${this.debugSettings.showFaceNormals ? 'ON' : 'OFF'}`, 'success');\n                                break;\n                                \n                            case 'bounds':\n                                this.debugSettings.showBoundingBoxes = !this.debugSettings.showBoundingBoxes;\n                                this.debugLog(`Bounding boxes: ${this.debugSettings.showBoundingBoxes ? 'ON' : 'OFF'}`, 'success');\n                                break;\n                                \n                            case 'raycast':\n                                this.debugSettings.showRaycastVector = !this.debugSettings.showRaycastVector;\n                                this.debugLog(`Raycast vector: ${this.debugSettings.showRaycastVector ? 'ON' : 'OFF'}`, 'success');\n                                break;\n                                \n                            case 'projection':\n                                this.debugSettings.showProjectionTest = !this.debugSettings.showProjectionTest;\n                                this.debugLog(`Projection test: ${this.debugSettings.showProjectionTest ? 'ON' : 'OFF'}`, 'success');\n                                this.debugLog('A test point will be shown at camera center', 'info');\n                                break;\n                                \n                            case 'culling':\n                                this.debugSettings.disableFaceCulling = !this.debugSettings.disableFaceCulling;\n                                this.debugLog(`Face culling: ${this.debugSettings.disableFaceCulling ? 'DISABLED' : 'ENABLED'}`, this.debugSettings.disableFaceCulling ? 'warn' : 'success');\n                                break;\n                                \n                            case 'overdraw':\n                                this.debugSettings.showOverdraw = !this.debugSettings.showOverdraw;\n                                this.debugLog(`Overdraw visualization: ${this.debugSettings.showOverdraw ? 'ON' : 'OFF'}`, 'success');\n                                break;\n                                \n                            case 'all':\n                                const newState = !this.debugSettings.wireframeOnly;\n                                this.debugSettings.wireframeOnly = newState;\n                                this.debugSettings.showDepthOrder = newState;\n                                this.debugSettings.showFaceNormals = newState;\n                                this.debugSettings.showBoundingBoxes = newState;\n                                this.debugSettings.showRaycastVector = newState;\n                                this.debugSettings.showProjectionTest = newState;\n                                this.debugSettings.showOverdraw = newState;\n                                this.debugLog(`All render debug: ${newState ? 'ON' : 'OFF'}`, newState ? 'success' : 'warn');\n                                break;\n                                \n                            case 'none':\n                                // Turn everything off\n                                this.debugSettings.wireframeOnly = false;\n                                this.debugSettings.showDepthOrder = false;\n                                this.debugSettings.showFaceNormals = false;\n                                this.debugSettings.showBoundingBoxes = false;\n                                this.debugSettings.showRaycastVector = false;\n                                this.debugSettings.showProjectionTest = false;\n                                this.debugSettings.showOverdraw = false;\n                                this.debugSettings.disableFaceCulling = false;\n                                this.debugLog('All render debug: OFF', 'warn');\n                                break;\n                                \n                            default:\n                                this.debugLog(`Unknown render option: ${subcommand}`, 'error');\n                                this.debugLog('Options: wireframe, depthorder, normals, bounds, raycast, projection, culling, overdraw, all, none', 'info');\n                        }\n                        break;\n                        \n                    case 'algo':\n                        // Top-level algorithm selection command\n                        const algoType = args[0] ? args[0].toLowerCase() : '';\n                        if (!algoType || !['painter', 'zbuffer', 'bsp'].includes(algoType)) {\n                            this.debugLog('Usage: algo <type>', 'error');\n                            this.debugLog('Types: painter, zbuffer, bsp', 'info');\n                            this.debugLog('  painter  - Classic painter\\'s algorithm (sort back-to-front)', 'info');\n                            this.debugLog('  zbuffer  - Z-buffer simulation (sub-pixel depth precision)', 'info');\n                            this.debugLog('  bsp      - Binary Space Partitioning (spatial tree)', 'info');\n                            this.debugLog(`Current: ${this.debugSettings.renderAlgorithm}`, 'info');\n                            break;\n                        }\n                        this.debugSettings.renderAlgorithm = algoType as 'painter' | 'zbuffer' | 'bsp';\n                        this.debugLog(`Render algorithm: ${algoType.toUpperCase()}`, 'success');\n                        \n                        // Show algorithm description\n                        const descriptions = {\n                            painter: 'Sorts blocks and faces by distance, renders back-to-front',\n                            zbuffer: 'Enhanced depth sorting with sub-pixel precision',\n                            bsp: 'Spatial tree traversal for optimal rendering order'\n                        };\n                        this.debugLog(descriptions[algoType], 'info');\n                        break;\n                        \n                    default:\n                        this.debugLog(`Unknown command: ${command}`, 'error');\n                }\n            },\n            \n            // Ritual reward - creative bonus for completing the temple ritual\n            triggerRitualReward() {\n                // Show blessing effect\n                if (this.birdEvent) {\n                    this.showBirdAlert('üå∏ DIVINE BLESSING ACTIVATED! üå∏');\n                }\n                \n                // 1. Grant player ritual flight ability (separate from debug fly)\n                this.ritualFlight = true;\n                this.ritualFlightTimer = 60 * 60 * 2; // 2 minutes of flight\n                \n                // 2. Create protective barrier that repels birds\n                this.ritualBarrierActive = true;\n                \n                // 3. Give player special items\n                this.addToInventory('berdger', 1);\n                this.addToInventory('apple', 32);\n                \n                // 4. Massive score bonus\n                if (this.survivalStats) {\n                    this.survivalStats.score += 10000;\n                    this.survivalStats.wave++;\n                    this.survivalStats.currentObjective = { text: '‚ú® Divine protection active!', type: 'blessed' };\n                    this.updateSurvivalHUD();\n                }\n                \n                // 5. All pest birds flee\n                for (const pest of this.pestBirds) {\n                    pest.state = 'fleeing';\n                    pest.stateTimer = 1200; // 20 seconds flee\n                    pest.anger = 0;\n                }\n                \n                // 6. Spawn golden particles around player\n                for (let i = 0; i < 100; i++) {\n                    this.particles.push({\n                        x: this.camera.x + (Math.random() - 0.5) * 10,\n                        y: this.camera.y + Math.random() * 8 - 2,\n                        z: this.camera.z + (Math.random() - 0.5) * 10,\n                        vx: (Math.random() - 0.5) * 0.15,\n                        vy: 0.1 + Math.random() * 0.2,\n                        vz: (Math.random() - 0.5) * 0.15,\n                        life: 200 + Math.random() * 100,\n                        type: 'blessing',\n                        size: 4 + Math.random() * 4\n                    });\n                }\n            },\n            \n            // Batch pickup notification system\n            pickupQueue: {},\n            pickupTimer: null,\n            \n            queuePickupNotification(type, count) {\n                if (!this.pickupQueue[type]) {\n                    this.pickupQueue[type] = 0;\n                }\n                this.pickupQueue[type] += count;\n                \n                // Clear existing timer and set new one\n                if (this.pickupTimer) {\n                    clearTimeout(this.pickupTimer);\n                }\n                \n                // Wait 500ms for more pickups before showing notification\n                this.pickupTimer = setTimeout(() => {\n                    this.flushPickupNotifications();\n                }, 500);\n            },\n            \n            flushPickupNotifications() {\n                const container = document.getElementById('pickupNotification');\n                if (!container) return;\n                \n                const itemNames = {\n                    grass: 'Grass Block', dirt: 'Dirt', stone: 'Stone', wood: 'Wood',\n                    appleLeaves: 'Apple Leaves', leaves: 'Leaves', sand: 'Sand', brick: 'Brick',\n                    ka69: 'KA-69', water_bucket: 'Water Bucket', lava_bucket: 'Lava Bucket',\n                    obsidian: 'Obsidian', cherryWood: 'Cherry Wood', cherryLeaves: 'Cherry Leaves',\n                    chest: 'Chest', seeds: 'Seeds', berdger: 'The Berdger', apple: 'Apple',\n                    sakuraPetal: 'Cherry Petal', shimenawa: 'Sacred Rope', omamori: 'Charm',\n                    ema: 'Wish Plaque', incense: 'Incense', whiteBrick: 'White Brick',\n                    redBrick: 'Red Brick', glowstone: 'Glowstone', ritualStone: 'Ritual Stone'\n                };\n                \n                for (const [type, count] of Object.entries(this.pickupQueue)) {\n                    if (count === 0) continue;\n                    \n                    const notification = document.createElement('div');\n                    notification.className = 'pickup-item';\n                    \n                    // Create mini block canvas\n                    const miniCanvas = document.createElement('canvas');\n                    miniCanvas.width = 24;\n                    miniCanvas.height = 24;\n                    this.drawMiniBlock(miniCanvas, type);\n                    \n                    notification.innerHTML = `\n                        <span class=\"pickup-icon\"></span>\n                        <span>+${count} ${itemNames[type] || type}</span>\n                    `;\n                    notification.querySelector('.pickup-icon').appendChild(miniCanvas);\n                    \n                    container.appendChild(notification);\n                    \n                    // Remove after animation\n                    setTimeout(() => {\n                        if (notification.parentNode) {\n                            notification.parentNode.removeChild(notification);\n                        }\n                    }, 2000);\n                }\n                \n                // Clear queue\n                this.pickupQueue = {};\n                this.pickupTimer = null;\n            },\n            \n            // Fluid dynamics simulation - not yet implemented\n            // Fluid dynamics simulation - spreads water/lava realistically\n            // Set fluid level at position\n            setFluidLevel(x, y, z, level) {\n                const key = `${x},${y},${z}`;\n                if (level <= 0) {\n                    delete this.fluidLevels[key];\n                } else {\n                    this.fluidLevels[key] = Math.min(8, Math.max(1, level));\n                }\n            },\n            \n            getFluidLevel(x, y, z) {\n                return this.fluidLevels[`${x},${y},${z}`] || 0;\n            },\n            \n            updateFluids() {\n                // Process fluid updates slowly for visible spreading effect\n                if (!this.fluidUpdateTimer) this.fluidUpdateTimer = 0;\n                this.fluidUpdateTimer++;\n                if (this.fluidUpdateTimer < 8) return;  // Update every 8 frames (~7.5 updates/sec)\n                this.fluidUpdateTimer = 0;\n                \n                // Process 1-2 fluid blocks per update cycle for gradual spread\n                const maxUpdates = 2;\n                let processed = 0;\n                \n                while (this.fluidUpdates.length > 0 && processed < maxUpdates) {\n                    const fluid = this.fluidUpdates.shift();\n                    processed++;\n                    \n                    // Skip if block is no longer fluid (was replaced by player)\n                    const currentBlock = this.getBlock(fluid.x, fluid.y, fluid.z);\n                    if (!currentBlock || !this.fluidBlocks.includes(currentBlock)) {\n                        // Clean up fluid level if block was removed\n                        this.setFluidLevel(fluid.x, fluid.y, fluid.z, 0);\n                        continue;\n                    }\n                    \n                    const currentLevel = fluid.level || 8;\n                    \n                    // Priority 1: Flow DOWN (gravity)\n                    const belowBlock = this.getBlock(fluid.x, fluid.y - 1, fluid.z);\n                    \n                    // Check for water/lava interactions when flowing down\n                    if (belowBlock === 'water' && fluid.type === 'lava') {\n                        // Lava falling onto water = STONE\n                        this.setBlock(fluid.x, fluid.y - 1, fluid.z, 'stone');\n                        this.setFluidLevel(fluid.x, fluid.y - 1, fluid.z, 0);\n                        continue;\n                    } else if (belowBlock === 'lava' && fluid.type === 'water') {\n                        // Water falling onto lava = OBSIDIAN\n                        this.setBlock(fluid.x, fluid.y - 1, fluid.z, 'obsidian');\n                        this.setFluidLevel(fluid.x, fluid.y - 1, fluid.z, 0);\n                        continue;\n                    }\n                    \n                    if (!belowBlock) {\n                        // Empty space below - flow down with full level (falling fluid is full)\n                        this.setBlock(fluid.x, fluid.y - 1, fluid.z, fluid.type);\n                        this.setFluidLevel(fluid.x, fluid.y - 1, fluid.z, 8);\n                        this.fluidUpdates.push({\n                            x: fluid.x,\n                            y: fluid.y - 1,\n                            z: fluid.z,\n                            type: fluid.type,\n                            level: 8  // Falling fluid has full level\n                        });\n                        continue;  // Prioritize downward flow\n                    }\n                    \n                    // Priority 2: Spread HORIZONTALLY (only if can't flow down)\n                    // Horizontal spread decreases level by 1\n                    const spreadLevel = currentLevel - 1;\n                    if (spreadLevel <= 0) continue;  // Can't spread further\n                    \n                    if (belowBlock && !this.fluidBlocks.includes(belowBlock)) {\n                        // Solid block below - spread horizontally\n                        const directions = [\n                            { x: 1, z: 0 },\n                            { x: -1, z: 0 },\n                            { x: 0, z: 1 },\n                            { x: 0, z: -1 }\n                        ];\n                        \n                        // Randomize spread direction for natural look\n                        for (let i = directions.length - 1; i > 0; i--) {\n                            const j = Math.floor(Math.random() * (i + 1));\n                            [directions[i], directions[j]] = [directions[j], directions[i]];\n                        }\n                        \n                        for (const dir of directions) {\n                            const nx = fluid.x + dir.x;\n                            const nz = fluid.z + dir.z;\n                            const neighborBlock = this.getBlock(nx, fluid.y, nz);\n                            const neighborLevel = this.getFluidLevel(nx, fluid.y, nz);\n                            \n                            // Water + Lava horizontal interaction\n                            if (fluid.type === 'lava' && neighborBlock === 'water') {\n                                // Lava touching water horizontally = stone (at neighbor)\n                                this.setBlock(nx, fluid.y, nz, 'stone');\n                                this.setFluidLevel(nx, fluid.y, nz, 0);\n                                continue;\n                            } else if (fluid.type === 'water' && neighborBlock === 'lava') {\n                                // Water touching lava horizontally = stone (at neighbor) \n                                this.setBlock(nx, fluid.y, nz, 'stone');\n                                this.setFluidLevel(nx, fluid.y, nz, 0);\n                                continue;\n                            }\n                            \n                            // Spread to empty spaces or lower-level same fluid\n                            if (!neighborBlock) {\n                                this.setBlock(nx, fluid.y, nz, fluid.type);\n                                this.setFluidLevel(nx, fluid.y, nz, spreadLevel);\n                                this.fluidUpdates.push({\n                                    x: nx,\n                                    y: fluid.y,\n                                    z: nz,\n                                    type: fluid.type,\n                                    level: spreadLevel\n                                });\n                            } else if (neighborBlock === fluid.type && neighborLevel < spreadLevel) {\n                                // Flow into lower-level same fluid\n                                this.setFluidLevel(nx, fluid.y, nz, spreadLevel);\n                                this.fluidUpdates.push({\n                                    x: nx,\n                                    y: fluid.y,\n                                    z: nz,\n                                    type: fluid.type,\n                                    level: spreadLevel\n                                });\n                            }\n                        }\n                    }\n                }\n            },\n            \n            // Toggle inventory screen\n            toggleInventory() {\n                this.inventoryOpen = !this.inventoryOpen;\n                const invScreen = document.getElementById('inventoryScreen');\n                if (invScreen) {\n                    invScreen.classList.toggle('active', this.inventoryOpen);\n                }\n                \n                if (this.inventoryOpen) {\n                    this.inventoryHeldItem = null; // Clear held item when opening\n                    this.renderInventory();\n                    // Release pointer lock but DON'T pause - game continues in background\n                    if (document.pointerLockElement) {\n                        document.exitPointerLock();\n                    }\n                } else {\n                    this.inventoryHeldItem = null; // Clear held item when closing\n                    // Set flag to prevent pause from pointer lock release\n                    this.justClosedInventory = true;\n                    setTimeout(() => { this.justClosedInventory = false; }, 100);\n                    // Re-request pointer lock when closing inventory\n                    if (!this.isPaused) {\n                        this.canvas.requestPointerLock();\n                    }\n                }\n            },\n            \n            // Attempt to repair KA-69 with NPC (costs 15 seeds)\n            attemptRepair() {\n                // Check if player has seeds\n                const seedCount = this.getItemCount('seed');\n                const REPAIR_COST = 15;\n                \n                if (seedCount < REPAIR_COST) {\n                    this.debugLog(`Repair NPC: \"Need ${REPAIR_COST} seeds! You only have ${seedCount}.\"`, 'warn');\n                    return;\n                }\n                \n                // Find broken KA-69 in inventory\n                let repairedSomething = false;\n                \n                // Check hotbar\n                for (let i = 0; i < this.inventory.hotbar.length; i++) {\n                    const slot = this.inventory.hotbar[i];\n                    if (slot && slot.id === 'ka69' && slot.durability !== undefined && slot.durability === 0) {\n                        // Repair it!\n                        slot.durability = slot.maxDurability || 100;\n                        repairedSomething = true;\n                        this.debugLog('‚ú® Repair NPC: \"Your KA-69 is good as new!\"', 'success');\n                        break;\n                    }\n                }\n                \n                // Check main inventory if not found in hotbar\n                if (!repairedSomething) {\n                    for (let i = 0; i < this.inventory.main.length; i++) {\n                        const slot = this.inventory.main[i];\n                        if (slot && slot.id === 'ka69' && slot.durability !== undefined && slot.durability === 0) {\n                            // Repair it!\n                            slot.durability = slot.maxDurability || 100;\n                            repairedSomething = true;\n                            this.debugLog('‚ú® Repair NPC: \"Your KA-69 is good as new!\"', 'success');\n                            break;\n                        }\n                    }\n                }\n                \n                if (repairedSomething) {\n                    // Remove seeds\n                    this.removeItemFromInventory('seed', REPAIR_COST);\n                    this.updateHotbarDisplay();\n                    \n                    // Make NPC speak\n                    if (this.repairNPC) {\n                        this.repairNPC.lastSpoke = Date.now();\n                    }\n                } else {\n                    this.debugLog('Repair NPC: \"You don\\'t have a broken KA-69 to fix!\"', 'warn');\n                }\n            },\n            \n            // Open dialogue with NPC\n            openDialogue(npcType) {\n                if (npcType === 'gunsmith') {\n                    this.dialogueOpen = true;\n                    this.currentDialogueNPC = 'gunsmith';\n                    this.isPaused = true;\n                    \n                    // Release pointer lock so player can click dialogue options\n                    if (document.pointerLockElement) {\n                        document.exitPointerLock();\n                    }\n                    \n                    // Mark as met\n                    if (!this.gunsmithMetBefore) {\n                        this.gunsmithMetBefore = true;\n                        // Activate first quest\n                        if (this.questData['meet_gunsmith']) {\n                            this.questData['meet_gunsmith'].stage = 1;\n                            this.quests.push(this.questData['meet_gunsmith']);\n                        }\n                    }\n                    \n                    this.renderDialogue();\n                }\n            },\n            \n            // Close dialogue\n            closeDialogue() {\n                this.dialogueOpen = false;\n                this.currentDialogueNPC = null;\n                this.isPaused = false;\n                \n                const dialogue = document.getElementById('dialogueScreen');\n                if (dialogue) dialogue.style.display = 'none';\n                \n                // Don't auto-request pointer lock - browser blocks it for security\n                // Show click-to-play overlay instead\n                const clickToPlay = document.getElementById('clickToPlay');\n                if (clickToPlay) {\n                    clickToPlay.classList.add('active');\n                }\n            },\n            \n            // Toggle journal\n            toggleJournal() {\n                this.journalOpen = !this.journalOpen;\n                \n                if (this.journalOpen) {\n                    this.isPaused = true;\n                    \n                    // Release pointer lock\n                    if (document.pointerLockElement) {\n                        document.exitPointerLock();\n                    }\n                    \n                    this.renderJournal();\n                } else {\n                    this.isPaused = false;\n                    const journal = document.getElementById('journalScreen');\n                    if (journal) journal.style.display = 'none';\n                    \n                    // Show click-to-play overlay instead of auto-requesting pointer lock\n                    const clickToPlay = document.getElementById('clickToPlay');\n                    if (clickToPlay) {\n                        clickToPlay.classList.add('active');\n                    }\n                }\n            },\n            \n            // Render dialogue UI\n            renderDialogue() {\n                let dialogueHTML = document.getElementById('dialogueScreen');\n                if (!dialogueHTML) {\n                    // Create dialogue screen element\n                    dialogueHTML = document.createElement('div');\n                    dialogueHTML.id = 'dialogueScreen';\n                    dialogueHTML.style.cssText = `\n                        position: absolute;\n                        top: 50%;\n                        left: 50%;\n                        transform: translate(-50%, -50%);\n                        width: 600px;\n                        max-height: 500px;\n                        background: rgba(30, 20, 40, 0.95);\n                        border: 3px solid #8b7355;\n                        border-radius: 8px;\n                        padding: 25px;\n                        color: #fff;\n                        font-family: 'Courier New', monospace;\n                        z-index: 9999;\n                        overflow-y: auto;\n                        box-shadow: 0 0 30px rgba(0,0,0,0.7);\n                    `;\n                    document.body.appendChild(dialogueHTML);\n                }\n                \n                dialogueHTML.style.display = 'block';\n                \n                // Gunsmith dialogue\n                if (this.currentDialogueNPC === 'gunsmith') {\n                    const stage = this.gunsmithDialogueStage;\n                    let npcName = 'üßô Gunsmith Wizard';\n                    let dialogue = '';\n                    let options = '';\n                    \n                    // First meeting\n                    if (!this.gunsmithMetBefore || stage === 0) {\n                        dialogue = `\n                            <div style=\"margin-bottom: 20px;\">\n                                <h2 style=\"color: #ffd700; margin: 0 0 15px 0;\">${npcName}</h2>\n                                <p style=\"line-height: 1.6; font-size: 14px;\">\n                                    <em>*The wizard adjusts his pointed hat and grins*</em>\n                                </p>\n                                <p style=\"line-height: 1.6; font-size: 14px;\">\n                                    \"Ah! A fellow survivor of the Great Feathering! Welcome, welcome!\"\n                                </p>\n                                <p style=\"line-height: 1.6; font-size: 14px;\">\n                                    \"You know, I've been debugging‚Äîer, I mean, <em>studying</em>‚Äîthese birds for quite some time. \n                                    The patterns are fascinating! Aggressive spawning rates, coordinated attacks, \n                                    suspiciously optimized pathfinding...\"\n                                </p>\n                                <p style=\"line-height: 1.6; font-size: 14px;\">\n                                    <em>*He pulls out a worn notebook covered in sketches and calculations*</em>\n                                </p>\n                                <p style=\"line-height: 1.6; font-size: 14px;\">\n                                    \"Between you and me, I think there's a <strong>source</strong> to all this madness. \n                                    Something‚Äîor someone‚Äîis spawning these creatures at an unnaturally high rate. \n                                    It's almost as if someone set the spawn chance to 1.0 instead of 0.001!\"\n                                </p>\n                                <p style=\"line-height: 1.6; font-size: 14px;\">\n                                    <em>*He chuckles nervously*</em>\n                                </p>\n                                <p style=\"line-height: 1.6; font-size: 14px;\">\n                                    \"But where are my manners! I'm a traveling gunsmith‚ÄîI can repair that KA-69 of yours. \n                                    And hey, if you're interested in actually <em>solving</em> this bird problem once and for all, \n                                    I could use someone with your... survival skills.\"\n                                </p>\n                            </div>\n                        `;\n                    } else {\n                        // Subsequent meetings\n                        dialogue = `\n                            <div style=\"margin-bottom: 20px;\">\n                                <h2 style=\"color: #ffd700; margin: 0 0 15px 0;\">${npcName}</h2>\n                                <p style=\"line-height: 1.6; font-size: 14px;\">\n                                    \"Ah, back again! How's the bird-battling going?\"\n                                </p>\n                                <p style=\"line-height: 1.6; font-size: 14px;\">\n                                    <em>*He peers at you with curious eyes*</em>\n                                </p>\n                                <p style=\"line-height: 1.6; font-size: 14px;\">\n                                    \"I'm still working on tracking down the source of all these birds. \n                                    The more data we gather, the closer we get to the truth!\"\n                                </p>\n                            </div>\n                        `;\n                    }\n                    \n                    // Dialogue options\n                    options = `\n                        <div style=\"border-top: 2px solid #8b7355; padding-top: 20px; margin-top: 20px;\">\n                            <div onclick=\"window.game.handleDialogueChoice('speak')\" \n                                 style=\"padding: 12px; margin: 8px 0; background: rgba(139, 115, 85, 0.3); \n                                        border: 2px solid #8b7355; border-radius: 4px; cursor: pointer; \n                                        transition: all 0.2s;\"\n                                 onmouseover=\"this.style.background='rgba(139, 115, 85, 0.5)'\"\n                                 onmouseout=\"this.style.background='rgba(139, 115, 85, 0.3)'\">\n                                üí¨ <strong>Speak</strong> - \"Tell me more about your quest\"\n                            </div>\n                            \n                            <div onclick=\"window.game.handleDialogueChoice('repair')\" \n                                 style=\"padding: 12px; margin: 8px 0; background: rgba(65, 105, 225, 0.3); \n                                        border: 2px solid #4169e1; border-radius: 4px; cursor: pointer;\n                                        transition: all 0.2s;\"\n                                 onmouseover=\"this.style.background='rgba(65, 105, 225, 0.5)'\"\n                                 onmouseout=\"this.style.background='rgba(65, 105, 225, 0.3)'\">\n                                üîß <strong>Repair KA-69</strong> - Cost: 15 seeds\n                            </div>\n                            \n                            <div onclick=\"window.game.handleDialogueChoice('exit')\" \n                                 style=\"padding: 12px; margin: 8px 0; background: rgba(139, 0, 0, 0.3); \n                                        border: 2px solid #8b0000; border-radius: 4px; cursor: pointer;\n                                        transition: all 0.2s;\"\n                                 onmouseover=\"this.style.background='rgba(139, 0, 0, 0.5)'\"\n                                 onmouseout=\"this.style.background='rgba(139, 0, 0, 0.3)'\">\n                                üö™ <strong>[Exit Dialogue]</strong>\n                            </div>\n                        </div>\n                    `;\n                    \n                    dialogueHTML.innerHTML = dialogue + options;\n                }\n            },\n            \n            // Handle dialogue choice\n            handleDialogueChoice(choice) {\n                if (choice === 'speak') {\n                    // Quest dialogue\n                    this.showQuestDialogue();\n                } else if (choice === 'repair') {\n                    // Repair function\n                    this.attemptRepair();\n                    // Update dialogue to show result\n                    setTimeout(() => {\n                        if (this.dialogueOpen) {\n                            this.renderDialogue();\n                        }\n                    }, 100);\n                } else if (choice === 'exit') {\n                    this.closeDialogue();\n                }\n            },\n            \n            // Show quest-related dialogue\n            showQuestDialogue() {\n                const dialogueHTML = document.getElementById('dialogueScreen');\n                if (!dialogueHTML) return;\n                \n                let questDialogue = `\n                    <div style=\"margin-bottom: 20px;\">\n                        <h2 style=\"color: #ffd700; margin: 0 0 15px 0;\">üßô Gunsmith Wizard</h2>\n                        <p style=\"line-height: 1.6; font-size: 14px;\">\n                            \"Excellent! I knew you had that collaborative spirit!\"\n                        </p>\n                        <p style=\"line-height: 1.6; font-size: 14px;\">\n                            <em>*He spreads out a map with various markings*</em>\n                        </p>\n                        <p style=\"line-height: 1.6; font-size: 14px;\">\n                            \"Here's what I'm thinking: These birds aren't just randomly spawning. \n                            There's <em>intelligence</em> behind this. Maybe a cursed artifact, maybe a rogue wizard, \n                            maybe even a bug in the fabric of reality itself‚ÄîI've seen weirder things!\"\n                        </p>\n                        <p style=\"line-height: 1.6; font-size: 14px;\">\n                            \"What I need from you is <strong>data</strong>. Real field data. Survive some waves, \n                            gather drops from defeated birds, and come back to me. I'll analyze the samples and \n                            we'll piece together where they're coming from.\"\n                        </p>\n                        <p style=\"line-height: 1.6; font-size: 14px; color: #ffd700;\">\n                            <strong>QUEST UNLOCKED: Origin of the Feathered Menace</strong>\n                        </p>\n                        <p style=\"line-height: 1.6; font-size: 14px;\">\n                            üìú Survive 3 bird waves<br>\n                            üì¶ Collect 50 bird drops<br>\n                            üîÑ Return to the Gunsmith\n                        </p>\n                        <p style=\"line-height: 1.6; font-size: 14px;\">\n                            \"Press <strong>J</strong> to open your journal and track your progress. Good luck out there!\"\n                        </p>\n                    </div>\n                    \n                    <div style=\"border-top: 2px solid #8b7355; padding-top: 20px; margin-top: 20px;\">\n                        <div onclick=\"window.game.handleDialogueChoice('exit')\" \n                             style=\"padding: 12px; margin: 8px 0; background: rgba(65, 105, 225, 0.3); \n                                    border: 2px solid #4169e1; border-radius: 4px; cursor: pointer;\n                                    transition: all 0.2s;\"\n                             onmouseover=\"this.style.background='rgba(65, 105, 225, 0.5)'\"\n                             onmouseout=\"this.style.background='rgba(65, 105, 225, 0.3)'\">\n                            ‚úì <strong>Accept Quest</strong> - \"Let's do this!\"\n                        </div>\n                    </div>\n                `;\n                \n                dialogueHTML.innerHTML = questDialogue;\n                \n                // Unlock the quest\n                if (this.questData['birds_origin'].status === 'locked') {\n                    this.questData['birds_origin'].status = 'active';\n                    this.questData['birds_origin'].stage = 1;\n                    this.quests.push(this.questData['birds_origin']);\n                }\n                \n                // Mark first quest as completed\n                if (this.questData['meet_gunsmith']) {\n                    this.questData['meet_gunsmith'].stage = 2;\n                    this.questData['meet_gunsmith'].status = 'completed';\n                }\n            },\n            \n            // Render journal UI\n            renderJournal() {\n                let journalHTML = document.getElementById('journalScreen');\n                if (!journalHTML) {\n                    // Create journal screen element\n                    journalHTML = document.createElement('div');\n                    journalHTML.id = 'journalScreen';\n                    journalHTML.style.cssText = `\n                        position: absolute;\n                        top: 50%;\n                        left: 50%;\n                        transform: translate(-50%, -50%);\n                        width: 700px;\n                        max-height: 600px;\n                        background: rgba(40, 30, 20, 0.95);\n                        border: 4px solid #8b7355;\n                        border-radius: 8px;\n                        padding: 30px;\n                        color: #fff;\n                        font-family: 'Courier New', monospace;\n                        z-index: 9999;\n                        overflow-y: auto;\n                        box-shadow: 0 0 40px rgba(0,0,0,0.8);\n                    `;\n                    document.body.appendChild(journalHTML);\n                }\n                \n                journalHTML.style.display = 'block';\n                \n                let html = `\n                    <div style=\"border-bottom: 3px solid #8b7355; padding-bottom: 20px; margin-bottom: 20px;\">\n                        <h1 style=\"color: #ffd700; margin: 0; font-size: 28px;\">üìñ Quest Journal</h1>\n                        <p style=\"color: #aaa; margin: 5px 0 0 0; font-size: 12px;\">Press J to close</p>\n                    </div>\n                `;\n                \n                // Active quests\n                const activeQuests = this.quests.filter(q => q.status === 'active');\n                if (activeQuests.length > 0) {\n                    html += `<h2 style=\"color: #4169e1; margin: 20px 0 10px 0;\">Active Quests</h2>`;\n                    activeQuests.forEach(quest => {\n                        html += `\n                            <div style=\"background: rgba(65, 105, 225, 0.2); border: 2px solid #4169e1; \n                                        border-radius: 6px; padding: 15px; margin: 10px 0;\">\n                                <h3 style=\"color: #ffd700; margin: 0 0 10px 0;\">${quest.title}</h3>\n                                <p style=\"line-height: 1.5; margin: 8px 0;\">${quest.description}</p>\n                                <div style=\"margin-top: 12px;\">\n                                    <strong style=\"color: #4169e1;\">Objectives:</strong>\n                                    <ul style=\"margin: 5px 0; padding-left: 20px;\">\n                                        ${quest.objectives.map(obj => `<li>${obj}</li>`).join('')}\n                                    </ul>\n                                </div>\n                                ${quest.progress ? `\n                                    <div style=\"margin-top: 10px; padding-top: 10px; border-top: 1px solid #4169e1;\">\n                                        <strong>Progress:</strong> \n                                        Waves: ${quest.progress.waves}/3 | \n                                        Drops: ${quest.progress.drops}/50\n                                    </div>\n                                ` : ''}\n                            </div>\n                        `;\n                    });\n                }\n                \n                // Completed quests\n                const completedQuests = this.quests.filter(q => q.status === 'completed');\n                if (completedQuests.length > 0) {\n                    html += `<h2 style=\"color: #228b22; margin: 30px 0 10px 0;\">Completed Quests</h2>`;\n                    completedQuests.forEach(quest => {\n                        html += `\n                            <div style=\"background: rgba(34, 139, 34, 0.2); border: 2px solid #228b22; \n                                        border-radius: 6px; padding: 15px; margin: 10px 0; opacity: 0.7;\">\n                                <h3 style=\"color: #90ee90; margin: 0 0 10px 0;\">‚úì ${quest.title}</h3>\n                                <p style=\"line-height: 1.5; margin: 8px 0; font-size: 13px;\">${quest.description}</p>\n                            </div>\n                        `;\n                    });\n                }\n                \n                if (this.quests.length === 0) {\n                    html += `\n                        <div style=\"text-align: center; padding: 40px; color: #888;\">\n                            <p style=\"font-size: 16px;\">No quests yet...</p>\n                            <p style=\"font-size: 13px;\">Talk to NPCs to discover new quests!</p>\n                        </div>\n                    `;\n                }\n                \n                journalHTML.innerHTML = html;\n            },\n            \n            // Render inventory UI\n            renderInventory() {\n                const invScreen = document.getElementById('inventoryScreen');\n                if (!invScreen) return;\n                \n                // Helper to get readable item name\n                const getItemName = (slot) => {\n                    if (!slot) return '';\n                    const id = slot.id || slot.type;\n                    const names = {\n                        grass: 'Grass Block', dirt: 'Dirt', stone: 'Stone', wood: 'Wood',\n                        leaves: 'Leaves', water: 'Water', sand: 'Sand', brick: 'Brick',\n                        ka69: 'KA-69', water_bucket: 'Water Bucket', lava_bucket: 'Lava Bucket',\n                        lava: 'Lava', obsidian: 'Obsidian', cherryWood: 'Cherry Wood',\n                        cherryLeaves: 'Cherry Leaves', chest: 'Chest',\n                        ritualChest: 'Ritual Chest', buildingChest: 'Building Chest',\n                        seeds: 'Seeds', berdger: 'The Berdger',\n                        sakuraPetal: 'Sacred Cherry Petal', shimenawa: 'Sacred Rope',\n                        omamori: 'Protective Charm', ema: 'Wooden Wish Plaque',\n                        incense: 'Purifying Incense'\n                    };\n                    return names[id] || id;\n                };\n                \n                let html = '<div class=\"inventory-container\">';\n                html += '<h2>Inventory</h2>';\n                \n                // Crafting section\n                html += '<div class=\"crafting-section\">';\n                html += '<h3>Crafting</h3>';\n                html += '<div class=\"recipe-list\">';\n                for (const recipe of this.recipes) {\n                    const canCraft = this.canCraftRecipe(recipe);\n                    html += `<div class=\"recipe ${canCraft ? 'craftable' : 'disabled'}\" data-recipe=\"${recipe.name}\">`;\n                    html += `<span class=\"recipe-name\">${recipe.name}</span>`;\n                    html += `<span class=\"recipe-ingredients\">`;\n                    recipe.ingredients.forEach(ing => {\n                        html += `${ing.count}x ${ing.id} `;\n                    });\n                    html += `</span>`;\n                    html += `<span class=\"recipe-result\">‚Üí ${recipe.result.count}x ${recipe.result.id}</span>`;\n                    if (canCraft) {\n                        html += `<button class=\"craft-btn\" onclick=\"minecraftGame.craftRecipe('${recipe.name}')\">Craft</button>`;\n                    }\n                    html += '</div>';\n                }\n                html += '</div></div>';\n                \n                // Hotbar\n                html += '<div class=\"inv-hotbar\">';\n                html += '<h3>Hotbar</h3>';\n                html += '<div class=\"inv-slots\" id=\"hotbarSlots\">';\n                this.inventory.hotbar.forEach((slot, i) => {\n                    const emoji = this.getItemEmoji(slot);\n                    const hasItem = slot && slot.count > 0;\n                    const isHeld = this.inventoryHeldItem && this.inventoryHeldItem.source === 'hotbar' && this.inventoryHeldItem.index === i;\n                    const tooltip = hasItem ? getItemName(slot) : '';\n                    html += `<div class=\"inv-slot ${i === this.selectedSlot ? 'selected' : ''} ${hasItem ? 'has-item' : ''} ${isHeld ? 'held' : ''}\" \n                        data-source=\"hotbar\" data-index=\"${i}\" ${tooltip ? `data-tooltip=\"${tooltip}\"` : ''}\n                        draggable=\"${hasItem}\">${emoji}<span class=\"count\">${slot ? slot.count : ''}</span></div>`;\n                });\n                html += '</div></div>';\n                \n                // Main inventory\n                html += '<div class=\"inv-main\">';\n                html += '<h3>Storage</h3>';\n                html += '<div class=\"inv-slots\" id=\"storageSlots\">';\n                for (let i = 0; i < 27; i++) {\n                    const slot = this.inventory.main[i];\n                    const hasItem = slot && slot.count > 0;\n                    const isHeld = this.inventoryHeldItem && this.inventoryHeldItem.source === 'main' && this.inventoryHeldItem.index === i;\n                    if (slot) {\n                        const emoji = this.getItemEmoji(slot);\n                        const tooltip = getItemName(slot);\n                        html += `<div class=\"inv-slot has-item ${isHeld ? 'held' : ''}\" data-source=\"main\" data-index=\"${i}\" ${tooltip ? `data-tooltip=\"${tooltip}\"` : ''} draggable=\"true\">${emoji}<span class=\"count\">${slot.count}</span></div>`;\n                    } else {\n                        html += `<div class=\"inv-slot empty\" data-source=\"main\" data-index=\"${i}\" draggable=\"false\"></div>`;\n                    }\n                }\n                html += '</div></div>';\n                \n                html += '<p class=\"inv-hint\">Click items to pick up/place | Drag also works | Press E or ESC to close</p>';\n                html += '</div>';\n                \n                invScreen.innerHTML = html;\n                \n                // Setup drag and drop handlers\n                this.setupInventoryDragDrop();\n            },\n            \n            setupInventoryDragDrop() {\n                const invScreen = document.getElementById('inventoryScreen');\n                const slots = document.querySelectorAll('#inventoryScreen .inv-slot');\n                \n                // Track held item for click-to-move\n                if (!this.inventoryHeldItem) this.inventoryHeldItem = null;\n                \n                // Prevent page scrolling when scrolling inside inventory\n                const invContainer = invScreen.querySelector('.inventory-container');\n                if (invContainer) {\n                    invContainer.addEventListener('wheel', (e) => {\n                        e.stopPropagation();\n                        // Allow scrolling inside the container but prevent it from bubbling\n                        const { scrollTop, scrollHeight, clientHeight } = invContainer;\n                        const atTop = scrollTop === 0;\n                        const atBottom = scrollTop + clientHeight >= scrollHeight;\n                        \n                        // Only prevent default if we're trying to scroll beyond bounds\n                        if ((atTop && (e as WheelEvent).deltaY < 0) || (atBottom && (e as WheelEvent).deltaY > 0)) {\n                            e.preventDefault();\n                        }\n                    }, { passive: false });\n                }\n                \n                // Prevent scroll on the inventory screen during drag operations\n                invScreen.addEventListener('dragover', (e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                });\n                \n                invScreen.addEventListener('drop', (e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                });\n                \n                slots.forEach(slot => {\n                    // Click to select/place items (more reliable than drag)\n                    slot.addEventListener('click', (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        \n                        const source = (slot as HTMLElement).dataset.source;\n                        const index = parseInt((slot as HTMLElement).dataset.index);\n                        const slotArray = source === 'hotbar' ? this.inventory.hotbar : this.inventory.main;\n                        const clickedItem = slotArray[index];\n                        \n                        if (this.inventoryHeldItem) {\n                            // Place held item in this slot (swap if occupied)\n                            this.swapInventorySlots(\n                                this.inventoryHeldItem.source,\n                                this.inventoryHeldItem.index,\n                                source,\n                                index\n                            );\n                            this.inventoryHeldItem = null;\n                            this.renderInventory();\n                            this.updateHotbar();\n                            this.updateHotbarDisplay();\n                        } else if (clickedItem && clickedItem.count > 0) {\n                            // Pick up this item\n                            this.inventoryHeldItem = { source, index };\n                            this.renderInventory();\n                        }\n                    });\n                    \n                    // Also support drag and drop\n                    slot.addEventListener('dragstart', (e) => {\n                        e.stopPropagation();\n                        const source = (slot as HTMLElement).dataset.source;\n                        const index = parseInt((slot as HTMLElement).dataset.index);\n                        this.draggedItem = { source, index };\n                        slot.classList.add('dragging');\n                        (e as DragEvent).dataTransfer.effectAllowed = 'move';\n                        (e as DragEvent).dataTransfer.setDragImage(slot, 20, 20);\n                    });\n                    \n                    slot.addEventListener('dragend', (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        slot.classList.remove('dragging');\n                        this.draggedItem = null;\n                    });\n                    \n                    slot.addEventListener('dragover', (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        (e as DragEvent).dataTransfer.dropEffect = 'move';\n                        slot.classList.add('drag-over');\n                    });\n                    \n                    slot.addEventListener('dragleave', (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        slot.classList.remove('drag-over');\n                    });\n                    \n                    slot.addEventListener('drop', (e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        slot.classList.remove('drag-over');\n                        \n                        if (!this.draggedItem) return;\n                        \n                        const targetSource = (slot as HTMLElement).dataset.source;\n                        const targetIndex = parseInt((slot as HTMLElement).dataset.index);\n                        \n                        // Store scroll position\n                        const invContainer = document.querySelector('.inventory-container');\n                        const scrollTop = invContainer ? invContainer.scrollTop : 0;\n                        \n                        // Swap items between source and target\n                        this.swapInventorySlots(\n                            this.draggedItem.source, \n                            this.draggedItem.index,\n                            targetSource,\n                            targetIndex\n                        );\n                        \n                        this.draggedItem = null;\n                        this.renderInventory();\n                        this.updateHotbar();\n                        this.updateHotbarDisplay();\n                        \n                        // Restore scroll position\n                        const newContainer = document.querySelector('.inventory-container');\n                        if (newContainer) {\n                            newContainer.scrollTop = scrollTop;\n                        }\n                    });\n                });\n            },\n            \n            swapInventorySlots(srcType, srcIdx, destType, destIdx) {\n                const srcArray = srcType === 'hotbar' ? this.inventory.hotbar : this.inventory.main;\n                const destArray = destType === 'hotbar' ? this.inventory.hotbar : this.inventory.main;\n                \n                // Get items\n                const srcItem = srcArray[srcIdx];\n                const destItem = destArray[destIdx];\n                \n                // Swap\n                srcArray[srcIdx] = destItem;\n                destArray[destIdx] = srcItem;\n                \n                // Update selected block/item if hotbar changed\n                if (srcType === 'hotbar' || destType === 'hotbar') {\n                    const currentSlot = this.inventory.hotbar[this.selectedSlot];\n                    if (currentSlot) {\n                        if (currentSlot.type === 'block') {\n                            this.selectedBlock = currentSlot.id;\n                            this.selectedItem = null;\n                        } else if (currentSlot.type === 'weapon') {\n                            this.selectedItem = currentSlot.id;\n                            this.selectedBlock = null;\n                        }\n                    } else {\n                        this.selectedBlock = null;\n                        this.selectedItem = null;\n                    }\n                }\n            },\n            \n            getItemEmoji(slot) {\n                if (!slot) return '';\n                const id = slot.id || slot.type;\n                const emojis = {\n                    grass: 'üåø', dirt: 'üü´', stone: 'ü™®', wood: 'ü™µ',\n                    leaves: 'üå∏', water: 'üíß', sand: 'üèñÔ∏è', brick: 'üß±',\n                    ka69: 'üî´', water_bucket: 'ü™£', lava_bucket: 'ü´ß',\n                    lava: 'üî•', obsidian: 'üü£', cherryWood: 'ü™µ', cherryLeaves: 'üå∏',\n                    chest: 'üì¶', ritualChest: 'üì¶', buildingChest: 'üì¶',\n                    seeds: 'üåæ', berdger: 'üçî',\n                    sakuraPetal: 'üå∏', shimenawa: 'ü™¢', omamori: 'üéÄ',\n                    ema: 'ü™ß', incense: 'üïØÔ∏è'\n                };\n                return emojis[id] || '‚ùì';\n            },\n            \n            canCraftRecipe(recipe) {\n                for (const ingredient of recipe.ingredients) {\n                    const total = this.countItem(ingredient.id);\n                    if (total < ingredient.count) return false;\n                }\n                return true;\n            },\n            \n            countItem(itemId) {\n                let count = 0;\n                for (const slot of this.inventory.hotbar) {\n                    if (slot && slot.id === itemId) count += slot.count;\n                }\n                for (const slot of this.inventory.main) {\n                    if (slot && slot.id === itemId) count += slot.count;\n                }\n                return count;\n            },\n            \n            craftRecipe(recipeName) {\n                const recipe = this.recipes.find(r => r.name === recipeName);\n                if (!recipe || !this.canCraftRecipe(recipe)) return;\n                \n                // Remove ingredients\n                for (const ingredient of recipe.ingredients) {\n                    this.removeItem(ingredient.id, ingredient.count);\n                }\n                \n                // Add result\n                this.addItem(recipe.result);\n                \n                // Re-render inventory\n                this.renderInventory();\n            },\n            \n            removeItem(itemId, count) {\n                let remaining = count;\n                \n                // Remove from hotbar first\n                for (const slot of this.inventory.hotbar) {\n                    if (slot && slot.id === itemId && remaining > 0) {\n                        const remove = Math.min(slot.count, remaining);\n                        slot.count -= remove;\n                        remaining -= remove;\n                    }\n                }\n                \n                // Then from main inventory\n                for (const slot of this.inventory.main) {\n                    if (slot && slot.id === itemId && remaining > 0) {\n                        const remove = Math.min(slot.count, remaining);\n                        slot.count -= remove;\n                        remaining -= remove;\n                    }\n                }\n            },\n            \n            addItem(item) {\n                // Try to stack with existing items first\n                for (const slot of this.inventory.hotbar) {\n                    if (slot && slot.id === item.id && slot.count < 64) {\n                        const add = Math.min(64 - slot.count, item.count);\n                        slot.count += add;\n                        item.count -= add;\n                        if (item.count <= 0) return;\n                    }\n                }\n                \n                for (const slot of this.inventory.main) {\n                    if (slot && slot.id === item.id && slot.count < 64) {\n                        const add = Math.min(64 - slot.count, item.count);\n                        slot.count += add;\n                        item.count -= add;\n                        if (item.count <= 0) return;\n                    }\n                }\n                \n                // Find empty slot\n                for (let i = 0; i < this.inventory.main.length; i++) {\n                    if (!this.inventory.main[i]) {\n                        this.inventory.main[i] = { ...item };\n                        return;\n                    }\n                }\n            },\n            \n            raycast() {\n                // Calculate ray direction from camera angles\n                // CRITICAL: Must use NEGATIVE angles to match projection coordinate system!\n                // Projection uses -rotX and -rotY, so raycast must too\n                const pitch = -this.camera.rotX;\n                const yaw = -this.camera.rotY;\n                \n                const cosPitch = Math.cos(pitch);\n                const sinPitch = Math.sin(pitch);\n                const cosYaw = Math.cos(yaw);\n                const sinYaw = Math.sin(yaw);\n                \n                // Direction vector in projection's coordinate system\n                // This MUST produce the ray that goes through screen center\n                const dx = sinYaw * cosPitch;  // Note: positive sinYaw (not negative)\n                const dy = sinPitch;           // Note: positive sinPitch\n                const dz = cosYaw * cosPitch;\n                \n                // Normalize direction (important for accurate distance calculation)\n                const len = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                const dirX = dx / len;\n                const dirY = dy / len;\n                const dirZ = dz / len;\n                \n                // Ray origin - start from camera eye position\n                let x = this.camera.x;\n                let y = this.camera.y;\n                let z = this.camera.z;\n                \n                // Current voxel position\n                let voxelX = Math.floor(x);\n                let voxelY = Math.floor(y);\n                let voxelZ = Math.floor(z);\n                \n                // Step direction (+1 or -1)\n                const stepX = dirX >= 0 ? 1 : -1;\n                const stepY = dirY >= 0 ? 1 : -1;\n                const stepZ = dirZ >= 0 ? 1 : -1;\n                \n                // Distance between voxel boundaries along each axis\n                const tDeltaX = Math.abs(1 / dirX);\n                const tDeltaY = Math.abs(1 / dirY);\n                const tDeltaZ = Math.abs(1 / dirZ);\n                \n                // Distance to first voxel boundary\n                let tMaxX, tMaxY, tMaxZ;\n                \n                if (dirX > 0) {\n                    tMaxX = (voxelX + 1 - x) / dirX;\n                } else if (dirX < 0) {\n                    tMaxX = (voxelX - x) / dirX;\n                } else {\n                    tMaxX = Infinity;\n                }\n                \n                if (dirY > 0) {\n                    tMaxY = (voxelY + 1 - y) / dirY;\n                } else if (dirY < 0) {\n                    tMaxY = (voxelY - y) / dirY;\n                } else {\n                    tMaxY = Infinity;\n                }\n                \n                if (dirZ > 0) {\n                    tMaxZ = (voxelZ + 1 - z) / dirZ;\n                } else if (dirZ < 0) {\n                    tMaxZ = (voxelZ - z) / dirZ;\n                } else {\n                    tMaxZ = Infinity;\n                }\n                \n                // Track the face we entered from (for block placement)\n                let enteredFace = null;\n                \n                // Maximum reach distance - 4 blocks (Minecraft-like)\n                const maxDistance = 4;\n                let t = 0;\n                \n                // Track last non-fluid entry face for proper placement\n                let lastSolidFace = null;\n                \n                // Track if ray passed through water\n                let throughWater = false;\n                let throughLava = false;\n                \n                // DDA traversal loop\n                for (let i = 0; i < 100; i++) { // safety limit\n                    // Check current voxel for block\n                    const block = this.getBlock(voxelX, voxelY, voxelZ);\n                    if (block) {\n                        // Skip fluid blocks - continue raycast through them\n                        if (block === 'water' || block === 'lava') {\n                            // Track which fluid we passed through\n                            if (block === 'water') throughWater = true;\n                            if (block === 'lava') throughLava = true;\n                            // Don't update lastSolidFace, just continue\n                        } else {\n                            // Hit a solid block! Calculate placement position\n                            let placePos = null;\n                            // Use lastSolidFace if we came through fluids, otherwise use enteredFace\n                            const placeFace = lastSolidFace || enteredFace;\n                            if (placeFace && (placeFace.x !== 0 || placeFace.y !== 0 || placeFace.z !== 0)) {\n                                placePos = {\n                                    x: voxelX + placeFace.x,\n                                    y: voxelY + placeFace.y,\n                                    z: voxelZ + placeFace.z\n                                };\n                            }\n                            \n                            return {\n                                hit: { x: voxelX, y: voxelY, z: voxelZ },\n                                place: placePos,\n                                block: block,\n                                throughWater: throughWater,\n                                throughLava: throughLava\n                            };\n                        }\n                    } else {\n                        // Empty space - update lastSolidFace\n                        lastSolidFace = enteredFace;\n                    }\n                    \n                    // Step to next voxel (choose axis with smallest tMax)\n                    if (tMaxX < tMaxY && tMaxX < tMaxZ) {\n                        t = tMaxX;\n                        if (t > maxDistance) break;\n                        voxelX += stepX;\n                        tMaxX += tDeltaX;\n                        enteredFace = { x: -stepX, y: 0, z: 0 };\n                    } else if (tMaxY < tMaxZ) {\n                        t = tMaxY;\n                        if (t > maxDistance) break;\n                        voxelY += stepY;\n                        tMaxY += tDeltaY;\n                        enteredFace = { x: 0, y: -stepY, z: 0 };\n                    } else {\n                        t = tMaxZ;\n                        if (t > maxDistance) break;\n                        voxelZ += stepZ;\n                        tMaxZ += tDeltaZ;\n                        enteredFace = { x: 0, y: 0, z: -stepZ };\n                    }\n                }\n                \n                // No block hit within range\n                return null;\n            },\n            \n            update() {\n                if (!this.isActive || this.isPaused) return;\n                \n                // Update weapon cooldowns\n                if (this.shootCooldown > 0) this.shootCooldown--;\n                if (this.muzzleFlash > 0) this.muzzleFlash--;\n                \n                // Update ritual flight timer (separate from debug fly)\n                if (this.ritualFlightTimer > 0) {\n                    this.ritualFlightTimer--;\n                    if (this.ritualFlightTimer <= 0) {\n                        this.ritualFlight = false;\n                    }\n                }\n                \n                const baseSpeed = this.debugMoveSpeed || 0.12;\n                const canFly = this.debugNoclip || this.debugFly || this.ritualFlight;\n                const speed = canFly ? baseSpeed * 2 : baseSpeed;\n                // Forward direction matches camera view: (-sin(rotY), cos(rotY))\n                const sin = Math.sin(this.camera.rotY);\n                const cos = Math.cos(this.camera.rotY);\n                \n                // --- NOCLIP/FLY MODE ---\n                if (this.debugNoclip || this.debugFly) {\n                    let moveX = 0, moveY = 0, moveZ = 0;\n                    \n                    // Forward/backward (W/S) - includes vertical component when looking up/down\n                    if (this.keys['w']) {\n                        moveX -= sin * Math.cos(this.camera.rotX) * speed;\n                        moveY -= Math.sin(this.camera.rotX) * speed;\n                        moveZ += cos * Math.cos(this.camera.rotX) * speed;\n                    }\n                    if (this.keys['s']) {\n                        moveX += sin * Math.cos(this.camera.rotX) * speed;\n                        moveY += Math.sin(this.camera.rotX) * speed;\n                        moveZ -= cos * Math.cos(this.camera.rotX) * speed;\n                    }\n                    // Strafe (A/D)\n                    if (this.keys['a']) {\n                        moveX -= cos * speed;\n                        moveZ -= sin * speed;\n                    }\n                    if (this.keys['d']) {\n                        moveX += cos * speed;\n                        moveZ += sin * speed;\n                    }\n                    // Up/Down (Space/Shift)\n                    if (this.keys[' ']) moveY += speed;\n                    if (this.keys['shift']) moveY -= speed;\n                    \n                    // Apply movement (no collision in noclip, collision in debug fly)\n                    if (this.debugNoclip) {\n                        this.camera.x += moveX;\n                        this.camera.y += moveY;\n                        this.camera.z += moveZ;\n                    } else {\n                        // Debug fly mode still has collision\n                        this.camera.x += moveX;\n                        this.camera.y += moveY;\n                        this.camera.z += moveZ;\n                    }\n                    \n                    // Reset velocity\n                    this.velocity = { x: 0, y: 0, z: 0 };\n                    return; // Skip normal physics\n                }\n                \n                // --- RITUAL FLIGHT MODE (with collision) ---\n                if (this.ritualFlight) {\n                    let moveX = 0, moveY = 0, moveZ = 0;\n                    \n                    // Horizontal movement\n                    if (this.keys['w']) {\n                        moveX -= sin * speed;\n                        moveZ += cos * speed;\n                    }\n                    if (this.keys['s']) {\n                        moveX += sin * speed;\n                        moveZ -= cos * speed;\n                    }\n                    if (this.keys['a']) {\n                        moveX -= cos * speed;\n                        moveZ -= sin * speed;\n                    }\n                    if (this.keys['d']) {\n                        moveX += cos * speed;\n                        moveZ += sin * speed;\n                    }\n                    // Vertical flight controls\n                    if (this.keys[' ']) moveY += speed;\n                    if (this.keys['shift']) moveY -= speed;\n                    \n                    // Apply with simple collision check\n                    const newX = this.camera.x + moveX;\n                    const newY = this.camera.y + moveY;\n                    const newZ = this.camera.z + moveZ;\n                    \n                    const feetY = Math.floor(newY - this.playerEyeHeight);\n                    const headY = Math.floor(newY);\n                    const px = Math.floor(newX);\n                    const pz = Math.floor(newZ);\n                    \n                    let canMove = true;\n                    for (let checkY = feetY; checkY <= headY; checkY++) {\n                        const block = this.getBlock(px, checkY, pz);\n                        if (block && !this.fluidBlocks.includes(block)) {\n                            canMove = false;\n                            break;\n                        }\n                    }\n                    \n                    if (canMove) {\n                        this.camera.x = newX;\n                        this.camera.y = newY;\n                        this.camera.z = newZ;\n                    }\n                    \n                    this.velocity = { x: 0, y: 0, z: 0 };\n                    return; // Skip normal physics\n                }\n                \n                // --- FLUID DETECTION ---\n                const playerFeetY = this.camera.y - this.playerEyeHeight;\n                const playerHeadY = playerFeetY + this.playerHeight;\n                const px = Math.floor(this.camera.x);\n                const pz = Math.floor(this.camera.z);\n                \n                // Check fluid at feet, waist, and head\n                const feetBlock = this.getBlock(px, Math.floor(playerFeetY), pz);\n                const waistBlock = this.getBlock(px, Math.floor(playerFeetY + 0.9), pz);\n                const headBlock = this.getBlock(px, Math.floor(playerHeadY - 0.1), pz);\n                \n                const feetInWater = feetBlock === 'water';\n                const feetInLava = feetBlock === 'lava';\n                const waistInWater = waistBlock === 'water';\n                const waistInLava = waistBlock === 'lava';\n                const headInWater = headBlock === 'water';\n                const headInLava = headBlock === 'lava';\n                \n                // Determine swimming state (in fluid at feet or waist level)\n                const inWater = feetInWater || waistInWater;\n                const inLava = feetInLava || waistInLava;\n                const swimming = inWater || inLava;\n                const submerged = headInWater || headInLava;\n                \n                // Store fluid state for rendering effects\n                this.inWater = inWater || headInWater;\n                this.inLava = inLava || headInLava;\n                this.swimming = swimming;\n                this.headSubmergedWater = headInWater;  // Only show blue overlay when head is underwater\n                this.headSubmergedLava = headInLava;    // Only show lava overlay when head is in lava\n                \n                // Apply speed modifier when in fluid\n                let speedMod = 1.0;\n                if (inWater) speedMod = 0.65;  // Water slows to 65%\n                if (inLava) speedMod = 0.35;   // Lava slows to 35%\n                \n                let moveX = 0;\n                let moveZ = 0;\n                const walkSpeed = baseSpeed;\n                \n                // Forward/backward (W/S)\n                if (this.keys['w']) {\n                    moveX -= sin * walkSpeed * speedMod;\n                    moveZ += cos * walkSpeed * speedMod;\n                }\n                if (this.keys['s']) {\n                    moveX += sin * walkSpeed * speedMod;\n                    moveZ -= cos * walkSpeed * speedMod;\n                }\n                // Strafe left/right (A/D) - perpendicular to view\n                if (this.keys['a']) {\n                    moveX -= cos * walkSpeed * speedMod;\n                    moveZ -= sin * walkSpeed * speedMod;\n                }\n                if (this.keys['d']) {\n                    moveX += cos * walkSpeed * speedMod;\n                    moveZ += sin * walkSpeed * speedMod;\n                }\n                \n                // Track old position\n                const oldX = this.camera.x;\n                const oldZ = this.camera.z;\n                \n                // Improved collision detection with smaller steps and wall sliding\n                const playerRadius = 0.25; // Slightly smaller for tighter spaces\n                const playerHeight = 1.8;\n                \n                // First, check if we're currently stuck and need to escape\n                if (this.collidesAt(this.camera.x, this.camera.y, this.camera.z, playerRadius, playerHeight)) {\n                    // EMERGENCY UNSTUCK - aggressive push out\n                    let escaped = false;\n                    for (let pushDist = 0.1; pushDist <= 1.5 && !escaped; pushDist += 0.1) {\n                        const escapeAngles = [0, 45, 90, 135, 180, 225, 270, 315];\n                        for (const angle of escapeAngles) {\n                            const rad = angle * Math.PI / 180;\n                            const testX = this.camera.x + Math.cos(rad) * pushDist;\n                            const testZ = this.camera.z + Math.sin(rad) * pushDist;\n                            if (!this.collidesAt(testX, this.camera.y, testZ, playerRadius, playerHeight)) {\n                                this.camera.x = testX;\n                                this.camera.z = testZ;\n                                escaped = true;\n                                break;\n                            }\n                        }\n                        // Also try pushing up\n                        if (!escaped && !this.collidesAt(this.camera.x, this.camera.y + pushDist, this.camera.z, playerRadius, playerHeight)) {\n                            this.camera.y += pushDist;\n                            escaped = true;\n                        }\n                    }\n                }\n                \n                // Try full movement first\n                let finalX = this.camera.x;\n                let finalZ = this.camera.z;\n                \n                // Step-based collision for smoother wall sliding\n                const steps = 8; // More steps for smoother collision\n                const stepX = moveX / steps;\n                const stepZ = moveZ / steps;\n                \n                for (let i = 0; i < steps; i++) {\n                    // Try X movement with slight margin\n                    const testX = finalX + stepX;\n                    if (!this.collidesAt(testX, this.camera.y, finalZ, playerRadius, playerHeight)) {\n                        finalX = testX;\n                    } else {\n                        // Try to slide along the wall with reduced speed\n                        const slideX = stepX * 0.5;\n                        if (!this.collidesAt(finalX + slideX, this.camera.y, finalZ, playerRadius, playerHeight)) {\n                            finalX += slideX;\n                        }\n                    }\n                    \n                    // Try Z movement with slight margin\n                    const testZ = finalZ + stepZ;\n                    if (!this.collidesAt(finalX, this.camera.y, testZ, playerRadius, playerHeight)) {\n                        finalZ = testZ;\n                    } else {\n                        // Try to slide along the wall with reduced speed\n                        const slideZ = stepZ * 0.5;\n                        if (!this.collidesAt(finalX, this.camera.y, finalZ + slideZ, playerRadius, playerHeight)) {\n                            finalZ += slideZ;\n                        }\n                    }\n                }\n                \n                // Final safety check - if still stuck, try small adjustments\n                if (this.collidesAt(finalX, this.camera.y, finalZ, playerRadius, playerHeight)) {\n                    // Don't move at all if we'd get stuck\n                    finalX = this.camera.x;\n                    finalZ = this.camera.z;\n                }\n                \n                this.camera.x = finalX;\n                this.camera.z = finalZ;\n                \n                // Track distance\n                const dx = this.camera.x - oldX;\n                const dz = this.camera.z - oldZ;\n                this.stats.distance += Math.sqrt(dx * dx + dz * dz);\n                \n                // --- GRAVITY / SWIMMING PHYSICS ---\n                if (swimming) {\n                    // SWIMMING MODE: Buoyancy and fluid drag\n                    const buoyancy = inLava ? 0.008 : 0.012;  // Lava is denser, less buoyancy\n                    const swimDrag = inLava ? 0.92 : 0.95;    // More drag in lava\n                    \n                    // Natural buoyancy pushes player up\n                    this.velocity.y += buoyancy;\n                    \n                    // SPACE = swim up\n                    if (this.keys[' ']) {\n                        const swimUpSpeed = inLava ? 0.04 : 0.06;\n                        this.velocity.y += swimUpSpeed;\n                    }\n                    \n                    // SHIFT = swim down\n                    if (this.keys['shift']) {\n                        const swimDownSpeed = inLava ? 0.03 : 0.04;\n                        this.velocity.y -= swimDownSpeed;\n                    }\n                    \n                    // Clamp swim velocity\n                    const maxSwimSpeed = inLava ? 0.12 : 0.15;\n                    this.velocity.y = Math.max(-maxSwimSpeed, Math.min(maxSwimSpeed, this.velocity.y));\n                    \n                    // Apply drag (velocity decays over time in fluid)\n                    this.velocity.y *= swimDrag;\n                    \n                    // Surface boost - when at surface and pressing space, jump out\n                    if (!submerged && this.keys[' '] && this.velocity.y < 0.15) {\n                        this.velocity.y = 0.2;\n                    }\n                } else {\n                    // NORMAL MODE: Standard gravity\n                    this.velocity.y += this.gravity;\n                }\n                \n                const newY = this.camera.y + this.velocity.y;\n                \n                // Ground collision - camera is at hip/waist level (playerEyeHeight above ground)\n                const groundY = this.getGroundHeightBelow(this.camera.x, this.camera.z, this.camera.y) + this.playerEyeHeight + 0.5;\n                if (newY < groundY) {\n                    this.camera.y = groundY;\n                    this.velocity.y = 0;\n                    this.isJumping = false;\n                    \n                    // Continuous jumping - if space is held and on ground, jump immediately\n                    if (this.keys[' '] && !swimming) {\n                        this.velocity.y = 0.28;\n                        this.isJumping = true;\n                        this.stats.jumps++;\n                    }\n                } else {\n                    this.camera.y = newY;\n                }\n                \n                // Ceiling collision\n                const ceilingY = this.getCeilingAbove(this.camera.x, this.camera.z, this.camera.y);\n                if (ceilingY !== null && this.camera.y > ceilingY - 0.5) {\n                    this.camera.y = ceilingY - 0.5;\n                    this.velocity.y = 0;\n                }\n                \n                // World boundary forcefield - keep player inside\n                if (this.worldBounds) {\n                    const margin = 0.5;  // Keep player slightly inside boundary\n                    const bounce = 0.3;  // Bounce back force\n                    \n                    if (this.camera.x < this.worldBounds.minX + margin) {\n                        this.camera.x = this.worldBounds.minX + margin;\n                        this.velocity.x = Math.abs(this.velocity.x || 0) * bounce;\n                    }\n                    if (this.camera.x > this.worldBounds.maxX - margin) {\n                        this.camera.x = this.worldBounds.maxX - margin;\n                        this.velocity.x = -Math.abs(this.velocity.x || 0) * bounce;\n                    }\n                    if (this.camera.z < this.worldBounds.minZ + margin) {\n                        this.camera.z = this.worldBounds.minZ + margin;\n                        this.velocity.z = Math.abs(this.velocity.z || 0) * bounce;\n                    }\n                    if (this.camera.z > this.worldBounds.maxZ - margin) {\n                        this.camera.z = this.worldBounds.maxZ - margin;\n                        this.velocity.z = -Math.abs(this.velocity.z || 0) * bounce;\n                    }\n                    // Prevent falling below world\n                    if (this.camera.y < this.worldBounds.minY + this.playerEyeHeight) {\n                        this.camera.y = this.worldBounds.minY + this.playerEyeHeight;\n                        this.velocity.y = 0.15;  // Bounce up\n                    }\n                }\n                \n                // Trippy filter animation\n                if (this.settings.filter === 'trippy') {\n                    this.applyFilters();\n                }\n            },\n            \n            // Check if player would collide with blocks at position\n            collidesAt(x, y, z, radius, height) {\n                const feetY = y - this.playerEyeHeight; // Camera is at waist level\n                // Check corners and center at multiple heights\n                const checkPoints = [\n                    { x: x - radius, z: z - radius },\n                    { x: x + radius, z: z - radius },\n                    { x: x - radius, z: z + radius },\n                    { x: x + radius, z: z + radius },\n                    { x: x, z: z }\n                ];\n                \n                for (const point of checkPoints) {\n                    const bx = Math.floor(point.x);\n                    const bz = Math.floor(point.z);\n                    // Check at feet, middle, and head level\n                    for (let checkY = Math.floor(feetY); checkY < Math.floor(feetY + height); checkY++) {\n                        const block = this.getBlock(bx, checkY, bz);\n                        // Fluids don't block movement - player can walk/swim through them\n                        if (block && !this.fluidBlocks.includes(block)) {\n                            return true;\n                        }\n                    }\n                }\n                return false;\n            },\n            \n            // Get ground height directly below player (not teleporting to trees)\n            getGroundHeightBelow(x, z, currentY) {\n                const bx = Math.floor(x);\n                const bz = Math.floor(z);\n                const startY = Math.floor(currentY - this.playerEyeHeight); // Start from feet level\n                \n                for (let y = startY; y >= 0; y--) {\n                    const block = this.getBlock(bx, y, bz);\n                    // Fluids don't count as ground - player sinks through them\n                    if (block && !this.fluidBlocks.includes(block)) {\n                        return y + 1;\n                    }\n                }\n                return 0;\n            },\n            \n            // Get ground height at position (searches from top down)\n            getGroundHeight(x, z) {\n                const bx = Math.floor(x);\n                const bz = Math.floor(z);\n                \n                // Search from reasonable max height down to bedrock\n                for (let y = 40; y >= 0; y--) {\n                    const block = this.getBlock(bx, y, bz);\n                    // Found solid ground (not air, water, or lava)\n                    if (block && block !== 'water' && block !== 'lava') {\n                        return y;\n                    }\n                }\n                return 0; // Fallback to bedrock level\n            },\n            \n            // Get ceiling above player\n            getCeilingAbove(x, z, currentY) {\n                const bx = Math.floor(x);\n                const bz = Math.floor(z);\n                const headY = Math.floor(currentY);\n                \n                for (let y = headY; y <= headY + 3; y++) {\n                    const block = this.getBlock(bx, y, bz);\n                    // Fluids don't count as ceiling\n                    if (block && !this.fluidBlocks.includes(block)) {\n                        return y;\n                    }\n                }\n                return null;\n            },\n            \n            render() {\n                if (!this.isActive) return;\n                \n                const ctx = this.ctx;\n                const width = this.canvas.width;\n                const height = this.canvas.height;\n                \n                // Calculate eye height for sneaking\n                const renderCamY = this.camera.y + this.getEyeHeight();\n                \n                // Sky gradient (cached when dimensions match)\n                if (!this.cachedSky || this.cachedSky.w !== width || this.cachedSky.h !== height || this.cachedSky.lighting !== this.settings.lighting) {\n                    const skyGrad = ctx.createLinearGradient(0, 0, 0, height);\n                    if (this.settings.lighting) {\n                        skyGrad.addColorStop(0, '#1a0a1a');\n                        skyGrad.addColorStop(0.5, '#2d1f3d');\n                        skyGrad.addColorStop(1, '#ffb7c5');\n                    } else {\n                        skyGrad.addColorStop(0, '#111');\n                        skyGrad.addColorStop(1, '#333');\n                    }\n                    this.cachedSky = { grad: skyGrad, w: width, h: height, lighting: this.settings.lighting };\n                }\n                ctx.fillStyle = this.cachedSky.grad;\n                ctx.fillRect(0, 0, width, height);\n                \n                // Cache camera values for this frame\n                const camX = this.camera.x;\n                const camY = renderCamY; // Use adjusted height for sneaking\n                const camZ = this.camera.z;\n                const cosY = Math.cos(-this.camera.rotY);\n                const sinY = Math.sin(-this.camera.rotY);\n                const cosX = Math.cos(-this.camera.rotX);\n                const sinX = Math.sin(-this.camera.rotX);\n                const halfW = width / 2;\n                const halfH = height / 2;\n                const fov = 400;\n                const renderDist = this.settings.renderDistance;\n                const renderDistSq = renderDist * renderDist;\n                \n                // Inline project function for speed\n                const project = (x, y, z) => {\n                    const dx = x - camX;\n                    const dy = y - camY;\n                    const dz = z - camZ;\n                    const rx = dx * cosY - dz * sinY;\n                    const rz = dx * sinY + dz * cosY;\n                    const ry = dy * cosX - rz * sinX;\n                    const finalZ = dy * sinX + rz * cosX;\n                    if (finalZ <= 0.1) return null;\n                    return { x: halfW + (rx / finalZ) * fov, y: halfH - (ry / finalZ) * fov, z: finalZ };\n                };\n                \n                // Collect visible blocks with frustum culling\n                const blocks = [];\n                const camDirX = -Math.sin(this.camera.rotY);\n                const camDirZ = Math.cos(this.camera.rotY);\n                \n                // Performance: Cache world keys if not changed\n                const worldKeys = Object.keys(this.world);\n                \n                for (let i = 0; i < worldKeys.length; i++) {\n                    const key = worldKeys[i];\n                    const [x, y, z] = key.split(',').map(Number);\n                    const dx = x + 0.5 - camX;\n                    const dy = y + 0.5 - camY;\n                    const dz = z + 0.5 - camZ;\n                    const distSq = dx * dx + dy * dy + dz * dz;\n                    \n                    // Distance culling\n                    if (distSq > renderDistSq) continue;\n                    \n                    // Basic frustum culling - skip blocks behind camera\n                    const dot = dx * camDirX + dz * camDirZ;\n                    if (dot < -3 && distSq > 16) continue; // Behind camera and not too close\n                    \n                    blocks.push({ x, y, z, dist: distSq, type: this.world[key] });\n                }\n                \n                // Sort back-to-front (painter's algorithm)\n                blocks.sort((a, b) => b.dist - a.dist);\n                \n                // Render blocks with face culling\n                const getBlock = (x, y, z) => this.world[`${x},${y},${z}`];\n                \n                // Check if a face should be rendered - includes transparent solid blocks\n                const isTransparent = (block) => {\n                    if (!block) return true; // No block = show face\n                    if (this.fluidBlocks.includes(block)) return true; // Fluid = transparent\n                    // Check if block has transparency property (leaves, glass, etc.)\n                    const blockProps = this.blockColors[block];\n                    if (blockProps && blockProps.transparent) return true;\n                    return false; // Solid opaque block\n                };\n                \n                // For transparent blocks, check if adjacent is SAME type (only hide if same)\n                const shouldHideFace = (currentType, adjacentType) => {\n                    if (!adjacentType) return false; // No adjacent = show face\n                    return currentType === adjacentType; // Only hide if same type\n                };\n                \n                const getFluidLevel = (x, y, z) => this.fluidLevels[`${x},${y},${z}`] || 8;\n                const animTime = Date.now() * 0.002; // Animation time for flowing effect\n                \n                // Separate opaque and transparent blocks for proper rendering\n                const opaqueBlocks = [];\n                const transparentBlocks = [];\n                \n                for (let i = 0; i < blocks.length; i++) {\n                    const block = blocks[i];\n                    const colors = this.blockColors[block.type];\n                    if (colors && colors.transparent) {\n                        transparentBlocks.push(block);\n                    } else {\n                        opaqueBlocks.push(block);\n                    }\n                }\n                \n                // PROPER RENDERING ORDER for painter's algorithm:\n                // 1. Sort transparent blocks back-to-front (furthest first)\n                // 2. Sort opaque blocks back-to-front (furthest first) \n                // 3. Draw transparent blocks first (they're behind)\n                // 4. Draw opaque blocks last (they overwrite and properly occlude)\n                \n                // ANGULAR OCCLUSION SYSTEM - check if block is visible from camera angle\n                // Uses corner visibility testing for proper edge handling\n                const isBlockOccluded = (x, y, z) => {\n                    // Test 8 corners of the block plus center\n                    const testPoints = [\n                        [x + 0.5, y + 0.5, z + 0.5], // center\n                        [x + 0.1, y + 0.1, z + 0.1], // corners with small inset\n                        [x + 0.9, y + 0.1, z + 0.1],\n                        [x + 0.1, y + 0.9, z + 0.1],\n                        [x + 0.9, y + 0.9, z + 0.1],\n                        [x + 0.1, y + 0.1, z + 0.9],\n                        [x + 0.9, y + 0.1, z + 0.9],\n                        [x + 0.1, y + 0.9, z + 0.9],\n                        [x + 0.9, y + 0.9, z + 0.9],\n                    ];\n                    \n                    // Block is visible if ANY corner/point is visible\n                    for (const [px, py, pz] of testPoints) {\n                        const dx = px - camX;\n                        const dy = py - camY;\n                        const dz = pz - camZ;\n                        const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                        \n                        let pointOccluded = false;\n                        // Ray march with finer steps near camera and target\n                        const steps = Math.min(8, Math.ceil(dist / 2));\n                        for (let i = 1; i < steps; i++) {\n                            const t = i / steps;\n                            const checkX = Math.floor(camX + dx * t);\n                            const checkY = Math.floor(camY + dy * t);\n                            const checkZ = Math.floor(camZ + dz * t);\n                            \n                            // Skip if we're checking the target block itself\n                            if (checkX === x && checkY === y && checkZ === z) continue;\n                            \n                            const checkBlock = getBlock(checkX, checkY, checkZ);\n                            // Solid non-fluid, non-transparent block occludes\n                            if (checkBlock && !this.fluidBlocks.includes(checkBlock)) {\n                                // Check if this block type has transparency property\n                                const blockColors = this.blockColors[checkBlock];\n                                if (!blockColors || !blockColors.transparent) {\n                                    pointOccluded = true;\n                                    break;\n                                }\n                            }\n                        }\n                        \n                        // If this point is visible, the block is visible\n                        if (!pointOccluded) return false;\n                    }\n                    \n                    // All points occluded = block is occluded\n                    return true;\n                };\n                \n                // Filter out occluded transparent blocks\n                const visibleTransparent = transparentBlocks.filter(b => !isBlockOccluded(b.x, b.y, b.z));\n                \n                // Sort each group - furthest (largest dist) first\n                visibleTransparent.sort((a, b) => b.dist - a.dist);\n                opaqueBlocks.sort((a, b) => b.dist - a.dist);\n                \n                // PROPER RENDERING ORDER for canvas 2D rendering:\n                // Sort ALL blocks by distance (back-to-front) and draw in that order\n                // This prevents transparent blocks from rendering through walls incorrectly\n                const allBlocks = [...opaqueBlocks, ...visibleTransparent];\n                \n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                // RENDERING ALGORITHM SELECTION\n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                // Three algorithms available: painter, zbuffer, bsp\n                const algorithm = this.debugSettings.renderAlgorithm;\n                \n                if (algorithm === 'painter') {\n                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                    // PAINTER'S ALGORITHM (Classic)\n                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                    // Sort blocks by distance, then sort faces within each block\n                    // Simple and effective for most voxel scenes\n                    \n                    // INDUSTRY-STANDARD STABLE SORT to prevent Z-fighting\n                    allBlocks.sort((a, b) => {\n                        const distDiff = b.dist - a.dist;\n                        \n                        // Primary sort by distance\n                        if (Math.abs(distDiff) > 0.001) {\n                            return distDiff;\n                        }\n                        \n                        // Multi-level tiebreaking for stability\n                        if (a.y !== b.y) return a.y - b.y;\n                        if (a.z !== b.z) return a.z - b.z;\n                        if (a.x !== b.x) return a.x - b.x;\n                        return a.type.localeCompare(b.type);\n                    });\n                    \n                } else if (algorithm === 'zbuffer') {\n                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                    // Z-BUFFER SIMULATION (Enhanced Precision)\n                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                    // Simulates Z-buffer by sorting with higher precision\n                    // Uses block corners for more accurate depth calculation\n                    \n                    // Calculate min depth for each block (closest corner to camera)\n                    allBlocks.forEach(block => {\n                        const { x, y, z } = block;\n                        \n                        // Check all 8 corners of the block\n                        const corners = [\n                            [x, y, z], [x+1, y, z], [x, y+1, z], [x+1, y+1, z],\n                            [x, y, z+1], [x+1, y, z+1], [x, y+1, z+1], [x+1, y+1, z+1]\n                        ];\n                        \n                        let minDist = Infinity;\n                        for (const [cx, cy, cz] of corners) {\n                            const dx = cx - camX;\n                            const dy = cy - camY;\n                            const dz = cz - camZ;\n                            const dist = dx * dx + dy * dy + dz * dz;\n                            if (dist < minDist) minDist = dist;\n                        }\n                        \n                        block.minDist = minDist;\n                    });\n                    \n                    // Sort by closest point (simulates per-pixel depth testing)\n                    allBlocks.sort((a, b) => {\n                        const distDiff = (b.minDist || b.dist) - (a.minDist || a.dist);\n                        \n                        // Higher precision threshold for Z-buffer\n                        if (Math.abs(distDiff) > 0.0001) {\n                            return distDiff;\n                        }\n                        \n                        // Tiebreaking\n                        if (a.y !== b.y) return a.y - b.y;\n                        if (a.z !== b.z) return a.z - b.z;\n                        if (a.x !== b.x) return a.x - b.x;\n                        return a.type.localeCompare(b.type);\n                    });\n                    \n                } else if (algorithm === 'bsp') {\n                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                    // BINARY SPACE PARTITIONING (Spatial Tree)\n                    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                    // Uses spatial tree structure for optimal rendering order\n                    // Automatically handles arbitrary camera positions\n                    \n                    // Build simple BSP tree using axis-aligned planes\n                    const buildBSPTree = (blocks: any[]): any => {\n                        if (blocks.length === 0) return null;\n                        if (blocks.length === 1) return { block: blocks[0], front: null, back: null };\n                        \n                        // Find median along longest axis\n                        const minX = Math.min(...blocks.map(b => b.x));\n                        const maxX = Math.max(...blocks.map(b => b.x));\n                        const minY = Math.min(...blocks.map(b => b.y));\n                        const maxY = Math.max(...blocks.map(b => b.y));\n                        const minZ = Math.min(...blocks.map(b => b.z));\n                        const maxZ = Math.max(...blocks.map(b => b.z));\n                        \n                        const rangeX = maxX - minX;\n                        const rangeY = maxY - minY;\n                        const rangeZ = maxZ - minZ;\n                        \n                        // Split along longest axis\n                        let axis: 'x' | 'y' | 'z';\n                        if (rangeX >= rangeY && rangeX >= rangeZ) axis = 'x';\n                        else if (rangeY >= rangeZ) axis = 'y';\n                        else axis = 'z';\n                        \n                        // Sort and split\n                        blocks.sort((a, b) => a[axis] - b[axis]);\n                        const mid = Math.floor(blocks.length / 2);\n                        const pivot = blocks[mid];\n                        \n                        const front = blocks.filter((b, i) => i < mid);\n                        const back = blocks.filter((b, i) => i > mid);\n                        \n                        return {\n                            block: pivot,\n                            axis,\n                            value: pivot[axis],\n                            front: buildBSPTree(front),\n                            back: buildBSPTree(back)\n                        };\n                    };\n                    \n                    // Traverse BSP tree based on camera position\n                    const traverseBSP = (node: any, result: any[]): void => {\n                        if (!node) return;\n                        \n                        if (!node.axis) {\n                            // Leaf node\n                            result.push(node.block);\n                            return;\n                        }\n                        \n                        // Determine which side of splitting plane camera is on\n                        const camPos = node.axis === 'x' ? camX : (node.axis === 'y' ? camY : camZ);\n                        const isInFront = camPos < node.value;\n                        \n                        if (isInFront) {\n                            // Camera in front: render back first, then front\n                            traverseBSP(node.back, result);\n                            result.push(node.block);\n                            traverseBSP(node.front, result);\n                        } else {\n                            // Camera in back: render front first, then back\n                            traverseBSP(node.front, result);\n                            result.push(node.block);\n                            traverseBSP(node.back, result);\n                        }\n                    };\n                    \n                    // Build and traverse tree\n                    const bspTree = buildBSPTree(allBlocks.slice());\n                    const sortedBlocks: any[] = [];\n                    traverseBSP(bspTree, sortedBlocks);\n                    \n                    // Replace allBlocks with BSP-sorted order\n                    allBlocks.length = 0;\n                    allBlocks.push(...sortedBlocks);\n                }\n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                // END ALGORITHM SELECTION\n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                \n                for (let i = 0; i < allBlocks.length; i++) {\n                    const block = allBlocks[i];\n                    const { x, y, z, type } = block;\n                    const colors = this.blockColors[type];\n                    if (!colors) continue;\n                    \n                    // CRITICAL: Disable stroking entirely for block faces\n                    // This prevents any accidental edge rendering\n                    ctx.lineWidth = 0;\n                    ctx.strokeStyle = 'transparent';\n                    \n                    const isFluid = this.fluidBlocks.includes(type);\n                    const fluidLevel = isFluid ? getFluidLevel(x, y, z) : 8;\n                    // Fluids should fill their block space properly - topY calculation\n                    const topY = y + (fluidLevel / 8);\n                    \n                    // Check adjacent blocks\n                    const adjTop = getBlock(x, y + 1, z);\n                    const adjBottom = getBlock(x, y - 1, z);\n                    const adjFront = getBlock(x, y, z + 1);\n                    const adjBack = getBlock(x, y, z - 1);\n                    const adjLeft = getBlock(x - 1, y, z);\n                    const adjRight = getBlock(x + 1, y, z);\n                    \n                    let hasTop, hasBottom, hasFront, hasBack, hasLeft, hasRight;\n                    \n                    // DEBUG: Disable face culling - show all faces\n                    if (this.debugSettings.disableFaceCulling) {\n                        hasTop = hasBottom = hasFront = hasBack = hasLeft = hasRight = true;\n                    } else if (isFluid) {\n                        // For fluids, show top if not covered by same fluid above\n                        hasTop = !adjTop || adjTop !== type;\n                        hasBottom = !adjBottom || !this.fluidBlocks.includes(adjBottom);\n                        \n                        // For sides, show face if:\n                        // 1. No adjacent block, or\n                        // 2. Adjacent is different type (including different fluid), or  \n                        // 3. Adjacent is same fluid but at a LOWER level (we need to show our side above their top)\n                        const myLevel = fluidLevel;\n                        \n                        const frontLevel = adjFront === type ? getFluidLevel(x, y, z + 1) : 0;\n                        const backLevel = adjBack === type ? getFluidLevel(x, y, z - 1) : 0;\n                        const leftLevel = adjLeft === type ? getFluidLevel(x - 1, y, z) : 0;\n                        const rightLevel = adjRight === type ? getFluidLevel(x + 1, y, z) : 0;\n                        \n                        hasFront = !adjFront || (adjFront !== type) || (frontLevel < myLevel);\n                        hasBack = !adjBack || (adjBack !== type) || (backLevel < myLevel);\n                        hasLeft = !adjLeft || (adjLeft !== type) || (leftLevel < myLevel);\n                        hasRight = !adjRight || (adjRight !== type) || (rightLevel < myLevel);\n                    } else {\n                        // Solid blocks: check if block has transparency\n                        const isCurrentTransparent = this.blockColors[type] && this.blockColors[type].transparent;\n                        \n                        if (isCurrentTransparent) {\n                            // Transparent solid blocks (leaves, glass) - only hide if same type adjacent\n                            hasTop = !shouldHideFace(type, adjTop);\n                            hasBottom = !shouldHideFace(type, adjBottom);\n                            hasFront = !shouldHideFace(type, adjFront);\n                            hasBack = !shouldHideFace(type, adjBack);\n                            hasLeft = !shouldHideFace(type, adjLeft);\n                            hasRight = !shouldHideFace(type, adjRight);\n                        } else {\n                            // Opaque solid blocks: show face if adjacent is empty OR transparent\n                            hasTop = isTransparent(adjTop);\n                            hasBottom = isTransparent(adjBottom);\n                            hasFront = isTransparent(adjFront);\n                            hasBack = isTransparent(adjBack);\n                            hasLeft = isTransparent(adjLeft);\n                            hasRight = isTransparent(adjRight);\n                        }\n                    }\n                    \n                    // Skip fully hidden blocks\n                    if (!hasTop && !hasBottom && !hasFront && !hasBack && !hasLeft && !hasRight) continue;\n                    \n                    // Define visible faces\n                    const faces = [];\n                    \n                    // Front face (+Z)\n                    if (hasFront) {\n                        faces.push({ v: [[x, y, z+1], [x+1, y, z+1], [x+1, topY, z+1], [x, topY, z+1]], color: colors.side, dark: 0.95, isTop: false });\n                    }\n                    // Back face (-Z)\n                    if (hasBack) {\n                        faces.push({ v: [[x+1, y, z], [x, y, z], [x, topY, z], [x+1, topY, z]], color: colors.side, dark: 0.75, isTop: false });\n                    }\n                    // Top face (+Y)\n                    if (hasTop) {\n                        faces.push({ v: [[x, topY, z], [x+1, topY, z], [x+1, topY, z+1], [x, topY, z+1]], color: colors.top, dark: 1, isTop: true });\n                    }\n                    // Bottom face (-Y)\n                    if (hasBottom) {\n                        faces.push({ v: [[x, y, z+1], [x+1, y, z+1], [x+1, y, z], [x, y, z]], color: colors.bottom, dark: 0.6, isTop: false });\n                    }\n                    // Left face (-X)\n                    if (hasLeft) {\n                        faces.push({ v: [[x, y, z], [x, y, z+1], [x, topY, z+1], [x, topY, z]], color: colors.side, dark: 0.85, isTop: false });\n                    }\n                    // Right face (+X)\n                    if (hasRight) {\n                        faces.push({ v: [[x+1, y, z+1], [x+1, y, z], [x+1, topY, z], [x+1, topY, z+1]], color: colors.side, dark: 0.9, isTop: false });\n                    }\n                    \n                    // Render visible faces\n                    // CRITICAL: Sort faces by distance from camera (back-to-front)\n                    // This ensures correct rendering from ANY viewing angle\n                    const facesWithDist = faces.map(face => {\n                        // Calculate center of face\n                        const centerX = (face.v[0][0] + face.v[1][0] + face.v[2][0] + face.v[3][0]) / 4;\n                        const centerY = (face.v[0][1] + face.v[1][1] + face.v[2][1] + face.v[3][1]) / 4;\n                        const centerZ = (face.v[0][2] + face.v[1][2] + face.v[2][2] + face.v[3][2]) / 4;\n                        \n                        // Distance from camera to face center\n                        const dx = centerX - camX;\n                        const dy = centerY - camY;\n                        const dz = centerZ - camZ;\n                        const distSq = dx * dx + dy * dy + dz * dz;\n                        \n                        return { face, distSq };\n                    });\n                    \n                    // Sort far to near (painter's algorithm)\n                    facesWithDist.sort((a, b) => b.distSq - a.distSq);\n                    \n                    for (let f = 0; f < facesWithDist.length; f++) {\n                        const { face } = facesWithDist[f];\n                        const pts = [];\n                        let valid = true;\n                        \n                        for (let v = 0; v < 4; v++) {\n                            const p = project(face.v[v][0], face.v[v][1], face.v[v][2]);\n                            if (!p) { valid = false; break; }\n                            pts.push(p);\n                        }\n                        if (!valid || pts.length !== 4) continue;\n                        \n                        // Apply shadow and get base color\n                        let fillColor = face.color;\n                        if (this.settings.shadows && face.dark < 1) {\n                            fillColor = this.darkenColor(face.color, face.dark);\n                        }\n                        \n                        // Animated fluid rendering\n                        if (isFluid && colors.animated) {\n                            if (type === 'water') {\n                                // ADVANCED WATER RENDERING with Screen-Space Reflections\n                                // Implements simplified SSR, Fresnel, caustics, and player reflection\n                                \n                                const time = animTime;\n                                \n                                // Multi-octave Gerstner wave simulation\n                                const wave1 = Math.sin(time + x * 0.7 + z * 0.5) * 0.4;\n                                const wave2 = Math.sin(time * 0.8 - x * 0.3 + z * 0.7) * 0.3;\n                                const wave3 = Math.sin(time * 1.3 + x * 0.5 - z * 0.3) * 0.2;\n                                const combinedWave = (wave1 + wave2 + wave3) / 3 + 0.5;\n                                \n                                // Calculate view vector for Fresnel\n                                const dx = x + 0.5 - camX;\n                                const dy = y + 0.5 - camY;\n                                const dz = z + 0.5 - camZ;\n                                const dist = Math.sqrt(dx*dx + dy*dy + dz*dz);\n                                \n                                // Normal-based view angle\n                                const viewDotNormal = Math.abs(dy / (dist || 1));\n                                \n                                // Schlick's Fresnel approximation\n                                const F0 = 0.02; // Water's base reflectivity\n                                const fresnel = F0 + (1 - F0) * Math.pow(1 - viewDotNormal, 5);\n                                \n                                // SCREEN-SPACE REFLECTION approximation\n                                // Check if player would be reflected in this water block\n                                let playerReflection = 0;\n                                const playerDx = this.camera.x - (x + 0.5);\n                                const playerDz = this.camera.z - (z + 0.5);\n                                const playerDistToWater = Math.sqrt(playerDx * playerDx + playerDz * playerDz);\n                                \n                                // Player is reflected if close to water and water is below player\n                                if (playerDistToWater < 5 && this.camera.y > y + 1) {\n                                    // Reflection strength based on distance and angle\n                                    const reflectStrengthDist = 1 - (playerDistToWater / 5);\n                                    playerReflection = reflectStrengthDist * fresnel * 0.3;\n                                }\n                                \n                                // Environment reflection sampling\n                                const skyColors = [\n                                    { r: 255, g: 183, b: 197 }, // Sunset pink\n                                    { r: 255, g: 218, b: 185 }, // Peach\n                                    { r: 135, g: 206, b: 235 }  // Sky blue\n                                ];\n                                const skyIndex = Math.min(2, Math.floor((1 - viewDotNormal) * 3));\n                                const sky = skyColors[skyIndex];\n                                \n                                // Base water color with depth absorption\n                                const depthFactor = Math.min(1, dist / 20);\n                                const waterR = 30 + depthFactor * 15;\n                                const waterG = 80 + depthFactor * 20;\n                                const waterB = 160 - depthFactor * 30;\n                                \n                                // Player color for reflection (brown shirt tone)\n                                const playerColor = { r: 100, g: 60, b: 40 };\n                                \n                                // Blend reflection and refraction based on Fresnel\n                                const reflectStrength = Math.min(0.7, fresnel * 1.5);\n                                let r = Math.floor(waterR * (1 - reflectStrength) + sky.r * reflectStrength);\n                                let g = Math.floor(waterG * (1 - reflectStrength) + sky.g * reflectStrength);\n                                let b = Math.floor(waterB * (1 - reflectStrength) + sky.b * reflectStrength);\n                                \n                                // Add player reflection tint\n                                if (playerReflection > 0) {\n                                    r = Math.floor(r * (1 - playerReflection) + playerColor.r * playerReflection);\n                                    g = Math.floor(g * (1 - playerReflection) + playerColor.g * playerReflection);\n                                    b = Math.floor(b * (1 - playerReflection) + playerColor.b * playerReflection);\n                                }\n                                \n                                // Specular highlights (Blinn-Phong)\n                                const sunDir = { x: 0.5, y: 0.8, z: 0.3 };\n                                const viewDir = { x: dx/dist, y: dy/dist, z: dz/dist };\n                                const halfVec = {\n                                    x: sunDir.x + viewDir.x,\n                                    y: sunDir.y + viewDir.y,\n                                    z: sunDir.z + viewDir.z\n                                };\n                                const halfLen = Math.sqrt(halfVec.x*halfVec.x + halfVec.y*halfVec.y + halfVec.z*halfVec.z);\n                                const specularBase = Math.max(0, halfVec.y / halfLen);\n                                const specular = Math.pow(specularBase, 32) * combinedWave * 0.6;\n                                \n                                // Caustics effect\n                                const caustic1 = Math.sin(time * 2 + x * 1.5) * Math.cos(time * 1.5 + z * 1.5);\n                                const caustic2 = Math.sin(time * 1.7 - x * 1.2 + z * 0.8);\n                                const caustics = (caustic1 * caustic2 + 1) * 0.1;\n                                \n                                // Final color with all effects\n                                const brightness = 0.85 + combinedWave * 0.15 + specular + caustics;\n                                const finalR = Math.min(255, Math.floor(r * brightness + specular * 200));\n                                const finalG = Math.min(255, Math.floor(g * brightness + specular * 180));\n                                const finalB = Math.min(255, Math.floor(b * brightness + specular * 150));\n                                \n                                // Dynamic transparency\n                                const baseAlpha = 0.55;\n                                const fresnelAlpha = fresnel * 0.35;\n                                const alpha = Math.min(0.9, baseAlpha + fresnelAlpha);\n                                \n                                fillColor = `rgba(${finalR}, ${finalG}, ${finalB}, ${alpha})`;\n                                \n                            } else if (type === 'lava') {\n                                // Animated lava with glowing/pulsing effect\n                                const glowPhase = animTime * 1.5 + x * 0.3 + z * 0.3;\n                                const glow = 0.8 + Math.sin(glowPhase) * 0.2;\n                                const r = Math.floor(255 * glow);\n                                const g = Math.floor((80 + Math.sin(glowPhase * 2) * 30) * glow);\n                                const b = Math.floor(30 * (1 - glow * 0.5));\n                                fillColor = `rgb(${Math.min(255, r)}, ${Math.min(255, g)}, ${b})`;\n                            }\n                        }\n                        \n                        // TEXTURE RENDERING with proper blend modes to avoid over-darkening\n                        // Determine which face type this is for texture selection\n                        const faceType = face.isTop ? 'top' : 'side';\n                        \n                        // Check if this block uses textures\n                        if (colors.useTexture && colors.texture && !isFluid) {\n                            // Apply shadow darkening to the base color BEFORE filling\n                            let baseFillColor = fillColor;\n                            if (this.settings.shadows && face.dark < 1) {\n                                // Parse and darken the base color\n                                if (fillColor.startsWith('#')) {\n                                    baseFillColor = this.darkenColor(fillColor, face.dark);\n                                } else if (fillColor.startsWith('rgb')) {\n                                    // For rgb colors, extract and darken\n                                    const match = fillColor.match(/\\d+/g);\n                                    if (match) {\n                                        const r = Math.floor(parseInt(match[0]) * face.dark);\n                                        const g = Math.floor(parseInt(match[1]) * face.dark);\n                                        const b = Math.floor(parseInt(match[2]) * face.dark);\n                                        baseFillColor = `rgb(${r},${g},${b})`;\n                                    }\n                                }\n                            }\n                            \n                            // DEBUG: Wireframe-only mode - skip fills\n                            if (this.debugSettings.wireframeOnly) {\n                                // Only draw wireframe\n                                ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';\n                                ctx.lineWidth = 1.5;\n                                ctx.beginPath();\n                                ctx.moveTo(pts[0].x, pts[0].y);\n                                ctx.lineTo(pts[1].x, pts[1].y);\n                                ctx.lineTo(pts[2].x, pts[2].y);\n                                ctx.lineTo(pts[3].x, pts[3].y);\n                                ctx.closePath();\n                                ctx.stroke();\n                                continue; // Skip fill rendering\n                            }\n                            \n                            // STEP 1: Fill the polygon with darkened base color (provides solid base)\n                            ctx.fillStyle = baseFillColor;\n                            ctx.beginPath();\n                            ctx.moveTo(pts[0].x, pts[0].y);\n                            ctx.lineTo(pts[1].x, pts[1].y);\n                            ctx.lineTo(pts[2].x, pts[2].y);\n                            ctx.lineTo(pts[3].x, pts[3].y);\n                            // REMOVED closePath() - causes visible edge artifacts on external faces\n                            ctx.fill();\n                            \n                            // STEP 2: Generate or get cached texture pattern\n                            const texture = this.generateTexture(colors.texture, baseFillColor, faceType);\n                            \n                            // STEP 3: Apply texture overlay with proper blending\n                            ctx.save();\n                            \n                            // Create clipping path for this face\n                            ctx.beginPath();\n                            ctx.moveTo(pts[0].x, pts[0].y);\n                            ctx.lineTo(pts[1].x, pts[1].y);\n                            ctx.lineTo(pts[2].x, pts[2].y);\n                            ctx.lineTo(pts[3].x, pts[3].y);\n                            ctx.closePath();\n                            ctx.clip();\n                            \n                            // Calculate bounding box for texture fill\n                            const minX = Math.min(pts[0].x, pts[1].x, pts[2].x, pts[3].x);\n                            const maxX = Math.max(pts[0].x, pts[1].x, pts[2].x, pts[3].x);\n                            const minY = Math.min(pts[0].y, pts[1].y, pts[2].y, pts[3].y);\n                            const maxY = Math.max(pts[0].y, pts[1].y, pts[2].y, pts[3].y);\n                            \n                            // Apply texture with OVERLAY blend for detail without over-darkening\n                            ctx.globalCompositeOperation = 'overlay';\n                            ctx.globalAlpha = 0.4; // Subtle texture overlay\n                            ctx.fillStyle = texture;\n                            ctx.fillRect(minX - 5, minY - 5, maxX - minX + 10, maxY - minY + 10);\n                            \n                            ctx.restore();\n                            \n                            // STEP 4: Add edge lines for depth perception (only for special cases)\n                            // REMOVED: Edge lines on all faces caused \"hollow block\" appearance\n                            // Solid blocks don't need edge lines - the texture provides depth\n                        } else {\n                            // Standard solid color rendering\n                            ctx.fillStyle = fillColor;\n                            ctx.beginPath();\n                            ctx.moveTo(pts[0].x, pts[0].y);\n                            ctx.lineTo(pts[1].x, pts[1].y);\n                            ctx.lineTo(pts[2].x, pts[2].y);\n                            ctx.lineTo(pts[3].x, pts[3].y);\n                            // REMOVED closePath() - causes visible edge artifacts on external faces\n                            ctx.fill();\n                            \n                            // REMOVED: Edge lines caused \"hollow block\" appearance\n                            // Solid blocks look better without edge lines\n                        }\n                    }\n                }\n                \n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                // DEBUG VISUALIZATIONS (Phase 2)\n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                \n                // 1. RAYCAST VECTOR - Show where raycast is pointing\n                if (this.debugSettings.showRaycastVector) {\n                    const hit = this.raycast();\n                    if (hit) {\n                        // Draw line from camera to hit point\n                        const startProj = project(camX, camY, camZ);\n                        const endProj = project(hit.hit.x + 0.5, hit.hit.y + 0.5, hit.hit.z + 0.5);\n                        \n                        if (startProj && endProj) {\n                            ctx.strokeStyle = 'rgba(255, 0, 0, 0.8)';\n                            ctx.lineWidth = 3;\n                            ctx.setLineDash([5, 5]);\n                            ctx.beginPath();\n                            ctx.moveTo(startProj.x, startProj.y);\n                            ctx.lineTo(endProj.x, endProj.y);\n                            ctx.stroke();\n                            ctx.setLineDash([]);\n                            \n                            // Draw dot at hit point\n                            ctx.fillStyle = 'rgba(255, 0, 0, 0.9)';\n                            ctx.beginPath();\n                            ctx.arc(endProj.x, endProj.y, 5, 0, Math.PI * 2);\n                            ctx.fill();\n                        }\n                    }\n                }\n                \n                // 2. PROJECTION TEST - Show marker at screen center\n                if (this.debugSettings.showProjectionTest) {\n                    // Draw crosshair marker at exact screen center\n                    // This is where the projection SHOULD be aiming\n                    const centerX = halfW;\n                    const centerY = halfH;\n                    \n                    // Large visible crosshair\n                    ctx.strokeStyle = 'rgba(0, 255, 0, 1)';\n                    ctx.lineWidth = 3;\n                    ctx.beginPath();\n                    ctx.moveTo(centerX - 20, centerY);\n                    ctx.lineTo(centerX + 20, centerY);\n                    ctx.moveTo(centerX, centerY - 20);\n                    ctx.lineTo(centerX, centerY + 20);\n                    ctx.stroke();\n                    \n                    // Center dot\n                    ctx.fillStyle = 'rgba(0, 255, 0, 1)';\n                    ctx.beginPath();\n                    ctx.arc(centerX, centerY, 5, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Label\n                    ctx.fillStyle = 'rgba(0, 255, 0, 1)';\n                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.8)';\n                    ctx.font = 'bold 14px monospace';\n                    ctx.lineWidth = 3;\n                    ctx.strokeText('SCREEN CENTER', centerX + 25, centerY - 15);\n                    ctx.fillText('SCREEN CENTER', centerX + 25, centerY - 15);\n                }\n                \n                // 3. DEPTH ORDER - Show render order numbers\n                if (this.debugSettings.showDepthOrder) {\n                    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.9)';\n                    ctx.font = 'bold 14px monospace';\n                    ctx.lineWidth = 3;\n                    \n                    for (let i = 0; i < Math.min(allBlocks.length, 50); i++) {\n                        const block = allBlocks[i];\n                        const centerProj = project(block.x + 0.5, block.y + 0.5, block.z + 0.5);\n                        if (centerProj) {\n                            const text = `#${i}`;\n                            ctx.strokeText(text, centerProj.x - 15, centerProj.y + 5);\n                            ctx.fillText(text, centerProj.x - 15, centerProj.y + 5);\n                        }\n                    }\n                }\n                \n                // 4. FACE NORMALS - Show normal vectors\n                if (this.debugSettings.showFaceNormals) {\n                    ctx.strokeStyle = 'rgba(255, 255, 0, 0.8)';\n                    ctx.lineWidth = 2;\n                    \n                    for (let i = 0; i < Math.min(allBlocks.length, 20); i++) {\n                        const block = allBlocks[i];\n                        const { x, y, z } = block;\n                        \n                        // Draw normals for each visible face\n                        const normals = [\n                            { center: [x + 0.5, y + 1, z + 0.5], dir: [0, 1, 0], name: 'Top' },\n                            { center: [x + 0.5, y, z + 0.5], dir: [0, -1, 0], name: 'Bottom' },\n                            { center: [x + 0.5, y + 0.5, z + 1], dir: [0, 0, 1], name: 'Front' },\n                            { center: [x + 0.5, y + 0.5, z], dir: [0, 0, -1], name: 'Back' },\n                            { center: [x, y + 0.5, z + 0.5], dir: [-1, 0, 0], name: 'Left' },\n                            { center: [x + 1, y + 0.5, z + 0.5], dir: [1, 0, 0], name: 'Right' }\n                        ];\n                        \n                        for (const normal of normals) {\n                            const startProj = project(normal.center[0], normal.center[1], normal.center[2]);\n                            const endProj = project(\n                                normal.center[0] + normal.dir[0] * 0.5,\n                                normal.center[1] + normal.dir[1] * 0.5,\n                                normal.center[2] + normal.dir[2] * 0.5\n                            );\n                            \n                            if (startProj && endProj) {\n                                ctx.beginPath();\n                                ctx.moveTo(startProj.x, startProj.y);\n                                ctx.lineTo(endProj.x, endProj.y);\n                                ctx.stroke();\n                                \n                                // Arrow head\n                                const angle = Math.atan2(endProj.y - startProj.y, endProj.x - startProj.x);\n                                ctx.beginPath();\n                                ctx.moveTo(endProj.x, endProj.y);\n                                ctx.lineTo(\n                                    endProj.x - 8 * Math.cos(angle - Math.PI / 6),\n                                    endProj.y - 8 * Math.sin(angle - Math.PI / 6)\n                                );\n                                ctx.lineTo(\n                                    endProj.x - 8 * Math.cos(angle + Math.PI / 6),\n                                    endProj.y - 8 * Math.sin(angle + Math.PI / 6)\n                                );\n                                ctx.lineTo(endProj.x, endProj.y);\n                                ctx.fill();\n                            }\n                        }\n                    }\n                }\n                \n                // 5. BOUNDING BOXES - Show block bounds\n                if (this.debugSettings.showBoundingBoxes) {\n                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.6)';\n                    ctx.lineWidth = 1;\n                    \n                    for (let i = 0; i < Math.min(allBlocks.length, 30); i++) {\n                        const block = allBlocks[i];\n                        const { x, y, z } = block;\n                        \n                        // Define 8 corners\n                        const corners = [\n                            [x, y, z], [x+1, y, z], [x+1, y+1, z], [x, y+1, z],\n                            [x, y, z+1], [x+1, y, z+1], [x+1, y+1, z+1], [x, y+1, z+1]\n                        ];\n                        \n                        const projected = corners.map(c => project(c[0], c[1], c[2])).filter(p => p !== null);\n                        \n                        if (projected.length === 8) {\n                            // Draw box edges\n                            const edges = [\n                                [0,1], [1,2], [2,3], [3,0], // Back face\n                                [4,5], [5,6], [6,7], [7,4], // Front face\n                                [0,4], [1,5], [2,6], [3,7]  // Connecting edges\n                            ];\n                            \n                            ctx.beginPath();\n                            for (const [a, b] of edges) {\n                                ctx.moveTo(projected[a].x, projected[a].y);\n                                ctx.lineTo(projected[b].x, projected[b].y);\n                            }\n                            ctx.stroke();\n                        }\n                    }\n                }\n                \n                // 6. OVERDRAW HEATMAP - Track pixel draw counts\n                if (this.debugSettings.showOverdraw) {\n                    // This is complex - for now show a simple indicator\n                    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.9)';\n                    ctx.font = 'bold 16px monospace';\n                    ctx.lineWidth = 3;\n                    const text = `OVERDRAW: ${allBlocks.length} blocks rendered`;\n                    ctx.strokeText(text, 10, 100);\n                    ctx.fillText(text, 10, 100);\n                }\n                \n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                // END DEBUG VISUALIZATIONS\n                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                \n                // Render world boundary forcefield\n                if (this.worldBounds) {\n                    const bounds = this.worldBounds;\n                    const time = Date.now() * 0.003;\n                    \n                    // Only render forcefield walls that are visible (within render distance)\n                    const wallSegments = [];\n                    const segmentSize = 5;  // Size of each forcefield segment\n                    \n                    // Check each boundary wall\n                    const walls = [\n                        { axis: 'x', value: bounds.minX, dir: 1 },   // West wall\n                        { axis: 'x', value: bounds.maxX, dir: -1 },  // East wall\n                        { axis: 'z', value: bounds.minZ, dir: 1 },   // North wall\n                        { axis: 'z', value: bounds.maxZ, dir: -1 }   // South wall\n                    ];\n                    \n                    for (const wall of walls) {\n                        // Check if wall is within render distance\n                        let distToWall;\n                        if (wall.axis === 'x') {\n                            distToWall = Math.abs(camX - wall.value);\n                        } else {\n                            distToWall = Math.abs(camZ - wall.value);\n                        }\n                        \n                        if (distToWall > renderDist * 1.5) continue;  // Skip walls too far away\n                        \n                        // Generate forcefield segments for this wall - skip segments way below player\n                        const minRenderY = Math.max(bounds.minY, camY - 10); // Don't render too far below player\n                        for (let y = minRenderY; y < bounds.maxY; y += segmentSize) {\n                            const perpStart = wall.axis === 'x' ? bounds.minZ : bounds.minX;\n                            const perpEnd = wall.axis === 'x' ? bounds.maxZ : bounds.maxX;\n                            \n                            for (let p = perpStart; p < perpEnd; p += segmentSize) {\n                                // Check if segment is within render distance\n                                let segX, segZ;\n                                if (wall.axis === 'x') {\n                                    segX = wall.value;\n                                    segZ = p + segmentSize / 2;\n                                } else {\n                                    segX = p + segmentSize / 2;\n                                    segZ = wall.value;\n                                }\n                                \n                                const segDist = Math.sqrt((segX - camX) ** 2 + (segZ - camZ) ** 2);\n                                if (segDist > renderDist) continue;\n                                \n                                // Define quad corners\n                                let corners;\n                                const yTop = Math.min(y + segmentSize, bounds.maxY);\n                                const pEnd = Math.min(p + segmentSize, perpEnd);\n                                \n                                if (wall.axis === 'x') {\n                                    corners = [\n                                        [wall.value, y, p],\n                                        [wall.value, y, pEnd],\n                                        [wall.value, yTop, pEnd],\n                                        [wall.value, yTop, p]\n                                    ];\n                                } else {\n                                    corners = [\n                                        [p, y, wall.value],\n                                        [pEnd, y, wall.value],\n                                        [pEnd, yTop, wall.value],\n                                        [p, yTop, wall.value]\n                                    ];\n                                }\n                                \n                                // Project corners\n                                const pts = [];\n                                let valid = true;\n                                for (const c of corners) {\n                                    const pt = project(c[0], c[1], c[2]);\n                                    if (!pt) { valid = false; break; }\n                                    pts.push(pt);\n                                }\n                                if (!valid || pts.length < 4) continue;\n                                \n                                // OCCLUSION CHECK: Don't render if behind solid blocks\n                                // Raycast from camera to segment center\n                                const segCenterX = (corners[0][0] + corners[2][0]) / 2;\n                                const segCenterY = (corners[0][1] + corners[2][1]) / 2;\n                                const segCenterZ = (corners[0][2] + corners[2][2]) / 2;\n                                \n                                const dx = segCenterX - camX;\n                                const dy = segCenterY - camY;\n                                const dz = segCenterZ - camZ;\n                                const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                                \n                                // Check points along ray for solid blocks\n                                let occluded = false;\n                                const steps = Math.max(8, Math.floor(dist / 2));\n                                for (let i = 1; i < steps; i++) {\n                                    const t = i / steps;\n                                    const checkX = Math.floor(camX + dx * t);\n                                    const checkY = Math.floor(camY + dy * t);\n                                    const checkZ = Math.floor(camZ + dz * t);\n                                    \n                                    const checkBlock = this.world[`${checkX},${checkY},${checkZ}`];\n                                    if (checkBlock && !this.fluidBlocks.includes(checkBlock)) {\n                                        // Check if it's a transparent block\n                                        const blockProps = this.blockColors[checkBlock];\n                                        if (!blockProps || !blockProps.transparent) {\n                                            // Solid opaque block occludes\n                                            occluded = true;\n                                            break;\n                                        }\n                                    }\n                                }\n                                \n                                if (occluded) continue; // Skip this forcefield segment\n                                \n                                // Calculate animated glow intensity\n                                const gridPhase = ((p + y) * 0.2 + time) % (Math.PI * 2);\n                                const alpha = 0.15 + 0.1 * Math.sin(gridPhase);\n                                \n                                // Draw forcefield panel with cyan/magenta energy effect\n                                const hue = (time * 30 + p + y) % 360;\n                                ctx.fillStyle = `hsla(${180 + Math.sin(time + p * 0.1) * 20}, 100%, 60%, ${alpha})`;\n                                ctx.beginPath();\n                                ctx.moveTo(pts[0].x, pts[0].y);\n                                ctx.lineTo(pts[1].x, pts[1].y);\n                                ctx.lineTo(pts[2].x, pts[2].y);\n                                ctx.lineTo(pts[3].x, pts[3].y);\n                                ctx.closePath();\n                                ctx.fill();\n                                \n                                // Draw grid lines\n                                ctx.strokeStyle = `hsla(180, 100%, 70%, ${alpha * 2})`;\n                                ctx.lineWidth = 1;\n                                ctx.stroke();\n                            }\n                        }\n                    }\n                    \n                    // Bottom forcefield (floor at minY) - only if player can see it\n                    const bottomY = bounds.minY;\n                    const canSeeFloor = camY > bottomY + 3; // Player must be above floor to see it\n                    \n                    if (canSeeFloor) {\n                        for (let x = bounds.minX; x < bounds.maxX; x += segmentSize) {\n                        for (let z = bounds.minZ; z < bounds.maxZ; z += segmentSize) {\n                            const segDist = Math.sqrt((x + segmentSize/2 - camX) ** 2 + (z + segmentSize/2 - camZ) ** 2);\n                            if (segDist > renderDist) continue;\n                            \n                            const xEnd = Math.min(x + segmentSize, bounds.maxX);\n                            const zEnd = Math.min(z + segmentSize, bounds.maxZ);\n                            \n                            const corners = [\n                                [x, bottomY, z],\n                                [xEnd, bottomY, z],\n                                [xEnd, bottomY, zEnd],\n                                [x, bottomY, zEnd]\n                            ];\n                            \n                            const pts = [];\n                            let valid = true;\n                            for (const c of corners) {\n                                const pt = project(c[0], c[1], c[2]);\n                                if (!pt) { valid = false; break; }\n                                pts.push(pt);\n                            }\n                            if (!valid || pts.length < 4) continue;\n                            \n                            // OCCLUSION CHECK: Don't render floor if player has blocks below them\n                            const segCenterX = x + segmentSize / 2;\n                            const segCenterZ = z + segmentSize / 2;\n                            \n                            const dx = segCenterX - camX;\n                            const dy = bottomY - camY;\n                            const dz = segCenterZ - camZ;\n                            const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                            \n                            // Raycast from camera to floor segment\n                            let occluded = false;\n                            const steps = Math.max(8, Math.floor(dist / 2));\n                            for (let i = 1; i < steps; i++) {\n                                const t = i / steps;\n                                const checkX = Math.floor(camX + dx * t);\n                                const checkY = Math.floor(camY + dy * t);\n                                const checkZ = Math.floor(camZ + dz * t);\n                                \n                                const checkBlock = this.world[`${checkX},${checkY},${checkZ}`];\n                                if (checkBlock && !this.fluidBlocks.includes(checkBlock)) {\n                                    const blockProps = this.blockColors[checkBlock];\n                                    if (!blockProps || !blockProps.transparent) {\n                                        // Solid block blocks view of floor\n                                        occluded = true;\n                                        break;\n                                    }\n                                }\n                            }\n                            \n                            if (occluded) continue; // Skip this floor segment\n                            \n                            const gridPhase = ((x + z) * 0.2 + time) % (Math.PI * 2);\n                            const alpha = 0.1 + 0.08 * Math.sin(gridPhase);\n                            \n                            ctx.fillStyle = `hsla(${280 + Math.sin(time + x * 0.1) * 20}, 100%, 50%, ${alpha})`;\n                            ctx.beginPath();\n                            ctx.moveTo(pts[0].x, pts[0].y);\n                            ctx.lineTo(pts[1].x, pts[1].y);\n                            ctx.lineTo(pts[2].x, pts[2].y);\n                            ctx.lineTo(pts[3].x, pts[3].y);\n                            ctx.closePath();\n                            ctx.fill();\n                            \n                            ctx.strokeStyle = `hsla(280, 100%, 60%, ${alpha * 2})`;\n                            ctx.lineWidth = 1;\n                            ctx.stroke();\n                        }\n                    }\n                    } // End canSeeFloor check\n                }\n                \n                // Render birds\n                for (const bird of this.birds) {\n                    // Check if bird is in front of camera\n                    const dx = bird.x - camX;\n                    const dy = bird.y - camY;\n                    const dz = bird.z - camZ;\n                    const dot = dx * camDirX + dz * camDirZ;\n                    if (dot < 0) continue; // Behind camera\n                    \n                    const distSq = dx * dx + dy * dy + dz * dz;\n                    if (distSq > renderDistSq) continue; // Too far\n                    \n                    // Project bird center\n                    const center = project(bird.x, bird.y, bird.z);\n                    if (!center) continue;\n                    \n                    // Calculate screen size based on distance\n                    const screenSize = (bird.size * fov) / center.z;\n                    if (screenSize < 2) continue; // Too small to render\n                    \n                    // Wing flap animation\n                    const wingAngle = Math.sin(bird.wingPhase) * 0.5;\n                    \n                    // Bird facing direction (tangent to circular path)\n                    const facingAngle = bird.angle + Math.PI / 2;\n                    \n                    // Draw bird body (dark pink/magenta for sakura theme)\n                    ctx.fillStyle = '#d85a8a';\n                    ctx.beginPath();\n                    ctx.ellipse(center.x, center.y, screenSize * 0.8, screenSize * 0.4, 0, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Draw wings\n                    ctx.fillStyle = '#ff9ec4';\n                    const wingSpan = screenSize * 1.5;\n                    const wingHeight = screenSize * 0.6 * (1 + wingAngle);\n                    \n                    // Left wing\n                    ctx.beginPath();\n                    ctx.moveTo(center.x, center.y);\n                    ctx.quadraticCurveTo(\n                        center.x - wingSpan * 0.5, center.y - wingHeight,\n                        center.x - wingSpan, center.y + screenSize * 0.2\n                    );\n                    ctx.quadraticCurveTo(\n                        center.x - wingSpan * 0.5, center.y + screenSize * 0.1,\n                        center.x, center.y\n                    );\n                    ctx.fill();\n                    \n                    // Right wing\n                    ctx.beginPath();\n                    ctx.moveTo(center.x, center.y);\n                    ctx.quadraticCurveTo(\n                        center.x + wingSpan * 0.5, center.y - wingHeight,\n                        center.x + wingSpan, center.y + screenSize * 0.2\n                    );\n                    ctx.quadraticCurveTo(\n                        center.x + wingSpan * 0.5, center.y + screenSize * 0.1,\n                        center.x, center.y\n                    );\n                    ctx.fill();\n                    \n                    // Draw head\n                    ctx.fillStyle = '#d85a8a';\n                    ctx.beginPath();\n                    ctx.arc(center.x + screenSize * 0.6, center.y - screenSize * 0.1, screenSize * 0.3, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Beak\n                    ctx.fillStyle = '#ffaa00';\n                    ctx.beginPath();\n                    ctx.moveTo(center.x + screenSize * 0.9, center.y - screenSize * 0.1);\n                    ctx.lineTo(center.x + screenSize * 1.2, center.y);\n                    ctx.lineTo(center.x + screenSize * 0.9, center.y + screenSize * 0.1);\n                    ctx.fill();\n                }\n                \n                // Render pest birds (smaller, always close to player)\n                for (const pest of this.pestBirds) {\n                    // Project pest bird\n                    const center = project(pest.x, pest.y, pest.z);\n                    if (!center) continue;\n                    \n                    // Calculate screen size (these are smaller)\n                    const screenSize = (pest.size * fov) / center.z;\n                    if (screenSize < 1) continue;\n                    \n                    // Frantic wing flap - faster when angry\n                    const wingAngle = Math.sin(pest.wingPhase) * 0.7;\n                    \n                    // Body color - gets redder with anger (0-5 anger levels)\n                    const anger = pest.anger || 0;\n                    const angerRed = Math.min(255, 107 + anger * 30); // 107 to 255\n                    const angerGreen = Math.max(0, 68 - anger * 10);   // 68 to 18\n                    const angerBlue = Math.max(0, 35 - anger * 7);     // 35 to 0\n                    \n                    const isSwooping = pest.state === 'swooping';\n                    const bodyColor = anger > 0 \n                        ? `rgb(${angerRed}, ${angerGreen}, ${angerBlue})`\n                        : (isSwooping ? '#8b4513' : '#6b4423');\n                    const wingColor = anger > 0\n                        ? `rgb(${Math.min(255, angerRed + 30)}, ${angerGreen + 20}, ${angerBlue + 10})`\n                        : (isSwooping ? '#a0522d' : '#8b7355');\n                    \n                    // Draw body (smaller, rounder - like a sparrow)\n                    ctx.fillStyle = bodyColor;\n                    ctx.beginPath();\n                    ctx.ellipse(center.x, center.y, screenSize * 0.6, screenSize * 0.5, 0, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Angry glow effect for high anger birds\n                    if (anger >= 3) {\n                        ctx.shadowColor = '#ff0000';\n                        ctx.shadowBlur = anger * 3;\n                    }\n                    \n                    // Draw frantic wings\n                    ctx.fillStyle = wingColor;\n                    const wingSpan = screenSize * 1.2;\n                    const wingHeight = screenSize * 0.8 * (1 + wingAngle);\n                    \n                    // Left wing\n                    ctx.beginPath();\n                    ctx.moveTo(center.x, center.y);\n                    ctx.quadraticCurveTo(\n                        center.x - wingSpan * 0.4, center.y - wingHeight,\n                        center.x - wingSpan, center.y\n                    );\n                    ctx.quadraticCurveTo(\n                        center.x - wingSpan * 0.4, center.y + screenSize * 0.2,\n                        center.x, center.y\n                    );\n                    ctx.fill();\n                    \n                    // Right wing\n                    ctx.beginPath();\n                    ctx.moveTo(center.x, center.y);\n                    ctx.quadraticCurveTo(\n                        center.x + wingSpan * 0.4, center.y - wingHeight,\n                        center.x + wingSpan, center.y\n                    );\n                    ctx.quadraticCurveTo(\n                        center.x + wingSpan * 0.4, center.y + screenSize * 0.2,\n                        center.x, center.y\n                    );\n                    ctx.fill();\n                    \n                    // Head\n                    ctx.fillStyle = bodyColor;\n                    ctx.beginPath();\n                    ctx.arc(center.x + screenSize * 0.4, center.y - screenSize * 0.15, screenSize * 0.25, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Beady eye\n                    ctx.fillStyle = '#000';\n                    ctx.beginPath();\n                    ctx.arc(center.x + screenSize * 0.45, center.y - screenSize * 0.2, screenSize * 0.08, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Small pointy beak\n                    ctx.fillStyle = '#ff6600';\n                    ctx.beginPath();\n                    ctx.moveTo(center.x + screenSize * 0.6, center.y - screenSize * 0.15);\n                    ctx.lineTo(center.x + screenSize * 0.85, center.y - screenSize * 0.1);\n                    ctx.lineTo(center.x + screenSize * 0.6, center.y - screenSize * 0.05);\n                    ctx.fill();\n                    \n                    // Tail feathers\n                    ctx.fillStyle = wingColor;\n                    ctx.beginPath();\n                    ctx.moveTo(center.x - screenSize * 0.4, center.y);\n                    ctx.lineTo(center.x - screenSize * 0.9, center.y - screenSize * 0.1);\n                    ctx.lineTo(center.x - screenSize * 0.95, center.y + screenSize * 0.05);\n                    ctx.lineTo(center.x - screenSize * 0.85, center.y + screenSize * 0.15);\n                    ctx.lineTo(center.x - screenSize * 0.4, center.y + screenSize * 0.1);\n                    ctx.fill();\n                    \n                    // Reset shadow\n                    ctx.shadowBlur = 0;\n                    ctx.shadowColor = 'transparent';\n                }\n                \n                // Render blue birds\n                if (this.blueBirds) {\n                    for (const bird of this.blueBirds) {\n                        const center = project(bird.x, bird.y, bird.z);\n                        if (!center) continue;\n                        \n                        const screenSize = Math.max(8, 25 / center.z);\n                        const wingAngle = Math.sin(bird.wingPhase) * 0.6;\n                        const wingHeight = screenSize * 0.5 * (1 + wingAngle);\n                        \n                        // Blue body\n                        ctx.fillStyle = '#1e90ff';\n                        ctx.beginPath();\n                        ctx.ellipse(center.x, center.y, screenSize * 0.5, screenSize * 0.3, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Wings\n                        ctx.fillStyle = '#00bfff';\n                        const wingSpan = screenSize * 1.2;\n                        ctx.beginPath();\n                        ctx.moveTo(center.x, center.y);\n                        ctx.quadraticCurveTo(center.x - wingSpan * 0.5, center.y - wingHeight, center.x - wingSpan, center.y);\n                        ctx.quadraticCurveTo(center.x - wingSpan * 0.5, center.y + screenSize * 0.2, center.x, center.y);\n                        ctx.fill();\n                        ctx.beginPath();\n                        ctx.moveTo(center.x, center.y);\n                        ctx.quadraticCurveTo(center.x + wingSpan * 0.5, center.y - wingHeight, center.x + wingSpan, center.y);\n                        ctx.quadraticCurveTo(center.x + wingSpan * 0.5, center.y + screenSize * 0.2, center.x, center.y);\n                        ctx.fill();\n                        \n                        // Angry eye\n                        ctx.fillStyle = '#ff0000';\n                        ctx.beginPath();\n                        ctx.arc(center.x + screenSize * 0.3, center.y - screenSize * 0.1, screenSize * 0.15, 0, Math.PI * 2);\n                        ctx.fill();\n                    }\n                }\n                \n                // Render fish\n                if (this.fish) {\n                    for (const fish of this.fish) {\n                        const center = project(fish.x, fish.y, fish.z);\n                        if (!center) continue;\n                        \n                        const screenSize = Math.max(4, fish.size * 30 / center.z);\n                        const swimOffset = Math.sin(fish.swimPhase) * 0.2;\n                        \n                        ctx.save();\n                        ctx.translate(center.x, center.y);\n                        ctx.rotate(Math.atan2(fish.vz, fish.vx) + swimOffset);\n                        \n                        // Body\n                        ctx.fillStyle = fish.color;\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, screenSize, screenSize * 0.4, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Tail\n                        ctx.beginPath();\n                        ctx.moveTo(-screenSize * 0.8, 0);\n                        ctx.lineTo(-screenSize * 1.5, -screenSize * 0.4);\n                        ctx.lineTo(-screenSize * 1.5, screenSize * 0.4);\n                        ctx.closePath();\n                        ctx.fill();\n                        \n                        // Eye\n                        ctx.fillStyle = '#000';\n                        ctx.beginPath();\n                        ctx.arc(screenSize * 0.5, -screenSize * 0.1, screenSize * 0.15, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        ctx.restore();\n                    }\n                }\n                \n                // Render cats\n                if (this.cats) {\n                    for (const cat of this.cats) {\n                        const center = project(cat.x, cat.y + 0.3, cat.z);\n                        if (!center) continue;\n                        \n                        const screenSize = Math.max(10, 40 / center.z);\n                        const walkBob = Math.sin(cat.walkPhase) * screenSize * 0.05;\n                        \n                        // Body\n                        ctx.fillStyle = cat.color;\n                        ctx.beginPath();\n                        ctx.ellipse(center.x, center.y + walkBob, screenSize * 0.6, screenSize * 0.4, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Head\n                        ctx.beginPath();\n                        ctx.arc(center.x + screenSize * 0.5, center.y - screenSize * 0.2 + walkBob, screenSize * 0.35, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Ears\n                        ctx.beginPath();\n                        ctx.moveTo(center.x + screenSize * 0.3, center.y - screenSize * 0.5 + walkBob);\n                        ctx.lineTo(center.x + screenSize * 0.4, center.y - screenSize * 0.2 + walkBob);\n                        ctx.lineTo(center.x + screenSize * 0.5, center.y - screenSize * 0.5 + walkBob);\n                        ctx.fill();\n                        ctx.beginPath();\n                        ctx.moveTo(center.x + screenSize * 0.6, center.y - screenSize * 0.5 + walkBob);\n                        ctx.lineTo(center.x + screenSize * 0.7, center.y - screenSize * 0.2 + walkBob);\n                        ctx.lineTo(center.x + screenSize * 0.5, center.y - screenSize * 0.5 + walkBob);\n                        ctx.fill();\n                        \n                        // Eyes\n                        ctx.fillStyle = '#00ff00';\n                        ctx.beginPath();\n                        ctx.ellipse(center.x + screenSize * 0.4, center.y - screenSize * 0.25 + walkBob, screenSize * 0.08, screenSize * 0.12, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.beginPath();\n                        ctx.ellipse(center.x + screenSize * 0.6, center.y - screenSize * 0.25 + walkBob, screenSize * 0.08, screenSize * 0.12, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Tail\n                        ctx.strokeStyle = cat.color;\n                        ctx.lineWidth = screenSize * 0.1;\n                        ctx.lineCap = 'round';\n                        ctx.beginPath();\n                        ctx.moveTo(center.x - screenSize * 0.5, center.y + walkBob);\n                        ctx.quadraticCurveTo(center.x - screenSize * 0.8, center.y - screenSize * 0.3, center.x - screenSize * 0.7, center.y - screenSize * 0.5);\n                        ctx.stroke();\n                    }\n                }\n                \n                // Render creepers\n                if (this.creepers) {\n                    for (const creeper of this.creepers) {\n                        const center = project(creeper.x, creeper.y + 0.8, creeper.z);\n                        if (!center) continue;\n                        \n                        const screenSize = Math.max(15, 50 / center.z);\n                        \n                        // Flash white when fusing\n                        const bodyColor = (creeper.state === 'fusing' && creeper.flashing) ? '#ffffff' : '#00aa00';\n                        \n                        // Body (tall rectangle)\n                        ctx.fillStyle = bodyColor;\n                        ctx.fillRect(center.x - screenSize * 0.3, center.y - screenSize * 0.5, screenSize * 0.6, screenSize);\n                        \n                        // Head\n                        ctx.fillRect(center.x - screenSize * 0.35, center.y - screenSize * 0.9, screenSize * 0.7, screenSize * 0.5);\n                        \n                        // Face (creepy)\n                        ctx.fillStyle = '#000';\n                        // Eyes\n                        ctx.fillRect(center.x - screenSize * 0.25, center.y - screenSize * 0.8, screenSize * 0.15, screenSize * 0.15);\n                        ctx.fillRect(center.x + screenSize * 0.1, center.y - screenSize * 0.8, screenSize * 0.15, screenSize * 0.15);\n                        // Mouth (frown)\n                        ctx.fillRect(center.x - screenSize * 0.2, center.y - screenSize * 0.55, screenSize * 0.1, screenSize * 0.15);\n                        ctx.fillRect(center.x + screenSize * 0.1, center.y - screenSize * 0.55, screenSize * 0.1, screenSize * 0.15);\n                        ctx.fillRect(center.x - screenSize * 0.1, center.y - screenSize * 0.5, screenSize * 0.2, screenSize * 0.1);\n                        \n                        // Legs\n                        ctx.fillStyle = bodyColor;\n                        ctx.fillRect(center.x - screenSize * 0.3, center.y + screenSize * 0.4, screenSize * 0.2, screenSize * 0.3);\n                        ctx.fillRect(center.x + screenSize * 0.1, center.y + screenSize * 0.4, screenSize * 0.2, screenSize * 0.3);\n                    }\n                }\n                \n                // Render Repair NPC (wise man)\n                if (this.repairNPC) {\n                    const npc = this.repairNPC;\n                    const center = project(npc.x, npc.y + 0.9, npc.z);\n                    if (center) {\n                        const screenSize = Math.max(20, 60 / center.z);\n                        \n                        // Body - blue robes\n                        ctx.fillStyle = '#4169e1';\n                        ctx.fillRect(center.x - screenSize * 0.35, center.y - screenSize * 0.3, screenSize * 0.7, screenSize * 0.8);\n                        \n                        // Head - tan/beige\n                        ctx.fillStyle = '#d2b48c';\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y - screenSize * 0.6, screenSize * 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Wizard hat - dark blue\n                        ctx.fillStyle = '#191970';\n                        ctx.beginPath();\n                        ctx.moveTo(center.x - screenSize * 0.35, center.y - screenSize * 0.8);\n                        ctx.lineTo(center.x, center.y - screenSize * 1.3);\n                        ctx.lineTo(center.x + screenSize * 0.35, center.y - screenSize * 0.8);\n                        ctx.closePath();\n                        ctx.fill();\n                        \n                        // Hat brim\n                        ctx.fillRect(center.x - screenSize * 0.4, center.y - screenSize * 0.85, screenSize * 0.8, screenSize * 0.1);\n                        \n                        // Beard - white/gray\n                        ctx.fillStyle = '#ddd';\n                        ctx.beginPath();\n                        ctx.moveTo(center.x - screenSize * 0.2, center.y - screenSize * 0.5);\n                        ctx.lineTo(center.x - screenSize * 0.15, center.y - screenSize * 0.2);\n                        ctx.lineTo(center.x + screenSize * 0.15, center.y - screenSize * 0.2);\n                        ctx.lineTo(center.x + screenSize * 0.2, center.y - screenSize * 0.5);\n                        ctx.closePath();\n                        ctx.fill();\n                        \n                        // Eyes - wise expression\n                        ctx.fillStyle = '#000';\n                        ctx.beginPath();\n                        ctx.arc(center.x - screenSize * 0.12, center.y - screenSize * 0.65, screenSize * 0.05, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.beginPath();\n                        ctx.arc(center.x + screenSize * 0.12, center.y - screenSize * 0.65, screenSize * 0.05, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Interaction prompt if close\n                        if (npc.showPrompt) {\n                            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n                            ctx.fillRect(center.x - 80, center.y - screenSize - 40, 160, 30);\n                            ctx.fillStyle = '#ffd700';\n                            ctx.font = '14px Arial';\n                            ctx.textAlign = 'center';\n                            ctx.fillText('[E] Talk to Gunsmith', center.x, center.y - screenSize - 22);\n                        }\n                    }\n                }\n                \n                // Render particles (only those in front of visible blocks)\n                for (const p of this.particles) {\n                    const center = project(p.x, p.y, p.z);\n                    if (!center) continue;\n                    \n                    // Check if particle is behind a block using simple raycast\n                    // Only check bullets since they're the main issue\n                    if (p.type === 'bullet') {\n                        const dx = p.x - this.camera.x;\n                        const dy = p.y - this.camera.y;\n                        const dz = p.z - this.camera.z;\n                        const dist = Math.sqrt(dx*dx + dy*dy + dz*dz);\n                        \n                        // Simple occlusion check - sample a few points between camera and bullet\n                        let occluded = false;\n                        for (let t = 0.3; t < 0.95; t += 0.2) {\n                            const checkX = this.camera.x + dx * t;\n                            const checkY = this.camera.y + dy * t;\n                            const checkZ = this.camera.z + dz * t;\n                            const block = this.getBlock(Math.floor(checkX), Math.floor(checkY), Math.floor(checkZ));\n                            if (block && !this.fluidBlocks.includes(block)) {\n                                occluded = true;\n                                break;\n                            }\n                        }\n                        if (occluded) continue;\n                        \n                        // Bullet trail\n                        if (p.trail.length > 1) {\n                            ctx.strokeStyle = 'rgba(255, 200, 50, 0.8)';\n                            ctx.lineWidth = 2;\n                            ctx.beginPath();\n                            let started = false;\n                            for (let i = 0; i < p.trail.length; i++) {\n                                const tp = project(p.trail[i].x, p.trail[i].y, p.trail[i].z);\n                                if (tp) {\n                                    if (!started) {\n                                        ctx.moveTo(tp.x, tp.y);\n                                        started = true;\n                                    } else {\n                                        ctx.lineTo(tp.x, tp.y);\n                                    }\n                                }\n                            }\n                            if (started) {\n                                ctx.lineTo(center.x, center.y);\n                                ctx.stroke();\n                            }\n                        }\n                        \n                        // Bullet head\n                        const bulletSize = Math.max(2, 8 / center.z);\n                        ctx.fillStyle = '#ffcc00';\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, bulletSize, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (p.type === 'ricochet' || p.type === 'spark') {\n                        const size = Math.max(1, (p.size || 3) * 20 / center.z);\n                        const alpha = Math.min(1, p.life / 15);\n                        ctx.fillStyle = `rgba(255, ${150 + Math.random() * 100}, 50, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (p.type === 'blessing') {\n                        // Divine blessing particles - golden with sparkle\n                        const size = Math.max(2, (p.size || 4) * 20 / center.z);\n                        const alpha = Math.min(1, p.life / 30);\n                        const sparkle = Math.sin(p.life * 0.3) * 0.5 + 0.5;\n                        \n                        // Outer glow\n                        ctx.fillStyle = `rgba(255, 215, 0, ${alpha * 0.3})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size * 2, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Inner core\n                        ctx.fillStyle = `rgba(255, ${200 + sparkle * 55}, ${100 + sparkle * 155}, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Central bright spot\n                        ctx.fillStyle = `rgba(255, 255, 255, ${alpha * sparkle})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size * 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (p.type === 'explosion') {\n                        // Creeper explosion particles - fiery orange/yellow\n                        const size = Math.max(3, (p.size || 5) * 25 / center.z);\n                        const alpha = Math.min(1, p.life / 20);\n                        const flicker = Math.random() * 0.3 + 0.7;\n                        \n                        // Outer fire glow\n                        ctx.fillStyle = `rgba(255, 100, 0, ${alpha * 0.4})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size * 1.5, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Inner fire core\n                        ctx.fillStyle = `rgba(255, ${150 + Math.random() * 100}, 0, ${alpha * flicker})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Hot center\n                        ctx.fillStyle = `rgba(255, 255, ${Math.random() * 100}, ${alpha * 0.8})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size * 0.4, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (p.type === 'feather') {\n                        const size = Math.max(2, 15 / center.z);\n                        const alpha = Math.min(1, p.life / 20);\n                        ctx.save();\n                        ctx.translate(center.x, center.y);\n                        ctx.rotate(p.rotation);\n                        ctx.fillStyle = `rgba(139, 90, 43, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size * 2, size * 0.5, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Feather spine\n                        ctx.strokeStyle = `rgba(100, 60, 30, ${alpha})`;\n                        ctx.lineWidth = 1;\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 2, 0);\n                        ctx.lineTo(size * 2, 0);\n                        ctx.stroke();\n                        ctx.restore();\n                    } else if (p.type === 'petal') {\n                        // Cherry blossom petal - pink and flutter\n                        // Check occlusion - don't render petals behind walls\n                        const dx = p.x - this.camera.x;\n                        const dy = p.y - this.camera.y;\n                        const dz = p.z - this.camera.z;\n                        let occluded = false;\n                        for (let t = 0.2; t < 0.9; t += 0.25) {\n                            const checkX = this.camera.x + dx * t;\n                            const checkY = this.camera.y + dy * t;\n                            const checkZ = this.camera.z + dz * t;\n                            const block = this.getBlock(Math.floor(checkX), Math.floor(checkY), Math.floor(checkZ));\n                            if (block && !this.fluidBlocks.includes(block)) {\n                                occluded = true;\n                                break;\n                            }\n                        }\n                        if (occluded) continue;\n                        \n                        const size = Math.max(2, (p.size || 4) * 15 / center.z);\n                        const alpha = Math.min(1, p.life / 50);\n                        ctx.save();\n                        ctx.translate(center.x, center.y);\n                        ctx.rotate(p.rotation);\n                        // Petal shape\n                        ctx.fillStyle = `rgba(255, 183, 197, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size * 1.5, size * 0.7, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Darker center\n                        ctx.fillStyle = `rgba(255, 150, 170, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size * 0.5, size * 0.3, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.restore();\n                    } else if (p.type === 'burger') {\n                        // Burger projectile - draw a burger!\n                        const size = Math.max(3, (p.size || 8) * 20 / center.z);\n                        ctx.save();\n                        ctx.translate(center.x, center.y);\n                        // Bun top\n                        ctx.fillStyle = '#D2691E';\n                        ctx.beginPath();\n                        ctx.ellipse(0, -size * 0.3, size, size * 0.5, 0, Math.PI, 0);\n                        ctx.fill();\n                        // Patty\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-size, -size * 0.2, size * 2, size * 0.4);\n                        // Lettuce\n                        ctx.fillStyle = '#228B22';\n                        ctx.fillRect(-size * 0.9, size * 0.1, size * 1.8, size * 0.15);\n                        // Bun bottom\n                        ctx.fillStyle = '#DEB887';\n                        ctx.beginPath();\n                        ctx.ellipse(0, size * 0.3, size, size * 0.4, 0, 0, Math.PI);\n                        ctx.fill();\n                        ctx.restore();\n                    } else if (p.type === 'burgerSplat') {\n                        // Burger splatter\n                        const size = Math.max(2, (p.size || 4) * 10 / center.z);\n                        const alpha = Math.min(1, p.life / 10);\n                        const colors = ['#D2691E', '#654321', '#228B22', '#FF6347'];\n                        ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)].replace(')', `, ${alpha})`).replace('rgb', 'rgba');\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (p.type === 'apple') {\n                        // Apple projectile - draw a red apple\n                        const size = Math.max(3, (p.size || 6) * 18 / center.z);\n                        ctx.save();\n                        ctx.translate(center.x, center.y);\n                        // Apple body\n                        ctx.fillStyle = '#dc143c';\n                        ctx.beginPath();\n                        ctx.arc(0, 0, size, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Highlight\n                        ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';\n                        ctx.beginPath();\n                        ctx.arc(-size * 0.3, -size * 0.3, size * 0.4, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Stem\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-1, -size - 3, 2, 4);\n                        // Leaf\n                        ctx.fillStyle = '#228b22';\n                        ctx.beginPath();\n                        ctx.ellipse(3, -size - 1, 4, 2, 0.3, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.restore();\n                    } else if (p.type === 'appleSplat') {\n                        // Apple splatter\n                        const size = Math.max(2, (p.size || 3) * 8 / center.z);\n                        const alpha = Math.min(1, p.life / 10);\n                        ctx.fillStyle = `rgba(220, 20, 60, ${alpha})`;\n                        ctx.beginPath();\n                        ctx.arc(center.x, center.y, size, 0, Math.PI * 2);\n                        ctx.fill();\n                    }\n                }\n                \n                // Render dropped items (with distance culling and occlusion) - 3D block models\n                if (this.droppedItems) {\n                    const maxItemDistSq = 400; // 20 blocks squared - reduced for performance\n                    for (const item of this.droppedItems) {\n                        // Distance culling - skip items too far away\n                        const dx = item.x - camX;\n                        const dy = item.y - camY;\n                        const dz = item.z - camZ;\n                        const distSq = dx * dx + dy * dy + dz * dz;\n                        if (distSq > maxItemDistSq) continue;\n                        \n                        // Occlusion check - don't render items through walls\n                        let occluded = false;\n                        const dist = Math.sqrt(distSq);\n                        for (let t = 0.15; t < 0.9; t += 0.2) {\n                            const checkX = camX + dx * t;\n                            const checkY = camY + dy * t;\n                            const checkZ = camZ + dz * t;\n                            const block = this.getBlock(Math.floor(checkX), Math.floor(checkY), Math.floor(checkZ));\n                            if (block && !this.fluidBlocks.includes(block)) {\n                                occluded = true;\n                                break;\n                            }\n                        }\n                        if (occluded) continue;\n                        \n                        const bobOffset = Math.sin(item.bobPhase) * 0.1;\n                        const center = project(item.x, item.y + bobOffset, item.z);\n                        if (!center || center.z <= 0) continue;\n                        \n                        const baseSize = Math.max(6, 30 / center.z);\n                        \n                        // Draw 3D item based on type\n                        this.drawDroppedItem3D(ctx, center.x, center.y, baseSize, item.type, item.bobPhase);\n                        \n                        // Count badge if more than 1\n                        if (item.count > 1) {\n                            ctx.font = `bold ${Math.max(8, baseSize * 0.5)}px monospace`;\n                            ctx.fillStyle = '#fff';\n                            ctx.strokeStyle = '#000';\n                            ctx.lineWidth = 2;\n                            ctx.textAlign = 'center';\n                            ctx.strokeText(item.count.toString(), center.x + baseSize * 0.5, center.y + baseSize * 0.4);\n                            ctx.fillText(item.count.toString(), center.x + baseSize * 0.5, center.y + baseSize * 0.4);\n                        }\n                    }\n                }\n                \n                // Draw block highlight (targeted block wireframe)\n                // Only shows if block is within reach (4 blocks)\n                if (!this.isPaused && this.pointerLocked) {\n                    const hit = this.raycast();\n                    if (hit && hit.hit) {\n                        // Show wireframe around the block you're POINTING at\n                        const bx = hit.hit.x;\n                        const by = hit.hit.y;\n                        const bz = hit.hit.z;\n                        \n                        // Define all 8 corners of the block (slightly expanded for visibility)\n                        const e = 0.005; // expansion amount\n                        const corners = [\n                            [bx - e, by - e, bz - e],\n                            [bx + 1 + e, by - e, bz - e],\n                            [bx + 1 + e, by + 1 + e, bz - e],\n                            [bx - e, by + 1 + e, bz - e],\n                            [bx - e, by - e, bz + 1 + e],\n                            [bx + 1 + e, by - e, bz + 1 + e],\n                            [bx + 1 + e, by + 1 + e, bz + 1 + e],\n                            [bx - e, by + 1 + e, bz + 1 + e]\n                        ];\n                        \n                        const projected = corners.map(c => project(c[0], c[1], c[2]));\n                        \n                        // Draw edges if all corners are visible\n                        if (projected.every(p => p !== null)) {\n                            // Simple black wireframe\n                            let strokeColor = 'rgba(0, 0, 0, 0.8)';\n                            let lineWidth = 2;\n                            \n                            // Color variation when looking through fluids\n                            if (hit.throughWater) {\n                                strokeColor = 'rgba(74, 144, 217, 0.7)';\n                                lineWidth = 3;\n                            } else if (hit.throughLava) {\n                                strokeColor = 'rgba(255, 100, 0, 0.7)';\n                                lineWidth = 3;\n                            }\n                            \n                            ctx.strokeStyle = strokeColor;\n                            ctx.lineWidth = lineWidth;\n                            \n                            const edges = [\n                                [0,1], [1,2], [2,3], [3,0], // back face\n                                [4,5], [5,6], [6,7], [7,4], // front face\n                                [0,4], [1,5], [2,6], [3,7]  // connecting edges\n                            ];\n                            \n                            ctx.beginPath();\n                            for (const [a, b] of edges) {\n                                ctx.moveTo(projected[a].x, projected[a].y);\n                                ctx.lineTo(projected[b].x, projected[b].y);\n                            }\n                            ctx.stroke();\n                        }\n                        \n                        // Show tooltip for targeted block\n                        const targetBlock = this.getBlock(bx, by, bz);\n                        this.updateBlockTooltip(targetBlock);\n                    } else {\n                        // No hit within reach - hide tooltip\n                        this.updateBlockTooltip(null);\n                    }\n                }\n                \n                // Debug info display\n                if (this.debugSettings.showCoords) {\n                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n                    ctx.fillRect(width - 200, 10, 190, 80);\n                    ctx.fillStyle = '#0f0';\n                    ctx.font = '12px monospace';\n                    ctx.textAlign = 'left';\n                    ctx.fillText(`X: ${this.camera.x.toFixed(2)}`, width - 190, 28);\n                    ctx.fillText(`Y: ${this.camera.y.toFixed(2)}`, width - 190, 43);\n                    ctx.fillText(`Z: ${this.camera.z.toFixed(2)}`, width - 190, 58);\n                    ctx.fillText(`Blocks: ${Object.keys(this.world).length}`, width - 190, 73);\n                    ctx.fillText(`Birds: ${this.pestBirds.length}`, width - 190, 88);\n                }\n                \n                // Player model (first person body when looking down)\n                this.renderPlayerModel(ctx, halfW, halfH, width, height);\n                \n                // Crosshair\n                if (!this.isPaused && this.pointerLocked) {\n                    ctx.strokeStyle = '#fff';\n                    ctx.lineWidth = 2;\n                    ctx.beginPath();\n                    ctx.moveTo(halfW - 10, halfH);\n                    ctx.lineTo(halfW + 10, halfH);\n                    ctx.moveTo(halfW, halfH - 10);\n                    ctx.lineTo(halfW, halfH + 10);\n                    ctx.stroke();\n                }\n                \n                // Bird event alert\n                if (this.birdEvent && this.birdEvent.alertMessage && this.birdEvent.alertFade > 0) {\n                    const alpha = Math.min(1, this.birdEvent.alertFade / 1000);\n                    const pulse = 0.8 + Math.sin(Date.now() * 0.01) * 0.2;\n                    \n                    ctx.save();\n                    ctx.globalAlpha = alpha;\n                    \n                    // Background box\n                    ctx.fillStyle = `rgba(0, 0, 0, ${0.7 * pulse})`;\n                    const alertWidth = Math.min(width * 0.8, 500);\n                    const alertHeight = 60;\n                    const alertX = (width - alertWidth) / 2;\n                    const alertY = 80;\n                    \n                    ctx.fillRect(alertX, alertY, alertWidth, alertHeight);\n                    \n                    // Border\n                    ctx.strokeStyle = `rgba(255, 100, 100, ${pulse})`;\n                    ctx.lineWidth = 3;\n                    ctx.strokeRect(alertX, alertY, alertWidth, alertHeight);\n                    \n                    // Text\n                    ctx.fillStyle = `rgba(255, 255, 255, ${pulse})`;\n                    ctx.font = 'bold 20px monospace';\n                    ctx.textAlign = 'center';\n                    ctx.fillText(this.birdEvent.alertMessage, width / 2, alertY + 38);\n                    \n                    ctx.restore();\n                }\n                \n                // Bird event timer display (small, top right)\n                if (this.birdEvent && !this.isPaused) {\n                    const timeLeft = Math.max(0, this.birdEvent.timer);\n                    const minutes = Math.floor(timeLeft / 60000);\n                    const seconds = Math.floor((timeLeft % 60000) / 1000);\n                    const timeStr = `üê¶ ${minutes}:${seconds.toString().padStart(2, '0')}`;\n                    \n                    ctx.save();\n                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\n                    ctx.fillRect(width - 100, 10, 90, 25);\n                    ctx.fillStyle = timeLeft < 60000 ? '#ff6666' : '#fff';\n                    ctx.font = '14px monospace';\n                    ctx.textAlign = 'right';\n                    ctx.fillText(timeStr, width - 15, 28);\n                    ctx.restore();\n                }\n                \n                // Render KA-69 if selected - Traditional FPS horizontal gun\n                if (this.selectedItem === 'ka69' && !this.isPaused) {\n                    const s = Math.min(width, height) * 0.0055;\n                    \n                    // Position gun in lower right corner, pointing left toward center\n                    const baseX = width * 0.75;\n                    const baseY = height * 0.78;\n                    \n                    ctx.save();\n                    ctx.translate(baseX, baseY);\n                    ctx.rotate(-0.1); // Slight upward angle\n                    \n                    // === HAND (holding grip) ===\n                    ctx.fillStyle = '#d4a574';  // Skin tone\n                    ctx.beginPath();\n                    ctx.ellipse(45 * s, 25 * s, 18 * s, 12 * s, 0.3, 0, Math.PI * 2);\n                    ctx.fill();\n                    // Fingers wrapped around grip\n                    ctx.fillStyle = '#c49a6c';\n                    for (let i = 0; i < 4; i++) {\n                        ctx.beginPath();\n                        ctx.ellipse((35 + i * 7) * s, 35 * s, 4 * s, 8 * s, 0.2, 0, Math.PI * 2);\n                        ctx.fill();\n                    }\n                    // Thumb\n                    ctx.fillStyle = '#d4a574';\n                    ctx.beginPath();\n                    ctx.ellipse(30 * s, 15 * s, 6 * s, 10 * s, -0.5, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // === STOCK (right side, behind receiver) ===\n                    ctx.fillStyle = '#5a3d2b';\n                    ctx.beginPath();\n                    ctx.moveTo(80 * s, -5 * s);\n                    ctx.lineTo(160 * s, 0 * s);\n                    ctx.lineTo(165 * s, 25 * s);\n                    ctx.lineTo(155 * s, 30 * s);\n                    ctx.lineTo(80 * s, 25 * s);\n                    ctx.closePath();\n                    ctx.fill();\n                    \n                    // Stock wood grain\n                    ctx.fillStyle = '#6b4d3b';\n                    ctx.fillRect(100 * s, 2 * s, 50 * s, 8 * s);\n                    ctx.fillRect(95 * s, 15 * s, 55 * s, 6 * s);\n                    \n                    // Stock butt plate\n                    ctx.fillStyle = '#333';\n                    ctx.fillRect(155 * s, -2 * s, 8 * s, 30 * s);\n                    \n                    // === RECEIVER (main body) ===\n                    ctx.fillStyle = '#2a2a2a';\n                    ctx.fillRect(-30 * s, -8 * s, 115 * s, 30 * s);\n                    \n                    // Receiver top cover\n                    ctx.fillStyle = '#3a3a3a';\n                    ctx.fillRect(-25 * s, -12 * s, 100 * s, 8 * s);\n                    \n                    // Ejection port\n                    ctx.fillStyle = '#1a1a1a';\n                    ctx.fillRect(15 * s, -6 * s, 25 * s, 12 * s);\n                    \n                    // === BARREL & HANDGUARD ===\n                    ctx.fillStyle = '#1a1a1a';\n                    ctx.fillRect(-140 * s, -4 * s, 115 * s, 14 * s);\n                    \n                    // Barrel\n                    ctx.fillStyle = '#111';\n                    ctx.fillRect(-180 * s, 0 * s, 45 * s, 8 * s);\n                    \n                    // Barrel hole\n                    ctx.fillStyle = '#000';\n                    ctx.beginPath();\n                    ctx.ellipse(-182 * s, 4 * s, 3 * s, 3 * s, 0, 0, Math.PI * 2);\n                    ctx.fill();\n                    \n                    // Gas tube\n                    ctx.fillStyle = '#333';\n                    ctx.fillRect(-130 * s, -10 * s, 100 * s, 5 * s);\n                    \n                    // Handguard ventilation holes\n                    ctx.fillStyle = '#111';\n                    for (let i = 0; i < 4; i++) {\n                        ctx.beginPath();\n                        ctx.ellipse((-120 + i * 22) * s, 3 * s, 6 * s, 3 * s, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                    }\n                    \n                    // === FRONT SIGHT ===\n                    ctx.fillStyle = '#1a1a1a';\n                    ctx.fillRect(-145 * s, -20 * s, 6 * s, 18 * s);\n                    ctx.fillRect(-148 * s, -22 * s, 12 * s, 4 * s);\n                    \n                    // === REAR SIGHT ===\n                    ctx.fillRect(-5 * s, -18 * s, 15 * s, 8 * s);\n                    \n                    // === MAGAZINE (curved) ===\n                    ctx.fillStyle = '#333';\n                    ctx.beginPath();\n                    ctx.moveTo(10 * s, 22 * s);\n                    ctx.lineTo(35 * s, 22 * s);\n                    ctx.quadraticCurveTo(45 * s, 50 * s, 35 * s, 80 * s);\n                    ctx.lineTo(15 * s, 85 * s);\n                    ctx.quadraticCurveTo(5 * s, 55 * s, 10 * s, 22 * s);\n                    ctx.closePath();\n                    ctx.fill();\n                    \n                    // Magazine ridges\n                    ctx.strokeStyle = '#222';\n                    ctx.lineWidth = 1.5 * s;\n                    for (let i = 0; i < 4; i++) {\n                        ctx.beginPath();\n                        ctx.moveTo((12 + i * 2) * s, (35 + i * 12) * s);\n                        ctx.lineTo((32 + i * 1) * s, (38 + i * 12) * s);\n                        ctx.stroke();\n                    }\n                    \n                    // === GRIP ===\n                    ctx.fillStyle = '#5a3d2b';\n                    ctx.beginPath();\n                    ctx.moveTo(45 * s, 22 * s);\n                    ctx.lineTo(65 * s, 22 * s);\n                    ctx.lineTo(70 * s, 65 * s);\n                    ctx.lineTo(45 * s, 70 * s);\n                    ctx.closePath();\n                    ctx.fill();\n                    \n                    // Grip texture\n                    ctx.fillStyle = '#4a2d1b';\n                    for (let i = 0; i < 5; i++) {\n                        ctx.fillRect(50 * s, (28 + i * 8) * s, 12 * s, 3 * s);\n                    }\n                    \n                    // === TRIGGER GUARD ===\n                    ctx.strokeStyle = '#2a2a2a';\n                    ctx.lineWidth = 3 * s;\n                    ctx.beginPath();\n                    ctx.arc(25 * s, 35 * s, 15 * s, -0.8, 2.2);\n                    ctx.stroke();\n                    \n                    // Trigger\n                    ctx.fillStyle = '#222';\n                    ctx.fillRect(22 * s, 28 * s, 4 * s, 12 * s);\n                    \n                    // === MUZZLE FLASH ===\n                    if (this.muzzleFlash > 0) {\n                        const flashSize = 25 + Math.random() * 20;\n                        const flashX = -190 * s;\n                        const flashY = 4 * s;\n                        \n                        // Outer glow\n                        ctx.fillStyle = 'rgba(255, 100, 0, 0.5)';\n                        ctx.beginPath();\n                        ctx.arc(flashX, flashY, flashSize * s * 1.5, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Orange middle\n                        ctx.fillStyle = 'rgba(255, 150, 0, 0.8)';\n                        ctx.beginPath();\n                        ctx.arc(flashX, flashY, flashSize * s, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Yellow core\n                        ctx.fillStyle = '#ffff00';\n                        ctx.beginPath();\n                        ctx.arc(flashX, flashY, flashSize * s * 0.4, 0, Math.PI * 2);\n                        ctx.fill();\n                        \n                        // Flash spikes pointing left (toward screen center)\n                        ctx.strokeStyle = '#ffff88';\n                        ctx.lineWidth = 2;\n                        for (let i = 0; i < 6; i++) {\n                            const angle = Math.PI + (Math.random() - 0.5) * 1.5;\n                            const len = (20 + Math.random() * 35) * s;\n                            ctx.beginPath();\n                            ctx.moveTo(flashX, flashY);\n                            ctx.lineTo(flashX + Math.cos(angle) * len, flashY + Math.sin(angle) * len);\n                            ctx.stroke();\n                        }\n                    }\n                    \n                    ctx.restore();\n                }\n                \n                // Render hotbar tooltip (pulsing name when scrolling)\n                if (this.hotbarTooltip.visible) {\n                    const age = Date.now() - this.hotbarTooltip.timestamp;\n                    const fadeStart = 1000; // Start fading after 1 second\n                    const fadeDuration = 500; // Fade over 0.5 seconds\n                    \n                    let alpha = 1;\n                    if (age > fadeStart) {\n                        alpha = 1 - Math.min(1, (age - fadeStart) / fadeDuration);\n                    }\n                    \n                    if (alpha > 0) {\n                        // Pulse effect\n                        const pulse = 1 + Math.sin(age * 0.01) * 0.1;\n                        const fontSize = 24 * pulse;\n                        \n                        // Position above hotbar center\n                        const tooltipX = width / 2;\n                        const tooltipY = height - 120;\n                        \n                        ctx.save();\n                        ctx.textAlign = 'center';\n                        ctx.textBaseline = 'middle';\n                        \n                        // Shadow for readability\n                        ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';\n                        ctx.shadowBlur = 8;\n                        ctx.shadowOffsetX = 2;\n                        ctx.shadowOffsetY = 2;\n                        \n                        // Text with fade\n                        ctx.font = `bold ${fontSize}px Arial`;\n                        ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;\n                        ctx.fillText(this.hotbarTooltip.text, tooltipX, tooltipY);\n                        \n                        ctx.restore();\n                    }\n                }\n                \n                // Fluid overlay effects - only when HEAD is submerged\n                if (this.headSubmergedWater) {\n                    // Blue tint when head is underwater\n                    ctx.fillStyle = 'rgba(0, 100, 200, 0.25)';\n                    ctx.fillRect(0, 0, width, height);\n                }\n                \n                if (this.headSubmergedLava) {\n                    // Intense orange/red overlay with animated flames\n                    const time = Date.now() * 0.005;\n                    \n                    // Base lava tint\n                    ctx.fillStyle = 'rgba(255, 80, 0, 0.4)';\n                    ctx.fillRect(0, 0, width, height);\n                    \n                    // Animated flame edges\n                    ctx.fillStyle = 'rgba(255, 50, 0, 0.6)';\n                    \n                    // Bottom flames\n                    for (let i = 0; i < 12; i++) {\n                        const x = (i / 12) * width;\n                        const flameHeight = 60 + Math.sin(time + i * 0.8) * 30 + Math.sin(time * 1.5 + i) * 20;\n                        ctx.beginPath();\n                        ctx.moveTo(x - 30, height);\n                        ctx.quadraticCurveTo(x, height - flameHeight, x + 30, height);\n                        ctx.fill();\n                    }\n                    \n                    // Top flames (dripping down)\n                    ctx.fillStyle = 'rgba(255, 100, 0, 0.5)';\n                    for (let i = 0; i < 8; i++) {\n                        const x = (i / 8) * width + 40;\n                        const flameHeight = 40 + Math.sin(time * 0.8 + i * 1.2) * 25;\n                        ctx.beginPath();\n                        ctx.moveTo(x - 25, 0);\n                        ctx.quadraticCurveTo(x, flameHeight, x + 25, 0);\n                        ctx.fill();\n                    }\n                    \n                    // Side flames\n                    ctx.fillStyle = 'rgba(255, 60, 0, 0.5)';\n                    for (let i = 0; i < 6; i++) {\n                        const y = (i / 6) * height;\n                        const flameWidth = 40 + Math.sin(time + i) * 20;\n                        // Left side\n                        ctx.beginPath();\n                        ctx.moveTo(0, y - 30);\n                        ctx.quadraticCurveTo(flameWidth, y, 0, y + 30);\n                        ctx.fill();\n                        // Right side\n                        ctx.beginPath();\n                        ctx.moveTo(width, y - 30);\n                        ctx.quadraticCurveTo(width - flameWidth, y, width, y + 30);\n                        ctx.fill();\n                    }\n                    \n                    // Vignette effect\n                    const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width * 0.7);\n                    gradient.addColorStop(0, 'rgba(255, 50, 0, 0)');\n                    gradient.addColorStop(0.7, 'rgba(255, 30, 0, 0.3)');\n                    gradient.addColorStop(1, 'rgba(200, 0, 0, 0.6)');\n                    ctx.fillStyle = gradient;\n                    ctx.fillRect(0, 0, width, height);\n                }\n            },\n            \n            project(x, y, z) {\n                const dx = x - this.camera.x;\n                const dy = y - this.camera.y;\n                const dz = z - this.camera.z;\n                \n                const cosY = Math.cos(-this.camera.rotY);\n                const sinY = Math.sin(-this.camera.rotY);\n                const rx = dx * cosY - dz * sinY;\n                const rz = dx * sinY + dz * cosY;\n                \n                const cosX = Math.cos(-this.camera.rotX);\n                const sinX = Math.sin(-this.camera.rotX);\n                const ry = dy * cosX - rz * sinX;\n                const finalZ = dy * sinX + rz * cosX;\n                \n                if (finalZ <= 0.1) return null;\n                \n                const fov = 400;\n                const screenX = this.canvas.width / 2 + (rx / finalZ) * fov;\n                const screenY = this.canvas.height / 2 - (ry / finalZ) * fov;\n                \n                return { x: screenX, y: screenY, z: finalZ };\n            },\n            \n            // Update block tooltip display\n            updateBlockTooltip(blockType) {\n                const tooltip = document.getElementById('blockTooltip');\n                if (!tooltip) return;\n                \n                const socketInfo = {\n                    'petalSocket': { name: 'Petal Socket', item: 'Requires: Sakura Petal', desc: 'Place a cherry blossom petal here' },\n                    'ropeSocket': { name: 'Rope Socket', item: 'Requires: Sacred Rope', desc: 'Place a shimenawa rope here' },\n                    'charmSocket': { name: 'Charm Socket', item: 'Requires: Omamori', desc: 'Place the protective charm here' },\n                    'plaqueSocket': { name: 'Plaque Socket', item: 'Requires: Wish Plaque', desc: 'Place a wooden ema here' },\n                    'incenseSocket': { name: 'Incense Socket', item: 'Requires: Incense', desc: 'Place purifying incense here' },\n                    'petalSocketFilled': { name: 'Petal Socket ‚úì', item: 'FILLED', desc: 'Cherry petal placed!' },\n                    'ropeSocketFilled': { name: 'Rope Socket ‚úì', item: 'FILLED', desc: 'Sacred rope placed!' },\n                    'charmSocketFilled': { name: 'Charm Socket ‚úì', item: 'FILLED', desc: 'Charm placed!' },\n                    'plaqueSocketFilled': { name: 'Plaque Socket ‚úì', item: 'FILLED', desc: 'Wish plaque placed!' },\n                    'incenseSocketFilled': { name: 'Incense Socket ‚úì', item: 'FILLED', desc: 'Incense placed!' }\n                };\n                \n                const info = blockType ? socketInfo[blockType] : null;\n                if (info) {\n                    tooltip.classList.add('active');\n                    tooltip.querySelector('.tooltip-title').textContent = info.name;\n                    const isFilled = info.item === 'FILLED';\n                    tooltip.querySelector('.tooltip-desc').innerHTML = \n                        `<span style=\"color:${isFilled ? '#4f4' : '#ffd700'}\">${info.item}</span><br>${info.desc}`;\n                } else {\n                    tooltip.classList.remove('active');\n                }\n            },\n            \n            // Render player model (first-person body visible when looking down)\n            renderPlayerModel(ctx, centerX, centerY, width, height) {\n                // Only show body when looking down\n                const lookDownAmount = Math.max(0, this.camera.rotX * 2); // 0 to 1 as player looks down\n                if (lookDownAmount < 0.05) {\n                    // Always show hands with held item even when not looking down\n                    this.renderHeldItem(ctx, centerX, centerY, width, height);\n                    return;\n                }\n                \n                const alpha = Math.min(1, lookDownAmount);\n                \n                ctx.save();\n                \n                // Body position based on look angle\n                const bodyY = height - 50 + (1 - lookDownAmount) * 200;\n                \n                // Draw the 3D body with shading\n                this.drawPlayerBody3D(ctx, centerX, bodyY, alpha, lookDownAmount);\n                \n                ctx.restore();\n                \n                // Always render held item\n                this.renderHeldItem(ctx, centerX, centerY, width, height);\n            },\n            \n            // Render held item in first person\n            renderHeldItem(ctx, centerX, centerY, width, height) {\n                const slot = this.inventory.hotbar[this.selectedSlot];\n                if (!slot) return;\n                \n                const itemId = slot.id;\n                const bobOffset = Math.sin(Date.now() * 0.003) * 3;\n                \n                // Hand position (bottom right of screen)\n                const handX = width - 120;\n                const handY = height - 100 + bobOffset;\n                const size = 60;\n                \n                ctx.save();\n                ctx.translate(handX, handY);\n                ctx.rotate(-0.2); // Slight tilt\n                \n                // Draw hand\n                ctx.fillStyle = '#ffdab9'; // Skin tone\n                ctx.beginPath();\n                ctx.ellipse(0, 20, 25, 35, 0.3, 0, Math.PI * 2);\n                ctx.fill();\n                \n                // Draw item based on type\n                const colors = this.blockColors[itemId];\n                \n                if (colors) {\n                    // Block item - draw 3D cube\n                    const s = size * 0.5;\n                    ctx.translate(0, -10);\n                    \n                    // Top face\n                    ctx.fillStyle = colors.top;\n                    ctx.beginPath();\n                    ctx.moveTo(0, -s);\n                    ctx.lineTo(s, -s/2);\n                    ctx.lineTo(0, 0);\n                    ctx.lineTo(-s, -s/2);\n                    ctx.closePath();\n                    ctx.fill();\n                    \n                    // Left face\n                    ctx.fillStyle = colors.side;\n                    ctx.beginPath();\n                    ctx.moveTo(-s, -s/2);\n                    ctx.lineTo(0, 0);\n                    ctx.lineTo(0, s);\n                    ctx.lineTo(-s, s/2);\n                    ctx.closePath();\n                    ctx.fill();\n                    \n                    // Right face\n                    ctx.fillStyle = this.darkenColor(colors.side, 0.7);\n                    ctx.beginPath();\n                    ctx.moveTo(0, 0);\n                    ctx.lineTo(s, -s/2);\n                    ctx.lineTo(s, s/2);\n                    ctx.lineTo(0, s);\n                    ctx.closePath();\n                    ctx.fill();\n                } else {\n                    // Non-block item\n                    if (itemId === 'ka69') {\n                        ctx.fillStyle = '#333';\n                        ctx.fillRect(-30, -20, 80, 15);\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-10, -5, 25, 25);\n                        ctx.fillStyle = '#222';\n                        ctx.fillRect(10, -5, 8, 20);\n                    } else if (itemId === 'berdger') {\n                        // Burger\n                        ctx.fillStyle = '#daa520';\n                        ctx.beginPath();\n                        ctx.ellipse(0, -15, 25, 12, 0, Math.PI, 0);\n                        ctx.fill();\n                        ctx.fillStyle = '#8b4513';\n                        ctx.fillRect(-22, -8, 44, 10);\n                        ctx.fillStyle = '#228b22';\n                        ctx.fillRect(-20, 0, 40, 5);\n                        ctx.fillStyle = '#daa520';\n                        ctx.beginPath();\n                        ctx.ellipse(0, 10, 23, 10, 0, 0, Math.PI);\n                        ctx.fill();\n                    } else if (itemId === 'apple') {\n                        ctx.fillStyle = '#dc143c';\n                        ctx.beginPath();\n                        ctx.arc(0, -5, 20, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.fillStyle = '#654321';\n                        ctx.fillRect(-2, -30, 4, 10);\n                        ctx.fillStyle = '#228b22';\n                        ctx.beginPath();\n                        ctx.ellipse(5, -28, 8, 4, 0.5, 0, Math.PI * 2);\n                        ctx.fill();\n                    } else if (itemId === 'water_bucket' || itemId === 'lava_bucket') {\n                        ctx.fillStyle = '#888';\n                        ctx.beginPath();\n                        ctx.moveTo(-20, -25);\n                        ctx.lineTo(20, -25);\n                        ctx.lineTo(15, 15);\n                        ctx.lineTo(-15, 15);\n                        ctx.closePath();\n                        ctx.fill();\n                        ctx.fillStyle = itemId === 'water_bucket' ? '#4a90d9' : '#ff6600';\n                        ctx.fillRect(-15, -15, 30, 25);\n                    } else if (itemId === 'seeds') {\n                        ctx.fillStyle = '#daa520';\n                        for (let i = 0; i < 5; i++) {\n                            ctx.beginPath();\n                            ctx.ellipse(Math.cos(i) * 10, Math.sin(i) * 8 - 10, 4, 6, i, 0, Math.PI * 2);\n                            ctx.fill();\n                        }\n                    }\n                }\n                \n                ctx.restore();\n            },\n            \n            // Draw the player body in 3D style with shading\n            drawPlayerBody3D(ctx, centerX, bodyY, alpha, lookAmount) {\n                ctx.save();\n                \n                // 3D depth effect - darker on edges\n                const edgeShade = 0.7;\n                \n                // Torso - cherry blossom pink themed with 3D shading\n                const gradient = ctx.createLinearGradient(centerX - 50, bodyY, centerX + 50, bodyY);\n                gradient.addColorStop(0, `rgba(180, 130, 150, ${alpha})`);\n                gradient.addColorStop(0.3, `rgba(255, 183, 197, ${alpha})`);\n                gradient.addColorStop(0.7, `rgba(255, 183, 197, ${alpha})`);\n                gradient.addColorStop(1, `rgba(180, 130, 150, ${alpha})`);\n                ctx.fillStyle = gradient;\n                \n                // Draw torso as trapezoid with rounded corners\n                ctx.beginPath();\n                ctx.moveTo(centerX - 35, bodyY + 5);\n                ctx.lineTo(centerX + 35, bodyY + 5);\n                ctx.quadraticCurveTo(centerX + 50, bodyY + 40, centerX + 45, bodyY + 80);\n                ctx.lineTo(centerX - 45, bodyY + 80);\n                ctx.quadraticCurveTo(centerX - 50, bodyY + 40, centerX - 35, bodyY + 5);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Collar V-neck\n                ctx.fillStyle = `rgba(255, 240, 245, ${alpha * 0.8})`;\n                ctx.beginPath();\n                ctx.moveTo(centerX - 20, bodyY + 5);\n                ctx.lineTo(centerX, bodyY + 25);\n                ctx.lineTo(centerX + 20, bodyY + 5);\n                ctx.closePath();\n                ctx.fill();\n                \n                // Arms with 3D shading\n                const armGradient = ctx.createRadialGradient(centerX - 55, bodyY + 30, 0, centerX - 55, bodyY + 30, 30);\n                armGradient.addColorStop(0, `rgba(255, 228, 205, ${alpha})`);\n                armGradient.addColorStop(1, `rgba(220, 180, 160, ${alpha})`);\n                ctx.fillStyle = armGradient;\n                ctx.beginPath();\n                ctx.ellipse(centerX - 52, bodyY + 35, 14, 28, -0.2, 0, Math.PI * 2);\n                ctx.fill();\n                \n                const armGradient2 = ctx.createRadialGradient(centerX + 55, bodyY + 30, 0, centerX + 55, bodyY + 30, 30);\n                armGradient2.addColorStop(0, `rgba(255, 228, 205, ${alpha})`);\n                armGradient2.addColorStop(1, `rgba(220, 180, 160, ${alpha})`);\n                ctx.fillStyle = armGradient2;\n                ctx.beginPath();\n                ctx.ellipse(centerX + 52, bodyY + 35, 14, 28, 0.2, 0, Math.PI * 2);\n                ctx.fill();\n                \n                // Hands\n                ctx.fillStyle = `rgba(255, 218, 195, ${alpha})`;\n                ctx.beginPath();\n                ctx.arc(centerX - 55, bodyY + 60, 12, 0, Math.PI * 2);\n                ctx.fill();\n                ctx.beginPath();\n                ctx.arc(centerX + 55, bodyY + 60, 12, 0, Math.PI * 2);\n                ctx.fill();\n                \n                // Legs with jeans texture effect\n                const jeansGradient = ctx.createLinearGradient(centerX - 40, bodyY + 75, centerX + 40, bodyY + 75);\n                jeansGradient.addColorStop(0, `rgba(50, 70, 100, ${alpha})`);\n                jeansGradient.addColorStop(0.3, `rgba(70, 90, 120, ${alpha})`);\n                jeansGradient.addColorStop(0.7, `rgba(70, 90, 120, ${alpha})`);\n                jeansGradient.addColorStop(1, `rgba(50, 70, 100, ${alpha})`);\n                ctx.fillStyle = jeansGradient;\n                \n                // Left leg\n                ctx.beginPath();\n                ctx.roundRect(centerX - 38, bodyY + 78, 28, 55, 3);\n                ctx.fill();\n                \n                // Right leg\n                ctx.beginPath();\n                ctx.roundRect(centerX + 10, bodyY + 78, 28, 55, 3);\n                ctx.fill();\n                \n                // Boots with shine\n                ctx.fillStyle = `rgba(100, 60, 30, ${alpha})`;\n                ctx.beginPath();\n                ctx.roundRect(centerX - 42, bodyY + 128, 35, 20, 4);\n                ctx.fill();\n                ctx.beginPath();\n                ctx.roundRect(centerX + 7, bodyY + 128, 35, 20, 4);\n                ctx.fill();\n                \n                // Boot shine\n                ctx.fillStyle = `rgba(255, 255, 255, ${alpha * 0.2})`;\n                ctx.beginPath();\n                ctx.ellipse(centerX - 30, bodyY + 133, 8, 3, 0, 0, Math.PI * 2);\n                ctx.fill();\n                ctx.beginPath();\n                ctx.ellipse(centerX + 20, bodyY + 133, 8, 3, 0, 0, Math.PI * 2);\n                ctx.fill();\n                \n                ctx.restore();\n            },\n            \n            \n            // Procedural texture generation for realistic block appearance\n            generateTexture(type, baseColor, face) {\n                const key = `${type}_${face}_${baseColor}`;\n                if (this.textureCache[key]) return this.textureCache[key];\n                \n                // Create offscreen canvas for texture\n                const size = 32; // Texture resolution\n                const canvas = document.createElement('canvas');\n                canvas.width = size;\n                canvas.height = size;\n                const ctx = canvas.getContext('2d');\n                \n                // Parse base color\n                const parseColor = (color) => {\n                    if (color.startsWith('rgba')) {\n                        const match = color.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)/);\n                        return { r: parseInt(match[1]), g: parseInt(match[2]), b: parseInt(match[3]) };\n                    }\n                    const r = parseInt(color.slice(1, 3), 16);\n                    const g = parseInt(color.slice(3, 5), 16);\n                    const b = parseInt(color.slice(5, 7), 16);\n                    return { r, g, b };\n                };\n                \n                const base = parseColor(baseColor);\n                \n                // Seeded random for consistency\n                const random = (seed) => {\n                    const x = Math.sin(seed) * 10000;\n                    return x - Math.floor(x);\n                };\n                \n                if (type === 'grass') {\n                    // Grass texture with organic variation\n                    for (let y = 0; y < size; y++) {\n                        for (let x = 0; x < size; x++) {\n                            const seed = x * 1000 + y;\n                            const noise = random(seed) * 0.3 - 0.15; // ¬±15% variation\n                            const r = Math.max(0, Math.min(255, base.r + base.r * noise));\n                            const g = Math.max(0, Math.min(255, base.g + base.g * noise));\n                            const b = Math.max(0, Math.min(255, base.b + base.b * noise));\n                            ctx.fillStyle = `rgb(${Math.floor(r)},${Math.floor(g)},${Math.floor(b)})`;\n                            ctx.fillRect(x, y, 1, 1);\n                        }\n                    }\n                    \n                    // Add grass blades on top face\n                    if (face === 'top') {\n                        ctx.fillStyle = 'rgba(90, 160, 70, 0.4)';\n                        for (let i = 0; i < 12; i++) {\n                            const x = Math.floor(random(i * 123) * size);\n                            const y = Math.floor(random(i * 456) * size);\n                            ctx.fillRect(x, y, 2, 3);\n                        }\n                    }\n                } else if (type === 'dirt') {\n                    // Dirt texture with clumpy noise\n                    for (let y = 0; y < size; y++) {\n                        for (let x = 0; x < size; x++) {\n                            const seed = x * 1000 + y;\n                            const noise1 = random(seed) * 0.25 - 0.125;\n                            const noise2 = random(seed + 999) * 0.15 - 0.075;\n                            const combined = noise1 + noise2;\n                            const r = Math.max(0, Math.min(255, base.r + base.r * combined));\n                            const g = Math.max(0, Math.min(255, base.g + base.g * combined));\n                            const b = Math.max(0, Math.min(255, base.b + base.b * combined));\n                            ctx.fillStyle = `rgb(${Math.floor(r)},${Math.floor(g)},${Math.floor(b)})`;\n                            ctx.fillRect(x, y, 1, 1);\n                        }\n                    }\n                    \n                    // Add small pebbles\n                    ctx.fillStyle = 'rgba(100, 80, 60, 0.3)';\n                    for (let i = 0; i < 8; i++) {\n                        const x = Math.floor(random(i * 789) * size);\n                        const y = Math.floor(random(i * 321) * size);\n                        ctx.fillRect(x, y, 2, 2);\n                    }\n                } else if (type === 'brick') {\n                    // Brick pattern with mortar\n                    const brickH = 8;\n                    const brickW = 16;\n                    const mortarSize = 2;\n                    \n                    // Mortar (darker background)\n                    ctx.fillStyle = `rgb(${Math.floor(base.r * 0.6)},${Math.floor(base.g * 0.6)},${Math.floor(base.b * 0.6)})`;\n                    ctx.fillRect(0, 0, size, size);\n                    \n                    // Draw bricks in pattern\n                    for (let row = 0; row < Math.ceil(size / brickH); row++) {\n                        const offset = (row % 2) * (brickW / 2);\n                        for (let col = -1; col < Math.ceil(size / brickW) + 1; col++) {\n                            const bx = col * brickW + offset;\n                            const by = row * brickH;\n                            \n                            // Each brick has slight variation\n                            const seed = row * 100 + col;\n                            const noise = random(seed) * 0.15 - 0.075;\n                            const r = Math.max(0, Math.min(255, base.r + base.r * noise));\n                            const g = Math.max(0, Math.min(255, base.g + base.g * noise));\n                            const b = Math.max(0, Math.min(255, base.b + base.b * noise));\n                            ctx.fillStyle = `rgb(${Math.floor(r)},${Math.floor(g)},${Math.floor(b)})`;\n                            ctx.fillRect(bx, by, brickW - mortarSize, brickH - mortarSize);\n                            \n                            // Add texture to brick\n                            ctx.fillStyle = `rgba(0,0,0,${random(seed + 50) * 0.1})`;\n                            ctx.fillRect(bx, by, brickW - mortarSize, brickH - mortarSize);\n                        }\n                    }\n                } else if (type === 'leaves') {\n                    // Leaves texture with organic patterns\n                    for (let y = 0; y < size; y++) {\n                        for (let x = 0; x < size; x++) {\n                            const seed = x * 1000 + y;\n                            const noise = random(seed) * 0.4 - 0.2; // More variation for leaves\n                            const r = Math.max(0, Math.min(255, base.r + base.r * noise));\n                            const g = Math.max(0, Math.min(255, base.g + base.g * noise));\n                            const b = Math.max(0, Math.min(255, base.b + base.b * noise));\n                            ctx.fillStyle = `rgb(${Math.floor(r)},${Math.floor(g)},${Math.floor(b)})`;\n                            ctx.fillRect(x, y, 1, 1);\n                        }\n                    }\n                    \n                    // Add darker veins/gaps between leaves\n                    ctx.fillStyle = 'rgba(0, 50, 0, 0.3)';\n                    for (let i = 0; i < 15; i++) {\n                        const x = Math.floor(random(i * 234) * size);\n                        const y = Math.floor(random(i * 567) * size);\n                        const w = 2 + Math.floor(random(i * 890) * 3);\n                        const h = 2 + Math.floor(random(i * 345) * 3);\n                        ctx.fillRect(x, y, w, h);\n                    }\n                } else if (type === 'wood') {\n                    // Wood texture with grain and rings\n                    if (face === 'top') {\n                        // TOP FACE: Tree rings (circular pattern)\n                        // Fill with base wood color\n                        for (let y = 0; y < size; y++) {\n                            for (let x = 0; x < size; x++) {\n                                const seed = x * 1000 + y;\n                                const noise = random(seed) * 0.15 - 0.075;\n                                const r = Math.max(0, Math.min(255, base.r + base.r * noise));\n                                const g = Math.max(0, Math.min(255, base.g + base.g * noise));\n                                const b = Math.max(0, Math.min(255, base.b + base.b * noise));\n                                ctx.fillStyle = `rgb(${Math.floor(r)},${Math.floor(g)},${Math.floor(b)})`;\n                                ctx.fillRect(x, y, 1, 1);\n                            }\n                        }\n                        \n                        // Add tree rings (concentric circles from center)\n                        const centerX = size / 2;\n                        const centerY = size / 2;\n                        for (let ring = 1; ring < 6; ring++) {\n                            const radius = ring * 4 + random(ring * 50) * 3;\n                            ctx.strokeStyle = `rgba(0, 0, 0, ${0.1 + random(ring * 100) * 0.1})`;\n                            ctx.lineWidth = 0.5 + random(ring * 200) * 1;\n                            ctx.beginPath();\n                            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);\n                            ctx.stroke();\n                        }\n                    } else {\n                        // SIDE FACES: Vertical bark texture (wood grain)\n                        for (let y = 0; y < size; y++) {\n                            for (let x = 0; x < size; x++) {\n                                const seed = x * 10 + y * 1000; // Emphasize vertical variation\n                                const noise = random(seed) * 0.2 - 0.1;\n                                const r = Math.max(0, Math.min(255, base.r + base.r * noise));\n                                const g = Math.max(0, Math.min(255, base.g + base.g * noise));\n                                const b = Math.max(0, Math.min(255, base.b + base.b * noise));\n                                ctx.fillStyle = `rgb(${Math.floor(r)},${Math.floor(g)},${Math.floor(b)})`;\n                                ctx.fillRect(x, y, 1, 1);\n                            }\n                        }\n                        \n                        // Add vertical grain lines (darker streaks)\n                        ctx.strokeStyle = 'rgba(0, 0, 0, 0.15)';\n                        ctx.lineWidth = 1;\n                        for (let i = 0; i < 8; i++) {\n                            const x = Math.floor(random(i * 333) * size);\n                            const waveOffset = random(i * 444) * 3;\n                            ctx.beginPath();\n                            ctx.moveTo(x, 0);\n                            for (let y = 0; y < size; y += 2) {\n                                const wave = Math.sin(y * 0.3 + i) * waveOffset;\n                                ctx.lineTo(x + wave, y);\n                            }\n                            ctx.stroke();\n                        }\n                        \n                        // Add horizontal cracks/knots occasionally\n                        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';\n                        for (let i = 0; i < 3; i++) {\n                            if (random(i * 555) > 0.7) {\n                                const y = Math.floor(random(i * 666) * size);\n                                const x = Math.floor(random(i * 777) * size * 0.8);\n                                ctx.fillRect(x, y, 4, 1);\n                            }\n                        }\n                    }\n                }\n                \n                // Create pattern from canvas\n                const pattern = ctx.createPattern(canvas, 'repeat');\n                this.textureCache[key] = pattern;\n                return pattern;\n            },\n            \n            darkenColor(hex, factor) {\n                // Use cache to avoid repeated hex parsing\n                const key = hex + factor;\n                if (!this.colorCache) this.colorCache = {};\n                if (this.colorCache[key]) return this.colorCache[key];\n                \n                const r = Math.floor(parseInt(hex.slice(1, 3), 16) * factor);\n                const g = Math.floor(parseInt(hex.slice(3, 5), 16) * factor);\n                const b = Math.floor(parseInt(hex.slice(5, 7), 16) * factor);\n                const result = `rgb(${r},${g},${b})`;\n                this.colorCache[key] = result;\n                return result;\n            },\n            \n            gameLoop(timestamp) {\n                // Completely stop loop when game is inactive\n                if (!this.isActive) {\n                    this.gameLoopId = null;\n                    return;\n                }\n                \n                // Initialize lastFrameTime if needed\n                if (!this.lastFrameTime) this.lastFrameTime = timestamp;\n                \n                // Calculate frame interval based on target FPS\n                const targetInterval = 1000 / this.settings.targetFps;\n                const elapsed = timestamp - this.lastFrameTime;\n                \n                // Only update if enough time has passed for target FPS\n                if (elapsed >= targetInterval) {\n                    this.lastFrameTime = timestamp - (elapsed % targetInterval);\n                    \n                    // Update FPS counter\n                    this.fpsCounter.frames++;\n                    if (timestamp - this.fpsCounter.lastTime >= 1000) {\n                        this.fpsCounter.fps = this.fpsCounter.frames;\n                        this.fpsCounter.frames = 0;\n                        this.fpsCounter.lastTime = timestamp;\n                        \n                        // Update debug console FPS\n                        const debugFps = document.getElementById('debugFps');\n                        if (debugFps) {\n                            debugFps.textContent = `${this.fpsCounter.fps} FPS`;\n                        }\n                    }\n                    \n                    // Only update physics if not paused\n                    if (!this.isPaused) {\n                        this.update();\n                        this.updateBirds();\n                        this.updateParticles();\n                        this.updateFluids();  // Fluid spreading simulation\n                        this.updateWind();    // Wind dynamics\n                        this.updatePetals();  // Cherry blossom petals\n                        this.updateDroppedItems();  // Ground items\n                        this.render();\n                        \n                        // Render FPS counter\n                        if (this.settings.showFps) {\n                            this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\n                            this.ctx.fillRect(this.canvas.width - 70, this.canvas.height - 25, 65, 20);\n                            this.ctx.fillStyle = '#00ff00';\n                            this.ctx.font = '12px monospace';\n                            this.ctx.textAlign = 'right';\n                            this.ctx.fillText(`${this.fpsCounter.fps} FPS`, this.canvas.width - 10, this.canvas.height - 10);\n                            this.ctx.textAlign = 'left';\n                        }\n                        \n                        // Display active rendering algorithm (top-right, always visible)\n                        const algoName = this.debugSettings.renderAlgorithm.toUpperCase();\n                        const algoColors = {\n                            PAINTER: '#00ff00',\n                            ZBUFFER: '#00ffff',\n                            BSP: '#ff00ff'\n                        };\n                        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n                        this.ctx.fillRect(this.canvas.width - 90, 5, 85, 20);\n                        this.ctx.fillStyle = algoColors[algoName] || '#ffffff';\n                        this.ctx.font = 'bold 12px monospace';\n                        this.ctx.textAlign = 'right';\n                        this.ctx.fillText(algoName, this.canvas.width - 10, 18);\n                        this.ctx.textAlign = 'left';\n                    }\n                }\n                \n                // Store the ID so we can cancel it on stop\n                this.gameLoopId = requestAnimationFrame((ts) => this.gameLoop(ts));\n            },\n            \n            start() {\n                // Initialize world on first start (deferred from page load)\n                this.fullInit();\n                \n                // Expose game instance for dialogue onclick handlers\n                (window as any).game = this;\n                \n                this.isActive = true;\n                this.isPaused = false;\n                this.pointerLocked = false;\n                this.stats = { blocksPlaced: 0, blocksBroken: 0, distance: 0, jumps: 0, startTime: Date.now() };\n                document.getElementById('minecraftGame').classList.add('active');\n                document.getElementById('pauseMenu').classList.remove('active');\n                document.getElementById('gameUI').style.display = 'flex';\n                \n                // Find safe spawn location using a spiral search\n                const findSafeSpawn = () => {\n                    const preferredX = 0;\n                    const preferredZ = -8;\n                    \n                    // Helper to check if a position is safe for spawning\n                    const isSpawnSafe = (x, z) => {\n                        // Find ground level\n                        let groundY = null;\n                        for (let checkY = 40; checkY >= 0; checkY--) {\n                            const block = this.getBlock(x, checkY, z);\n                            if (block && block !== 'water' && block !== 'lava') {\n                                groundY = checkY;\n                                break;\n                            }\n                        }\n                        \n                        if (groundY === null) return null; // No ground found\n                        \n                        // Check if there are blocks ABOVE ground (buildings, trees)\n                        // Scan upward to make sure player is truly outside\n                        let hasRoof = false;\n                        for (let checkY = groundY + 1; checkY <= groundY + 10; checkY++) {\n                            const block = this.getBlock(x, checkY, z);\n                            if (block && block !== 'water' && block !== 'lava') {\n                                hasRoof = true;\n                                break; // Found structure above\n                            }\n                        }\n                        \n                        // Reject if there's a roof/structure above\n                        if (hasRoof) return null;\n                        \n                        // Check surrounding area for structures (avoid spawning next to buildings)\n                        let nearStructure = false;\n                        for (let dx = -2; dx <= 2; dx++) {\n                            for (let dz = -2; dz <= 2; dz++) {\n                                // Check if there are tall structures nearby\n                                for (let dy = 1; dy <= 5; dy++) {\n                                    const block = this.getBlock(x + dx, groundY + dy, z + dz);\n                                    if (block && block !== 'water' && block !== 'lava') {\n                                        nearStructure = true;\n                                        break;\n                                    }\n                                }\n                                if (nearStructure) break;\n                            }\n                            if (nearStructure) break;\n                        }\n                        \n                        // Prefer open areas away from structures\n                        if (nearStructure) {\n                            return null; // Skip this location\n                        }\n                        \n                        const feetY = groundY + 1;\n                        const bodyY = groundY + 2;\n                        \n                        // Check if there's space for the player (2 blocks of air above ground)\n                        const feetBlock = this.getBlock(x, feetY, z);\n                        const bodyBlock = this.getBlock(x, bodyY, z);\n                        \n                        // Both spaces must be empty or fluid (can spawn in water but not in solid)\n                        const feetClear = !feetBlock || feetBlock === 'water' || feetBlock === 'lava';\n                        const bodyClear = !bodyBlock || bodyBlock === 'water' || bodyBlock === 'lava';\n                        \n                        // Check for flat ground (prefer stable, flat terrain)\n                        const groundBlock = this.getBlock(x, groundY, z);\n                        const isDryLand = groundBlock !== 'water' && groundBlock !== 'lava' && groundBlock !== 'sand';\n                        \n                        // Check if ground is reasonably flat (check adjacent blocks)\n                        let isFlat = true;\n                        for (let dx = -1; dx <= 1; dx++) {\n                            for (let dz = -1; dz <= 1; dz++) {\n                                if (dx === 0 && dz === 0) continue;\n                                \n                                // Find ground at adjacent position (inline logic)\n                                let adjGroundY = null;\n                                for (let checkY = 40; checkY >= 0; checkY--) {\n                                    const adjBlock = this.getBlock(x + dx, checkY, z + dz);\n                                    if (adjBlock && adjBlock !== 'water' && adjBlock !== 'lava') {\n                                        adjGroundY = checkY;\n                                        break;\n                                    }\n                                }\n                                \n                                // If can't find adjacent ground or too steep, not flat\n                                if (adjGroundY === null || Math.abs(adjGroundY - groundY) > 1) {\n                                    isFlat = false; // Too steep/uneven or no ground\n                                    break;\n                                }\n                            }\n                            if (!isFlat) break;\n                        }\n                        \n                        if (feetClear && bodyClear && isFlat) {\n                            return {\n                                x: x,\n                                y: feetY + this.playerEyeHeight,\n                                z: z,\n                                priority: isDryLand ? 1 : 2 // Prefer dry land\n                            };\n                        }\n                        \n                        return null;\n                    };\n                    \n                    // Try preferred location first\n                    let bestSpawn = isSpawnSafe(preferredX, preferredZ);\n                    if (bestSpawn && bestSpawn.priority === 1) {\n                        return bestSpawn;\n                    }\n                    \n                    // Spiral search outward from preferred location\n                    const maxRadius = 30;\n                    for (let radius = 1; radius <= maxRadius; radius++) {\n                        for (let dx = -radius; dx <= radius; dx++) {\n                            for (let dz = -radius; dz <= radius; dz++) {\n                                // Only check perimeter of current radius\n                                if (Math.abs(dx) !== radius && Math.abs(dz) !== radius) continue;\n                                \n                                const spawn = isSpawnSafe(preferredX + dx, preferredZ + dz);\n                                if (spawn) {\n                                    if (spawn.priority === 1) {\n                                        return spawn; // Found perfect spot\n                                    }\n                                    if (!bestSpawn || spawn.priority < bestSpawn.priority) {\n                                        bestSpawn = spawn;\n                                    }\n                                }\n                            }\n                        }\n                        \n                        // If we found something decent, use it\n                        if (bestSpawn && radius > 5) {\n                            return bestSpawn;\n                        }\n                    }\n                    \n                    // Fallback - spawn high in the sky\n                    return { x: 0, y: 30, z: 0 };\n                };\n                \n                const spawnPos = findSafeSpawn();\n                this.camera = { x: spawnPos.x + 0.5, y: spawnPos.y, z: spawnPos.z + 0.5, rotX: -0.3, rotY: 0 };\n                (this.canvas as HTMLElement).style.filter = '';\n                \n                // Reset player state\n                this.velocity = { x: 0, y: 0, z: 0 };\n                this.isJumping = false;\n                this.inWater = false;\n                this.inLava = false;\n                this.swimming = false;\n                this.headSubmergedWater = false;\n                this.headSubmergedLava = false;\n                \n                // Clear any lingering particles/fluids from previous session\n                this.particles = [];\n                this.fluidUpdates = [];\n                \n                // Initialize bird event system\n                this.birdEvent = {\n                    timer: 5 * 60 * 1000, // 5 minutes in ms\n                    lastUpdate: Date.now(),\n                    currentEvent: 0,\n                    events: [\n                        {\n                            name: 'SWARM',\n                            description: 'the birds will swarm!',\n                            action: () => this.triggerBirdSwarm()\n                        },\n                        {\n                            name: 'RAGE',\n                            description: 'the birds will rage!',\n                            action: () => this.triggerBirdRage()\n                        },\n                        {\n                            name: 'MULTIPLY',\n                            description: 'the birds will multiply!',\n                            action: () => this.triggerBirdMultiply()\n                        },\n                        {\n                            name: 'CREEPER INVASION',\n                            description: 'creepers will stalk you!',\n                            action: () => this.triggerCreeperInvasion()\n                        }\n                    ],\n                    alertShown: { five: false, three: false, one: false, thirty: false, ten: false },\n                    alertMessage: null,\n                    alertFade: 0\n                };\n                \n                // Initialize survival game stats\n                this.survivalStats = {\n                    score: 0,\n                    wave: 1,\n                    birdsDefeated: 0,\n                    objectiveTimer: 0,\n                    currentObjective: null,\n                    objectives: [\n                        { text: 'Survive the bird apocalypse!', type: 'survive' },\n                        { text: 'Find the Ritual Temple', type: 'find_temple' },\n                        { text: 'Collect 5 apples', type: 'collect', item: 'apple', count: 5 },\n                        { text: 'Knock back 10 birds', type: 'knockback', count: 10 },\n                        { text: 'Complete the Omamori ritual', type: 'ritual' }\n                    ]\n                };\n                this.survivalStats.currentObjective = this.survivalStats.objectives[0];\n                this.updateSurvivalHUD();\n                \n                // Hide main site animations to save GPU compositing\n                const petalCanvas = document.getElementById('petalCanvas');\n                if (petalCanvas) (petalCanvas as HTMLElement).style.display = 'none';\n                \n                // Hide flame particles container\n                const flameParticles = document.getElementById('flameParticles');\n                if (flameParticles) (flameParticles as HTMLElement).style.visibility = 'hidden';\n                \n                // Lock page scrolling while game is active\n                (document.body as HTMLElement).style.overflow = 'hidden';\n                (document.documentElement as HTMLElement).style.overflow = 'hidden';\n                \n                // Show click-to-play - user must click to lock pointer\n                document.getElementById('clickToPlay').classList.add('active');\n                \n                // Start game loop (cancel any existing one first)\n                if (this.gameLoopId) {\n                    cancelAnimationFrame(this.gameLoopId);\n                }\n                \n                // Force hotbar refresh with delay to ensure DOM is ready\n                setTimeout(() => {\n                    this.updateHotbarDisplay();\n                    this.updateHotbar();\n                }, 50);\n                \n                this.gameLoop();\n            },\n            \n            pause() {\n                if (!this.isActive) return;\n                this.isPaused = true;\n                document.getElementById('pauseMenu').classList.add('active');\n                document.getElementById('gameUI').style.display = 'none';\n                document.getElementById('clickToPlay').classList.remove('active');\n                this.showSubmenu('menuMain');\n                \n                // Exit pointer lock if still locked\n                if (document.pointerLockElement) {\n                    document.exitPointerLock();\n                }\n            },\n            \n            resume() {\n                this.isPaused = false;\n                document.getElementById('pauseMenu').classList.remove('active');\n                document.getElementById('gameUI').style.display = 'flex';\n                \n                // Must show click-to-play because we need a new user gesture to re-lock\n                // (Browser security: can't re-lock immediately after ESC release)\n                document.getElementById('clickToPlay').classList.add('active');\n            },\n            \n            updateFullscreenButton() {\n                const btn = document.getElementById('btnFullscreen');\n                const isFs = document.fullscreenElement || document.webkitFullscreenElement;\n                btn.textContent = isFs ? 'Windowed' : 'Fullscreen';\n                \n                // Update canvas size based on fullscreen state\n                if (isFs) {\n                    this.canvas.width = window.innerWidth;\n                    this.canvas.height = window.innerHeight;\n                } else {\n                    this.canvas.width = 800;\n                    this.canvas.height = 450;\n                }\n            },\n            \n            stop() {\n                // Cancel any pending animation frame\n                if (this.gameLoopId) {\n                    cancelAnimationFrame(this.gameLoopId);\n                    this.gameLoopId = null;\n                }\n                \n                this.isActive = false;\n                this.isPaused = false;\n                this.pointerLocked = false;\n                \n                // Clear runtime resources to free memory\n                this.particles = [];\n                this.fluidUpdates = [];\n                this.fluidUpdateTimer = 0;\n                this.birdPruneTimer = 0;\n                this.inWater = false;\n                this.inLava = false;\n                this.swimming = false;\n                this.headSubmergedWater = false;\n                this.headSubmergedLava = false;\n                \n                // Reset pest bird anger (calm down for next session)\n                if (this.pestBirds) {\n                    for (const pest of this.pestBirds) {\n                        pest.anger = 0;\n                        pest.timesShot = 0;\n                        pest.state = 'circling';\n                    }\n                }\n                \n                // Reset canvas\n                this.canvas.width = 800;\n                this.canvas.height = 450;\n                \n                // Clear the canvas to free GPU memory\n                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n                \n                // Hide UI elements\n                document.getElementById('minecraftGame').classList.remove('active');\n                document.getElementById('pauseMenu').classList.remove('active');\n                document.getElementById('clickToPlay').classList.remove('active');\n                document.getElementById('inventoryScreen').classList.remove('active');\n                this.inventoryOpen = false;\n                (this.canvas as HTMLElement).style.filter = '';\n                \n                // Exit pointer lock\n                if (document.pointerLockElement) {\n                    document.exitPointerLock();\n                }\n                \n                // Exit fullscreen if active\n                if (document.fullscreenElement || document.webkitFullscreenElement) {\n                    if (document.exitFullscreen) {\n                        document.exitFullscreen();\n                    } else if (document.webkitExitFullscreen) {\n                        document.webkitExitFullscreen();\n                    }\n                }\n                \n                // Reset key states to prevent stuck keys\n                this.keys = {};\n                \n                // Unlock page scrolling\n                (document.body as HTMLElement).style.overflow = '';\n                (document.documentElement as HTMLElement).style.overflow = '';\n                \n                // Restore main site animations\n                const petalCanvas = document.getElementById('petalCanvas');\n                if (petalCanvas) (petalCanvas as HTMLElement).style.display = 'block';\n                \n                // Show flame particles container\n                const flameParticles = document.getElementById('flameParticles');\n                if (flameParticles) (flameParticles as HTMLElement).style.visibility = 'visible';\n            }\n};\n\n/**\n * SakuraCraftGame Class\n * Provides a typed class-based interface to the game\n */\nexport class SakuraCraftGame {\n  private _game: ISakuraCraftEngine & Record<string, any>;\n  private _initialized: boolean;\n\n  constructor() {\n    this._game = minecraftGame;\n    this._initialized = false;\n  }\n\n  /**\n   * Initialize the game with options\n   */\n  init(options: SakuraCraftInitOptions = {}): this {\n    // Inject HTML if not present\n    if (!document.getElementById('minecraftGame')) {\n      let container: HTMLElement = document.body;\n      if (options.container) {\n        container = typeof options.container === 'string'\n          ? (document.querySelector(options.container) as HTMLElement) || document.body\n          : options.container;\n      }\n      injectGameHTML(container);\n    }\n    \n    // Initialize the game engine\n    this._game.init();\n    this._initialized = true;\n    \n    // Setup trigger element\n    if (options.trigger) {\n      const triggerEl = typeof options.trigger === 'string'\n        ? document.querySelector(options.trigger) as HTMLElement | null\n        : options.trigger;\n      if (triggerEl) {\n        triggerEl.addEventListener('click', () => this.start());\n        (triggerEl as HTMLElement).style.cursor = 'pointer';\n      }\n    }\n    \n    // Setup close button\n    document.getElementById('closeMinecraft')?.addEventListener('click', () => this.stop());\n    \n    // Setup click to play\n    document.getElementById('clickToPlay')?.addEventListener('click', () => {\n      if (this._game.isActive && !this._game.isPaused && this._game.canvas) {\n        this._game.canvas.requestPointerLock();\n      }\n    });\n    \n    // Cleanup on page unload\n    window.addEventListener('beforeunload', () => {\n      if (this._game.isActive) this.stop();\n    });\n    \n    return this;\n  }\n\n  /**\n   * Start the game\n   */\n  start(): this {\n    if (!this._initialized) {\n      this.init();\n    }\n    this._game.start();\n    return this;\n  }\n\n  /**\n   * Stop the game\n   */\n  stop(): this {\n    this._game.stop();\n    return this;\n  }\n\n  /**\n   * Pause the game\n   */\n  pause(): this {\n    this._game.pause();\n    return this;\n  }\n\n  /**\n   * Resume the game\n   */\n  resume(): this {\n    this._game.resume();\n    return this;\n  }\n\n  /**\n   * Get game stats\n   */\n  getStats(): GameStats {\n    return { ...this._game.stats };\n  }\n\n  /**\n   * Get game settings\n   */\n  get settings(): GameSettings {\n    return this._game.settings;\n  }\n\n  /**\n   * Update game settings\n   */\n  set settings(value: Partial<GameSettings>) {\n    Object.assign(this._game.settings, value);\n  }\n\n  /**\n   * Check if game is active\n   */\n  get isActive(): boolean {\n    return this._game.isActive;\n  }\n\n  /**\n   * Check if game is paused\n   */\n  get isPaused(): boolean {\n    return this._game.isPaused;\n  }\n\n  /**\n   * Get the underlying game engine for advanced usage\n   */\n  get engine(): ISakuraCraftEngine & Record<string, any> {\n    return this._game;\n  }\n}\n\n// Default export\nexport default SakuraCraftGame;\n","/**\n * SakuraCraft - A voxel-based browser game with cherry blossom aesthetics\n * \n * @module SakuraCraft\n * @example\n * // ES Module usage\n * import SakuraCraft from 'sakuracraft';\n * const game = new SakuraCraft();\n * game.init({ trigger: '#playButton' });\n */\n\nimport { SakuraCraftGame, minecraftGame } from './game/SakuraCraftGame';\n\n// Re-export types\nexport type * from './types';\n\n// Export the game class and raw engine\nexport { SakuraCraftGame, minecraftGame };\n\n// Default export is the class\nexport default SakuraCraftGame;\n\n// Auto-expose to window in browser context\ndeclare global {\n  interface Window {\n    SakuraCraft: typeof SakuraCraftGame;\n    SakuraCraftGame: typeof SakuraCraftGame;\n    sakuraCraft?: SakuraCraftGame;\n  }\n}\n\nif (typeof window !== 'undefined') {\n  window.SakuraCraft = SakuraCraftGame;\n  window.SakuraCraftGame = SakuraCraftGame;\n  \n  // Auto-initialize if script has data-auto-init attribute\n  const currentScript = document.currentScript as HTMLScriptElement | null;\n  if (currentScript?.hasAttribute('data-auto-init')) {\n    const trigger = currentScript.getAttribute('data-trigger');\n    document.addEventListener('DOMContentLoaded', () => {\n      const game = new SakuraCraftGame();\n      game.init({ trigger: trigger ?? undefined });\n      window.sakuraCraft = game;\n    });\n  }\n}\n"],"names":["gameTemplate","injectGameHTML","container","wrapper","minecraftGame","perm","fade","t","lerp","a","b","grad","hash","x","y","h","u","v","X","Y","A","B","octaves","value","amplitude","frequency","maxValue","i","worldSize","waterLevel","baseHeight","heightMap","biomeMap","z","n1","n2","distFromCenter","edgeFalloff","height","key","biomeNoise","isBeach","isDesert","treeX","treeZ","ritualChestCount","rx","rz","rKey","rHeight","ritualItem","sx","sz","sKey","sHeight","tree","appleCount","templeX","templeZ","templeKey","templeHeight","buildingTypes","wcdonaldsPlaced","qx","qz","minX","minZ","numBuildings","bx","bz","attempts","bounds","groundY","block","h1","h2","h3","h4","type","baseY","dx","dz","dy","steepleX","steepleZ","crossY","row","existingBlock","wX","wZ","wY","chestKey","radius","by","blockX","blockY","blockZ","width","depth","centerX","centerZ","searchRadius","angle","testX","testZ","numBirds","numPests","playerX","playerY","playerZ","birdsCalmed","pest","angerWingBonus","angerSpeedMult","angerRadiusMult","angerSwoopChance","prevX","prevY","prevZ","birdBlock","speed","recoveryThreshold","numToSpawn","newAngle","newRadius","swoopT","pullT","retreatDist","hoverAngle","targetX","targetY","targetZ","smoothing","maxBirdSpeed","moveSpeed","scale","bird","dist","newX","newY","newZ","fish","cat","safeMinX","safeMaxX","safeMinZ","safeMaxZ","spawnX","spawnY","spawnZ","foundValidSpawn","maxAttempts","blockType","air1","air2","air3","blockBelow","npc","distToPlayer","creeper","force","roll","dropType","dropCount","now","delta","timeLeft","nextEvent","message","event","numCreepers","waterPos","scoreEl","waveEl","objEl","cx","cz","slotIdx","slot","hit","isChest","contents","item","hitBlock","heldSlot","heldId","fluidType","placePos","px","pz","feetY","headY","wouldCollide","checkY","itemNames","itemId","itemName","index","e","invSlot","err","id","toggle","isOn","fps","menuId","m","elapsed","mins","secs","filter","isSelected","canvas","durBar","fill","percent","pitch","yaw","dirX","dirY","dirZ","bulletSpeed","bullet","knockbackForce","hitBird","hitDist","birdDirX","birdDirY","birdDirZ","ricochetSpeed","ry","len","playerKnockback","toBirdX","toBirdZ","toBirdDist","spawnRoll","birdsToSpawn","p","j","gustStrength","gustAngle","currentPetals","maxPetals","petalsToSpawn","spawnRange","spawnChance","spreadX","spreadZ","heightBonus","count","itemType","canAdd","itemDef","notification","ctx","colors","w","cy","size","sy","blockSize","topColor","sideColor","rightColor","bobPhase","rotation","s","cosPitch","sinPitch","hasItems","socketType","socketItemMap","filledSocketMap","requiredItem","socket","itemCount","consoleEl","output","input","suggestions","self","debugConsole","debugInput","debugSuggestions","header","isDragging","currentX","currentY","initialX","initialY","computedStyle","xOffset","yOffset","isResizing","resizeEdge","startWidth","startHeight","startX","startY","startLeft","startTop","handleMouseMove","newWidth","newHeight","newLeft","newTop","maxX","maxY","clampedX","clampedY","rect","edge","atTop","atBottom","atLeft","atRight","inputContainer","commands","selectedSuggestionIndex","currentSuggestions","showSuggestions","query","suggestionsEl","cmd","selectSuggestion","applySuggestion","testSuggestions","msg","div","parts","command","args","landmark","mobType","spawnCount","validMobs","totalKilled","time","outputEl","subcommand","newState","algoType","descriptions","miniCanvas","level","maxUpdates","processed","fluid","currentBlock","currentLevel","belowBlock","spreadLevel","directions","dir","nx","nz","neighborBlock","neighborLevel","invScreen","seedCount","REPAIR_COST","repairedSomething","npcType","dialogue","clickToPlay","journal","dialogueHTML","stage","npcName","options","choice","questDialogue","journalHTML","html","activeQuests","q","quest","obj","completedQuests","getItemName","recipe","canCraft","ing","emoji","hasItem","isHeld","tooltip","slots","invContainer","scrollTop","scrollHeight","clientHeight","source","clickedItem","targetSource","targetIndex","newContainer","srcType","srcIdx","destType","destIdx","srcArray","destArray","srcItem","destItem","currentSlot","ingredient","recipeName","r","remaining","remove","add","cosYaw","voxelX","voxelY","voxelZ","stepX","stepY","stepZ","tDeltaX","tDeltaY","tDeltaZ","tMaxX","tMaxY","tMaxZ","enteredFace","maxDistance","lastSolidFace","throughWater","throughLava","placeFace","baseSpeed","sin","cos","moveX","moveY","moveZ","canMove","playerFeetY","playerHeadY","feetBlock","waistBlock","headBlock","feetInWater","feetInLava","waistInWater","waistInLava","headInWater","headInLava","inWater","inLava","swimming","submerged","speedMod","walkSpeed","oldX","oldZ","playerRadius","playerHeight","escaped","pushDist","escapeAngles","rad","finalX","finalZ","steps","slideX","slideZ","buoyancy","swimDrag","swimUpSpeed","swimDownSpeed","maxSwimSpeed","ceilingY","checkPoints","point","renderCamY","skyGrad","camX","camY","camZ","cosY","sinY","cosX","sinX","halfW","halfH","fov","renderDist","renderDistSq","project","blocks","camDirX","camDirZ","worldKeys","distSq","getBlock","isTransparent","blockProps","shouldHideFace","currentType","adjacentType","getFluidLevel","animTime","opaqueBlocks","transparentBlocks","isBlockOccluded","testPoints","py","pointOccluded","checkX","checkZ","checkBlock","blockColors","visibleTransparent","allBlocks","algorithm","distDiff","corners","minDist","buildBSPTree","minY","maxZ","rangeX","rangeY","rangeZ","axis","mid","pivot","front","back","traverseBSP","node","result","bspTree","sortedBlocks","isFluid","fluidLevel","topY","adjTop","adjBottom","adjFront","adjBack","adjLeft","adjRight","hasTop","hasBottom","hasFront","hasBack","hasLeft","hasRight","myLevel","frontLevel","backLevel","leftLevel","rightLevel","faces","facesWithDist","face","centerY","f","pts","valid","fillColor","wave1","wave2","wave3","combinedWave","viewDotNormal","F0","fresnel","playerReflection","playerDx","playerDz","playerDistToWater","skyColors","skyIndex","sky","depthFactor","waterR","waterG","waterB","playerColor","reflectStrength","g","sunDir","viewDir","halfVec","halfLen","specularBase","specular","caustic1","caustic2","caustics","brightness","finalR","finalG","finalB","baseAlpha","fresnelAlpha","alpha","glowPhase","glow","faceType","baseFillColor","match","texture","startProj","endProj","centerProj","text","normals","normal","projected","c","edges","segmentSize","walls","wall","distToWall","minRenderY","perpStart","perpEnd","segX","segZ","yTop","pEnd","pt","segCenterX","segCenterY","segCenterZ","occluded","gridPhase","bottomY","xEnd","zEnd","center","screenSize","wingAngle","wingSpan","wingHeight","anger","angerRed","angerGreen","angerBlue","isSwooping","bodyColor","wingColor","swimOffset","walkBob","started","tp","bulletSize","sparkle","flicker","bobOffset","baseSize","strokeColor","lineWidth","targetBlock","pulse","alertWidth","alertHeight","alertX","alertY","minutes","seconds","timeStr","baseX","flashSize","flashX","flashY","age","fadeStart","fadeDuration","fontSize","tooltipX","tooltipY","flameHeight","flameWidth","gradient","screenX","screenY","info","isFilled","lookDownAmount","bodyY","handX","handY","lookAmount","armGradient","armGradient2","jeansGradient","baseColor","base","color","random","seed","noise","noise1","noise2","combined","offset","col","ring","waveOffset","wave","pattern","hex","factor","timestamp","targetInterval","debugFps","algoName","algoColors","ts","spawnPos","isSpawnSafe","hasRoof","nearStructure","bodyBlock","feetClear","bodyClear","groundBlock","isDryLand","isFlat","adjGroundY","adjBlock","bestSpawn","maxRadius","spawn","petalCanvas","flameParticles","btn","isFs","SakuraCraftGame","__publicField","_a","_b","triggerEl","currentScript","trigger","game"],"mappings":"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"}